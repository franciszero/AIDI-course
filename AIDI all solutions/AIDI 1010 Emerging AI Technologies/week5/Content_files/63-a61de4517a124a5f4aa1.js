(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{"8VoP":function(e,t,s){"use strict";(function(e){s.d(t,"b",(function(){return b})),s.d(t,"a",(function(){return m}));var a=s("0JpG"),r=s("Qbdf"),o=s("AI52"),n=s("Q/M7"),i=s("lEL+"),c=s("jhBu"),l=s("E4Qo"),u=s("GbAM"),d=s("Sa5G"),p=s("inG1"),h=s("Y+9S");const b="ultra.course.exports.controller";class x{constructor(t,s,a,r,o,n,i){this.$scope=t,this.exportService=s,this.$modal=a,this.bbLocalize=r,this.timeout=o,this.contextCourse=n,this.entitlementService=i,this.changeListViewTypeFn=e=>{this.updateDisplayedPackageList(Number(e),this.currentPage)},this.changeCurrentPage=e=>{this.updateDisplayedPackageList(this.currentTabId,e)},t.courseExport=this,this.currentCourse=t.course.model,this.courseId=this.contextCourse.courseId,this.canExport=this.currentCourse.canExport(),this.canArchive=this.currentCourse.canArchive(),this.canViewAutoArchive=this.currentCourse.canViewAutoArchive(),this.exportModalTitleKey=this.currentCourse.isOrganization?"organization.export.modal.modalTitle":"course.export.modal.modalTitle",this.getExportsAndScheduledTasks(!0),t.$on("update-course-exports",(()=>{this.getExportsAndScheduledTasks(!1),this.timeout((()=>{const t=e(".list-archive-export li:last .file-name").text().trim();this.$scope.$root.$broadcast(u.a,this.exportFileAddedNotification(t)),e(".list-archive-export li:last > .file-link").focus()}),this.$scope,1e3)})),this.currentTabId=0,this.currentPage=0,this.itemsPerPage=20}updateDisplayedPackageList(e,t){this.currentTabId=e,this.currentPage=t,this.currentTabId===p.a.USER_CREATED&&this.userCreatedExports&&(this.courseExports=this.userCreatedExports.slice(this.currentPage*this.itemsPerPage,(this.currentPage+1)*this.itemsPerPage),this.numberOfPages=Math.ceil(this.userCreatedExports.length/this.itemsPerPage)),this.currentTabId===p.a.AUTOMATIC_CREATED&&this.automaticallyCreatedExports&&(this.courseExports=this.automaticallyCreatedExports.slice(this.currentPage*this.itemsPerPage,(this.currentPage+1)*this.itemsPerPage),this.numberOfPages=Math.ceil(this.automaticallyCreatedExports.length/this.itemsPerPage))}getLocalizedCount(e){if(!this.userCreatedExports)return"--";const t=this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:"course.export.exportPanel.ninetyNinePlus",noWrap:!0});if(e===p.a.USER_CREATED){const e=this.bbLocalize.formatNumberSync(this.userCreatedExports.length,this.$scope);return this.userCreatedExports.length>99?t:e}if(e===p.a.AUTOMATIC_CREATED){const e=this.bbLocalize.formatNumberSync(this.automaticallyCreatedExports.length,this.$scope);return this.automaticallyCreatedExports.length>99?t:e}}getUserCreatedCount(){return this.getLocalizedCount(p.a.USER_CREATED)}getAutomaticCreatedCount(){return this.getLocalizedCount(p.a.AUTOMATIC_CREATED)}getUserCanSeeAutomaticCreatedPackages(){return this.canViewAutoArchive||this.entitlementService.isEntitled(d.k.CourseExportArchiveWithPassword,this.currentCourse.id)}filterPackageList(e,t){return t?e.filter((e=>!e.cxFileId.startsWith(this.currentCourse.courseId+"__"))):e.filter((e=>e.cxFileId.startsWith(this.currentCourse.courseId+"__")))}sortPackageListByCreationDate(e){return e.sort(((e,t)=>t.createDate.getTime()-e.createDate.getTime()))}updatePackageLists(e){this.userCreatedExports=this.sortPackageListByCreationDate(this.filterPackageList(e.courseExports,!0)),this.automaticallyCreatedExports=this.sortPackageListByCreationDate(this.filterPackageList(e.courseExports,!1)),this.updateDisplayedPackageList(this.currentTabId,this.currentPage),this.scheduledTasks=e.scheduledTasks}getExportsAndScheduledTasks(e){this.exportService.getExportsAndScheduledTasks(this.courseId,this.currentCourse.courseId,e,this.canExport,this.canArchive).then((e=>{this.updatePackageLists(e)}))}openExportModal(){!this.canExport||this.canArchive?!this.canArchive||this.canExport?this.modalInstance=this.$modal.open({template:l,scope:this.$scope,resolve:{translations:[a.serviceName,e=>e.loadBundle("features/course/exports/course-export")]}}):this.exportService.createExportTask(!0,this.courseId).then((e=>{this.updatePackageLists(e),this.$scope.$emit("start-task-status-check")})):this.exportService.createExportTask(!1,this.courseId).then((e=>{this.updatePackageLists(e),this.$scope.$emit("start-task-status-check")}))}notifyMobileAppOnDownload(){Object(h.o)(h.c.DownloadLinkClicked)}exportFileAddedNotification(e){return this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:"course.export.aria-label.file-added",params:{fileName:e},noWrap:!0})}exportProgressNotification(){return this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:"course.export.aria-label.export-in-progress",noWrap:!0})}triggerCourseExport(e){this.modalInstance.dismiss(),this.exportService.createExportTask(e,this.courseId).then((e=>{this.updatePackageLists(e),this.$scope.$emit("start-task-status-check"),this.timeout((()=>{this.$scope.$root.$broadcast(u.a,this.exportProgressNotification())}),this.$scope,1e3)}))}deleteCourseExport(e){this.exportService.deleteCourseExport(e,this.courseId).then((e=>{this.updatePackageLists(e)}))}deleteExportTask(e){this.exportService.deleteScheduledTask(e,this.courseId).then((e=>{this.updatePackageLists(e)}))}getAbsoluteUrl(e){return n.c(e)}}x.$inject=["$scope",o.b,"$modal",a.serviceName,i.b,r.e,c.b];class m extends x{}}).call(this,s("71td"))},AI52:function(e,t,s){"use strict";s.d(t,"a",(function(){return n})),s.d(t,"b",(function(){return i}));var a=s("nsO7"),r=s("Llzl"),o=s("pjml");const n="ultra.service.course.export",i="courseExport";class c{constructor(e,t,s,a){this.CourseModel=e,this.ScheduledTaskModel=t,this.$modal=s,this.$q=a,this.exportsAndScheduledTasksByCourseId={},this.permissionsByCourseId={}}getExportsAndScheduledTasks(e,t,s,a,r){const o=this.$q.defer();return e&&t&&(a||r)&&(!this.exportsAndScheduledTasksByCourseId[e]||s?this.populateCourseExportsAndScheduledTasks(e,t,a,r).then((t=>{this.exportsAndScheduledTasksByCourseId[e]={courseExports:t[0],scheduledTasks:t[1]},o.resolve(this.exportsAndScheduledTasksByCourseId[e])})):o.resolve(this.exportsAndScheduledTasksByCourseId[e])),o.promise}createExportTask(e,t){const s=this.$q.defer();if(t){const a={cxAction:e?"CX_ACTION_ARCHIVE":"CX_ACTION_EXPORT"};this.CourseModel.$new(t).exports.$build(a).$save().$then((e=>{this.ScheduledTaskModel.$find(e.taskId).$then((e=>{this.exportsAndScheduledTasksByCourseId[t].scheduledTasks.push(e),s.resolve(this.exportsAndScheduledTasksByCourseId[t])}))}))}return s.promise}deleteCourseExport(e,t){const s=this.$q.defer();return t&&this.CourseModel.$new(t).exports.$new(e.cxFileId).$destroy().$then((()=>{a.remove(this.exportsAndScheduledTasksByCourseId[t].courseExports,(t=>t.cxFileId===e.cxFileId)),s.resolve(this.exportsAndScheduledTasksByCourseId[t])})),s.promise}deleteScheduledTask(e,t){const s=this.$q.defer();return t&&this.ScheduledTaskModel.$new(e.taskId).$destroy().$then((()=>{a.remove(this.exportsAndScheduledTasksByCourseId[t].scheduledTasks,(t=>t.taskId===e.taskId)),s.resolve(this.exportsAndScheduledTasksByCourseId[t])})),s.promise}populateCourseExportsAndScheduledTasks(e,t,s,a){return this.$q.all([this.getCourseExports(e),this.getScheduledTasks(t,s,a)])}getCourseExports(e){return this.CourseModel.$new(e).exports.$refresh().$asPromise()}getScheduledTasks(e,t,s){let a="";if(t||s){t&&(a+="EXPORT"),s&&(""!==a&&(a+=","),a+="ARCHIVE");const r={filterBy:"cxTasks",courseId:e,groupStatus:"INPROGRESS",operation:a};return this.ScheduledTaskModel.$collection().$refresh(r).$asPromise()}}}c.$inject=[o.m.serviceName,o.nb.serviceName,"$modal","$q"];r.module(n,[o.N]).service(i,c)},E4Qo:function(e,t){e.exports='<bb-modal id="notification-modal"\n          class="notification"\n          modal-title-key="{{::courseExport.exportModalTitleKey}}"\n          analytics-id-tag-prefix="course.export.modal.startArchive">\n  <div name="modal-contents">\n    <p bb-translate="course.export.modal.modalText" course-org-token-resolver></p>\n  </div>\n  <button name="modal-footer-button-primary" \n          class="close-modal-export js-export-without-student-data button js-primary-button" \n          ng-click="courseExport.triggerCourseExport(false)"\n          analytics-id="course.export.modal.startExport.button">\n    <span bb-translate="course.export.modal.startExport"></span>\n  </button>\n  <button name="modal-footer-button-secondary" \n          class="close-modal-export js-export-with-student-data button button--secondary js-secondary-button" \n          ng-click="courseExport.triggerCourseExport(true)"\n          analytics-id="course.export.modal.startArchive.button">\n    <span bb-translate="course.export.modal.startArchive"></span>\n  </button>\n</bb-modal>'},EACR:function(e,t,s){var a=s("ziER"),r=s("5JeM"),o=new a({id:"icon-medium-export",use:"icon-medium-export-usage",viewBox:"0 0 24 24",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-medium-export"><g clip-path="url(#icon-medium-export_clip0)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 1L9 15M17 1h6v6M23 14v9H1V1h10" /></g><defs><clipPath id="icon-medium-export_clip0"><path fill="#fff" d="M0 0h24v24H0z" /></clipPath></defs></symbol>'});r.add(o);e.exports=o},asT1:function(e,t){e.exports='<div id="panel-export" bb-load-bundle="features/course/exports/course-export" bb-cache-compilation="course-exports">\n  <div class="panel-wrap">\n    <header class="panel-header simple-header">\n      <div class="panel-titles-container">\n        \x3c!-- sub-title should be according to course --\x3e\n        <div class="panel-sub-title">({{::course.model.displayId + \' \\u2022 \' + course.model.displayName}})</div>\n        <div class="black-header-contents">\n          <button class="left-off-canvas-toggle menu-toggle standard-button dark-background"\n                  analytics-id="course.export.exportPanel.base.menu.button">\n            <bb-svg-icon size="small" icon="main-menu"></bb-svg-icon>\n            <span class="sr-only" bb-translate>base.menu</span>\n          </button>\n          <h1 class="panel-title" bb-translate="course.export.exportPanel.head"></h1>\n        </div>\n      </div>\n    </header>\n    <div class="panel-content">\n      <div class="com-export-package">\n        <header>\n          <span class="title" bb-translate="course.export.exportPanel.title"></span>\n          <button id="add-export-package"\n                  class="anchor btn-export"\n                  ng-if="courseExport.scheduledTasks.length === 0"\n                  ng-click="courseExport.openExportModal()"\n                  bb-translate-attrs="{\'aria-label\':\'course.export.aria-label.add-export-package\'}"\n                  analytics-id="course.export.exportPanel.openExportModal.button">\n            <bb-svg-icon size="medium" icon="export"></bb-svg-icon>\n          </button>\n          <div class="expiry-info">\n            <bb-ui-icon-medium-information size="medium" icon="information"></bb-ui-icon-medium-information>\n            <span class="expiry-text" bb-translate="course.export.exportPanel.expiryWarning"></span>\n          </div>\n        </header>\n\n        <div class="course-export-tabs">\n          <bb-course-export-tabs\n            user-created-count="courseExport.getUserCreatedCount()"\n            automatic-created-count="courseExport.getAutomaticCreatedCount()"\n            selected-tab="courseExport.currentTabId"\n            show-automatic-packages="courseExport.getUserCanSeeAutomaticCreatedPackages()"\n            on-tab-changed="courseExport.changeListViewTypeFn">\n          </bb-course-export-tabs>\n        </div>\n        <ul class="list-export-tasks">\n          <li class="in-progress" task-id="{{exportTask.taskId}}" ng-repeat="exportTask in courseExport.scheduledTasks">\n            <div class="export-progress">\n              <span class="description-progress">\n                <div class="spinner bb-secondary-color-2" aria-hidden="true"></div>\n                <span bb-translate="course.export.exportPanel.inProgress"></span>\n                <span class="progress-status" ng-if="exportTask.startDate != null" aria-live="polite">\n                  <span bb-translate="course.export.exportPanel.started"></span>\n                  <bb-date format="Short">exportTask.startDate</bb-date>\n                </span>\n                <span class="progress-status" ng-if="exportTask.startDate == null" aria-live="polite">\n                  <span bb-translate="course.export.exportPanel.justStarted"></span>\n                </span>\n              </span>\n              <button class="anchor cancel-export"\n                      ng-if="exportTask.permissions.delete && false"\n                      ng-click="courseExport.deleteExportTask(exportTask)"\n                      bb-translate-attrs="{\'aria-label\':\'course.export.aria-label.delete-in-progress\'}"\n                      analytics-id="course.export.exportPanel.cancelExport.button">\n                <bb-svg-icon size="small" icon="add"></bb-svg-icon>\n              </button>\n            </div>\n          </li>\n        </ul>\n        <ul class="list-archive-export" id="list-archive-export">\n          <li class="completed" ng-repeat="completeTask in courseExport.courseExports">\n            <a class="file-link"\n               ng-click="courseExport.notifyMobileAppOnDownload()"\n               ng-href="{{courseExport.getAbsoluteUrl(completeTask.openUrl)}}"\n               analytics-id="course.export.exportPanel.completedTask.url.link"\n               id="{{completeTask.cxFileId}}">\n              <bb-ui-icon-large-zip color="primary"></bb-ui-icon-large-zip>\n              <span class="description" aria-describedby="{{completeTask.cxFileId}}">\n                <span class="file-name">{{::completeTask.cxFileId}}.zip</span>\n                <span class="date-created" ng-if="courseExport.currentTabId == 0">\n                  <span bb-translate="course.export.exportPanel.available"></span> - <bb-date format="Short">completeTask.expiryDate</bb-date>\n                </span>\n                <span class="date-created" ng-if="courseExport.currentTabId == 1">\n                  <span bb-translate="course.export.exportPanel.created"></span> - <bb-date format="Short">completeTask.createDate</bb-date>\n                </span>\n              </span>\n            </a>\n            <a href="javascript:void(0);"\n               class="file-delete js-delete-archive"\n               bb-confirmation-needed="resource/x-bb-course-archive"\n               show-type="always"\n               ng-click="courseExport.deleteCourseExport(completeTask)"\n               ng-hide="completeTask.isAutoArchive"\n               role="button"\n               confirmation-course-org-token-resolver\n               bb-translate-attrs="{\'aria-label\':\'course.export.aria-label.delete-completed\'}"\n               translate-attrs-values="{\'fileName\': completeTask.cxFileId + \'.zip\'}"\n               analytics-id="course.export.exportPanel.deleteCourseExport.link">\n              <bb-svg-icon size="small" icon="trash"></bb-svg-icon>\n            </a>\n          </li>\n        </ul>\n      </div>\n      <div class="paginator">\n        <bb-paging-selector\n          page="courseExport.currentPage"\n          number-of-pages="courseExport.numberOfPages"\n          on-page-change="courseExport.changeCurrentPage"\n          compact="true"\n          ng-if="courseExport.numberOfPages > 0"\n          class-name="course-export-paginator"\n          analytics-id="course.export.exportPanel.paginator"\n        />\n      </div>\n    </div>\n    \x3c!-- End: com-export-package --\x3e\n  </div>\n</div>\n'},inG1:function(e,t,s){"use strict";var a;s.d(t,"a",(function(){return a})),function(e){e[e.USER_CREATED=0]="USER_CREATED",e[e.AUTOMATIC_CREATED=1]="AUTOMATIC_CREATED"}(a||(a={}))},"m+3A":function(e,t,s){"use strict";s.r(t);s("JzsJ"),s("VCKY"),s("GkCm"),s("dV61"),s("EACR");var a=s("Llzl"),r=s("TB6y"),o=s("Fvsw"),n=s("8VoP"),i=s("AI52"),c=s("ZzYr"),l=s("CPVT"),u=s("jT78"),d=s("ERkP"),p=s("1ZbL"),h=s("C+e0"),b=s("tN4z");const x="ultra.components.directives.react-toolkit.course-export-tabs-component",m={Class:Object(h.a)((e=>{const{userCreatedCount:t,automaticCreatedCount:s,showAutomaticPackages:a,onChange:r,localize:o}=e,[n,i]=d.useState(0),c=d.useCallback(((e,t)=>{i(t),r(String(t))}),[r]);return d.createElement(b.AnalyticsTabs,{value:n,onChange:c,ariaOrientation:"horizontal",analyticsId:"course.export.exportPanel.listViewTabs"},d.createElement(b.AnalyticsTab,{id:"user-created-tab",label:o.translate("course.export.exportPanel.manualCreatedSection",{amountManual:t}),"aria-controls":"list-archive-export",analyticsId:"course.export.exportPanel.listViewTab.tab-panel-manualCreatedPackages"}),a&&d.createElement(b.AnalyticsTab,{id:"automatic-created-tab",label:o.translate("course.export.exportPanel.automaticallyCreatedSection",{amountAutomatic:s}),"aria-controls":"list-archive-export",analyticsId:"course.export.exportPanel.listViewTab.tab-panel-automaticCreatedPackages"}))})),bindingNames:["userCreatedCount","automaticCreatedCount","showAutomaticPackages","onChange"],renderLocalized:!0};a.module(x,[]).component("bbCourseExportTabsBase",Object(p.a)(m));var g=s("D57K"),C=s("aHpC");const k="ultra.components.directives.react-toolkit.course-export-tabs-directive";let E=class{constructor(e){this.scope=e,this.onTabChange=e=>{this.scope.onTabChanged&&this.scope.$apply((()=>this.scope.onTabChanged(e)))}}};E=Object(g.a)([Object(g.c)(0,Object(C.b)("scope"))],E);let T=class{constructor(e){this.$injector=e,this.restrict="E",this.template='<bb-course-export-tabs-base\n                        user-created-count="courseExportTabs.scope.userCreatedCount"\n                        automatic-created-count="courseExportTabs.scope.automaticCreatedCount"\n                        show-automatic-packages="courseExportTabs.scope.showAutomaticPackages"\n                        on-change="courseExportTabs.onTabChange">\n                      </bb-course-export-tabs-base>',this.scope={onTabChanged:"<?",selectedTab:"<?",userCreatedCount:"<?",automaticCreatedCount:"<?",showAutomaticPackages:"<?"},this.link=e=>{e.courseExportTabs=this.$injector.instantiate(E,{scope:e})}}};T=Object(g.a)([Object(g.c)(0,Object(C.b)("$injector"))],T),angular.module(k,[x]).directive("bbCourseExportTabs",["$injector",e=>e.instantiate(T)]);var v=s("u3gM"),f=s("12mu"),P=s("jhBu"),A=s("zYa8"),y=s("GQY/");const I="ultra.components.directives.bbUiIcon.medium.Information";Object(A.a)(y.a,I,"bbUiIconMediumInformation");var S=s("pjml"),$=s("yXB1"),L=s("asT1");s.d(t,"moduleName",(function(){return w})),s.d(t,"controllerName",(function(){return z})),s.d(t,"template",(function(){return L}));const w="ultra.course.exports",z=n.b;a.module(w,[r.a,i.a,o.a,c.a,l.a,f.a,S.N,$.a,u.a,x,k,v.a,P.a,I]).controller(n.b,n.a)},u3gM:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var a=s("Llzl"),r=s("0JpG"),o=s("AuQm"),n=s("1ZbL");const i="ultra.components.directives.paging.panel",c={Class:o.J,attributes:["analyticsId","className"],bindingNames:["page","compact","numberOfPages","onPageChange","elementSelectorToFocus"],renderLocalized:!0};a.module(i,[r.moduleName]).component("bbPagingSelector",Object(n.a)(c))}}]);