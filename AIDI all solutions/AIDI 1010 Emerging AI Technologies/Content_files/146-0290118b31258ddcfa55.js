(window.webpackJsonp=window.webpackJsonp||[]).push([[146],{"9hVN":function(e,t,s){"use strict";s.d(t,"a",(function(){return h})),s.d(t,"b",(function(){return u}));var i=s("D57K"),r=s("Llzl"),n=s("sgjL"),a=s("TnpK"),o=s("lEL+"),c=s("nmzr"),l=s("g66W"),d=s("aHpC");const h="ultraUi.components.services.contentCollection",u="ContentCollection";let m=class{constructor(e,t,s,i){this.$q=e,this.postMessageDispatcherService=t,this.stateService=s,this.timeoutService=i}handleContentCollectionResponse(e,t=null){this.postMessageDispatcherService.registerEventHandler("classic-picker-cancel",((t,s)=>{this.timeoutService((()=>{l.d(this.stateService.current.name,"peek.content-collection-picker")&&this.stateService.leavePeekState(this.stateService.current.name),window!==s&&s.close()}),e,0)}),e),this.postMessageDispatcherService.registerEventHandler("classic-picker-submit",((s,i)=>{this.timeoutService((()=>{t?e.$emit("bb-bbml-editor-add-from-content-collection",t,s.items):this.getCcFilesDeferred.resolve(s.items),l.d(this.stateService.current.name,"peek.content-collection-picker")&&this.stateService.leavePeekState(this.stateService.current.name),window!==i&&i.close()}),e,0)}),e,!0)}getOpenContentCollectionFunction(e){return t=>{this.handleContentCollectionResponse(e),this.getCcFilesDeferred=this.$q.defer(),this.getCcFilesDeferred.promise.then((e=>{t(e)})),this.stateService.goPeekState(c.h.CONTENT_COLLECTION_PICKER,{pickerType:"File",multi:"true"})}}};m=Object(i.a)([Object(i.c)(0,Object(d.b)("$q")),Object(i.c)(1,Object(d.b)(n.b)),Object(i.c)(2,Object(d.b)(a.d)),Object(i.c)(3,Object(d.b)(o.b))],m),r.module(h,[]).service(u,m)},BXQP:function(e,t){e.exports='<div class="timestamp" bb-load-bundle="components/directives/duration" ng-cloak bb-cache-compilation="duration-directive">\n  <div ng-if="!duration.needAgo()">\n    <div class="js-split-datetime" ng-if="duration.separateDatetime()">\n      <span class="date" ng-bind="duration.date"></span>\n      <span class="time" ng-bind="duration.time"></span>\n    </div>\n    <bb-datetime ng-if="!duration.separateDatetime()" ng-class="{\'date\':duration.date}" value="date" format="Short"></bb-datetime>\n  </div>\n  <div ng-if="duration.needAgo()"\n       class="js-duration-ago"\n       bb-translate="components.directives.duration.agoText"\n       translate-values="{durationDate: duration.date, durationTime: duration.time}"></div>\n</div>'},BjFu:function(e,t,s){"use strict";s.d(t,"b",(function(){return v})),s.d(t,"c",(function(){return f})),s.d(t,"a",(function(){return C}));var i=s("D57K"),r=s("nsO7"),n=s("Llzl"),a=s("yC9S"),o=s("Fvsw"),c=s("go4a"),l=s("pjml"),d=s("zdqs"),h=s("SoDU"),u=s("fYJU"),m=s("VdDF"),p=s("aHpC"),b=s("zGdY"),g=s("KiLF");const v="ultra.service.termMembership",f="termMembership";function C(e,t=new Date){let s=e.startDate,i=e.endDate;return b.x.UseTerm===e.durationType&&e.term&&(s=e.term.startDate,i=e.term.endDate),m.a.isWithinDateRange(t,{start:s,end:i})}let S=class{constructor(e,t,s,i,r,n,o,c,l){this.$q=e,this.context=s,this.CourseModel=i,this.CourseMembershipModel=r,this.TermModel=n,this.UserModel=o,this.ExternalCourseModel=c,this.contextUser=l,a.b.OnRootScope(t,"courseUltraStatusChanged",((e,t,s)=>{this.updateCourseUltraStatus(t,s)}))}clear(){this.termsAndMemberships=void 0,this.loadPromise=void 0}getTermsAndMemberships(){return this.loadPromise?this.loadPromise:this.reloadTermsAndMemberships()}filterMemberships(e,t,s,i){return e&&Array.isArray(e)?e.filter((e=>(!e.course.isOrganization===t||!!e.course.isOrganization===s)&&(!i||i(e)))):[]}getCourseMembershipsFromArray(e,t){return this.filterMemberships(e,!0,!1,t)}getOrganizationMembershipsFromArray(e,t){return this.filterMemberships(e,!1,!0,t)}parseMembershipFromExternalCourse(e){const t=this.CourseMembershipModel.$new();return t.course=this.CourseModel.$new(),t.course.id=e.id,t.course.name=e.title,t.course.description=e.description,t.course.displayName=e.title,t.course.startDate=e.startDate,t.course.endDate=e.endDate,t.course.isAvailable=!0,t.course.durationType=b.x.DateRange,t.userId=e.userId,t.isAvailable=!0,t.userHasHidden=e.isHidden,t.courseCardColorIndex=parseInt((e.id||"0").replace(/_1$/,"").replace(/[^\d]/g,""),10),t.course.ui={courseColorClass:c.a(t),isExternal:!0,description:e.description,externalUrl:e.url},t}parseExternalCourseFromMembership(e){const t=this.ExternalCourseModel.$new(e.course.id);return t.id=e.course.id,t.title=e.course.name,t.startDate=e.course.startDate,t.endDate=e.course.endDate,t.userId=e.userId,t.description=e.course.ui.description,t.url=e.course.ui.externalUrl,t.isHidden=e.userHasHidden,t}reloadTermsAndMemberships(){const e=this.$q.defer();this.loadPromise=e.promise,this.termsAndMemberships={terms:[],termsByTermId:{},memberships:[],membershipsByTermId:{}};const t=this.context.getServerTime();return this.$q.all([this.getInternalMembership(),this.getExternalCoursesMembership(),this.updateTermsAndMemberships()]).then((([s,i])=>{this.termsAndMemberships.membershipsByTermId=Object.create(null),this.termsAndMemberships.memberships.splice(0,this.termsAndMemberships.memberships.length),(s=s.filter(((e,t,s)=>s.findIndex((t=>e.$pk===t.$pk))===t))).forEach((e=>{this.termsAndMemberships.memberships.push(e)})),i.forEach((e=>{this.termsAndMemberships.memberships.push(e)})),this.associateTermsWithCourses();const n=new h.a(this.TermModel,this.termsAndMemberships.terms);let a=new d.a(n).map(this.termsAndMemberships.memberships,t);a=this.applyStudentAvailabilityRules(a),a.forEach((e=>{const t=t=>{let s=this.termsAndMemberships.membershipsByTermId[t.id];s||(s=this.termsAndMemberships.membershipsByTermId[t.id]={memberships:[]}),s.memberships.push(e.membership)};t(e.term);const s=e.membership.course.term;!s||e.term!==n.currentTerm&&e.term!==n.upcomingTerm||t(s),this.buildTermRelationships(e)})),Object.keys(this.termsAndMemberships.membershipsByTermId).forEach((e=>{const t=this.termsAndMemberships.membershipsByTermId[e];t.memberships=r.sortBy(t.memberships,(e=>e.course.name))})),e.resolve(this.termsAndMemberships)})),this.loadPromise}getInternalMembership(){return this.contextUser.getMemberships().then((e=>(e.forEach((e=>{e.course&&(e.course.term&&(e.course.term.id=e.course.term.$pk),e.course.ui={courseColorClass:c.a(e)})})),this.getActiveMemberships(e))))}getActiveMemberships(e){return e.filter((e=>e.course&&e.isAvailable))}getExternalCoursesMembership(){return this.ExternalCourseModel.$search({limit:1e4}).$asPromise().then((e=>e.map((e=>this.parseMembershipFromExternalCourse(e)))))}updateTermsAndMemberships(){return this.TermModel.$search().$asPromise().then((e=>{this.termsAndMemberships.terms=r.orderBy(e,["startDate","durationType"],["asc","desc"]);const t=h.a.decorateTerm(new this.TermModel,l.Gb.ConstantTermId.CurrentTerm),s=h.a.decorateTerm(new this.TermModel,l.Gb.ConstantTermId.UpcomingTerm);this.termsAndMemberships.terms.push(t,s)}))}associateTermsWithCourses(){this.termsAndMemberships.memberships.forEach((e=>{e.course.term&&(e.course.term=this.termsAndMemberships.terms.find((t=>t.id===e.course.term.id)))}))}buildTermRelationships(e){const t=this.termsAndMemberships.termsByTermId[e.term.id];if(e.membership.course.term){if(e.term.id!==e.membership.course.term.id){if(!t)return void(this.termsAndMemberships.termsByTermId[e.term.id]=[e.membership.course.term]);t.indexOf(e.membership.course.term)<0&&t.push(e.membership.course.term)}}else;this.termsAndMemberships.termsByTermId[e.term.id]=r.orderBy(t,["startDate","name"],["desc","asc"])}applyStudentAvailabilityRules(e){return e.filter((e=>(e.membership.isStudentOrGuestMembership()&&e.membership.course.isUndecided()&&(e.membership.course.isAvailable=!1),!0)))}getCourseMembership(e){const t=this.findCourseMembership(e,this.termsAndMemberships.memberships);if(-1!==t)return this.termsAndMemberships.memberships[t]}findCourseMembership(e,t){return t.findIndex((t=>t.course.id===e))}updateCourseUltraStatus(e,t){let s=this.findCourseMembership(e,this.termsAndMemberships.memberships);-1!==s&&(this.termsAndMemberships.memberships[s].course.ultraStatus=t),Object.keys(this.termsAndMemberships.membershipsByTermId).forEach((i=>{s=this.findCourseMembership(e,this.termsAndMemberships.membershipsByTermId[i].memberships),-1!==s&&(this.termsAndMemberships.membershipsByTermId[i].memberships[s].course.ultraStatus=t)}))}filterAssociatedWithTermCourseMembershipsByTerm(e,t){return this.filterAssociatedWithTermCourseMemberships(e).filter((e=>e.course.term.id===t.id))}filterAssociatedWithTermCourseMemberships(e){return e.filter((e=>e.course.term&&!g.a.Continuous.isEqualTo(e.course.term.durationType)))}filterAssortedDatesCourseMemberships(e){return e.filter((e=>null==e.course.term||e.course.term&&g.a.Continuous.isEqualTo(e.course.term.durationType)))}};S=Object(i.a)([Object(i.c)(0,Object(p.b)("$q")),Object(i.c)(1,Object(p.b)("$rootScope")),Object(i.c)(2,Object(p.b)(o.b)),Object(i.c)(3,Object(p.b)(l.m.serviceName)),Object(i.c)(4,Object(p.b)(l.t.serviceName)),Object(i.c)(5,Object(p.b)(l.Gb.serviceName)),Object(i.c)(6,Object(p.b)(l.Jb.serviceName)),Object(i.c)(7,Object(p.b)(l.z.serviceName)),Object(i.c)(8,Object(p.b)(u.b))],S);n.module(v,[o.a,l.N]).service(f,S)},GvHr:function(e,t){e.exports='<div bb-load-bundle="components/directives/messages" ng-cloak class="messages-container color-override no-border">\n  <div class="messages-header js-course-skip-link-target" tabindex="-1">\n    <div class="summary" ng-show="showMigrationInProgressScreen === false && messagesToolIsAvailable">\n      <div class="private-course-info-header" ng-if="courseConversations.isCoursePrivate() && !courseConversations.shouldShowLoadingSpinner()">\n        <bb-ui-icon-small-information class="info-icon"></bb-ui-icon-small-information>\n        <div class="info-text">\n          <bb-translate course-org-token-resolver>components.directives.message.messagesPanelInfo</bb-translate>\n        </div>\n      </div>\n      <div class="messages-header-space-holder"></div>\n\n      \x3c!-- items per page selection --\x3e\n      <div ng-if="courseConversations.shouldShowItemsPerPage()">\n        <bb-page-size-selector\n          class-name="pageSize"\n          on-page-size-change="courseConversations.onPageSizeChange"\n          page-size-options="courseConversations.pageSizeOptions"\n          initial-page-size="courseConversations.pageSizeString"\n          analytics-id="components.directives.messages.courseConversations.pageSize.selector"\n        />\n      </div>\n\n      <div class="add-message-button guidance-wrapper" ng-if="courseConversations.conversations.permissions.create">\n        \x3c!-- set keep-guidance-when-focusout to be true then add bb-key-hide-ftue="messages.add" on the child, focusable element button --\x3e\n        <a bb-guidance-target component-key="messages.add" keep-guidance-when-focusout="true"\n           class="super-clear round right js-create-message"\n           bb-translate-attrs="{\'aria-label\': \'components.directives.message.newMessage\', \'title\': \'components.directives.message.newMessage\'}"\n           ng-class="{\'js-course-skip-link-target\': courseConversations.conversations.length === 0}"\n           bb-peek-sref="create-message({courseId:course.id,allowReplies:courseConversations.allowReplies})"\n           analytics-id="components.directives.messages.courseConversations.newMessage.link">\n          <bb-svg-icon icon="add-circle" size="medium"></bb-svg-icon>\n        </a>\n        <bb-guidance ng-if="courseConversations.isShowGuidance"\n                     component-key="messages.add" class="guidance-element-overlay push-right push-bottom">\n          <bb-translate>components.directives.message.ftue.addMessage</bb-translate>\n        </bb-guidance>\n      </div>\n    </div>\n  </div>\n\n  <div class="conversation-container" ng-if="messagesToolIsAvailable">\n    <div class="private-course-info-container" ng-if="courseConversations.isCoursePrivate() && !courseConversations.shouldShowLoadingSpinner()">\n      <bb-ui-icon-small-information class="info-icon"></bb-ui-icon-small-information>\n      <div class="info-text">\n        <bb-translate course-org-token-resolver>components.directives.message.messagesPanelInfo</bb-translate>\n      </div>\n    </div>\n    <div ng-if="unreadMessages > 0 && !courseConversations.shouldShowLoadingSpinner()" class="unread-messages"\n      bb-translate="components.directives.message.unreadMessages.plural" translate-values="{count: unreadMessages}">\n    </div>\n    <ul class="message-cards row" ng-if="showMigrationInProgressScreen === false && !courseConversations.shouldShowLoadingSpinner()">\n      <li class="message-card message-status js-course-skip-link-target"\n          ng-show="courseConversations.conversations.length > 0"\n          ng-repeat="conversation in courseConversations.conversations track by conversation.id"\n          tabindex="-1"\n          ng-class="{unread: conversation.unreadCount > 0}">\n        \x3c!-- Only shows up when the message hasn\'t been read yet --\x3e\n        <span class="sr-only" ng-show="conversation.unreadCount > 0" bb-translate>components.directives.message.unreadMessage</span>\n        <div class="columns small-12">\n          <div class="message-avatar" ng-class="{\'bb-user-avatar-group-inactive\': conversation.ui.allParticipantsWithoutSenderUnavailable}">\n            <bb-user-avatar user="conversation.latestSender" inactive="conversation.ui.allParticipantsWithoutSenderUnavailable" auto-update="true"></bb-user-avatar>\n          </div>\n\n          <div class="message-info">\n            <div bb-click-to-invoke-child="a.content-title" class="message-meta-info">\n              <a class="content-title participants ellipse sender-container"\n                 ng-class="{ inactive: conversation.ui.allParticipantsWithoutSenderUnavailable }"\n                 ng-click="courseConversations.goToEditMessagePeekState(conversation.id)"\n                 ng-attr-tabindex="{{courseConversations.isDisableTab ? -1 : 0}}"\n                 href="{{!courseConversations.isDisableTab ? \'#\' : \'\'}}"\n                 id="message-conversation-{{conversation.id}}"\n                 aria-labelledby="message-conversation-{{conversation.id}} message-date-{{conversation.id}}"\n                 aria-describedby="latest-message-{{conversation.id}}"\n                 analytics-id="components.directives.messages.courseConversations.selectConversation.link">\n                <bb-username class="sender" user="conversation.latestSender" auto-update="true"></bb-username>\n              </a>\n              <span class="content-title participants ellipse sender-container"\n                    ng-if="conversation.latestSender.id == courseConversations.contextUser.userId">\n                &nbsp;(<bb-translate>components.directives.message.you</bb-translate>)\n              </span>\n              <div class="last-activity" id="message-date-{{conversation.id}}">\n                <bb-duration date="conversation.updatedDate" auto-update="true" has-ago="true"></bb-duration>\n              </div>\n              <div class="recipients" ng-switch="conversation.includesAllMembers">\n                <bb-translate>components.directives.message.to</bb-translate>\n                <bb-translate ng-switch-when="true" course-org-token-resolver>components.directives.message.participant.allCourseMembers</bb-translate>\n                <bb-usernames ng-switch-when="false" users="conversation.participantsWithoutLatestSender" max-user="courseConversations.defaultParticipantsViewCount" auto-update="true"></bb-usernames>\n              </div>\n              <div class="actions">\n                <button class="button super-clear js-delete-message"\n                        bb-translate-attrs="{\'title\': \'components.directives.message.deleteButtonTitle\'}"\n                        aria-label="{{courseConversations.deleteButtonAriaLabels[conversation.id]}}"\n                        ng-if="courseConversations.conversations.permissions.delete && conversation.participantsWithoutSender != null"\n                        ng-click="courseConversations.deleteConversation(conversation)"\n                        tabindex="{{courseConversations.isDisableTab ? -1 : 0}}"\n                        bb-confirmation-needed="{{ courseConversations.deleteConfirmHandler }}"\n                        must-show-delete-confirmation="false"\n                        analytics-id="components.directives.messages.courseConversations.deleteConversation.button">\n                  <bb-svg-icon icon="trash" size="small"></bb-svg-icon>\n                </button>\n              </div>\n            </div>\n            <div class="latest-message" id="latest-message-{{conversation.id}}">\n              <bb-rich-text-editor ng-model="conversation.latestMessages[0].body.displayText"\n                                   is-read-only="true"\n                                   plugin-options="{\'attachment\': true}"\n              />\n            </div>\n          </div>\n        </div>\n      </li>\n    </ul>\n  </div>\n\n  <div class="spinner bb-secondary-color-2" ng-if="courseConversations.shouldShowLoadingSpinner()" aria-hidden="true"></div>\n\n  <div class="row js-course-skip-link-target" ng-if="showMigrationInProgressScreen === false && messagesToolIsAvailable === false">\n    <div class="columns small-12 text-center no-messages" tabindex="-1">\n      <p class="caption" bb-translate="components.directives.message.notAllow.content" course-org-token-resolver></p>\n    </div>\n  </div>\n\n  <div class="row js-course-skip-link-target" ng-if="showMigrationInProgressScreen === false && messagesToolIsAvailable && courseConversations.conversations.paging.count === 0 && courseConversations.conversations.permissions.create">\n    <div class="columns small-12 text-center no-messages" tabindex="-1">\n      <img src="./static/images/ftue/ftuMMicon_NoMessages.png" role="presentation" />\n      <p class="main" bb-translate="components.directives.message.noMessages.title" course-org-token-resolver></p>\n      <p class="caption" bb-translate="components.directives.message.noMessages.content" course-org-token-resolver></p>\n    </div>\n  </div>\n\n  <div class="row js-course-skip-link-target" ng-if="showMigrationInProgressScreen === false && messagesToolIsAvailable && courseConversations.conversations.paging.count === 0 && !courseConversations.conversations.permissions.create">\n    <div class="columns small-12 text-center no-messages" tabindex="-1">\n      <img src="./static/images/ftue/ftuMMicon_NoMessages.png" role="presentation" />\n      <p class="main" bb-translate="components.directives.message.noMessages.titleReadOnly" course-org-token-resolver></p>\n      <p class="caption" bb-translate="components.directives.message.noMessages.contentReadOnly" course-org-token-resolver></p>\n    </div>\n  </div>\n\n  <div class="row js-course-skip-link-target" ng-if="showMigrationInProgressScreen === true">\n    <div class="columns small-12 text-center no-messages js-migration-in-progress" tabindex="-1">\n      \x3c!--TODO: update the image to the Migration In Progress one when image is ready--\x3e\n      <img src="./static/images/ftue/ftuMMicon_NoMessages.png" role="presentation" />\n      <p class="main" bb-translate="components.directives.message.migrationInProgress.title"></p>\n    </div>\n  </div>\n\n  <bb-paging-selector\n    class="pagination"\n    ng-if="courseConversations.shouldShowPagination()"\n    page="courseConversations.currentPage"\n    number-of-pages="courseConversations.numberOfPages"\n    on-page-change="courseConversations.onChangePage"\n    compact="courseConversations.isSmallBreakpoint"\n    class-name="pagination"\n    analytics-id="components.directives.messages.courseConversations"\n  />\n</div>\n'},HdfQ:function(e,t,s){"use strict";s("i1PZ"),s("ja1T");var i=s("71td"),r=s("Llzl"),n=s("7/CN"),a=s("H8CZ"),o=s("lEL+"),c=s("0JpG"),l=s("nsO7"),d=s("yC9S");s.d(t,"a",(function(){return h}));const h="bbSlick";class u{constructor(e,t){this.timeout=e,this.localize=t,this.restrict="AE",this.scope={initOnload:"@",data:"=",currentIndex:"=?",accessibility:"@",arrows:"@",asNavFor:"@",autoplay:"@",autoplaySpeed:"@",centerMode:"@",centerPadding:"@",cssEase:"@",dots:"@",draggable:"@",easing:"@",fade:"@",focusOnSelect:"@",disableOffScreenSlides:"&?",hideOffScreenSlides:"&?",infinite:"@",init:"&",initialSlide:"=?",lazyLoad:"@",manualInit:"=",nextArrow:"@",onBeforeChange:"&?",onAfterChange:"&?",onInit:"&?",onReInit:"&?",onUpdate:"&",pauseOnHover:"@",prevArrow:"@",responsive:"=",slickHandle:"=",slide:"@",slidesToShow:"=?",slidesToScroll:"@",speed:"@",swipe:"@",touchMove:"@",touchThreshold:"@",toUpdateSlide:"=",vertical:"@",useCss:"@"},this.link=(e,t,s)=>{let r=!1,o=!1;const c=i(t),h=this.localize;e.$on("slickRefresh",(()=>{c.slick("unslick"),c.init=b()})),e.$on("$destroy",(()=>{o&&this.timeout((()=>{c.slick("unslick")}),e,500)}));const u=i(e.prevArrow),m=i(e.nextArrow);function p(e){e.slideCount<=e.options.slidesToShow&&(e.slideCount-1===e.currentSlide&&m.addClass("slick-disabled"),0===e.currentSlide&&u.addClass("slick-disabled")),u.hasClass("slick-disabled")?u.attr("disabled","disabled"):u.removeAttr("disabled"),m.hasClass("slick-disabled")?m.attr("disabled","disabled"):m.removeAttr("disabled")}function b(){t.on("beforeChange",(function(s,i,r,a){e.onBeforeChange&&(e.onBeforeChange({$event:s,$sl:i,$oldIndex:r,$newIndex:a}),e.$apply()),e.hideOffScreenSlides&&e.hideOffScreenSlides()?t.find(".slick-slide").children().show():e.disableOffScreenSlides&&e.disableOffScreenSlides()&&n.i(t.find(".slick-slide"))})),t.on("afterChange",(function(s,i,r){p(i),e.onAfterChange&&e.onAfterChange({$event:s,$sl:i,$newIndex:r});const a=t.find(".slick-slide");if(a.removeAttr("aria-hidden"),e.hideOffScreenSlides&&e.hideOffScreenSlides()?a.not(".slick-active, .slick-current").children().hide():e.disableOffScreenSlides&&e.disableOffScreenSlides()&&n.f(a.not(".slick-active, .slick-current")),!e.$$phase&&!e.$root.$$phase)return e.$apply((function(){return e.currentIndex=r}));e.currentIndex=r})),t.on("init",(function(s,r){e.onInit&&e.onInit(),p(r);const a=t.find(".slick-slide");if(a.removeAttr("aria-hidden"),e.hideOffScreenSlides&&e.hideOffScreenSlides()?a.not(".slick-active, .slick-current").children().hide():e.disableOffScreenSlides&&e.disableOffScreenSlides()&&n.f(a.not(".slick-active, .slick-current")),i(window).trigger("resize"),o=!0,e.toUpdateSlide)return e.toUpdateSlide=!1,r.slideHandler(e.currentIndex,!1,!0)})),e.onReInit&&t.on("reInit",(function(t,s){e.onReInit()})),c.slick({accessibility:"false"!==e.accessibility,arrows:"false"!==e.arrows,asNavFor:e.asNavFor,autoplay:"true"===e.autoplay,autoplaySpeed:null!=e.autoplaySpeed?parseInt(e.autoplaySpeed,10):3e3,centerMode:"true"===e.centerMode,centerPadding:e.centerPadding||"50px",cssEase:e.cssEase||"ease",dots:"true"===e.dots,draggable:"true"===e.draggable,easing:e.easing||"linear",fade:"true"===e.fade,focusOnSelect:"true"===e.focusOnSelect,infinite:"false"!==e.infinite,initialSlide:null!=e.initialSlide?parseInt(e.initialSlide,10):0,lazyLoad:e.lazyLoad||"ondemand",nextArrow:i(e.nextArrow),pauseOnHover:"false"!==e.pauseOnHover,prevArrow:i(e.prevArrow),responsive:e.responsive,rtl:h.isRTL(e),slide:e.slide||"div",slidesToShow:e.slidesToShow,slidesToScroll:null!=e.slidesToScroll?parseInt(e.slidesToScroll,10):1,speed:null!=e.speed?parseInt(e.speed,10):300,swipe:"false"!==e.swipe,touchMove:"false"!==e.touchMove,touchThreshold:e.touchThreshold?parseInt(e.touchThreshold,10):5,useCSS:"false"!==e.useCss,vertical:"true"===e.vertical}),t.find(".slick-list").removeAttr("aria-live");d.b.OnWindow("resize",(()=>{c.get(0).slick&&i(window).width()===c.get(0).slick.windowWidth&&c.get(0).slick.setPosition()}),e)}const g=()=>{c.get(0).slick&&c.get(0).slick.reinit(),c.slick("unslick"),c.find(".slick-list").remove(),e.onUpdate(),this.timeout((()=>{b(),e.$emit("update-slick-refresh")}),e,0,!1)};if(e.slickHandle&&(e.slickHandle=c),e.manualInit)c.init=b,c.refresh=g;else{if(!e.initOnload)return b();r=!1,e.$watch("data",((e,t)=>{null!=e&&(r?g():(b(),r=!0))}))}d.b.OnWindow("bb-offcanvas-breakpoint-large bb-offcanvas-breakpoint-medium bb-offcanvas-breakpoint-small",(()=>{a.b(i(window),(e=>{var t;const s=e.target,i=Object(l.isString)(null==s?void 0:s.className)?null==s?void 0:s.className:(null===(t=null==s?void 0:s.classList)||void 0===t?void 0:t.value)||"";if(!e.data.noTransitions&&-1===i.indexOf("bb-offcanvas-panel"))return!1;c.get(0).slick&&c.get(0).slick.setPosition()}))}),e)}}}u.$inject=[o.b,c.serviceName],r.module(h,[o.a]).directive("bbSlick",["$injector",e=>e.instantiate(u)])},Jygx:function(e,t){function s(e){this.message=e}s.prototype=new Error,s.prototype.name="InvalidCharacterError",e.exports="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new s("'atob' failed: The string to be decoded is not correctly encoded.");for(var i,r,n=0,a=0,o="";r=t.charAt(a++);~r&&(i=n%4?64*i+r:r,n++%4)?o+=String.fromCharCode(255&i>>(-2*n&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return o}},Np64:function(e,t,s){"use strict";s.d(t,"b",(function(){return r})),s.d(t,"a",(function(){return n}));var i=s("nsO7");function r(e,t){const s=i.findIndex(e,t);if(null!=s){const t=e.splice(s,1)[0];e.splice(0,0,t)}}function n(e,t){const s=t.length-1;return{next:()=>t[e<s?e+1:0],previous:()=>t[e<=0?s:e-1]}}},"P4+T":function(e,t,s){"use strict";var i=s("D57K"),r=(s("smDF"),s("dV61"),s("5MwF")),n=s("nsO7"),a=s("Llzl"),o=s("Np64"),c=s("oVrE"),l=s("PdQf"),d=s("bbg+"),h=s("r133"),u=s("BXiQ"),m=s("4HBD"),p=s("bDYn"),b=s("jbaE"),g=s("ZzYr"),v=s("0JpG"),f=s("pjml"),C=s("5RJJ"),S=s("lEL+"),y=s("TnpK"),M=s("z6Q5"),T=s("k9iv"),I=s("BjFu"),k=s("XH1I"),O=s("u3gM"),A=s("fYJU"),P=s("aHpC"),w=s("GvHr"),j=s("GbAM"),x=s("seHs"),D=s("gkef"),L=s("+brj"),$=s("4lp/"),U=s("WyD7"),z=s("RPob");s.d(t,"a",(function(){return F}));const F="ultra.directives.bbCourseConversations",E="CONVERSATION_ITEMS_PER_PAGE";let R=class{constructor(e,t,s,i,r,n,a,o,d,h,u,m,p,b,g,v){this.$q=e,this.scope=t,this.$rootScope=s,this.$http=i,this.$ngRedux=r,this.browserStorage=n,this.windowSize=a,this.CourseModel=o,this.membershipService=d,this.timeout=h,this.ultraState=u,this.localize=m,this.batchService=p,this.errorModalService=b,this.contextUser=g,this.nameFormatService=v,this.deleteConfirmHandler="resource/x-bb-messages",this.defaultParticipantsViewCount=2,this.isShowGuidance=!1,this.isLoadAllParticipants=!1,this.isDisableTab=!1,this.participantsLoading=!1,this.conversationsLoading=!1,this.deleteButtonAriaLabels={},this.anonymousUser=c.b(this.scope,this.localize),this.numOfJobsInProgress=0,this.maxNumOfBatchRequests=50,this.pageSizeOptions=x.c,this.currentPage=0,this.onPageSizeChange=e=>{this.itemsPerPage=e,this.browserStorage.saveToStorage(E,e.toString(10),L.a.LocalStorage),this.onChangePage(0)},this.onChangePage=e=>{this.currentPage=e,this.refreshCourseConversations()},this.localizeTokenPrefix="components.directives.message.participant.",this.scope.course.isOrganization&&(this.localizeTokenPrefix="components.directives.message.organization.participant."),this.allMembersDummyParticipant=l.g(this.scope,this.localize,this.localizeTokenPrefix+"allCourseMembers"),this.isShowGuidance=t.isShowGuidance,this.courseMembership=t.courseMembership,this.participantsLoading=!0,this.initConversationLoaderAria(),this.membershipService.getMsgToolAvailability(this.scope.course).then((e=>{this.scope.messagesToolIsAvailable=e,this.checkMigrationStatus()}));const f=this.scope.$on("bb-message-refresh",((e,t,s,i)=>{if(this.scope.course.id===t)if("READ_STATUS"===s){const e=i[0],t=e?e.id:i[0];this.conversations.forEach((s=>{s.id===t&&(s.unreadCount=0,this.scope.unreadMessages>0&&(this.scope.unreadMessages-=1),this.addOrRefreshConversation(e))}))}else this.refreshCourseConversations()})),C=this.scope.$on("bb-message-create",((e,t,s)=>{this.scope.course.id===t&&(this.currentPage>0?(this.currentPage=0,this.refreshCourseConversations()):this.addOrRefreshConversation(s))}));this.scope.isDisableTab&&this.scope.$watch("isDisableTab()",((e,t)=>{this.timeout((()=>{this.isDisableTab=e}),this.scope)})),n.getFromStorage(E,L.a.LocalStorage).then((e=>{this.initialPageSize=Number(e)||this.pageSizeOptions[0],this.itemsPerPage=this.initialPageSize})).catch((()=>{this.initialPageSize=this.pageSizeOptions[0],this.itemsPerPage=this.initialPageSize})).finally((()=>{this.refreshCourseConversations()})),this.scope.$on("$destroy",(()=>{f(),C()}))}shouldShowItemsPerPage(){return this.conversationsCount>=1}shouldShowLoadingSpinner(){return this.participantsLoading||this.conversationsLoading}shouldShowPagination(){return!this.shouldShowLoadingSpinner()&&!!this.numberOfPages&&this.numberOfPages>1}isCoursePrivate(){return this.scope.course.isPrivate()||!Object(I.a)(this.scope.course)}checkMigrationStatus(){const e=this;this.$http({method:"GET",url:r.a.apiBasePath+"/v1/utilities/migration/coursemessages/inprogress?course_id="+this.scope.course.id}).then((function(t){t.data.success&&t.data.inProgress&&t.data.isCourseBeingMigrated?e.scope.showMigrationInProgressScreen=!0:e.scope.showMigrationInProgressScreen=!1}),(function(t){e.scope.showMigrationInProgressScreen=!1}))}initConversationLoaderAria(){this.ariaLoadingConversation=this.localize.translateSync({locale:this.localize.getLocale(this.scope),key:"components.directives.message.messagesLoading"}),this.ariaConversationLoaded=this.localize.translateSync({locale:this.localize.getLocale(this.scope),key:"components.directives.message.messagesLoaded"})}refreshCourseConversations(){this.conversationsLoading=!0,this.$rootScope.$broadcast(j.b,this.ariaLoadingConversation);const e=this.currentPage*this.itemsPerPage,t=this.itemsPerPage;this.CourseModel.$new(this.scope.course.id).$then((s=>{s.conversationCounts.$resolve().$asPromise().then((e=>{this.scope.totalMessages=e.totalCount,this.scope.unreadMessages=e.unreadCount})),s.conversations.$refresh({offset:e,limit:t,fields:"-participantIds"}).$then((e=>{this.conversationsCount=e.paging.count,e.forEach((e=>{this.latestMessageToPlaintextMessage(e)})),this.conversations=e,this.getParticipants(this.conversations)}),(e=>{this.errorModalService.handleApiError(e.$response,(()=>{this.$rootScope.$broadcast($.b)}))})).$finally((()=>{this.conversationsLoading=!1,this.$rootScope.$broadcast(j.b,this.ariaConversationLoaded)}))}))}getParticipants(e){if(!e)return;this.participantsLoading=!0;const t=[];n(e).filter((e=>!this.isConversationIsBroadcastToAllMembers(e)||(e.participantsWithoutSender=[this.allMembersDummyParticipant],e.participantsWithoutLatestSender=[this.allMembersDummyParticipant],!1))).chunk(this.maxNumOfBatchRequests).forEach((e=>{t.push(this.batchService.performBatch((()=>{e.forEach((e=>{e.participants.$refresh({limit:3}).$then((t=>{this.refreshParticipants(e,t)}))}))})))})),this.$q.all(t).then((()=>{this.participantsLoading=!1}))}setParticipantWithoutLatestSender(e,t){if(t.userName)if(this.contextUser.userId===t.id){const t=this.nameFormatService.formatSelfWithoutName(this.localize.getLocale(this.scope));e.participantsWithoutLatestSender.unshift({userName:"",givenName:t,familyName:""})}else e.participantsWithoutLatestSender.push(t);else t.givenName=this.anonymousUser.givenName,t.familyName=this.anonymousUser.familyName,e.participantsWithoutLatestSender.push(t)}setParticipantWithoutSender(e,t){t.id!==this.contextUser.userId&&e.participantsWithoutSender.push(t)}addParticipantsNotInACategory(e){var t,s;(null===(t=e.participantsNotInACategory)||void 0===t?void 0:t.length)>0&&(null===(s=e.recipientCategory)||void 0===s?void 0:s.length)>0&&e.participantsNotInACategory.forEach((t=>{this.setParticipantWithoutLatestSender(e,t),this.setParticipantWithoutSender(e,t)}))}participantsHaveBeenProcessed(e){return e.participantsWithoutLatestSender.length>0&&e.participantsWithoutSender.length>0}processParticipants(e){e.participantsWithoutSender=[],e.participantsWithoutLatestSender=[],this.addRecipientCategoryToParticipants(e),this.addParticipantsNotInACategory(e),this.participantsHaveBeenProcessed(e)||(e.participants.forEach((t=>{this.setParticipantWithoutLatestSender(e,t)})),n.range(0,Math.max(0,e.participants.paging.count-e.participantsWithoutLatestSender.length)).forEach((t=>{e.participantsWithoutLatestSender.push({})})),0===e.participantsWithoutLatestSender.length&&e.participantsWithoutLatestSender.push(this.anonymousUser))}latestMessageToPlaintextMessage(e){e.latestMessages.forEach((e=>{e.body.displayText=Object(z.l)(e.body.displayText)}))}refreshParticipants(e,t){if(e.participants=t,this.processParticipants(e),this.participantsHaveBeenProcessed(e))return this.allParticipantUnAvailable(e).then((t=>{e.ui.allParticipantsWithoutSenderUnavailable=t})),void this.createDeleteButtonAriaLabel(e);const s=e.creatorId;o.b(t,(function(e){return e.id===s})),this.isConversationIsBroadcastToAllMembers(e)?(e.participantsWithoutSender.push(this.allMembersDummyParticipant),e.ui.allParticipantsWithoutSenderUnavailable=!1):1===t.length?e.participantsWithoutSender.push(t[0]):(t.forEach((t=>{this.setParticipantWithoutSender(e,t)})),this.allParticipantUnAvailable(e).then((t=>{e.ui.allParticipantsWithoutSenderUnavailable=t}))),this.createDeleteButtonAriaLabel(e)}addOrRefreshConversation(e){if(!e)return;const t=!!n.find(this.conversations,(t=>t.id===e.id));let s;this.isConversationIsBroadcastToAllMembers(e)?(e.participantsWithoutSender=[this.allMembersDummyParticipant],e.participantsWithoutLatestSender=[this.allMembersDummyParticipant],s=this.$q.resolve(null)):s=e.participants.$refresh({limit:3}).$asPromise(),s.then((s=>{if(t){const t=a.copy(e.messages);e.latestMessages=[t[t.length-1]],e.updatedDate=e.latestMessages[0].postDate;const s=t=>t.id===e.id;n.remove(this.conversations,s)}else this.conversations.paging.count+=1,this.conversationsCount+=1,this.CourseModel.$new(this.scope.course.id).$then((t=>{t.conversationCounts.$resolve().$asPromise().then((t=>{this.scope.totalMessages=t.totalCount,this.updateUnreadMessageCount(e,1)}))}));s&&this.refreshParticipants(e,s);let i=0;for(let t=0;t<=this.conversations.length;++t)if(t===this.conversations.length||0===this.conversations[t].unreadCount&&e.updatedDate>this.conversations[t].updatedDate){i=t;break}this.latestMessageToPlaintextMessage(e),this.conversations.splice(i,0,e),this.$rootScope.$broadcast(h.b)}))}createDeleteButtonAriaLabel(e){const t={userNameFormat:v.ILocaleUsernameFormat.Short,noWrap:!0,noEscape:!0};this.localize.formatUsernameList(e.participantsWithoutSender,this.defaultParticipantsViewCount,this.scope,t).then((t=>{this.deleteButtonAriaLabels[e.id]=this.localize.translateSync({locale:this.localize.getLocale(this.scope),key:"components.directives.message.deleteButtonAriaLabel",params:{messageParticipants:t},noWrap:!0,noEscape:!0})}))}get allowReplies(){return this.conversations&&this.conversations.permissions.canSetRepliedToAsFalse}get pageSizeString(){return this.itemsPerPage.toString()}get numberOfPages(){return Math.ceil(this.conversationsCount/this.itemsPerPage)}get isSmallBreakpoint(){return this.windowSize.isSmallBreakpoint()}goToCreateMessagePeekState(){this.ultraState.goPeekState("create-message",{courseId:this.scope.course.id,allowReplies:this.allowReplies})}goToEditMessagePeekState(e){this.ultraState.goPeekState("edit-message",{courseId:this.scope.course.id,conversationId:e,offset:this.getOffsetForSingleMessage(e),count:this.conversationsCount})}goToCourseMessagePeekState(){this.ultraState.goPeekState("course.messages",{courseId:this.scope.course.id})}getOffsetForSingleMessage(e){const t=n.defaultTo(this.conversations.paging.offset,NaN),s=n.findIndex(this.conversations,{id:e});if(!(Number.isNaN(t)||s<0))return t+s}updateUnreadMessageCount(e,t){if(this.isConversationIsBroadcastToAllMembers(e))this.scope.unreadMessages+=t;else for(const s of e.participantsWithoutLatestSender)if(1===e.unreadCount&&(void 0===s.id||s.id===this.contextUser.userId)){this.scope.unreadMessages+=t;break}}deleteConversation(e){e.$destroy().$then((()=>{this.scope.unreadMessages>0&&this.updateUnreadMessageCount(e,-1);const t=Math.max(1,Math.ceil(this.conversationsCount/this.itemsPerPage)),s=Math.max(1,Math.ceil((this.conversationsCount-1)/this.itemsPerPage)),i=t!==s;if(this.conversationsCount<=1||i)return this.currentPage=Math.min(this.currentPage,s-1),this.refreshCourseConversations(),void this.emitMessageRefreshEvent();n.remove(this.conversations,(t=>t.id===e.id)),this.conversationsCount-=1,this.scope.totalMessages-=1,this.emitMessageRefreshEvent()}))}emitMessageRefreshEvent(){this.$rootScope.$broadcast("bb-message-delete")}allParticipantUnAvailable(e){return this.isConversationIsBroadcastToAllMembers(e)?this.$q.resolve(!1):this.membershipService.getUserCourseAvailabilities(this.scope.course.id).then((t=>(e.participantsWithoutSender||[]).every((e=>!t[e.id]))))}isConversationIsBroadcastToAllMembers(e){return e.includesAllMembers||e.isCategoryIncluded(this.allMembersDummyParticipant.id)}addRecipientCategoryToParticipants(e){var t,s;if(!(null===(t=e.recipientCategory)||void 0===t?void 0:t.length))return;const i=null===(s=e.recipientCategory)||void 0===s?void 0:s.map((e=>this.localizeTokenPrefix+l.f(e))),r=l.m(i,this.scope,this.localize);e.participantsWithoutLatestSender=[...r],e.participantsWithoutSender=[...r]}};R=Object(i.a)([Object(i.c)(0,Object(P.b)("$q")),Object(i.c)(1,Object(P.b)("scope")),Object(i.c)(2,Object(P.b)("$rootScope")),Object(i.c)(3,Object(P.b)("$http")),Object(i.c)(4,Object(P.b)("$ngRedux")),Object(i.c)(5,Object(P.b)(L.c)),Object(i.c)(6,Object(P.b)(D.b)),Object(i.c)(7,Object(P.b)(f.m.serviceName)),Object(i.c)(8,Object(P.b)(C.b)),Object(i.c)(9,Object(P.b)(S.b)),Object(i.c)(10,Object(P.b)(y.d)),Object(i.c)(11,Object(P.b)(v.serviceName)),Object(i.c)(12,Object(P.b)(M.b)),Object(i.c)(13,Object(P.b)(T.c)),Object(i.c)(14,Object(P.b)(A.b)),Object(i.c)(15,Object(P.b)(d.b))],R);class N{constructor(e){this.$injector=e,this.restrict="E",this.template=w,this.scope={course:"=",courseMembership:"<",isShowGuidance:"=?",isDisableTab:"&?"},this.link=(e,t)=>{e.courseConversations=this.$injector.instantiate(R,{scope:e})}}}N.$inject=["$injector"],a.module(F,[h.a,u.a,m.a,p.a,b.a,g.a,C.a,A.a,f.N,k.a,O.a,d.a,L.b,U.a]).directive("bbCourseConversations",["$injector",e=>e.instantiate(N)])},SoDU:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var i=s("VdDF"),r=s("pjml");class n{constructor(e,t){this.TermModel=e,this.terms=t,this.currentTerm=this.getTerm(r.Gb.ConstantTermId.CurrentTerm),this.upcomingTerm=this.getTerm(r.Gb.ConstantTermId.UpcomingTerm)}getTerm(e){return this.terms.filter((t=>t.id===e))[0]}static decorateTerm(e,t){return e.id=t,e.ui={type:t},e}createYearTerm(e){const t=e.getFullYear(),s="year-"+t;let i=this.getTerm(s);return i||(i=new this.TermModel,i.id=s,i.ui={type:"year",year:t},i.startDate=new Date(t,0),this.addTerm(i)),i}addTerm(e){if(e)for(let t=0;t<this.terms.length;t++)if(this.terms[t].startDate>=e.startDate||this.terms[t]===this.currentTerm)return void this.terms.splice(t,0,e)}filterTerm(e){return this.terms.filter((t=>!!r.Gb.TermDuration.DateRange.isEqualTo(t.durationType)&&i.a.isWithinDateRange(e,{start:t.startDate,end:t.endDate})))}}},WSu0:function(e,t,s){"use strict";var i=s("aY38");function r(e){this.message=e}r.prototype=new Error,r.prototype.name="InvalidTokenError",e.exports=function(e,t){if("string"!=typeof e)throw new r("Invalid token specified");var s=!0===(t=t||{}).header?0:1;try{return JSON.parse(i(e.split(".")[s]))}catch(e){throw new r("Invalid token specified: "+e.message)}},e.exports.InvalidTokenError=r},XH1I:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var i=s("Llzl"),r=s("0JpG"),n=s("AuQm"),a=s("1ZbL");const o="ultra.components.directives.page.size.selector",c={Class:n.H,attributes:["analyticsId","className"],bindingNames:["pageSizeOptions","onPageSizeChange","initialPageSize"],renderLocalized:!0,withErrorModalBoundary:!1};i.module(o,[r.moduleName]).component("bbPageSizeSelector",Object(a.a)(c))},aY38:function(e,t,s){var i=s("Jygx");e.exports=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(i(e).replace(/(.)/g,(function(e,t){var s=t.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s})))}(t)}catch(e){return i(t)}}},cs5G:function(e,t,s){"use strict";s.d(t,"a",(function(){return y})),s.d(t,"b",(function(){return M}));var i=s("D57K"),r=s("nsO7"),n=s("t3aq"),a=s("Qbdf"),o=s("X455"),c=s("HAJP"),l=s("0JpG"),d=s("5MwF"),h=s("WSu0"),u=s("pjml"),m=s("Q/M7"),p=s("aHpC"),b=s("6fZB"),g=s("VAMW"),v=s("jhBu"),f=s("Sa5G"),C=s("/5AG"),S=s("nYZ0");const y="ultra.service.ally",M="ally",T="privileged";class I{constructor(e){this.service=e,this.key=g.d.Ally}isAvailable(){return Object(b.a)(this.service.isAvailable())}isAllySupportedContentItem(e){return this.service.isAllySupportedContentItem(e)}getXythosIdFromContentItem(e){return this.service.getXythosIdFromContentItem(e)}update(e,t,s){this.service.update(e,t,s)}isAllyInstructor(){return this.service.isAllyInstructor()}}let k=class{constructor(e,t,s,i,r,n,a,o,c,l){this.$q=e,this.$timeout=t,this.$interval=s,this.allyModel=i,this.contextCourse=r,this.contextCourseMembership=n,this.bbLocalize=a,this.bbScriptLoader=o,this.entitlementService=c,this.contentService=l,this.cachedTokensMap=new Map,this._mockCourses={},this._xythosIdToContentIdMap={},this._xythosIdToInstructorFeedbackUpdateCallbackMap=new Map,this.getToken=e=>{const t=e?this._xythosIdToContentIdMap[e]:void 0;return this.cachedTokensMap.has(e)&&Date.now()<this.cachedTokensMap.get(e).exp?this.$q.resolve(this.cachedTokensMap.get(e).token):this.allyModel.getAllyToken(this.contextCourse.courseId,t).then((t=>{const s=this.getExpireMillisFromToken(t),i={bearer:t.authToken};return this.cachedTokensMap.set(e,{token:i,exp:s}),i}))},Object(g.f)(new I(this))}getContentById(e){const t=this.contextCourse.course,s=this.contentService.findRootNode(t,u.p.ContentRootNode.ROOT);return this.contentService.getContentInContentTree(s,t.courseId,e).then((e=>e.content))}downloadAlternativeFormat(e){window.open(e,"_blank","noopener")}updateReviewStateForLaunchedContent(e){Object(C.u)(e)}getAllySettings(){return this._allyConfig?this.$q.resolve(this._allyConfig):this.allyModel.getAllyConfig().then((e=>this._allyConfig=e))}getExpireMillisFromToken(e){return 1e3*h(e.authToken).exp}isAvailable(){return this.getAllySettings().then((e=>e.serviceAvailable))}getXythosIdFromContentFileUrl(e){const t=/(?:xid|_xy)-([^&]*)/.exec(e);let s=t&&t[1];return s&&"_"!==s.substr(0,1)&&(s="_"+s),s}getXythosIdFromContentItem(e){const t=r.get(e,"contentDetail['resource/x-bb-file'].file.permanentUrl");if(t)return this.getXythosIdFromContentFileUrl(t)}isAllySupportedContentItem(e){return e.isFile()&&!e.isConditionalReleaseLocked()}disable(){this._allyConfig?this._allyConfig.serviceAvailable=!1:this._allyConfig={serviceAvailable:!1}}ensureAlly(){const e=this,t=this.$q.defer();return this.ally?t.resolve():this.getAllySettings().then((s=>{if(s.serviceAvailable){let i,r=!1;const n=(e,s)=>{r||(e?t.resolve():(this.disable(),s&&console.error(s),t.reject()),r=!0,this.$timeout.cancel(i))};i=this.$timeout((()=>{n(!1,"Ally initialization timed out.  Disabling Ally Service.")}),d.a.allyInitializationTimeout||1e4),this.bbScriptLoader.getScript(s.javascriptUrl,{attributes:{"data-ally-loader":""},exports:"ally"}).then((t=>{e.ally=t;try{e.ally.ready((()=>{n(!0)}))}catch(e){console.error(e),n(!1,"Ally initialization error.  Disabling Ally Service.")}})).catch((()=>{n(!1,"Failed to load ally.js.  Disabling Ally Service.")}))}else t.resolve()})),t.promise}getRole(){return this.entitlementService.isEntitled(f.f.ModifyContent)?T:"unprivileged"}isAllyInstructor(){return this.getRole()===T}destroyCurrentAllyInstance(){this.cachedTokensMap.clear();const e=this.$q.defer();return this._xythosIdToInstructorFeedbackUpdateCallbackMap.clear(),this.allyUI?this.allyUI.destroy().then((()=>{e.resolve()})):e.resolve(),e.promise}ensureAllyUI(e){if(this.allyLoadInProgressPromise)return this.allyLoadInProgressPromise;const t="string"==typeof e?e:this.bbLocalize.getLocale(e),s=this.$q.defer();return this.allyLoadInProgressPromise=s.promise,this.ensureAlly().then((()=>{this.getAllySettings().then((e=>{if(!e.serviceAvailable||this.currentCourseId===this.contextCourse.courseId&&this.currentLocale===t)this.allyLoadInProgressPromise=void 0,s.resolve();else{this.currentCourseId!==this.contextCourse.courseId&&(this._xythosIdToContentIdMap={}),this.currentCourseId=this.contextCourse.courseId,this.currentLocale=t;const i={alternativeformats:{callbacks:{closed(){},formatGenerated:e=>this.downloadAlternativeFormat(e.url),alternativeFormatAccessed:e=>{const t=e.contentId;return this.getContentById(t).then((e=>{this.updateReviewStateForLaunchedContent(e)}))}}},client:{auth:this.getToken.bind(this),baseUrl:m.i(e.ltiUrl),clientId:e.clientId},courseId:this.currentCourseId,locale:this.currentLocale,platformName:"learn",role:this.getRole(),instructorfeedback:{callbacks:{closed:()=>{this.allyUI.client.clearAllFromCache(),this.allyUI.update()},deleted:e=>{},replacedFile:(e,t)=>{},updated:e=>{this.instructorFeedbackUpdateCallback(e)},fixHtmlIssue:()=>{}}}};d.a.features.devtools_allyMock&&(this.allyMock=this.ally.ui.$mock(this._mockCourses,void 0),i.client.jQuery=this.allyMock),this.destroyCurrentAllyInstance().then((()=>{this.allyUI=this.ally.ui(i),this.allyUI.autoUpdate({domWatch:d.a.allyAutoUpdateInterval||500}).then((()=>{this.allyLoadInProgressPromise=void 0,s.resolve()}))}))}}))})).catch((()=>{this.allyLoadInProgressPromise=void 0,s.reject()})),this.allyLoadInProgressPromise}update(e,t,s){this.isAvailable().then((i=>{if(i){const i="string"==typeof e?e:this.bbLocalize.getLocale(e);this.ensureAllyUI(i).then((()=>{t&&s&&(this._xythosIdToContentIdMap[s]=t,this.allyUI.client.clearFileIdFromCache(s)),this.registerMockFileReference(s)}))}}))}registerMockFileReference(e){d.a.features.devtools_allyMock&&e&&(r.merge(this._mockCourses,{[this.currentCourseId]:{File:{[e]:{availableAlternativeFormats:["Tts","Epub","Translation","Braille","Html"],creator:null,decorative:null,description:"mock file",id:e,isVersioned:!1,libraryReference:null,name:"mockfile",producer:null,results:{},score:.75,size:12345,suggestions:{},type:"pdf"}},RichContent:{}}}),this.allyMock.set(this._mockCourses))}fileUploadEvent(){!this._clearCacheInterval&&this.isAllyInstructor()&&(this._clearCacheInterval=this.$interval((()=>{this.allyUI&&this.allyUI.client&&this.allyUI.client.clearAllFromCache()}),d.a.allyClearCacheInterval||1e4,0,!1))}getIndexMapFromBbML(e){const t=new Map;if(!e)return t;const s=e.match(/(<a[^>]+)/gi)||[];let i=0;return s.forEach((e=>{if(e.includes('data-bbfile="')){const s=e.match(/href="[^"]+xid-([0-9_]+)/)||[];s.length>=2&&("_"!==s[1].substr(0,1)&&(s[1]="_"+s[1]),t.set(s[1],i)),i++}})),t}instructorFeedbackUpdateCallback(e){const t=this._xythosIdToInstructorFeedbackUpdateCallbackMap.get(e.id);t&&t(e)}onUpdate(e,t,s){if(e===n.c.InstructorFeedback)this._xythosIdToInstructorFeedbackUpdateCallbackMap.set(t,s)}destroyListeners(e){this._xythosIdToInstructorFeedbackUpdateCallbackMap.delete(e)}getReactService(e){return{getXythosIdFromContentFileUrl:this.getXythosIdFromContentFileUrl.bind(this),update:(t,s)=>this.update(e,t,s),isAvailable:()=>Object(b.a)(this.isAvailable()),getIndexMapFromBbML:this.getIndexMapFromBbML.bind(this),onUpdate:this.onUpdate.bind(this),destroyListeners:this.destroyListeners.bind(this)}}};k=Object(i.a)([Object(i.c)(0,Object(p.b)("$q")),Object(i.c)(1,Object(p.b)("$timeout")),Object(i.c)(2,Object(p.b)("$interval")),Object(i.c)(3,Object(p.b)(u.a.serviceName)),Object(i.c)(4,Object(p.b)(a.e)),Object(i.c)(5,Object(p.b)(o.d)),Object(i.c)(6,Object(p.b)(l.serviceName)),Object(i.c)(7,Object(p.b)(c.b)),Object(i.c)(8,Object(p.b)(v.b)),Object(i.c)(9,Object(p.b)(S.f))],k);angular.module(y,[a.b,o.a,l.moduleName,c.a,v.a,S.d]).service(M,k)},r133:function(e,t,s){"use strict";s.d(t,"a",(function(){return c})),s.d(t,"b",(function(){return l}));var i=s("Llzl"),r=s("Fvsw"),n=s("0JpG"),a=s("0+Qs"),o=s("BXQP");const c="ultra.directives.bbDuration",l="refresh.relative.dates";class d{constructor(e,t,s,i){this.scope=e,this.bbContext=t,this.bbLocalize=s,this.interval=i,this.date="",this.time="",this.lessThanOneDay=!1;const r=e.$watch("date",(()=>{this._localizeRelativeDate(),e.autoUpdate&&!e.autoUpdate()&&e.date&&r()}));e.$on(l,(()=>{this._localizeRelativeDate()})),this.interval((()=>{this._localizeRelativeDate()}),this.scope,d.DEFAULT_REFRESH_INTERVAL)}needAgo(){return!!(this.scope.hasAgo&&this.scope.hasAgo()&&this.lessThanOneDay)}separateDatetime(){return!(!this.scope.separateDatetime||!this.scope.separateDatetime())}_localizeRelativeDate(){if(this.scope.date){let e={},t=new Date;const s=this.scope.isRelativeToServerDate&&this.scope.isRelativeToServerDate();(null==s||s)&&(e={relativeTo:this.bbContext.getServerTime()},t=this.bbContext.getServerTime());const i=t.getTime()-this.scope.date.getTime();if(i>=6e4&&this.scope.date.setSeconds(30),this.lessThanOneDay=i<=864e5,this.needAgo()||this.separateDatetime()){const t=this.bbLocalize.getFormatEnum(n.ILocaleDateFormat,this.scope.dateFormat)||n.ILocaleDateFormat.Short;this.bbLocalize.formatDuration(this.scope.date,this.scope,e,t).then((e=>{this.date=e.date||"",this.time=e.time||""}))}}}}d.DEFAULT_REFRESH_INTERVAL=18e4,d.$inject=["scope",r.b,n.serviceName,a.b];class h{constructor(e){this.$injector=e,this.restrict="E",this.replace=!0,this.template=o,this.scope={date:"=",autoUpdate:"&?",isRelativeToServerDate:"&?",dateFormat:"@?",hasAgo:"&?",separateDatetime:"&?"},this.link=e=>{e.duration=this.$injector.instantiate(d,{scope:e})}}}h.$inject=["$injector"],i.module(c,[r.a,n.moduleName,a.a]).directive("bbDuration",["$injector",e=>e.instantiate(h)])},seHs:function(e,t,s){"use strict";s.d(t,"d",(function(){return i})),s.d(t,"b",(function(){return r})),s.d(t,"a",(function(){return n})),s.d(t,"c",(function(){return a}));const i=25,r=50,n=100,a=[i,r,n]},u3gM:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var i=s("Llzl"),r=s("0JpG"),n=s("AuQm"),a=s("1ZbL");const o="ultra.components.directives.paging.panel",c={Class:n.I,attributes:["analyticsId","className"],bindingNames:["page","compact","numberOfPages","onPageChange","elementSelectorToFocus"],renderLocalized:!0};i.module(o,[r.moduleName]).component("bbPagingSelector",Object(a.a)(c))},zdqs:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var i=s("nsO7"),r=s("VdDF"),n=s("pjml"),a=s("zGdY");class o{constructor(e){this.termUtil=e,this.membershipTermMapper=new c(this.termUtil)}getMembershipMapper(){return this.membershipTermMapper}map(e,t){return e.map((e=>({membership:e,term:this.membershipTermMapper.adjustTerm(e,t)})))}}class c{constructor(e){this.termUtil=e}adjustTerm(e,t){const s=this.getCourseDateRange(e);return s.start>t?e.course.ui.term=this.termUtil.upcomingTerm:r.a.isWithinDateRange(t,s)?e.course.ui.term=this.termUtil.currentTerm:e.course.term?e.course.ui.term=e.course.term:e.course.ui.term=this.getTermMappingBasedOnCourseDates(e,s,t),e.course.ui.term}getCourseDateRange(e){let t,s;if(a.x.DateRange===e.course.durationType)t=e.course.startDate,s=e.course.endDate;else if(a.x.FixedNumDays===e.course.durationType)t=e.enrollmentDate,s=new Date(e.enrollmentDate.getTime()),s.setDate(s.getDate()+e.course.numDaysOfUse);else if(a.x.UseTerm===e.course.durationType){const i=e.course.term?this.termUtil.getTerm(e.course.term.id):null;i&&(n.Gb.TermDuration.DateRange.isEqualTo(i.durationType)?(t=i.startDate,s=i.endDate):n.Gb.TermDuration.FixedNumDays.isEqualTo(i.durationType)&&(t=e.enrollmentDate,s=new Date(e.enrollmentDate.getTime()),s.setDate(s.getDate()+i.daysOfUse)))}return{end:s,start:t}}getTermMappingBasedOnCourseDates(e,t,s){let r=t.start||e.course.term&&e.course.term.startDate;if(!r){if(!(t.end&&s>t.end))return this.termUtil.currentTerm;r=t.end}const n=this.termUtil.filterTerm(r);if(0===n.length)return this.termUtil.createYearTerm(r);if(1===n.length)return n[0];if(n.length>1){const e=i.sortBy(n,["startDate","id"]);return e[e.length-1]}}}}}]);