(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{m3mx:function(e,t,n){"use strict";var s=n("ERkP"),a=n("7nmT"),i=n("uDfI"),o=n("7O4Y"),r=n("np6O"),c=n("hQuh"),l=n("wgY5"),u=n.n(l),d=n("fXuP"),m=n("MC1S"),h=n("WBPx"),p=n("caKH"),g=n("nbDY"),b=n.n(g);class E extends b.a{}E.VIEW=new E("view"),E.CREATE=new E("create"),E.EDIT=new E("edit"),E.DUPLICATE=new E("duplicate"),E.DELETE=new E("delete");var C=n("n7/H"),S=n("ERsv"),y=n("RPob");function D(e,t){let n="";if(e&&u()(e).isValid()){const s=u()(e).toDate();if(function(e,t,n){return e>=t&&e<n}((new Date).getTime()-s.getTime(),0,864e5)){const e=t.formatDuration(s,{},C.ILocaleDateFormat.Short);n=t.translate("components.directives.duration.agoText",{durationDate:e.date||"",durationTime:e.time||""})}else n=t.formatDatetime(s,C.ILocaleDatetimeFormat.Short)}return n}const v=document.createElement("textarea");function A(e){return v.innerHTML=e,v.value}function T(e,t){e=e.replace(/"{"/g,"'{\"").replace(/"}"/g,"\"}'");let n=(new DOMParser).parseFromString(e,"text/html");const s=[{tag:"table",replacementText:`[${t.translate("course.announcements.tableWithContent")}]`}];n=Object(y.w)(n,s);return Array.from(n.getElementsByTagName("a")).forEach((e=>{const t=JSON.parse(Object(S.fixDoubleQuotesInJSONValues)(e.getAttribute("data-bbfile")));(null==t?void 0:t.alternativeText)?e.textContent=`[${t.alternativeText}]`:(null==t?void 0:t.alt)?e.textContent=`[${t.alt}]`:e.textContent=`[${e.textContent}]`})),n.body.innerHTML=n.body.innerHTML.replace(/</g," <"),(n.body.innerText||n.body.innerHTML).trim()}function I(e,t){const n=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds());return u()(n)}var f=n("myse"),k=n("Pam5"),P=n("0x+l");class N extends s.Component{constructor(e){super(e),this.timerHandler=null,this.onClickActionMenu=e=>{this.setState({target:e.currentTarget})},this.onOpenDeleteConfirmDialog=()=>{this.setState({hideDialog:!1})},this.onCloseDeleteConfirmDialog=()=>{this.setState({hideDialog:!0})},this.onOpenAnnouncement=()=>{const{courseId:e,announcement:t,permissions:n}=this.props;this.props.openAnnouncementDetailPanel(e,t.id,n)},this.onPostAnnouncement=()=>{this.setState({disablePostButton:!0});const{saveAnnouncement:e,courseId:t,announcement:n}=this.props;e(t,{...n,isDraft:!1,startDateRestriction:u()().toDate(),endDateRestriction:null}).catch((()=>this.setState({disablePostButton:!1})))},this.onEditAnnouncement=()=>{this.setState({disablePostButton:!1});const{courseId:e,announcement:t,permissions:n}=this.props;this.props.openAnnouncementDetailPanel(e,t.id,n,E.EDIT)},this.onDuplicateAnnouncement=()=>{const{courseId:e,announcement:t,permissions:n}=this.props;this.props.openAnnouncementDetailPanel(e,t.id,n,E.DUPLICATE)},this.onDeleteAnnouncement=()=>{const{removeAnnouncement:e,announcement:t,loadAnnouncements:n,courseId:s}=this.props;e(t.courseId,t.id).then((()=>{this.onCloseDeleteConfirmDialog(),n(s,{})}))},this.isPostedAnnouncement=e=>!(e.isDraft||e.startDateRestriction&&u()(e.startDateRestriction).isAfter(u()())),this.getActionOptions=()=>{const{permissions:e,analyticsId:t,analyticsEventAugmentor:n,localize:a}=this.props,i={items:[]},o=n(f.AnalyticsEventTypes.CLICK_EVENT,this.onEditAnnouncement,t+".listItem.edit.button"),r=n(f.AnalyticsEventTypes.CLICK_EVENT,this.onDuplicateAnnouncement,t+".listItem.duplicate.button"),c=n(f.AnalyticsEventTypes.CLICK_EVENT,this.onOpenDeleteConfirmDialog,t+".listItem.delete.button");return e&&e.modify&&i.items.push({key:E.EDIT,name:a.translate("course.announcements.button.edit"),icon:s.createElement(P.Edit,null),onClick:o}),e&&e.create&&i.items.push({key:E.DUPLICATE,name:a.translate("course.announcements.button.duplicate"),icon:s.createElement(P.Duplicate,null),onClick:r}),e&&e.delete&&i.items.push({key:E.DELETE,name:a.translate("course.announcements.button.delete"),icon:s.createElement(P.Trash,null),onClick:c}),i},this.renderItemStatus=()=>{const{announcement:e,localize:t,permissions:n,analyticsId:a,isCourseAvailable:i,isCompact:o}=this.props;let r=`course.announcements.status.${this.isPostedAnnouncement(e)?"posted":"inSchedule"}.${o?"uppercase":"capitalize"}`;return e.isDraft&&(r="course.announcements.status.draft"),s.createElement("div",{className:"item-status-info"},e.isDraft&&n.modify?s.createElement(h.AnalyticsDefaultButton,{"data-automation-id":"test",onClick:this.onPostAnnouncement,disabled:!n.viewUnposted||!i||this.state.disablePostButton,analyticsId:`${a}.listItem.postNow`},t.translate("course.announcements.button.postNow")):s.createElement("div",null,s.createElement("span",{className:"list-item-status"},n.viewUnposted&&t.translate(r)),s.createElement("span",{className:"list-item-date-sent"},e.startDateRestriction&&!e.isDraft&&D(e.startDateRestriction.toISOString(),t))))},this.registerTimeoutEvent=()=>{const{debounceTime:e,onExpire:t,announcement:n}=this.props;this.timerHandler=setTimeout((()=>{t(n.id)}),e)},this.renderDialog=()=>{const{localize:e,analyticsId:t}=this.props;return s.createElement(p.c,{onDismiss:()=>{this.setState({hideDialog:!0})},showAsCallout:!this.state.hideDialog,target:this.state.target,dialogContentProps:{type:m.DialogType.actionConfirmation,title:e.translate("course.announcements.dialogText.deleteAnnouncement"),subText:e.translate("course.announcements.dialogText.confirmDeleteAnnouncement"),showCloseButton:!1},analyticsId:t+".listItem.deleteDialog"},s.createElement(m.DialogFooter,null,s.createElement(h.AnalyticsDefaultButton,{onClick:this.onCloseDeleteConfirmDialog,analyticsId:t+".listItem.deleteDialog.cancel.button"},e.translate("course.announcements.button.cancel")),s.createElement(h.AnalyticsPrimaryButton,{onClick:this.onDeleteAnnouncement,className:"deleteConfirmBtn",analyticsId:t+".listItem.deleteDialog.confirm.button"},e.translate("course.announcements.button.delete"))))},this.state={hideDialog:!0,target:null,disablePostButton:!1}}componentDidMount(){this.props.isNewlyCreated&&this.registerTimeoutEvent()}componentDidUpdate(e){!e.isNewlyCreated&&this.props.isNewlyCreated&&this.registerTimeoutEvent()}componentWillUnmount(){this.timerHandler&&clearTimeout(this.timerHandler)}render(){const{announcement:e,localize:t,permissions:n,isNewlyCreated:a,analyticsId:i,analyticsEventAugmentor:o,isCompact:r}=this.props,c=this.getActionOptions(),l=o(f.AnalyticsEventTypes.CLICK_EVENT,this.onOpenAnnouncement,i+".listItem.open.link");return s.createElement("tr",{className:"announcement-item-row "+(a?"is-new":""),role:"row"},s.createElement("td",{className:"announcement-header-column "+(n.viewUnposted?"small-1-2":"large-1"),role:"gridcell"},s.createElement("div",{className:"announcement-header"},s.createElement("div",{className:"small-1-1 announcement-icon"+(e.isDraft?" is-restricted":"")},s.createElement("div",{className:"element-image"},s.createElement(k.a,{color:"primary"}))),s.createElement("div",{className:"click-message-detail"},s.createElement("div",{className:"announcement-title-detail"},s.createElement("a",{className:`list-item-title ${n.viewUnposted?"entitled":""} `,href:"#","data-analytics-id":`${i}.listItem.open.link`,onClick:l},A(e.title)),e.isDraft&&s.createElement("span",{className:"draft-status one-line"},t.translate("course.announcements.status.draft"))),s.createElement("a",{className:"list-item-body "+(n.viewUnposted?"one-line":"three-lines multiple-line-ellipsis"),href:"#",onClick:this.onOpenAnnouncement},e.body&&T(e.body.rawText,this.props.localize))),r&&this.renderItemStatus())),!r&&s.createElement("td",{className:"announcement-status-column",role:"gridcell"}," ",this.renderItemStatus()," "),n.viewUnposted&&s.createElement("td",{className:"announcement-viewers-column",role:"gridcell"},s.createElement("div",{className:"announcement-viewers",onClick:this.onClickActionMenu},s.createElement("span",{className:"list-item-view-count"},e.readCount||0," / ",e.totalParticipants),c&&c.items&&c.items.length>0&&s.createElement(m.ActionMenu,{ariaLabel:`${t.translate("course.announcements.moreOptions",{announcementTitle:e.title})}`,className:"announcement-item-action-menu",disabled:!this.state.hideDialog,menuProps:c,maintainExpandedProperties:!this.state.hideDialog,analyticsId:i+".listItem.actionMenu"}),this.renderDialog())))}}var w=Object(f.withAnalytics)(Object(d.a)(N)),x=n("AuQm"),O=n("nsO7");class V extends s.PureComponent{constructor(e){super(e),this.debouncedSearch=O.debounce((()=>{const{courseId:e,notifyStateChange:t,searchAnnouncements:n}=this.props;this.setState({shouldNotify:!0}),this.state.isValidSearch&&n(e,{searchText:encodeURIComponent(this.state.text.trim())})}),this.props.debounceTime),this.focusElement=e=>{e.focus()},this.shouldStartSearching=e=>!e.trim().length||e.trim().length>=this.props.minCharToStartSearching,this.showCharacterInsufficient=e=>!!e.trim()&&e.trim().length<this.props.minCharToStartSearching,this.handleSearchTextChange=e=>{const t=e.target.value;this.setState({text:t,isValidSearch:this.shouldStartSearching(t),shouldNotify:!1}),this.debouncedSearch()},this.handleEnterToSearch=e=>{const{searchAnnouncements:t,courseId:n,notifyStateChange:s}=this.props;"Enter"===e.key&&(this.setState((e=>({isValidSearch:e.text.trim().length>0}))),this.state.isValidSearch&&(s(this.state.text,this.state.isCollapsed,this.state.isValidSearch),t(n,{searchText:encodeURIComponent(this.state.text.trim())})))},this.closeSearchInput=()=>{this.setState({text:"",isCollapsed:!0,isValidSearch:!1})},this.state={text:"",isCollapsed:!1,isValidSearch:!1,shouldNotify:!0}}UNSAFE_componentWillReceiveProps(e){e.isCollapsed&&!e.searchText.trim().length&&this.debouncedSearch.cancel(),this.setState({text:e.searchText,isCollapsed:e.isCollapsed})}componentDidUpdate(e,t){const{isCollapsed:n,notifyStateChange:s}=this.props;!0===e.isCollapsed&&n!==e.isCollapsed&&this.focusElement(this.searchInput),this.showCharacterInsufficient(this.state.text)?this.searchInput.addEventListener("keyup",this.handleEnterToSearch):this.searchInput.removeEventListener("keyup",this.handleEnterToSearch),this.state.shouldNotify&&s(this.state.text,this.state.isCollapsed,this.state.isValidSearch)}render(){const{t:e,analyticsId:t,analyticsEventAugmentor:n}=this.props,a=n(f.AnalyticsEventTypes.CLICK_EVENT,(()=>{}),t);return s.createElement("div",{className:"search-input-wrap","data-analytics-id":t},s.createElement(P.Search,{className:"search-icon"}),s.createElement("label",{className:"sr-only",htmlFor:"search-input"},this.props.placeHolder),s.createElement("input",{className:"left",id:"search-input",onChange:this.handleSearchTextChange,placeholder:this.props.placeHolder,ref:e=>{this.searchInput=e},type:"text",value:this.state.text,onClick:a}),s.createElement(r.AnalyticsIconButton,{"aria-label":e("course.announcements.button.closeSearch"),className:"search-controls button super-clear",onClick:this.closeSearchInput,title:e("course.announcements.button.closeSearch"),analyticsId:"course.announcements.listPanel.closeSearch.button"},s.createElement(P.Clear,null)))}}var M=Object(f.withAnalytics)(Object(c.a)(V)),L=n("zGdY");class R extends s.PureComponent{constructor(){super(...arguments),this.getArrowDirection=()=>{const{currentSort:e,sortField:t}=this.props;return t&&(null==e?void 0:e.field)===t?(this.localSort=e,this.isDescendingSort(e)?"arrow-down":"arrow-up"):""},this.updateSortCriteria=()=>{const{sortField:e,onSwitchSortCriteria:t}=this.props;this.localSort?this.localSort={field:e,direction:this.localSort.direction===L.Wb.Ascending?L.Wb.Descending:L.Wb.Ascending}:this.localSort={field:e,direction:L.Wb.Ascending},t(this.localSort)},this.isDescendingSort=e=>e.direction===L.Wb.Descending}render(){const{t:e,viewText:t,analyticsId:n,analyticsEventAugmentor:a}=this.props,i=a(f.AnalyticsEventTypes.CLICK_EVENT,this.updateSortCriteria,n);return s.createElement(s.Fragment,null,s.createElement("button",{id:`sort-by-${t}-button`,className:"active clear",onClick:i,"data-analytics-id":n},s.createElement("span",{className:"sort-description"},e(`course.announcements.sort.${t}.description`)),s.createElement("div",{className:"sort-list-arrows "+this.getArrowDirection(),role:"presentation"},s.createElement("div",{className:"sort-list-arrow-up"}),s.createElement("div",{className:"sort-list-arrow-down"}))))}}var U,B=Object(f.withAnalytics)(Object(c.a)(R));!function(e){e.Ascending="ascending",e.Descending="descending",e.None="none",e.Other="other"}(U||(U={}));var j=U,F=n("50Q+"),W=n("Y+9S"),z=n("E1pj"),H=n("8jBL"),q=n("IbyE"),_=n("9OUN");class $ extends s.PureComponent{constructor(){super(...arguments),this.renderAnnouncementItem=e=>{const{courseId:t,courseContext:n,openAnnouncementDetailPanel:a,permissions:i,removeAnnouncement:o,saveAnnouncement:r,recentUpdatedAnnouncementIds:c,removeFromRecentUpdated:l,UltraWindowSize:u}=this.props,d=Object.values(this.props.announcements)[e];return s.createElement(w,{announcement:d,courseId:t,debounceTime:2e3,isCompact:null==u?void 0:u.isSmallBreakpoint(),isCourseAvailable:n.isAvailable,isNewlyCreated:c&&c.indexOf(d.id)>-1,key:d.id,onExpire:l,openAnnouncementDetailPanel:a,permissions:i,removeAnnouncement:o,saveAnnouncement:r,loadAnnouncements:this.loadAnnByCurrentSettings,analyticsId:"course.announcements.listPanel"})},this.loadMore=()=>{const{announcements:e,paging:t,loadAnnouncements:n,courseId:s,searchInputState:a,sortCriteria:i}=this.props,o=a.searchText;n(s,{paging:{offset:Object.keys(e).length,limit:t.limit},searchText:o,sort:i},!0)},this.searchInputStateChange=(e,t,n)=>{const{searchInputState:s,changeSearchInputState:a}=this.props;t&&t!==s.isCollapsed?this.onToggleSearchInput():e===s.searchText&&t===s.isCollapsed&&n===s.isValidSearch||a({searchText:e,isCollapsed:t,isValidSearch:n})},this.onToggleSearchInput=()=>{const{courseId:e,searchInputState:t,changeSearchInputState:n}=this.props,s=!t.isCollapsed,a=s?"":t.searchText;n({searchText:a,isCollapsed:s}),s&&t.searchText.trim().length>0&&this.loadAnnByCurrentSettings(e,{searchText:a})},this.onSwitchSortCriteria=e=>{const{courseId:t,switchSortCriteria:n}=this.props;n([e]),this.loadAnnByCurrentSettings(t,{sort:[e]})},this.sortAriaValueForAnnouncement=e=>{const t=e[0];return(null==t?void 0:t.field)===L.bb.Title?t.direction===L.Wb.Ascending?j.Ascending:j.Descending:j.None},this.sortAriaValueByStatus=e=>{const t=e[0];return(null==t?void 0:t.field)===L.bb.Status?t.direction===L.Wb.Ascending?j.Ascending:j.Descending:j.None},this.sortAriaValueByViewers=e=>{const t=e[0];return(null==t?void 0:t.field)===L.bb.ReadCount?t.direction===L.Wb.Ascending?j.Ascending:j.Descending:j.None},this.onCreateAnnouncement=()=>{this.props.openAnnouncementDetailPanel(this.props.courseId,null,this.props.permissions,E.CREATE)},this.loadAnnByCurrentSettings=(e,t)=>{const{announcements:n,searchInputState:s,loadAnnouncements:a,sortCriteria:i}=this.props,o=t||{},r=null!=o.searchText?o.searchText:!s.isCollapsed&&s.searchText.trim()||"",c=o.sort||i,l=n&&Object.keys(n).length||0;a(e,{searchText:r,paging:{limit:o.limit||Math.max(l,10),offset:o.offset||0},sort:c})},this.renderNoResultString=e=>{const{searchInputState:t,t:n,isLoading:a,paging:i,isSearchingSuccessful:o,courseContext:r}=this.props;return t.searchText?e?s.createElement("p",{className:"search-insufficient","aria-live":"assertive"},n("course.announcements.characterInsufficient")):o&&s.createElement("p",{className:"search-no-results ng-scope","aria-live":"assertive"},n("course.announcements.noSearchResult")):!a&&0===(null==i?void 0:i.count)&&t.isCollapsed&&s.createElement("p",{className:"search-no-results ng-scope"},n(Object(F.o)("announcements.noResult",null==r?void 0:r.isOrganization)))},this.getMessageAnnouncementInCourse=()=>{const{t:e,announcementsCounts:t,announcements:n}=this.props;return e("course.announcements.totalAnnouncementInCourse",{filterCount:Object.values(n).length,announcementCount:t.draftCount+t.postedCount+t.scheduledCount})},this.renderAnnouncementListView=e=>{const{t,searchInputState:n,sortCriteria:a,isSearchingSuccessful:i,permissions:r,courseContext:c,UltraWindowSize:l}=this.props,u=n.searchText.trim(),d=!n.isCollapsed&&u.length&&u.length<2&&!n.isValidSearch;return e>0&&!d?s.createElement("div",{className:Object(o.a)("tabular-list-container",{"-with-seach-bar":!n.isCollapsed})},s.createElement("div",{className:"tabular-list"},s.createElement("table",{className:"table-content sortable-table",role:"grid","aria-readonly":!0,"aria-labelledby":"announcement-table-caption"},s.createElement("caption",{id:"announcement-table-caption",className:"sr-only"},t(Object(F.o)("announcements.pageTitle",null==c?void 0:c.isOrganization))),s.createElement("thead",{className:"list-item-columns announcement-sort-header"},s.createElement("tr",{className:"list-item-row announcement-sort-row",role:"row"},s.createElement("th",{className:"column-title sort",role:"columnheader",id:"title","aria-sort":this.sortAriaValueForAnnouncement(a)},s.createElement(B,{courseId:this.props.courseId,currentSort:a[0],onSwitchSortCriteria:this.onSwitchSortCriteria,sortField:L.bb.Title,viewText:"title",analyticsId:"course.announcements.listPanel.sortByTitle.button"})),!l.isSmallBreakpoint()&&s.createElement("th",{className:`column-${r.viewUnposted?"status":"date"} sort`,role:"columnheader",id:r.viewUnposted?"status":"date","aria-sort":this.sortAriaValueByStatus(a)},s.createElement(B,{courseId:this.props.courseId,currentSort:a[0],onSwitchSortCriteria:this.onSwitchSortCriteria,sortField:r.viewUnposted?L.bb.Status:L.bb.StartDateRestriction,viewText:t(r.viewUnposted?"status":"date"),analyticsId:"course.announcements.listPanel.sortByDate.button"})),r.viewUnposted&&s.createElement("th",{className:"column-viewers sort",role:"columnheader",id:"viewers","aria-sort":this.sortAriaValueByViewers(a)},s.createElement(B,{courseId:this.props.courseId,currentSort:a[0],onSwitchSortCriteria:this.onSwitchSortCriteria,sortField:L.bb.ReadCount,viewText:"viewers",analyticsId:"course.announcements.listPanel.sortByViews.button"})))),s.createElement("tbody",null,Object.values(this.props.announcements).map(((e,t)=>s.createElement(s.Fragment,null,this.renderAnnouncementItem(t))))),n.isValidSearch&&i&&s.createElement("div",{"aria-live":"polite","aria-hidden":!1,className:"sr-only",role:"status"},t("course.announcements.searchResults"))),this.renderScroll()),s.createElement("span",{role:"status",className:"sr-only"},this.getMessageAnnouncementInCourse())):s.createElement("div",{className:"columns small-12 no-result-section"},s.createElement("div",{className:"row"},s.createElement("div",{className:"columns small-12 small-centered text-center ftue-container"},this.renderNoResultString(d))))}}componentDidMount(){const{courseId:e,courseContext:t,getAnnouncementsCounts:n,getCourseContext:s,permissions:a,switchSortCriteria:i}=this.props;if(Object(W.m)()){const e={type:W.c.AnnouncementListOpened,status:W.b.Success,permission:{search:!0}},t=Object(W.q)(e);t.response.subscribe((e=>{e.event===W.a.Search&&this.onToggleSearchInput()})),this.correlationId=t.correlationId}const o=a.viewUnposted?[{field:L.bb.ModifiedDate,direction:L.Wb.Descending}]:[{field:L.bb.StartDateRestriction,direction:L.Wb.Descending}];i(o),this.loadAnnByCurrentSettings(e,{sort:o}),n(e),t&&t.courseId===e||s(e)}componentDidUpdate(e){this.props.listener.refreshAnnouncementsCounts&&!e.listener.refreshAnnouncementsCounts&&this.props.getAnnouncementsCounts(this.props.courseId),this.props.listener.resetSortSetting&&!e.listener.resetSortSetting&&this.props.switchSortCriteria([{field:L.bb.ModifiedDate,direction:L.Wb.Descending}]),this.props.listener.resetSearchSetting&&!e.listener.resetSearchSetting&&this.props.changeSearchInputState({searchText:"",isCollapsed:!0}),this.props.listener.refreshAnnouncements&&!e.listener.refreshAnnouncements&&this.props.loadAnnouncements(this.props.courseId,{searchText:this.props.searchInputState.searchText})}componentWillUnmount(){const{root:e,clearAnnouncements:t}=this.props;Object(W.m)()&&Object(W.f)(this.correlationId),t()}renderScroll(){const{paging:e,isLoading:t}=this.props,n=!t&&(null==e?void 0:e.count)>Object.keys(this.props.announcements).length;return n&&s.createElement(x.Y,{loader:this.loadMore,hasMore:n})}render(){const{announcements:e,paging:t,permissions:n,searchInputState:a,courseId:i,courseContext:o,t:c,announcementsCounts:l,UltraWindowSize:u}=this.props,d=e&&Object.keys(e).length||0,m=(null==u?void 0:u.isMediumBreakpoint())||(null==u?void 0:u.isSmallBreakpoint());return s.createElement("div",{className:"page-announcement course-announcement-layer"},s.createElement("div",{className:"panel-wrap"},s.createElement("header",{className:"panel-header simple-header"},s.createElement("div",{className:"panel-titles-container"},s.createElement("span",{className:"panel-sub-title"},o&&o.displayName||""),s.createElement("div",{className:"editable-title-container black-header-contents"},s.createElement(r.AnalyticsIconButton,{"aria-label":c("base.menu"),className:"left-off-canvas-toggle menu-toggle  standard-button dark-background",title:c("base.menu"),analyticsId:"course.announcements.listPanel.menu.button"},s.createElement(P.MainMenu,null)),s.createElement("h1",{className:"panel-title"},c(Object(F.o)("announcements.pageTitle",null==o?void 0:o.isOrganization))))),s.createElement("div",{className:"header-actions-menu__item active no-select"},s.createElement("div",{className:"active no-select"},s.createElement(r.AnalyticsIconButton,{"aria-label":c("course.announcements.search.placeHolder"),className:"anchor-button",id:"search-button",onClick:this.onToggleSearchInput,title:c("course.announcements.search.placeHolder"),analyticsId:"course.announcements.listPanel.search.button"},m?s.createElement(P.Search,null):s.createElement(H.Search,null))))),s.createElement("div",{className:"guidance-wrapper "+(a.isCollapsed?"":"hide")},l&&(null==t?void 0:t.count)>=0&&s.createElement("span",null,n.viewUnposted?c("course.announcements.guidance.instructor",{postedCount:l.postedCount||0,scheduledCount:l.scheduledCount||0})+c("course.announcements.guidance.draftCount.plural",{draftCount:l.draftCount||0}):c("course.announcements.guidance.student",{totalCount:(null==t?void 0:t.count)||0})),n.create&&s.createElement(r.AnalyticsIconButton,{"aria-label":c("course.announcements.createAnnouncement"),className:"create-announcement",onClick:this.onCreateAnnouncement,title:c("course.announcements.createAnnouncement"),analyticsId:"course.announcements.listPanel.create.button"},m?s.createElement(P.Add,null):s.createElement(H.AddCircle,null))),s.createElement("div",{className:"panel-content"},s.createElement("div",{className:"row collapse "+(a.isCollapsed?"hide":""),id:"announcement-search"},s.createElement(M,{courseId:i,debounceTime:1500,isCollapsed:a.isCollapsed,minCharToStartSearching:2,notifyStateChange:this.searchInputStateChange,placeHolder:c("course.announcements.search.placeHolder"),searchAnnouncements:this.loadAnnByCurrentSettings,searchText:a.searchText,analyticsId:"course.announcements.listPanel.search.input.text"})),s.createElement("div",{className:"row collapse"},this.renderAnnouncementListView(d),this.props.isLoading?s.createElement("div",{className:"spinner bb-secondary-color-2"}):""))))}}var Y=Object(i.b)((e=>({announcements:e.announcement.announcements,isLoading:e.announcement.isLoading,isSearchingSuccessful:e.announcement.isSearchingSuccessful,searchInputState:e.announcement.searchInputState,paging:e.announcement.paging,announcementsCounts:e.announcement.announcementsCounts,courseContext:e.announcement.courseContext,sortCriteria:e.announcement.sortCriteria,listener:e.announcement.listener,recentUpdatedAnnouncementIds:e.announcement.recentUpdatedAnnouncementIds})),(e=>Object(_.b)({loadAnnouncements:q.V.announcement.loadAnnouncements,removeAnnouncement:q.V.announcement.removeAnnouncement,saveAnnouncement:q.V.announcement.saveAnnouncement,changeSearchInputState:q.V.announcement.changeSearchInputState,getAnnouncementsCounts:q.V.announcement.getAnnouncementsCounts,getCourseContext:q.V.announcement.getCourseContext,switchSortCriteria:q.V.announcement.switchSortCriteria,clearAnnouncements:q.V.announcement.clearAnnouncements,removeFromRecentUpdated:q.V.announcement.removeFromRecentUpdated},e)))(Object(z.windowResizingResponsiveComponentWrapper)(Object(c.a)($))),K=n("tN4z");const J=e=>({months:[e("course.announcements.datePicker.months.january"),e("course.announcements.datePicker.months.february"),e("course.announcements.datePicker.months.march"),e("course.announcements.datePicker.months.april"),e("course.announcements.datePicker.months.may"),e("course.announcements.datePicker.months.june"),e("course.announcements.datePicker.months.july"),e("course.announcements.datePicker.months.august"),e("course.announcements.datePicker.months.september"),e("course.announcements.datePicker.months.october"),e("course.announcements.datePicker.months.november"),e("course.announcements.datePicker.months.december")],shortMonths:[e("course.announcements.datePicker.shortMonths.january"),e("course.announcements.datePicker.shortMonths.february"),e("course.announcements.datePicker.shortMonths.march"),e("course.announcements.datePicker.shortMonths.april"),e("course.announcements.datePicker.shortMonths.may"),e("course.announcements.datePicker.shortMonths.june"),e("course.announcements.datePicker.shortMonths.july"),e("course.announcements.datePicker.shortMonths.august"),e("course.announcements.datePicker.shortMonths.september"),e("course.announcements.datePicker.shortMonths.october"),e("course.announcements.datePicker.shortMonths.november"),e("course.announcements.datePicker.shortMonths.december")],days:[e("course.announcements.datePicker.days.sunday"),e("course.announcements.datePicker.days.monday"),e("course.announcements.datePicker.days.tuesday"),e("course.announcements.datePicker.days.wednesday"),e("course.announcements.datePicker.days.thursday"),e("course.announcements.datePicker.days.friday"),e("course.announcements.datePicker.days.saturday")],shortDays:[e("course.announcements.datePicker.shortDays.sunday"),e("course.announcements.datePicker.shortDays.monday"),e("course.announcements.datePicker.shortDays.tuesday"),e("course.announcements.datePicker.shortDays.wednesday"),e("course.announcements.datePicker.shortDays.thursday"),e("course.announcements.datePicker.shortDays.friday"),e("course.announcements.datePicker.shortDays.saturday")],goToToday:e("course.announcements.datePicker.goToToday"),prevMonthAriaLabel:e("course.announcements.datePicker.prevMonthAriaLabel"),nextMonthAriaLabel:e("course.announcements.datePicker.nextMonthAriaLabel"),prevYearAriaLabel:e("course.announcements.datePicker.prevYearAriaLabel"),nextYearAriaLabel:e("course.announcements.datePicker.nextYearAriaLabel")});class Q extends s.PureComponent{constructor(e){super(e),this.timeoutPromiseWrapper=(e,t,n)=>new Promise((s=>{e.apply(this,t),setTimeout((()=>{const a=e.apply(n,t);s(a)}))})),this.errorMessage=()=>{const{isValueValid:e,errorEmptyMessage:t,errorFormatMessage:n}=this.props;if(!e){let e=n;return this.state.uiDateStr||(e=t),s.createElement("span",{className:"error-message"},s.createElement(P.Attention,null),e)}return null},this.toggleCalendar=()=>{this.setState((e=>({isDisplayCalendar:!e.isDisplayCalendar})),(()=>{this.state.isDisplayCalendar&&setTimeout((()=>{this.calRef.focus()}),100)}))},this.onSelectDate=e=>{const{localize:t,onChangeValue:n}=this.props;this.timeoutPromiseWrapper(t.formatDate,[e,C.ILocaleDateFormat.Short],t).then((t=>{n(e),this.setState({uiDateStr:t}),this.toggleCalendar()}))},this.onTypeDate=e=>{this.setState({uiDateStr:e.target.value})},this.onHandleBlur=()=>{var e,t;const{uiDateStr:n}=this.state,{onChangeValue:s,localize:a}=this.props;setTimeout((()=>{this.datePickerRef.contains(document.activeElement)||this.setState({isDisplayCalendar:!1})}));const i=this.timeoutPromiseWrapper(a.parseDate,[n,C.ILocaleDateFormat.Short],a).then((e=>{e&&s(e)}));null===(t=(e=this.props).onDateTimeChanging)||void 0===t||t.call(e,i)},this.state={isDisplayCalendar:!1,uiDateStr:""}}componentDidMount(){const{value:e,onChangeValue:t,localize:n}=this.props;e&&this.timeoutPromiseWrapper(n.formatDate,[e,C.ILocaleDateFormat.Short],n).then((n=>{t(e),this.setState({uiDateStr:n})}))}componentDidUpdate(e,t){const{uiDateStr:n}=this.state,{value:s,onValidateCallback:a,disabled:i,localize:o}=this.props;s&&s!==e.value&&this.timeoutPromiseWrapper(o.formatDate,[s,C.ILocaleDateFormat.Short],o).then((e=>{this.setState({uiDateStr:e}),a(!0)})),s||s===e.value||(this.setState({uiDateStr:""}),a(!0)),this.state.uiDateStr===t.uiDateStr||i||this.timeoutPromiseWrapper(o.parseDate,[n,C.ILocaleDateFormat.Short],o).then((e=>{a(!!e)}))}render(){const{isDisplayCalendar:e,uiDateStr:t}=this.state,{value:n,disabled:a,localize:{translate:i},analyticsId:o,analyticsEventAugmentor:c}=this.props,l=c(f.AnalyticsEventTypes.CLICK_EVENT,(()=>{}),o+".input.text");return s.createElement("div",{ref:e=>this.datePickerRef=e,className:"date-picker"},s.createElement("div",{className:"calendar-input-container",id:`${o}.input.text`,"data-analytics-id":`${o}.input.text`},s.createElement("input",{"aria-labelledby":`${o}.input.text`,className:"date-input",ref:e=>this.dateInputRef=e,type:"text",value:t,onChange:this.onTypeDate,disabled:a,onClick:l,onBlur:this.onHandleBlur}),s.createElement(r.AnalyticsIconButton,{"aria-label":i("course.announcements.datePicker.dueDate"),className:"btn-date open-datepicker",disabled:a,onClick:this.toggleCalendar,title:i("course.announcements.datePicker.dueDate"),analyticsId:o+".open.button"},s.createElement(P.Calendar,null)),this.errorMessage()),e&&s.createElement(m.Callout,{target:this.dateInputRef,doNotLayer:!0,directionalHint:5,isBeakVisible:!1,gapSpace:0,setInitialFocus:!1},s.createElement(m.Calendar,{componentRef:e=>this.calRef=e,className:"date-picker-dropdown",value:n,strings:J(i),isMonthPickerVisible:!1,showGoToToday:!1,onSelectDate:this.onSelectDate,analyticsId:o+".calendar"})))}}var G=Object(f.withAnalytics)(Object(d.a)(Q));class X extends s.Component{constructor(){super(...arguments),this.getEditorElement=()=>document.querySelector(".bb-editor"),this.prepareEditorPlugins=()=>{const{localize:e,editor:t,fileUploadSettings:n}=this.props,s={...t.pluginConfig,babelfishFormatInstance:e.babelfishFormat,babelfishInstance:e.babelfish,apiBasePath:q.cb.apiBasePath,locale:e.locale,xsrfToken:q.cb.xsrf,fileUploadSettings:n},a=[Object(S.link)(),Object(S.image)(),Object(S.video)(),Object(S.insertLocalFile)(s),Object(S.videoEverywhere)(s)];return s.openCloudStorageIntegrationModal&&a.push(Object(S.insertCloudStorageIntegrationFile)({openCloudStorageIntegrationModal:s.openCloudStorageIntegrationModal,...s})),s.getEmbedSrc&&a.push(Object(S.insertYoutubeVideo)({getEmbedSrc:s.getEmbedSrc,...s})),a},this.focusEditor=()=>{const e=this.getEditorElement();e&&e.focus()}}componentDidMount(){this.props.editor.isReadOnly||this.focusEditor()}shouldComponentUpdate(e){return Object(O.differenceWith)([e.editor],[this.props.editor],O.isEqual).length>0}componentDidUpdate(){this.props.editor.isReadOnly||this.focusEditor()}render(){const{editor:e}=this.props,t=this.prepareEditorPlugins();return s.createElement(S.BbEditor,{...e,plugins:t})}}const Z=Object(d.a)(X),ee=256;class te extends s.Component{constructor(e){super(e),this.mappingAnnouncementToState=e=>{const{courseId:t,courseContext:n,getCourseContext:s}=this.props;if(e){const{title:t="",startDateRestriction:n,endDateRestriction:s,isDraft:a,pushNotify:i}=e,o=e.body&&e.body.rawText||"";this.setState({currentBbml:o,currentAnnouncement:e,title:t,isValid:!!t.trim()&&!!o.trim(),isDraft:a,isSendEmailChecked:i}),a||(i||this.setState({isScheduleChecked:!0,isShowOnChecked:!0,startDate:u()(n).toDate(),startTime:u()(n).toDate()}),s&&this.setState({isEndChecked:!0,endDate:u()(s).toDate(),endTime:u()(s).toDate()}))}this.notifyMobileApp(e),n&&n.courseId===t||s(t);const a=this.getMode();this.titleTextField&&this.isEditableMode(a)&&this.titleTextField.focus(),this.updateAnnouncementPanelState(E.DUPLICATE.isEqualTo(a),!1)},this.notifyMobileApp=e=>{const t={type:W.c.AnnouncementDetailOpened,status:W.b.Success,pageTitle:this.getTitle(e)};Object(W.r)(t)},this.getMode=()=>this.props.mode||E.VIEW,this.isEditableMode=e=>E.EDIT.isEqualTo(e)||E.DUPLICATE.isEqualTo(e)||E.CREATE.isEqualTo(e),this.onTitleChange=e=>{this.setState((t=>({title:e,isTitleInputPristine:!1,isValid:!!e.trim()&&e.trim().length<=ee&&!!t.currentBbml.trim()}))),this.updateAnnouncementPanelState(!!e.trim())},this.onMessageChange=e=>{const{currentAnnouncement:t,isMessageEditorPristine:n}=this.state,s=e.toBbML();this.setState((e=>({currentBbml:s,isMessageEditorPristine:!1,isValid:!!s.trim()&&!!e.title.trim()&&e.title.trim().length<=ee}))),t&&!n?this.updateAnnouncementPanelState(t.body.rawText!==s):t||this.updateAnnouncementPanelState(!!s)},this.onTitleErrorMessage=e=>{const{isTitleInputPristine:t}=this.state,{t:n}=this.props;let s="";return t||e.trim().length?!t&&e.trim().length>ee&&(s=n("course.announcements.errors.messages.titleMaxlength",{maxLength:ee})):s=n("course.announcements.errors.messages.titleRequired"),s},this.onSave=async()=>{if(this.state.isSaving)return;this.setState({isSaving:!0}),await this.state.onDateTimeChangingPromise;const e=this.getMode();let{currentAnnouncement:t}=this.state;const{currentBbml:n,title:s,isSendEmailChecked:a,isScheduleChecked:i,isShowOnChecked:o,isEndChecked:r,startDate:c,startTime:l,endDate:u,endTime:d}=this.state,{courseId:m,saveAnnouncement:h,closePanel:p}=this.props;if(c&&l&&c.setHours(l.getHours(),l.getMinutes(),l.getSeconds()),u&&d&&u.setHours(d.getHours(),d.getMinutes(),d.getSeconds()),!t&&E.CREATE.isEqualTo(e))t={},t.isDraft=!0,t.title=s,t.body={rawText:n},t.pushNotify=a,i&&(t.isDraft=!1,o&&(t.startDateRestriction=I(c,l).toDate()),t.endDateRestriction=r?I(u,d).toDate():null);else{if(!E.DUPLICATE.isEqualTo(e)&&!E.EDIT.isEqualTo(e))return console.error("Failed to save announcement!"),void this.setState({isSaving:!1});{const m={...t.body,rawText:n};t={...t,title:s,body:m},E.DUPLICATE.isEqualTo(e)&&(t={...t,isDraft:!0,id:null}),t.pushNotify=a,i?(t.isDraft=!1,o&&(t.startDateRestriction=I(c,l).toDate()),t.endDateRestriction=r?I(u,d).toDate():null):(t.isDraft=!0,t.startDateRestriction=null,t.endDateRestriction=null)}}h(m,t).then((()=>{this.updateAnnouncementPanelState(!1,!0),p()}))},this.onCancel=()=>{this.props.closePanel()},this.validateInputs=()=>!!this.state.title.trim()&&!!this.state.currentBbml.trim()&&this.state.title.trim().length<=ee,this.validateSchedule=()=>{const{isScheduleChecked:e,isShowOnChecked:t,isEndChecked:n,isStartDateValid:s,isStartTimeValid:a,isEndDateValid:i,isEndTimeValid:o}=this.state;if(e){if(t&&(!s||!a))return!1;if(n&&(!i||!o))return!1}return!0},this.onSendEmailChange=()=>{this.updateAnnouncementPanelState(!0),this.setState((e=>({isSendEmailChecked:!e.isSendEmailChecked})))},this.onScheduleChange=()=>{this.updateAnnouncementPanelState(!0),this.setState((e=>({isScheduleChecked:!e.isScheduleChecked,isShowOnChecked:!e.isScheduleChecked&&!e.isSendEmailChecked})))},this.onShowOnChange=()=>{this.setState((e=>({isShowOnChecked:!e.isShowOnChecked}))),this.updateAnnouncementPanelState(!0)},this.onHideOnChange=()=>{this.setState((e=>({isEndChecked:!e.isEndChecked}))),this.updateAnnouncementPanelState(!0)},this.isEndLaterThanStart=()=>{const{isScheduleChecked:e,isEndChecked:t,isStartDateValid:n,isStartTimeValid:s,isEndDateValid:a,isEndTimeValid:i,startDate:o,startTime:r,endDate:c,endTime:l}=this.state;return!(e&&t&&n&&s&&a&&i&&o&&r&&c&&l)||I(c,l).diff(I(o,r))>0},this.state={currentBbml:"",currentAnnouncement:null,title:"",isMessageEditorPristine:!0,isTitleInputPristine:!0,isSaving:!1,isValid:!1,isDraft:!1,isSendEmailChecked:!1,isScheduleChecked:!1,isShowOnChecked:!1,isEndChecked:!1,startDate:null,startTime:null,endDate:null,endTime:null,isStartDateValid:!0,isStartTimeValid:!0,isEndDateValid:!0,isEndTimeValid:!0,onDateTimeChangingPromise:Promise.resolve()}}componentDidMount(){const{courseId:e,announcementId:t,announcements:n,announcement:s,getAnnouncement:a,permissions:i}=this.props;E.CREATE.isEqualTo(this.getMode())?i.create?this.mappingAnnouncementToState(null):console.error("User is not authorized to create announcement!"):n&&n[t]?this.mappingAnnouncementToState(n[t]):s&&s.id===t?this.mappingAnnouncementToState(s):t?a(e,t).then((()=>{this.mappingAnnouncementToState(this.props.announcement)})):console.error("Unexpected behavior!")}componentDidUpdate(e,t){const{isScheduleChecked:n,isShowOnChecked:s,isSendEmailChecked:a}=this.state;if((t.isScheduleChecked!==n&&n||t.isShowOnChecked!==s&&s)&&!a&&(this.state.startDate&&this.state.startTime||this.setState({startDate:u()().toDate(),startTime:u()().toDate()})),t.isSendEmailChecked!==a&&a&&(this.state.startDate||this.state.startTime)&&this.setState({startDate:null,startTime:null}),this.state.isEndChecked!==t.isEndChecked&&this.state.isEndChecked&&(!this.state.endDate||!this.state.endTime)){const{startDate:e,startTime:t}=this.state;if(e&&t)this.setState({endDate:u()(e).add(1,"days").toDate(),endTime:u()(t).add(1,"days").toDate()});else{const e=u()().toDate();this.setState({endDate:u()(e).add(1,"days").toDate(),endTime:u()(e).add(1,"days").toDate()})}}}getTitle(e){const t=this.getMode(),{t:n}=this.props;let s=e&&A(e.title)||"";return E.CREATE.isEqualTo(t)?s=n("course.announcements.newAnnouncement"):E.EDIT.isEqualTo(t)?s=n("course.announcements.editAnnouncement",{announcement:s}):E.DUPLICATE.isEqualTo(t)&&(s=n("course.announcements.copyAnnouncement",{announcement:s})),s}updateAnnouncementPanelState(e,t=!1){this.props.changeAnnouncementPanelState({isDirty:e,isSaved:t})}get isEditorInputValid(){const{currentBbml:e,isMessageEditorPristine:t}=this.state;return t||e.length>0}renderBbEditorErrorMessage(){return this.isEditorInputValid?null:s.createElement("div",{className:"error-message",role:"alert"},s.createElement(P.Attention,null),s.createElement("span",null,this.props.t("course.announcements.errors.messages.messageRequired")))}render(){const e=this.getMode(),{permissions:t,courseContext:n,t:a,pluginConfig:i,fileUploadSettings:c}=this.props,{currentAnnouncement:l,isSaving:u,isValid:d,isSendEmailChecked:p,isScheduleChecked:g,isShowOnChecked:b,isEndChecked:C,startDate:S,startTime:y,endDate:D,endTime:v,isStartDateValid:T,isStartTimeValid:I,isEndDateValid:f,isEndTimeValid:k}=this.state,N=this.getTitle(l),w=(null==l?void 0:l.body.rawText)||"";return(t.viewUnposted||E.VIEW.isEqualTo(e))&&s.createElement("div",{className:"announcement-detail-panel"},E.VIEW.isEqualTo(e)&&s.createElement("div",{className:"panel-wrap"},s.createElement("header",{className:"panel-header simple-header"},s.createElement("div",{className:"panel-titles-container"},s.createElement("span",{className:"panel-sub-title"},a(Object(F.o)("announcements.pageTitle",null==n?void 0:n.isOrganization))),s.createElement("div",{className:"editable-title-container black-header-contents"},s.createElement(r.AnalyticsIconButton,{className:"left-off-canvas-toggle menu-toggle  standard-button dark-background",title:a("base.menu"),"aria-label":a("base.menu"),analyticsId:"course.announcements.detailPanel.menu.button"},s.createElement(P.MainMenu,null)),s.createElement("h1",{className:"panel-title",title:N},N)))),s.createElement("section",{className:"panel-container panel-content"},s.createElement("div",{className:"body-text"},s.createElement(Z,{editor:{bbml:w,pluginConfig:i,isReadOnly:!0,isToolbarHidden:!0,showWordCount:!1,onChange:this.onMessageChange,placeholder:a("course.announcements.detail.messageDesc")},fileUploadSettings:c})))),this.isEditableMode(e)&&s.createElement("div",{className:"peek-panel-with-footer"},s.createElement("div",{className:"panel-wrap"},s.createElement("header",{className:"panel-header simple-header"},s.createElement("div",{className:"panel-titles-container"},s.createElement("span",{className:"panel-sub-title"},n&&n.displayName||""),s.createElement("div",{className:"editable-title-container black-header-contents"},s.createElement(r.AnalyticsIconButton,{className:"left-off-canvas-toggle menu-toggle standard-button dark-background",title:a("base.menu"),"aria-label":a("base.menu"),analyticsId:"course.announcements.detailPanel.menu.button"},s.createElement(P.MainMenu,null)),s.createElement("h1",{className:"panel-title",title:N},N)))),s.createElement("section",{className:"panel-container panel-content -has-footer"},s.createElement(m.TextField,{className:"label-decorator",label:a("course.announcements.detail.title"),value:A(this.state.title),onChanged:this.onTitleChange,placeholder:a("course.announcements.detail.titleDesc"),ref:e=>{this.titleTextField=e},onGetErrorMessage:this.onTitleErrorMessage,required:!0,analyticsId:"course.announcements.detailPanel.title.input.text"}),s.createElement(m.Dropdown,{label:a("course.announcements.detail.recipients"),defaultSelectedKey:"all",required:!0,options:[{key:"all",text:a(Object(F.o)("announcements.detail.allRecipients",null==n?void 0:n.isOrganization),{studentCount:n&&n.membershipCount||0})}],analyticsId:"course.announcements.detailPanel.recipients.dropdown"}),s.createElement("div",{className:"panel-content__field"},s.createElement(m.Label,{className:"panel-content__field__label",id:"announcement-bb-editor-label",required:!0},a("course.announcements.detail.message")),s.createElement("div",{className:Object(o.a)("panel-content__message",{"-invalid":!this.isEditorInputValid})},s.createElement(Z,{editor:{bbml:w,pluginConfig:i,ariaLabelledBy:"announcement-bb-editor-label",ariaRequired:!0,isReadOnly:!1,isToolbarHidden:!1,onChange:this.onMessageChange,placeholder:a("course.announcements.detail.messageDesc"),showWordCount:!0},fileUploadSettings:c})),this.renderBbEditorErrorMessage()),s.createElement("div",null,s.createElement(K.AnalyticsFormControlLabel,{label:a("course.announcements.button.email"),disabled:g,htmlFor:"send-email-checkbox",className:"announcement-checkbox",control:s.createElement(K.AnalyticsCheckbox,{id:"send-email-checkbox",checked:p,onChange:this.onSendEmailChange,"aria-describedby":"email-checkbox-desc",analyticsId:"course.announcements.detailPanel.sendEmail.input.checkbox"}),"aria-describedby":"email-checkbox-desc",analyticsId:"course.announcements.detailPanel.sendEmail.input.label"}),s.createElement("p",{className:"information-message",id:"email-checkbox-desc"},a("course.announcements.detail.emailDesc")),s.createElement("p",{className:"information-message",id:"email-checkbox-warning"},a("course.announcements.detail.emailRestriction"))),s.createElement("div",null,s.createElement(K.AnalyticsFormControlLabel,{label:a("course.announcements.button.schedule"),disabled:p,htmlFor:"schedule-announcement-checkbox",className:"announcement-checkbox",control:s.createElement(K.AnalyticsCheckbox,{id:"schedule-announcement-checkbox",checked:g,onChange:this.onScheduleChange,"aria-describedby":"email-info-checkbox-desc",analyticsId:"course.announcements.detailPanel.scheduleAnnouncement.input.checkbox"}),"aria-describedby":"email-info-checkbox-desc",analyticsId:"course.announcements.detailPanel.scheduleAnnouncement.input.label"}),s.createElement("p",{className:"information-message",id:"email-info-checkbox-desc"},a("course.announcements.detail.scheduleEmailInfo")),g&&!p&&s.createElement("div",null,s.createElement("div",null,s.createElement(K.AnalyticsFormControlLabel,{label:a("course.announcements.dateTimePicker.showOn"),disabled:p,htmlFor:"show-on-checkbox",className:"announcement-checkbox",control:s.createElement(K.AnalyticsCheckbox,{id:"show-on-checkbox",checked:b,onChange:this.onShowOnChange,analyticsId:"course.announcements.detailPanel.showOn.input.checkbox"}),analyticsId:"course.announcements.detailPanel.showOn.input.label"}),s.createElement("div",{className:"row collapse date-time-inputs"},s.createElement("div",{className:"columns small-6"},s.createElement(G,{value:S,disabled:p,onChangeValue:e=>{this.setState({startDate:e})},onValidateCallback:e=>{this.setState({isStartDateValid:e})},onDateTimeChanging:e=>{this.setState({onDateTimeChangingPromise:e})},isValueValid:T||!b||p,errorFormatMessage:a("components.directives.validation.messages.errors.date"),errorEmptyMessage:a("components.directives.content-visibility.startDateError"),analyticsId:"course.announcements.detailPanel.showOn.datePicker"})),s.createElement("div",{className:"columns small-6"},s.createElement(x.W,{value:y,disabled:p,onChangeValue:e=>{this.setState({startTime:e})},onValidateCallback:e=>{this.setState({isStartTimeValid:e})},isValueValid:I||!b||p,onDateTimeChanging:e=>{this.setState({onDateTimeChangingPromise:e})},errorFormatMessage:a("components.directives.validation.messages.errors.time"),errorEmptyMessage:a("components.directives.content-visibility.startTimeError"),analyticsId:"course.announcements.detailPanel.showOn.timePicker"})))),s.createElement("div",null,s.createElement(K.AnalyticsFormControlLabel,{label:a("course.announcements.dateTimePicker.hideOn"),htmlFor:"hide-on-checkbox",className:"announcement-checkbox",control:s.createElement(K.AnalyticsCheckbox,{id:"hide-on-checkbox",checked:C,onChange:this.onHideOnChange,analyticsId:"course.announcements.detailPanel.hideOn.input.checkbox"}),analyticsId:"course.announcements.detailPanel.hideOn.input.label"}),s.createElement("div",{className:"row collapse date-time-inputs"},s.createElement("div",{className:"columns small-6"},s.createElement(G,{value:D,onChangeValue:e=>{this.setState({endDate:e})},onValidateCallback:e=>{this.setState({isEndDateValid:e})},onDateTimeChanging:e=>{this.setState({onDateTimeChangingPromise:e})},isValueValid:f||!C,disabled:!C,errorFormatMessage:a("components.directives.validation.messages.errors.date"),errorEmptyMessage:a("components.directives.content-visibility.endDateError"),analyticsId:"course.announcements.detailPanel.hideOn.datePicker"})),s.createElement("div",{className:"columns small-6"},s.createElement(x.W,{value:v,onChangeValue:e=>{this.setState({endTime:e})},onValidateCallback:e=>{this.setState({isEndTimeValid:e})},isValueValid:k||!C,disabled:!C,onDateTimeChanging:e=>{this.setState({onDateTimeChangingPromise:e})},errorFormatMessage:a("components.directives.validation.messages.errors.time"),errorEmptyMessage:a("components.directives.content-visibility.endTimeError"),analyticsId:"course.announcements.detailPanel.hideOn.timePicker"})))),!this.isEndLaterThanStart()&&s.createElement("span",{className:"error-message"},s.createElement(P.Attention,null),a("course.announcements.errors.messages.hideOnShouldLaterThanShowOn")))))),s.createElement("footer",{className:"panel-footer"},s.createElement("span",{className:"place-holder"}),s.createElement(h.AnalyticsDefaultButton,{className:"button-cancel",onClick:this.onCancel,analyticsId:"course.announcements.detailPanel.cancel.button"},a("course.announcements.button.cancel")),s.createElement(h.AnalyticsPrimaryButton,{className:"button-save",disabled:!(d&&this.validateSchedule()&&this.isEndLaterThanStart()),onClick:this.onSave,analyticsId:"course.announcements.detailPanel.save.button"},a("course.announcements.button.save")))),u?s.createElement("div",{className:"spinner bb-secondary-color-2"}):"")}}var ne=Object(i.b)((e=>({announcements:e.announcement.announcements,courseContext:e.announcement.courseContext,announcement:e.announcement.announcement,detailPanelState:e.announcement.detailPanelState,fileUploadSettings:q.Yb.fileUploadSettings.getFileUploadSettings(e)})),(e=>Object(_.b)({saveAnnouncement:q.V.announcement.saveAnnouncement,getCourseContext:q.V.announcement.getCourseContext,getAnnouncement:q.V.announcement.getAnnouncement,changeAnnouncementPanelState:q.V.announcement.changeAnnouncementPanelState},e)))(Object(c.a)(te)),se=n("gh1U");class ae extends s.Component{constructor(e){super(e),this.onOpenAllAnnouncements=()=>{const{onOpenAllAnnouncements:e}=this.props;e(),this.onDismissAll()},this.openAnnouncementDetail=e=>{const{openAnnouncementDetail:t}=this.props;t(e),this.onDismissAll()},this.onDismissAll=()=>{this.announcementSlides.forEach((e=>this.props.dismissAnnouncementItem(e.sourceEntry))),this.onCloseSlideModal()},this.updateContext=()=>{const{currentViewingIndex:e,currentAnnouncement:t}=this.state,{courseContext:n,getCourseContext:s}=this.props;t&&t.courseId&&e>=0&&(n&&n.courseId===t.courseId||s(t.courseId))},this.onCloseSlideModal=()=>{this.setState({showModal:!1})},this.state={currentAnnouncement:null,currentViewingIndex:-1,showModal:!1}}componentDidMount(){this.props.fetchAnnouncementSlides().then((e=>{e.sort((function(e,t){return e.startDateRestriction&&t.startDateRestriction?e.startDateRestriction.toISOString().localeCompare(t.startDateRestriction.toISOString()):0})),this.announcementSlides=e.slice(),this.announcementSlides.length>0&&this.setState({currentViewingIndex:0,currentAnnouncement:{...this.announcementSlides[0]},showModal:!0},this.updateContext),this.elementCards=this.announcementSlides.map((e=>{var t;return s.createElement("li",{className:"element-card",key:e.id},s.createElement("div",{className:"element-image"},s.createElement(k.a,{color:"primary"})),s.createElement("div",{className:"element-details"},s.createElement("div",{className:"name"},s.createElement("a",{className:"rows-block header-title",onClick:()=>{this.openAnnouncementDetail(e.id)},href:"#"},A(e.title)),s.createElement("span",{className:"rows-block header-sent-date"},D(null===(t=e.startDateRestriction)||void 0===t?void 0:t.toISOString(),this.props.localize))),s.createElement("br",null),s.createElement("div",{className:"rows-block body-text message-entries"},s.createElement("p",null,T(e.body.rawText,this.props.localize)))))}))}))}render(){const{localize:e,courseContext:t}=this.props;return s.createElement(se.Modal,{isOpen:this.state.showModal,containerClassName:"ms-modalExample-container container-inherit"},s.createElement("div",{className:"notice notification "+this.props.courseColorClass+" reveal-modal course-announcements-slide open in"},s.createElement("div",{className:"title-container"},s.createElement("h1",{className:"title-modal"},e.translate(Object(F.o)("announcements.newCourseAnnouncements",null==t?void 0:t.isOrganization))),s.createElement(r.AnalyticsIconButton,{"aria-label":e.translate("course.announcements.closeModal"),className:"close-modal-button",onClick:this.onDismissAll,analyticsId:"course.announcements.modal.close.button"},s.createElement(P.Close,null))),s.createElement("div",{className:"modal-contents"},s.createElement("ul",{className:"modal-notifications"},this.elementCards)),s.createElement("div",{className:"announcement-modal-footer"},s.createElement(h.AnalyticsPrimaryButton,{onClick:this.onOpenAllAnnouncements,className:"view-all-announcements-button",analyticsId:"course.announcements.slide.view.all.button"},e.translate("course.announcements.button.viewAll")))))}}var ie=Object(i.b)((e=>({courseContext:e.announcement.courseContext})),(e=>Object(_.b)({getCourseContext:q.V.announcement.getCourseContext},e)))(Object(d.a)(ae)),oe=n("4JTD");n.d(t,"a",(function(){return E}));const re=(e,t,n,i,o,r)=>{let c=n;null==n&&"undefined"!=typeof window&&window.location.search.match("setLang=")&&(c=window.location.search.match(/setLang=([^$&]+)/)[1]),a.render(s.createElement(K.AnalyticsJssThemeProvider,{theme:"light",isRtl:r},s.createElement(oe.a,{locale:c,babelfishInstance:i,babelfishFormatInstance:o,bundlesToLoad:["announcements/locales/[locale]/announcements.json"],isRtl:r},s.createElement("div",null,e))),t)},ce={renderAnnouncementListPanel:(e,t,n,a,o,r,c,l,u)=>{re(s.createElement(i.a,{store:t},s.createElement(Y,{courseId:c,permissions:l,root:e,openAnnouncementDetailPanel:u})),e,n,a,o,r)},destroyAnnouncementListPanel:e=>{a.unmountComponentAtNode(e)},renderAnnouncementDetailPanel:(e,t,n,a,o,r,c,l,u,d,m,h)=>{re(s.createElement(i.a,{store:t},s.createElement(ne,{courseId:c,announcementId:l,permissions:u,mode:d,closePanel:m,pluginConfig:h})),e,n,a,o,r)},destroyAnnouncementDetailPanel:e=>{a.unmountComponentAtNode(e)},renderAnnouncementSlide:(e,t,n,a,o,r,c,l,u,d,m)=>{re(s.createElement(i.a,{store:t},s.createElement(ie,{courseColorClass:c,fetchAnnouncementSlides:l,dismissAnnouncementItem:m,onOpenAllAnnouncements:u,openAnnouncementDetail:d})),e,n,a,o,r)},destroyAnnouncementSlide:e=>{a.unmountComponentAtNode(e)}};t.b=ce}}]);