(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{"/ugB":function(e,t){e.exports='<bb-telemetry-chart ng-if="telemetry.showData"\n                    chart-config="telemetry.chart"\n                    reflow-chart-on="reflowChartOn()"\n                    table-config="telemetry.table"\n                    course="course()"\n                    selected-user="user()"\n                    filename-suffix="a"\n                    source="userActivity"\n                    can-view-all-user-data="canViewAllUserData()"\n                    class="telemetry-time-series">\n  \x3c!-- Activity time-series table --\x3e\n  <div st-table="rows" st-safe-src="telemetry.table.rows" class="activity-time-series-table">\n    <table class="fs-table table table-striped">\n      <thead>\n      <tr>\n        <th id="my-activity-date-header"\n            scope="col"\n            class="telemetry-sortable"\n            st-sort="date"\n            st-skip-natural="true"\n            st-sort-default="true" >\n            <span role="button" tabindex="0">\n              <bb-translate>components.directives.telemetry.table.dateColumn</bb-translate>\n              <span id="my-activity-date-header-asc">\n                <span class="sr-only" bb-translate>components.directives.telemetry.table.ascendingOrder</span>\n              </span>\n              <span id="my-activity-date-header-desc">\n                <span class="sr-only" bb-translate>components.directives.telemetry.table.descendingOrder</span>\n              </span>\n            </span>\n        </th>\n        <th scope="col" bb-translate>components.directives.telemetry.table.classActivityColumn</th>\n        <th scope="col" bb-translate>components.directives.telemetry.table.classActivityConfidenceColumn</th>\n        <th scope="col" bb-translate>components.directives.telemetry.table.classActivityInstructor</th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr ng-repeat="row in rows">\n        <td scope="row" class="date" bb-translate translate-values="{ value: row.date }">components.directives.telemetry.table.dateValue</td>\n        <td class="activity-class">\n          <span class="round" bb-translate translate-values="{ value: row.courseValue }">components.directives.telemetry.table.activityValue</span>\n        </td>\n        <td class="delta">\n          <span class="round" bb-translate translate-values="{ min: row.intervalMin, max: row.intervalMax }">components.directives.telemetry.table.activityValueRange</span>\n        </td>\n        <td class="activity">\n          <span class="round" bb-translate translate-values="{ value: row.studentValue }">components.directives.telemetry.table.activityValue</span>\n          <span class="deviation down" ng-if="::row.belowStdDev && row.diffFromInterval >= 0.01 " bb-translate translate-values="{ diff: row.diffFromInterval }">components.directives.telemetry.table.valueBelowInterval</span>\n          <span class="deviation up" ng-if="::row.aboveStdDev && row.diffFromInterval >= 0.01 " bb-translate translate-values="{ diff: row.diffFromInterval }">components.directives.telemetry.table.valueAboveInterval</span>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n  <div class="telemetry-table-legend" ng-show="telemetry.table.hasDataOutsideInterval">\n    <div class="telemetry-table-legend-container">\n      <span class="legend-entry">\n      <span class="ci-icon above-ci-icon"></span>\n      <span class="ci-label" bb-translate>components.directives.telemetry.table.legendAboveCI</span>\n    </span>\n      <span class="legend-entry">\n      <span class="ci-icon below-ci-icon"></span>\n      <span class="ci-label" bb-translate>components.directives.telemetry.table.legendBelowCI</span>\n    </span>\n    </div>\n  </div>\n</bb-telemetry-chart>\n'},"1ovh":function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return o}));var s,r=n("7g5f"),a=n("/ugB");function i(e){if(e)return Object.values(s).find((t=>t.toLowerCase()===e.toLowerCase()))}function o(e){switch(e){case s.Activity:return a;case s.Grades:return r}}!function(e){e.Grades="grades",e.Activity="activity"}(s||(s={}))},"3Bw1":function(e,t){e.exports='<bb-modal id="content-deleted-modal"\n          class="notification"\n          modal-title-key="base.stream.modal.deleted.title"\n          analytics-id-tag-prefix="base.stream.modal.deleted">\n  <div name="modal-contents">\n    <p bb-translate>base.stream.modal.deleted.body</p>\n  </div>\n  <button name="modal-footer-button-primary" class="button confirm-ok js-primary-button" ng-click="$parent.$close()" bb-translate analytics-id="global.ok">global.ok</button>\n</bb-modal>\n'},"7C3+":function(e,t,n){"use strict";n.d(t,"g",(function(){return f})),n.d(t,"h",(function(){return g})),n.d(t,"f",(function(){return S})),n.d(t,"e",(function(){return I})),n.d(t,"a",(function(){return v})),n.d(t,"d",(function(){return D})),n.d(t,"b",(function(){return _})),n.d(t,"c",(function(){return C}));var s=n("nsO7"),r=n("Llzl"),a=n("6ynb"),i=n("0JpG"),o=n("vhkR"),c=n("Is+C"),l=n("Fvsw"),d=n("KBr+"),u=n("P2dS"),p=n("12mu"),h=n("pjml"),m=n("8jzW"),y=n("KtUo"),b=n("r6lH"),E=n("av75"),T=n("nmzr");const f="ultra.service.stream.transformer.data",g="baseStreamEntryTransformer";class S{static getCourseId(e){return e&&e.se_courseId||e&&e.se_orgId||""}static getCourseName(e){return e&&e.ui.streamCourse&&e.ui.streamCourse.name||""}static getSequenceId(e){return e.se_id.substr(e.providerId.length)}static getEntryType(e){if(e){const t=e.extraAttribs&&e.extraAttribs.event_type||e.providerId;if(t&&t.length>0)return t.trim()}throw new Error("Type identifier does not exist on the given Learn stream entry."+(e.se_id||""))}static generateStreamId(e){return e&&e.se_id||"local_"+S.index++}static validateEntriesForGrouping(e,t){let n=e&&e.length>0;if(n){const s=e[0].courseId;n=e.every((e=>e.isGroupable&&t.some((t=>t===e.type))&&e.courseId===s))}return n}static hasNewEntry(e){return e&&e.some((e=>e.isNew))||!1}static getMostRecentEntry(e){return e&&e.length>0?s.sortBy(e,"notificationCreationDate")[e.length-1]:null}static getGroupedEntryIds(e){let t=[];return e&&Array.isArray(e)&&e.forEach((e=>{const n=e.groupedEntryIds;n?t=t.concat(n):t.push(e.id)})),t}static getDistinctAuthorIds(e,t){const n={};return e.forEach((e=>{const s=e.authorIds;if(s)s.forEach((e=>{n[e]=n[e]||[]}));else{const s=t(e);(n[s]=n[s]||[]).push(e)}})),Object.keys(n)}static getCoursePanelStateRef(e,t){return"course.outline("+r.toJson({courseId:e,legacyUrl:t})+")"}static getDiscussionPanelStateRef(e,t){return'discussion.view.with-grading({ contentId: "'+e+'", courseId: "'+t+'" })'}static getJournalPanelStateRef(e,t){return`${T.B.JOURNAL_VIEW_WITH_PARTICIPATION}({ contentId: "${e}", courseId: "${t}" })`}}S.DUE_DATE_FORMAT=i.ILocaleDatetimeFormat.Short,S.index=1;class I extends a.a{constructor(e){super(e),this.name="StreamEntriesGroupingError"}}class v{constructor(e){this.supportedTypes=e}canHandle(e){return e&&this.canHandleType(S.getEntryType(e))}canHandleType(e){return this.supportedTypes&&this.supportedTypes.some((t=>0===t.indexOf(e)))}convert(e){return{id:S.generateStreamId(e),type:S.getEntryType(e),providerId:e.providerId,eventType:e.itemSpecificData.eventType,notificationCreationDate:e.se_timestamp>0?new Date(e.se_timestamp):null,contextualDate:null,icon:null,isNew:!1,isImportant:!1,isGroupable:!1,courseId:S.getCourseId(e),isOrg:e&&e.ui.streamCourse&&e.ui.streamCourse.isOrganization||null,header:S.getCourseName(e),title:null,contentHandler:e.itemSpecificData.contentDetails&&e.itemSpecificData.contentDetails.contentHandler}}setLegacyCourseUrlRefToBody(e,t){const n=e&&e.ui&&e.ui.streamCourse,s=e&&e.se_itemUri;n&&n.isClassic()&&s&&(t.body=t.body||{},t.body.stateRef=S.getCoursePanelStateRef(n.id,s))}}class D extends v{constructor(e,t){super(t),this.bbLocalize=e}convert(e){const t=super.convert(e);return t.entrySpecificData=e.ui.streamUser?{streamUser:e.ui.streamUser}:null,t}getUserDisplayName(e){return this.bbLocalize.formatUsername(e,i.ILocaleUsernameFormat.Short,null,{noWrap:!0,noEscape:!0})}}class _ extends v{constructor(){super([])}canHandle(e){return!1}canHandleType(e){return!1}convert(e){const t=super.convert(e),n=e.itemSpecificData;return t.icon=_.DEFAULT_ICON,t.body={type:E.a.SimpleText,content:{bodyText:n.contentExtract||e.se_details||e.se_context}},t}}_.DEFAULT_ICON="post";class C extends v{constructor(e,t){super(y.b(e)),this.supportedEventTypes=e}canHandleType(e){if(!this.supportedEventTypes||!Object.keys(this.supportedEventTypes).length)return!1;const t=e.split(":")[0],n=this.supportedEventTypes[t];return n&&n.length>0&&n.some((t=>0===t.indexOf(e)))}convert(e){const t=super.convert(e),n=e.itemSpecificData.notificationDetails;return t.icon=C.TYPE_ICON_MAPPINGS[n.sourceType]||t.icon,t.notificationIds=n.notificationIds,t}}C.TYPE_ICON_MAPPINGS={AS:"assignment",BL:"blog",CM:"message",CR:"course",DF:"discussion",DT:"discussion",JN:"journal",GB:"grades",PE:"test",PS:"test",QU:"course",SU:"survey",SC:"scormengine",TE:"test",UA:"assignment",WK:"wiki"};r.module(f,[i.moduleName,o.a,c.b,l.a,d.a,p.a,h.N,m.b,b.a,u.b]).service(g,_)},"7g5f":function(e,t){e.exports='<bb-telemetry-chart ng-if="telemetry.showData"\n                    chart-config="telemetry.chart"\n                    reflow-chart-on="reflowChartOn()"\n                    table-config="telemetry.table"\n                    course="course()"\n                    selected-user="user()"\n                    filename-suffix="g"\n                    source="userGrade"\n                    can-view-all-user-data="canViewAllUserData()"\n                    y-axis-zoom-enabled="false"\n                    class="telemetry-time-series">\n  \x3c!-- Grade time-series table --\x3e\n  <div st-table="rows" st-safe-src="telemetry.table.rows" class="grade-time-series-table">\n    <table class="fs-table table table-striped">\n      <thead>\n      <tr>\n        <th id="my-grades-date-header"\n            scope="col"\n            class="telemetry-sortable"\n            st-sort="date"\n            st-skip-natural="true"\n            st-sort-default="true">\n            <span tabindex="0" role="button">\n              <bb-translate>components.directives.telemetry.table.dateColumn</bb-translate>\n              <span id="my-grades-date-header-asc">\n                <span class="sr-only" bb-translate>components.directives.telemetry.table.ascendingOrder</span>\n              </span>\n              <span id="my-grades-date-header-desc">\n                <span class="sr-only" bb-translate>components.directives.telemetry.table.descendingOrder</span>\n              </span>\n            </span>\n        </th>\n        <th scope="col" bb-translate>components.directives.telemetry.table.classGradeColumn</th>\n        <th scope="col" bb-translate>components.directives.telemetry.table.classGradeConfidenceColumn</th>\n        <th scope="col" bb-translate>components.directives.telemetry.table.classGradeInstructor</th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr ng-repeat="row in rows">\n        <td scope="row" class="date" bb-translate translate-values="{ value: row.date }">components.directives.telemetry.table.dateValue</td>\n        <td class="grade-class">\n          <span class="round" bb-translate translate-values="{percentage: row.courseValue}">global.percentDecimal</span>\n        </td>\n        <td class="delta">\n          <span class="round" bb-translate translate-values="{ min: row.intervalMin, max: row.intervalMax }">components.directives.telemetry.table.gradeValueRange</span>\n        </td>\n        <td class="grade">\n          <div><readonly-grade-pill grade="row.studentValue" points-possible="telemetry.gradePillSettings.pointsPossible"\n                                  variant="telemetry.gradePillSettings.variant"\n                                  grade-color-variant="telemetry.gradePillSettings.colorDefault">\n          </readonly-grade-pill></div>\n          <span class="deviation down" ng-if="::row.belowStdDev && row.diffFromInterval >= 0.01" bb-translate translate-values="{ diff: row.diffFromInterval }">components.directives.telemetry.table.valueBelowInterval</span>\n          <span class="deviation up" ng-if="::row.aboveStdDev && row.diffFromInterval >= 0.01" bb-translate translate-values="{ diff: row.diffFromInterval }">components.directives.telemetry.table.valueAboveInterval</span>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n  <div class="telemetry-table-legend" ng-show="telemetry.table.hasDataOutsideInterval">\n    <div class="telemetry-table-legend-container">\n      <span class="legend-entry">\n      <span class="ci-icon above-ci-icon"></span>\n      <span class="ci-label" bb-translate>components.directives.telemetry.table.legendAboveCI</span>\n    </span>\n      <span class="legend-entry">\n      <span class="ci-icon below-ci-icon"></span>\n      <span class="ci-label" bb-translate>components.directives.telemetry.table.legendBelowCI</span>\n    </span>\n    </div>\n  </div>\n</bb-telemetry-chart>\n'},"8iPc":function(e,t){e.exports='<p class="summary" ng-if="::bodyContent().bodyText" ng-bind-html="::bodyContent().bodyText"></p>\n<a class="button button--secondary action-button"\n   ng-if="::!bodyContent().isComponentActionSref"\n   bb-peek-sref="{{bodyContent().actionSref}}"\n   analytics-id="base.stream.entryBody.telemetry.link">{{::bodyContent().actionText}}</a>'},EtRF:function(e,t,n){"use strict";var s;!function(e){e.Default="retention-center",e.Kudos="kudos",e.Alert="alert-error"}(s||(s={})),t.a=s},"KBr+":function(e,t,n){"use strict";var s=n("Llzl"),r=n("iYZE");const a="ultra.utility.batchLoader",i="BatchLoaderFactory";class o{constructor(e,t,n,s){this.modelStatic=t,this.$q=n,this.$timeout=s,this.toFetch={},this.cache=new r(e)}push(e,t){const n=this.cache.get(e);if(void 0!==n)return t(null,this.modelStatic.$buildRaw(n),e);const s=this.toFetch[e];null==s?this.toFetch[e]=[t]:s.push(t)}load(e){const t=this.$q.defer();return s.isArray(e)&&e.length>0||!s.isArray(e)?this._loadInternal(e,((e,n,s)=>{e?t.reject(e):t.resolve(n)})):t.resolve({}),t.promise}_loadInternal(e,t){if(Array.isArray(e)){const n=this.getCoalescingCallback(e.length,t);for(let t=0;t<e.length;t++)this.push(e[t],n)}else this.push(e,t);this.lazyLoad()}_load(){const e=this.toFetch;this.toFetch={};const t=Object.keys(e);0!==t.length&&this.modelStatic.findMany(t).$asPromise().then((n=>{let s,r={};if(Array.isArray(n))for(let e=0;e<n.length;e++)s=n[e],r[s.id]=s;else{if("object"!=typeof n)throw new Error("Invalid items format");r=n}for(let n=0;n<t.length;n++){const a=t[n];s=r[a];const i=e[a];this.cache.set(a,void 0===s?null:s.$encode());for(let e=0;e<i.length;e++)i[e](null,s,a)}}),(n=>{t.forEach((t=>{e[t].forEach((e=>{e(n)}))}))}))}lazyLoad(){null==this.timeout&&(this.timeout=this.$timeout((()=>{this._load(),this.timeout=null}),0,!1))}getCoalescingCallback(e,t){let n=!1;const s={};let r=0;return(a,i,o)=>{if(!n){if(a)return n=!0,t(a);i&&(s[o]=i),r++,r>=e&&(n=!0,t(null,s))}}}}s.module(a,[]).factory(i,["$q","$timeout",(e,t)=>function(n,s){return new o(n,s,e,t)}]);var c=n("pjml");n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return d}));const l="ultra.batchLoader.courseNameBatchLoader",d="CourseBatchLoader";class u{constructor(e,t){this.batchLoader=e(200,t)}load(e){return this.batchLoader.load(e)}}u.$inject=[i,c.m.serviceName];s.module(l,[a,c.N]).service(d,u)},KtUo:function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a}));const s=function(e){return e.contextualDate||e.notificationCreationDate},r=function(e,t){const n=new Date(t.getTime());n.setHours(0,0,0,0);const s=new Date(n.getTime()+864e5);return e<n?-1:e>=s?1:0},a=function(e){return e&&Object.keys(e||{}).reduce(((t,n)=>t.concat(e[n])),[])}},OaxLs:function(e,t,n){"use strict";var s=n("D57K"),r=n("nsO7"),a=n("Llzl"),i=n("5MwF"),o=n("Fvsw"),c=n("xpqL"),l=n("yC9S"),d=n("adx1"),u=n("aHpC"),p=n("MOka"),h=n("KtUo");var m=function(e){return e.filter((function(e){return e.isImportant}))};var y=function(e,t){return e.filter((function(e){const n=h.c(e);return!e.isImportant&&n&&h.a(n,t)<0}))};var b=function(e,t){return e.filter((function(e){const n=h.c(e);return!e.isImportant&&n&&0===h.a(n,t)}))};var E=function(e,t){return e.filter((function(e){const n=h.c(e);return!e.isImportant&&n&&h.a(n,t)>0}))},T=n("av75");class f{constructor(){this.allEntries=[],this.view=[]}addEntries(e){this.allEntries=this.allEntries.concat(e)}refreshView(e){this.view=[].concat((e?e(this.allEntries):this.allEntries).filter((e=>!e.hidden)))}deleteEntries(e){this.allEntries=this.allEntries.filter((t=>-1===e.indexOf(t.id)))}}class g extends f{constructor(e){super(),this.entryLoader=e}addEntries(e){super.addEntries(m(e))}deleteEntry(e){if(e.isImportant){const t=this.allEntries.indexOf(e);t>=0&&(this.allEntries.splice(t,1),this.refreshView(this.entryLoader.viewFilter))}}refreshView(e){super.refreshView(e),this.entryLoader._updateBadgeCount()}}class S extends f{constructor(e){super(),this.context=e,this.hasMoreInView=!1}addEntries(e){super.addEntries(E(e,this.context.getServerTime())),this.allEntries=r.sortBy(this.allEntries,h.c)}refreshView(e){super.refreshView(e);const t=this.view.slice(P.UPCOMING_MAX_LENGTH,this.view.length);this.hasMoreInView=t.length>0&&t.some((e=>e.body&&e.body.type===T.a.DueDatedContent)),this.view=this.hasMoreInView?this.view.slice(0,P.UPCOMING_MAX_LENGTH):this.view}}class I extends f{constructor(e,t,n){super(),this.context=e,this.entryLoader=t,this.streamSettings=n}addEntries(e){super.addEntries(b(e,this.context.getServerTime())),this.allEntries=this.entryLoader.groupStreamEntries(this.allEntries);const t=this.context.getServerTime(),n=this.allEntries.filter((e=>h.c(e)>=t)),s=this.allEntries.filter((e=>h.c(e)<t));this.allEntries=r.sortBy(n,h.c).concat(r.sortBy(s,h.c).reverse()),this.allEntries.forEach((e=>{e.hidden=this.streamSettings.hidden(e)}))}deleteEntries(e){this.allEntries=this.allEntries.filter((t=>{const n=t;if(n.groupedEntryIds){n.groupedEntryIds=n.groupedEntryIds.filter((t=>-1===e.indexOf(t)));const t=n;return t.entryContents&&(t.entryContents=t.entryContents.filter((t=>-1===e.indexOf(t.id)))),n.groupedEntryIds.length>0}return-1===e.indexOf(t.id)}))}}class v extends f{constructor(e,t){super(),this.context=e,this.entryLoader=t,this._currentViewFilter=null,this.queuedView=[]}addEntries(e){super.addEntries(y(e,this.context.getServerTime())),this.allEntries=r.sortBy(this.allEntries,h.c).reverse()}refreshView(e){this.queuedView=[].concat((e?e(this.allEntries):this.allEntries).filter((e=>!e.hidden))),(e||null)!==this._currentViewFilter?(this.view=[],this.loadMoreEntriesIntoView(),this._currentViewFilter=e):this.view=this.queuedView.splice(0,this.view.length)}loadMoreEntriesIntoView(){if(this.queuedView.length>0){const e=this.queuedView.splice(0,this._numEntriesToLoad());Array.prototype.push.apply(this.view,e)}}_numEntriesToLoad(){const e=this.entryLoader.countViewEntries();return e>=v.MAX_ENTRIES_TO_PROGRESSIVE_LOAD?v.MAX_ENTRIES_TO_PROGRESSIVE_LOAD:v.MAX_ENTRIES_TO_PROGRESSIVE_LOAD-e}get MAX_ENTRIES_TO_PROGRESSIVE_LOAD(){return v.MAX_ENTRIES_TO_PROGRESSIVE_LOAD}}v.MAX_ENTRIES_TO_PROGRESSIVE_LOAD=20;var D=n("eQBN");n.d(t,"c",(function(){return _})),n.d(t,"d",(function(){return C})),n.d(t,"a",(function(){return R})),n.d(t,"b",(function(){return P}));const _="ultra.service.stream.loader",C="streamEntryLoader";let A=0;const R="PullingTaskScheduled";let P=class e extends d.a{constructor(e,t,n,s,a,i,o,c){super(),this.$interval=e,this.$log=t,this.$q=n,this.$rootScope=s,this.context=a,this.streamEntryManager=i,this.streamSettings=o,this.studentPreview=c,this.badgeCount=0,this.loadingErrorCount=0,this.buckets={},this.preLoading=!0,this.loadingStreamEntriesInProgress=!1,this.oneLoadingIsQueued=!1,this.buckets={important:new g(this),upcoming:new S(a),today:new I(a,this,o),previous:new v(a,this)},l.b.OnRootScope(this.$rootScope,"stream-entry-parent-item-not-found",((e,t)=>{this.deleteEntries([t.id]),this.refreshEntries(!0)})),l.b.OnRootScope(this.$rootScope,"stream-settings-updated",(()=>{this.reapplySettings()})),this.studentPreview.isInIframeOfPreviewMode()||this.init(),l.b.OnRootScope(this.$rootScope,"update-course-status",((e,t)=>{const n=[];r.forEach(this.buckets,(e=>{r.forEach(e.allEntries,(e=>{e.courseId&&e.courseId===t&&!e.isOrg&&n.push(e.id)}))})),this.deleteEntries(n),this.refreshEntries(!0)})),l.b.OnRootScope(this.$rootScope,"update-course-name",((e,t)=>{r.forEach(this.buckets,(e=>{r.forEach(e.allEntries,(e=>{e.courseId&&e.courseId===t.id&&!e.isOrg&&(e.header=t.displayName)}))}))}))}init(){this.initialLoading=this.streamSettings.initializeSettings().finally((()=>{this.preLoading=!1;try{return this.schedulePullingTask()}finally{this.currentTask.run()}})),this.streamEntryManager.$onStreamPulled(((e,t)=>{this._queueStreamData(t)}))}schedulePullingTask(e=!1){if(this.currentTask&&!e)return this.currentTask.promise;this.$log.debug("Stream Polling Task Scheduled",(new Date).toISOString());const t=this.$q.defer(),n=this.$q.defer(),s=this.currentTask={id:A++,run:r.once((()=>{window.requestAnimationFrame((()=>{this.$log.debug("Stream Polling Task Running",(new Date).toISOString()),this._loadEntries(e).finally((()=>{t.resolve(!0),s.run=r.once((()=>n.resolve()));const e=this.$interval(r.noop,i.a.streamLoadingInterval,1,!1);return this.$q.race([n.promise,e]).then((()=>{this.$interval.cancel(e)}))})).then((()=>{this.currentTask=null,this.schedulePullingTask()}))}))})),promise:t.promise};return this.$emitEvent(R,this.currentTask),t.promise}_loadEntries(e){return this.loadingStreamEntriesInProgress?this.oneLoadingIsQueued?null:(this.oneLoadingIsQueued=!0,this.loadEntriesPromise.then((()=>(this.oneLoadingIsQueued=!1,this._loadEntries(e))))):(this.loadingStreamEntriesInProgress=!0,this.loadEntriesPromise=this.streamEntryManager.loadAllStreamEntries((()=>{}),e).then((()=>{this.loadingErrorCount=0}),(()=>{this.loadingErrorCount++,this.loadingErrorCount>=w.MAX_LOADING_ERRORS&&this.cancelPeriodicLoading()})).finally((()=>{this.loadingStreamEntriesInProgress=!1})),this.loadEntriesPromise)}refreshEntries(e){return this.schedulePullingTask(e)}cancelPeriodicLoading(){this.$log.error("Stream loading errors")}reapplySettings(){this.getAllEntries().then((e=>{e.forEach((e=>{e.hidden=this.streamSettings.hidden(e)})),this._refreshViews()}))}isStreamLoading(){return this.loadingStreamEntriesInProgress||this.preLoading}groupStreamEntries(t){if(t&&t.length>0){const n={};t.forEach((t=>{const s=t.type+e.ENTRY_GROUPING_KEY_DELIMITER+t.courseId;(n[s]=n[s]||[]).push(t)}));let s=[];return Object.keys(n).forEach((t=>{let r=n[t];if(1!==r.length&&r[0].isGroupable){const n=t.split(e.ENTRY_GROUPING_KEY_DELIMITER)[0];r=this.streamEntryManager.processGroupStreamEntry(r,n),s=s.concat(r)}else s=s.concat(r)})),s}return t}bulkUpdateEntryStatus(e){e.forEach((e=>{a.isUndefined(e.hidden)&&(e.hidden=this.streamSettings.hidden(e))}))}_queueStreamData(e){this._deleteEntries(e.deletedIds,!1),this._populateEntries(e.entries)}_populateEntries(e){this.bulkUpdateEntryStatus(e),this.addEntries(e,!1)}deleteEntries(e){this._deleteEntries(e,!1)}_deleteEntries(e,t){e&&e.length>0&&(this.allBuckets().forEach((t=>t.deleteEntries(e))),t||this._refreshViews())}addEntries(e,t){e&&e.length>0&&(this.allBuckets().forEach((t=>t.addEntries(e))),t||this._refreshViews())}removeImportantEntry(e){this.buckets.important.deleteEntry(e)}_refreshViews(){this.allBuckets().forEach((e=>e.refreshView(this.viewFilter)))}_updateBadgeCount(){this.badgeCount=this.buckets.important.view.length}allBuckets(){return Object.keys(this.buckets).reduce(((e,t)=>(e.push(this.buckets[t]),e)),[])}_countAllEntries(){return this.allBuckets().reduce(((e,t)=>e+t.allEntries.length),0)}findEntry(e){return this.getAllEntries().then((t=>r.find(t,{id:e})))}getAllEntries(){return this.studentPreview.isInIframeOfPreviewMode()?this.$q.when([]):this.initialLoading.then((()=>this._getAllEntries()))}_getAllEntries(){return Object.keys(this.buckets).reduce(((e,t)=>e.concat(this.buckets[t].allEntries)),[])}countViewEntries(){return this.allBuckets().reduce(((e,t)=>e+t.view.length),0)}setViewFilter(e){this.viewFilter=e,this._refreshViews()}_reset(){this.allBuckets().forEach((e=>{e.allEntries=[]})),this._refreshViews()}};P.ENTRY_GROUPING_KEY_DELIMITER="##",P.UPCOMING_MAX_LENGTH=5,P.MAX_LOADING_ERRORS=3,P=Object(s.a)([Object(s.c)(0,Object(u.b)("$interval")),Object(s.c)(1,Object(u.b)("$log")),Object(s.c)(2,Object(u.b)("$q")),Object(s.c)(3,Object(u.b)("$rootScope")),Object(s.c)(4,Object(u.b)(o.b)),Object(s.c)(5,Object(u.b)(c.b)),Object(s.c)(6,Object(u.b)(p.b)),Object(s.c)(7,Object(u.b)(D.e))],P);class w extends P{}a.module(_,[o.a,D.b,c.a]).service(C,P)},Oy15:function(e,t){e.exports='<span class="due-date" ng-switch on="bodyContent().localizedDueDate != null">\n  <bb-translate ng-switch-when="true" translate-values="{ datetime: \'{{bodyContent().localizedDueDate}}\' }">base.stream.entryBody.duedatedContent.dueDate</bb-translate>\n  <bb-translate ng-switch-when="false">base.stream.entryBody.duedatedContent.noDueDate</bb-translate>\n</span>\n\n'},ZNC7:function(e,t,n){"use strict";var s;function r(e){switch(e){case s.BoxNotification:return"notification-box";case s.DefaultNotification:return"notification-default"}}function a(e){return e===s.BoxNotification?"first-of-box":""}n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a})),function(e){e.BoxNotification="BOX_NOTIFICATION",e.DefaultNotification="DEFAULT_NOTIFICATION"}(s||(s={}))},av75:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return l}));var s,r=n("u2fd"),a=n("Oy15"),i=n("gFY1"),o=n("sbY4"),c=n("8iPc");function l(e){switch(e){case s.Calendar:return i;case s.DueDatedContent:return a;case s.SimpleText:return r;case s.Telemetry:return c;case s.Grades:return o}}!function(e){e.SimpleText="SIMPLE_TEXT",e.DueDatedContent="DUE_DATED_CONTENT",e.Calendar="CALENDAR",e.Grades="GRADES",e.Telemetry="TELEMETRY"}(s||(s={}))},gFY1:function(e,t){e.exports='<p class="summary">{{bodyContent().eventDescription}}</p>\n<bb-translate ng-if="!(bodyContent().isAllDayEvent)" translate-values="{ datetime: \'{{bodyContent().localizedEventDate}}\' }">base.stream.entryBody.calendar.eventDate</bb-translate>\n<bb-translate ng-if="bodyContent().isAllDayEvent" translate-values="{ date: \'{{bodyContent().localizedEventDate}}\' }">base.stream.entryBody.calendar.allDayEventDate</bb-translate>\n'},iG2q:function(e,t,n){"use strict";var s=n("nsO7"),r=n("Llzl"),a=n("nbDY"),i=n.n(a),o=n("7C3+"),c=n("m3mx"),l=n("Fvsw"),d=n("pjml"),u=n("0JpG"),p=n("g66W"),h=n("av75");const m="announcementStreamEntryTransformer";class y extends o.a{constructor(e,t,n,s){super(y.SUPPORTED_EVENT_TYPES),this.bbLocalize=e,this.context=t,this.CourseModel=n,this.remove=function(){return s.all(this.notificationIds.map((e=>n.$new(this.courseId).notifications.$new(e).$destroy().$allow([404]).$asPromise())))}}convert(e){const t=super.convert(e);return t.icon="announcement",t.isGroupable=!1,t.isImportant=!1,t.remove=this.remove,t.notificationStartDate=void 0!==e.itemSpecificData.notificationDetails.startDate?new Date(e.itemSpecificData.notificationDetails.startDate):null,this.processDetails(t,e),t}processDetails(e,t){const n=t.itemSpecificData.notificationDetails,s="SYSTEM"===n.announcementType;s&&this.context.getBrand().$then((t=>{e.header=this.bbLocalize.translateSync({locale:null,key:"base.stream.institution",params:{brand:t.bannerText}})})),e.title=n.announcementTitle,e.body={type:h.a.SimpleText,content:{bodyText:p.b(n.contentExtract),fullText:p.c(n.announcementBody)}},s?e.body.stateRef='announcement({streamEntryId:"'+e.id+'"})':t.ui&&t.ui.streamCourse&&t.ui.streamCourse.isUltra()?(e.body.stateRef="announcement-detail("+r.toJson({courseId:n.courseId,announcementId:n.sourceId,mode:c.a.View,courseName:e.header})+")",e.notificationIds=n.notificationIds,e.body.content.sourceId=n.sourceId):this.setLegacyCourseUrlRefToBody(t,e)}}y.SUPPORTED_EVENT_TYPES=["AN:AN_AVAIL","AN_AVAIL"],y.$inject=[u.serviceName,l.b,d.m.serviceName,"$q"];r.module(o.g).service(m,y);var b=n("zGdY");const E="calendarStreamEntryTransformer";class T extends o.a{constructor(e){super(T.SUPPORTED_PROVIDERS),this.bbLocalize=e}convert(e){const t=super.convert(e);return t.icon="calendar",this.processDetails(t,e.itemSpecificData.calendarDetails),t}processDetails(e,t){switch(t.calendarId){case b.U.Institution:e.header=this.bbLocalize.translateSync({locale:null,key:"base.stream.calendar.institution"});break;case b.U.Personal:e.header=this.bbLocalize.translateSync({locale:null,key:"base.stream.calendar.personal"})}e.title=this._getTitle(t.title);const n=new Date(t.startDate);let s=!1;if(t.endDate){const e=new Date(t.endDate);s=0===n.getHours()&&0===n.getMinutes()&&23===e.getHours()&&59===e.getMinutes()}e.contextualDate=n;const r={eventDescription:t.description,localizedEventDate:s?this.bbLocalize.formatDateSync(n,u.ILocaleDateFormat.Short):this.bbLocalize.formatDatetimeSync(n,u.ILocaleDatetimeFormat.Short),eventStartDate:n,isAllDayEvent:s};e.body={type:h.a.Calendar,content:r};const a=t.canEdit?"event-edit":"event-view";e.body.stateRef=[a,"({",'calendarId: "',t.calendarId,'",','itemSourceType: "',t.itemSourceType,'",','itemSourceId: "',t.itemSourceId,'"',"})"].join("")}_getTitle(e){return this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.calendar.event",params:{entryTitle:e},noWrap:!0,noEscape:!0})}}T.SUPPORTED_PROVIDERS=["bb_calendar"],T.$inject=[u.serviceName];angular.module(o.g).service(E,T);const f="collabStreamEntryTransformer";var g,S;function I(e){switch(e){case S.EntryPosted:return"entryPosted";case S.EntryEdited:return"entryEdited";case S.EntryDeleted:return"entryDeleted";case S.CommentPosted:return"commentPosted";case S.CommentDeleted:return"commentDeleted"}}!function(e){e.Blog="blog",e.Journal="journal",e.Wiki="wiki"}(g||(g={})),function(e){e.EntryPosted="EP",e.EntryEdited="EE",e.EntryDeleted="ED",e.CommentPosted="CP",e.CommentDeleted="CD"}(S||(S={}));class v extends o.d{constructor(e){super(e,v.SUPPORTED_PROVIDERS)}convert(e){const t=super.convert(e);t.isGroupable=!0,t.hasParticipated=e.se_participated,t.collabAuthorUser=e.ui.streamUser;const n=e.itemSpecificData.blogDetails,s=e.itemSpecificData.wikiDetails,r=n||s;n?(t.collabType=n.isJournal?g.Journal:g.Blog,t.collabId=n.coreIdContainer,t.collabTitle=n.blogName,n.isJournal?t.eventType="JR_".concat(t.eventType):t.eventType="BL_".concat(t.eventType)):s&&(t.collabType=g.Wiki,t.collabId=s.coreIdContainer,t.collabTitle=s.wikiName),this.processDetails(t,r),this.setLegacyCourseUrlRefToBody(e,t);const a=r.others;if(a&&a.length>0){const e=t;return t.collabAuthorUser?e.authorIds=a.concat([t.collabAuthorUser.id]):e.authorIds=a,e.groupedEntryIds=[t.id],this._setGroupedEntryTitle(e,t,e.authorIds.length),e}return this._setEntryTitle(t),t}processDetails(e,t){var n;e.collabEventType=(n=t.eventType,Object.values(S).find((e=>e===n))),e.collabEntryId=t.coreId,e.collabEntryTitle=t.title,e.icon=e.collabType,e.body={type:h.a.SimpleText,content:{bodyText:this._getBodyText(t)}}}_setEntryTitle(e){const t=I(e.collabEventType);t||(e.title=e.collabEntryTitle);const n=this.getTitle(e),s=["base.stream.entryTitle",e.collabType,t];e.collabAuthorUser?this.getUserDisplayName(e.collabAuthorUser).then((t=>{s.push("withName"),e.title=this.bbLocalize.translateSync({locale:null,key:s.join("."),params:{entryTitle:n,userName:t}})})):(s.push("noName"),e.title=this.bbLocalize.translateSync({locale:null,key:s.join("."),params:{entryTitle:n,userName:null}}))}getTitle(e){return this._isCommentEventType(e.collabEventType)?e.collabEntryTitle:e.collabTitle}_getBodyText(e){return this._isCommentEventType(e.eventType)?e.contentExtract:e.contentExtract?this.bbLocalize.translateSync({locale:null,key:"base.stream.entryBody.withHeader",noEscape:!0,params:{header:e.title,body:e.contentExtract}}):e.title}_isCommentEventType(e){return S.CommentPosted===e||S.CommentDeleted===e}group(e){const t=o.f;if(!t.validateEntriesForGrouping(e,v.SUPPORTED_PROVIDERS))throw new o.e({message:"Could not group stream entries"});let n=[];const s={};return e.forEach((e=>{const t=this._isCommentEventType(e.collabEventType);let r=t?e.collabEntryId:e.collabId;if(!r&&t&&g.Wiki===e.collabType&&(r=e.collabEntryTitle),r){const t=[e.collabType,e.collabEventType,r].join(v.ENTRY_GROUPING_KEY_DELIMITER);(s[t]=s[t]||[]).push(e)}else n.push(e)})),Object.keys(s).forEach((e=>{const r=s[e];if(r.length>1){const s=t.getMostRecentEntry(r),a=this.distinctAuthorIds(r),i=s.courseId,o=t.getGroupedEntryIds(r),c={id:this.generateGroupedEntryId(i,e),groupedEntryIds:o,collabType:s.collabType,collabEventType:s.collabEventType,collabId:s.collabId,collabEntryId:s.collabEntryId,collabTitle:s.collabTitle,collabEntryTitle:s.collabEntryTitle,collabAuthorUser:s.collabAuthorUser,authorIds:a,entrySpecificData:s.entrySpecificData,type:s.type,providerId:s.providerId,eventType:s.eventType,notificationCreationDate:s.notificationCreationDate,icon:s.icon,isNew:t.hasNewEntry(r),isImportant:!1,isGroupable:!0,hasParticipated:r.some((e=>e.hasParticipated)),courseId:i,isOrg:s.isOrg,header:s.header,headerSubtitle:s.headerSubtitle,title:null,body:s.body};this._setGroupedEntryTitle(c,s,a.length),n.push(c)}else n=n.concat(r)})),n}_setGroupedEntryTitle(e,t,n){const r=this.getTitle(t),a=["base.stream.groupedEntries",t.collabType,I(t.collabEventType)];if(t.collabAuthorUser)this.getUserDisplayName(t.collabAuthorUser).then((t=>{const i=n-1,o=i>0?"plural":"";a.push("withName",o),e.title=this.bbLocalize.translateSync({locale:null,key:s.compact(a).join("."),params:{entryTitle:r,userName:t,numUsers:i}})}));else{const t=n,i=t>0?"plural":"";a.push("noName",i),e.title=this.bbLocalize.translateSync({locale:null,key:s.compact(a).join("."),params:{entryTitle:r,userName:null,numUsers:t}})}}generateGroupedEntryId(e,t){return["collabGroupEntry",e,t].join(v.ENTRY_GROUPING_KEY_DELIMITER)}distinctAuthorIds(e){return o.f.getDistinctAuthorIds(e,(function(e){const t=e;return t.collabAuthorUser&&t.collabAuthorUser.id||"unknown"}))}}v.SUPPORTED_PROVIDERS=["bb_blog","bb_Wiki"],v.ENTRY_GROUPING_KEY_DELIMITER="##",v.$inject=[u.serviceName];r.module(o.g).service(f,v);var D=n("vhkR"),_=n("Is+C"),C=n("4nF1"),A=n("TnpK"),R=n("tdYh"),P=n("Q/M7"),w=n("f4B+"),O=n("3Bw1"),U=n("SeO5");const N="courseContentStreamEntryTransformer";class L extends o.c{constructor(e,t,n,s,r,a,i,o){super({CO:[L.TYPE]},o),this.bbLocalize=e,this.CourseModel=t,this.ltiService=n,this.scormService=s,this.ultraState=r,this.$modal=a,this.$rootScope=i,this._GROUPED_ENTRY_TITLE="base.stream.groupedEntries.courseContent.title",this.SUPPORTED_GROUP_PEEK_TYPES=[d.p.ContentHandler.ExternalLink,d.p.ContentHandler.File,d.p.ContentHandler.LtiPlacement,d.p.ContentHandler.LtiLink,d.p.ContentHandler.PartnerCloud]}convert(e){const t=super.convert(e);return t.isGroupable=!0,t.icon="",t.streamCourse=e.ui.streamCourse,this.processDetails(t,e.itemSpecificData),this.setLegacyCourseUrlRefToBody(e,t),t}processDetails(e,t){const n=t.notificationDetails,s=t.contentDetails;e.title=this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.avail",params:{entryTitle:n.title},noWrap:!0,noEscape:!0}),e.body={type:h.a.SimpleText,content:{bodyText:e.streamCourse.isUltra()?w.a.HTML(n.contentExtract||""):n.contentExtract}};let r=null;const a=C.a.normalize(s&&s.contentHandler);switch(r=d.p.ContentHandler.parse(a),e.entrySpecificData={contentItem:{id:n.courseContentId,courseId:e.courseId,contentHandler:r,title:n.title}},r){case d.p.ContentHandler.Discussion:e.body.stateRef=o.f.getDiscussionPanelStateRef(n.courseContentId,e.courseId);break;case d.p.ContentHandler.ExternalLink:{let t=s.contentSpecificExtraData;t&&(t=R.a.test(t)?t:"http://"+t,e.body.externalRef={target:"_blank",href:t});break}case d.p.ContentHandler.LtiPlacement:case d.p.ContentHandler.LtiLink:{const[t,a]=s.contentSpecificExtraData.split(":::");e.entrySpecificData.contentItem.contentDetail={},e.entrySpecificData.contentItem.contentDetail[r.toString()]={itemOrigin:t,cloudDocumentType:a},e.body.clickHandler=()=>{this.ltiService.ltiLaunch({courseId:e.courseId,contentId:n.courseContentId,showPreLaunchPanel:!0})};break}case d.p.ContentHandler.PartnerCloud:e.body.clickHandler=()=>{this.ltiService.ltiLaunch({courseId:e.courseId,contentId:n.courseContentId,showPreLaunchPanel:!0})};break;case d.p.ContentHandler.RusticiScorm:e.body.clickHandler=()=>{this.scormService.scormLaunch({courseId:e.courseId,contentId:n.courseContentId,showPreLaunchPanel:!0})};break;case d.p.ContentHandler.File:{const t=s.contentSpecificExtraData;t&&(e.entrySpecificData.contentItem.contentDetail={},e.entrySpecificData.contentItem.contentDetail[d.p.ContentHandler.File.toString()]={file:{mimeType:t},fileAssociationMode:b.G.Link});const n=s.contentSpecificFileData;n&&(e.body.externalRef={target:"_blank",href:P.c(n)});break}case d.p.ContentHandler.Folder:{e.entrySpecificData.contentItem.contentDetail={};const s=t.contentDetails&&t.contentDetails.isBbPage;e.entrySpecificData.contentItem.contentDetail[d.p.ContentHandler.Folder.toString()]={isBbPage:s,isFolder:t.contentDetails&&t.contentDetails.isFolder},s&&this.setStreamEntryClickToGoToDestination(e,n,(()=>{this.ultraState.goPeekState(C.b.EDIT_STATE_SREF,{id:n.courseContentId,courseId:e.courseId})}));break}case d.p.ContentHandler.Journal:e.body.stateRef=o.f.getJournalPanelStateRef(n.courseContentId,e.courseId)}e.body.externalRef||e.body.stateRef||e.body.clickHandler||this.setCourseUrlRefToBody(e)}setStreamEntryClickToGoToDestination(e,t,n){e.body.clickHandler=()=>{this.CourseModel.$new(t.courseId).contents.$find(t.courseContentId).$allow(["404","403"]).$then((t=>{if(t.$response){const s=t.$response.status;404===s?this.$modal.open({template:O,scope:null}).result.then((()=>{this.$rootScope.$emit("stream-entry-parent-item-not-found",e)})):403===s?this.$modal.open({template:U,scope:null}).result.then((()=>{this.$rootScope.$emit("stream-entry-parent-item-not-found",e)})):n()}}))}}group(e){const t=o.f,n=L.TYPE;if(t.validateEntriesForGrouping(e,[n])){const s=t.getMostRecentEntry(e),r=s.courseId,a=this.generateGroupedEntryId(r),i={id:a,groupedEntryIds:t.getGroupedEntryIds(e),type:n,providerId:s.providerId,notificationCreationDate:s.notificationCreationDate,icon:"document-multiple",isNew:t.hasNewEntry(e),isImportant:!1,isGroupable:!0,courseId:r,isOrg:s.isOrg,streamCourse:s.streamCourse,header:s.header,title:this.bbLocalize.translateSync({locale:null,key:this._GROUPED_ENTRY_TITLE}),entryContents:this.getGroupedEntryContents(e)};return i.streamCourse.isUltra()&&this.areAllSupportedGroupPeekEntries(i.entryContents)?i.body={stateRef:'content-group({streamEntryId:"'+a+'"})'}:this.setCourseUrlRefToBody(i),[i]}throw new o.e({message:"Could not group stream entries"})}getGroupedEntryContents(e){let t=[];return e&&Array.isArray(e)&&e.forEach((e=>{const n=e.entryContents;n?t=t.concat(n):t.push(e)})),t}generateGroupedEntryId(e){return["courseContentGroupEntry",L.TYPE,e].join("-")}setCourseUrlRefToBody(e){e.body=e.body||{},null!==e.streamCourse&&(e.body.stateRef=o.f.getCoursePanelStateRef(e.streamCourse.id))}areAllSupportedGroupPeekEntries(e){return e.every((e=>C.a.matchesHandlers(e.entrySpecificData.contentItem.contentHandler.toString(),this.SUPPORTED_GROUP_PEEK_TYPES)))}}L.TYPE="CO:CO_AVAIL",L.$inject=[u.serviceName,d.m.serviceName,D.b,_.c,A.d,"$modal","$rootScope","$q"];r.module(o.g).service(N,L);var G=n("KBr+");const B="deploymentStreamEntryTransformer";class x extends o.a{constructor(e,t){super(x.SUPPORTED_PROVIDERS),this.bbLocalize=e,this.CourseBatchLoader=t}convert(e){const t=super.convert(e);return t.icon="survey",this.processDetails(t,e.itemSpecificData.learnDeploymentDetails),t}processDetails(e,t){t.courseId?this.CourseBatchLoader.load(t.courseId).then((t=>{e.courseId=t.id,e.header=t.name})):e.header=this.bbLocalize.translateSync({locale:null,key:"base.stream.institution",params:{brand:t.deploymentName}}),e.title=this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.outcomes.bb_deployment",params:{entryTitle:t.instrumentName},noWrap:!0,noEscape:!0}),e.body={type:h.a.SimpleText,content:{bodyText:this.bbLocalize.translateSync({locale:null,key:"base.stream.entryBody.bb_deployment"})}},t.deploymentUrl&&(e.body.externalRef={target:"new",href:t.deploymentUrl})}}x.SUPPORTED_PROVIDERS=["bb_deployment"],x.$inject=[u.serviceName,G.b];r.module(o.g).service(B,x);const k="discussionBoardStreamEntryTransformer";class M extends i.a{constructor(e,t,n,s,r){super(e),this.learnEntryType=e,this.resourceKey=t,this.entryTitlePropertyName=n,this.entryTitleContainsUsersName=s,this.groupingIdPropertyName=r}isGroupable(){return null!=this.groupingIdPropertyName}getGroupingId(e){return e[this.groupingIdPropertyName]}getEntryTitle(e){return e[this.entryTitlePropertyName]}isThreadEventType(){return M.ThreadPosted.isEqualTo(this)||M.ThreadSubscribed.isEqualTo(this)||M.ThreadUnsubscribed.isEqualTo(this)}}M.ForumCreated=new M("FC","forumCreated","forumName",!1,null),M.ForumSubscribed=new M("FS","forumSubscribed","forumName",!0,"forumId"),M.ForumUnsubscribed=new M("FU","forumUnsubscribed","forumName",!0,"forumId"),M.PostRated=new M("PR","postRated","msgTitle",!0,"msgId"),M.ReplyPosted=new M("RP","replyPosted","threadTitle",!0,"threadId"),M.ThreadPosted=new M("TP","threadPosted","threadTitle",!0,null),M.ThreadSubscribed=new M("TS","threadSubscribed","threadTitle",!0,"threadId"),M.ThreadUnsubscribed=new M("TU","threadUnsubscribed","threadTitle",!0,"threadId");class V extends o.d{constructor(e){super(e,V.SUPPORTED_PROVIDERS)}convert(e){const t=e.itemSpecificData.discussionboardDetails;if(t.isIndirect)return null;const n=super.convert(e);return n.hasParticipated=e.se_participated,this.processDetails(n,t),this.setLegacyCourseUrlRefToBody(e,n),n}processDetails(e,t){const n=M.parse(t.eventType),s=n.isThreadEventType();e.icon=V.ICON,e.isGroupable=!0,e.forumId=t.coreIdContainer,e.forumName=t.forumName,e.threadId=s?t.coreId:t.threadId,e.threadTitle=s?t.title:t.threadName,e.msgEventType=n,e.msgId=t.coreId,e.msgTitle=t.title,e.body={type:h.a.SimpleText,content:{bodyText:t.contentExtract},stateRef:o.f.getDiscussionPanelStateRef(t.courseContentId,e.courseId)},this._setTitle(e)}_setTitle(e){const t=["base.stream.entryTitle.disc",e.msgEventType.resourceKey],n=e.msgEventType.entryTitleContainsUsersName,s=e.msgEventType.getEntryTitle(e);n&&e.entrySpecificData&&e.entrySpecificData.streamUser?this.getUserDisplayName(e.entrySpecificData.streamUser).then((n=>{t.push("withName"),e.title=this.bbLocalize.translateSync({locale:null,key:t.join("."),params:{userName:n,entryTitle:s}})})):(n&&t.push("noName"),e.title=this.bbLocalize.translateSync({locale:null,key:t.join("."),params:{userName:null,entryTitle:s}}))}group(e){const t=o.f;if(!t.validateEntriesForGrouping(e,V.SUPPORTED_PROVIDERS))throw new o.e({message:"Could not group stream entries"});let n=[];const s={};return e.forEach((e=>{let t=!1;if(e.msgEventType.isGroupable()){const n=e.msgEventType.getGroupingId(e);if(n){t=!0;const r=[n,e.msgEventType].join(V.ENTRY_GROUPING_KEY_DELIMITER);(s[r]=s[r]||[]).push(e)}}t||n.push(e)})),Object.keys(s).forEach((e=>{const r=e.split(V.ENTRY_GROUPING_KEY_DELIMITER),a=r[0],i=r[1],o=s[e];if(o.length>1){const e=t.getMostRecentEntry(o),s=e.courseId,r=t.getGroupedEntryIds(o),c=this.distinctAuthorIds(o),l={id:this.generateGroupedEntryId(s,i,a),forumId:e.forumId,forumName:e.forumName,threadId:e.threadId,threadTitle:e.threadTitle,entrySpecificData:e.entrySpecificData,msgId:e.msgId,msgTitle:e.msgTitle,msgEventType:e.msgEventType,groupedEntryIds:r,authorIds:c,type:e.type,providerId:e.providerId,notificationCreationDate:e.notificationCreationDate,icon:V.ICON,isNew:t.hasNewEntry(o),isImportant:!1,isGroupable:!0,hasParticipated:o.some((e=>e.hasParticipated)),courseId:s,isOrg:e.isOrg,header:e.header,headerSubtitle:e.headerSubtitle,title:null,body:e.body};this._setGroupedEntryTitle(l,c.length,e.msgEventType.getEntryTitle(e)),n.push(l)}else n=n.concat(o)})),n}_setGroupedEntryTitle(e,t,n){const r=["base.stream.groupedEntries.disc",e.msgEventType.resourceKey];if(e.entrySpecificData&&e.entrySpecificData.streamUser)this.getUserDisplayName(e.entrySpecificData.streamUser).then((a=>{const i=t-1,o=i>0?"plural":"";r.push("withName",o),e.title=this.bbLocalize.translateSync({locale:null,key:s.compact(r).join("."),params:{userName:a,numUsers:i,entryTitle:n}})}));else{const a=t,i=a>0?"plural":"";r.push("noName",i),e.title=this.bbLocalize.translateSync({locale:null,key:s.compact(r).join("."),params:{userName:null,numUsers:a,entryTitle:n}})}}generateGroupedEntryId(e,t,n){return["discBoardGroupEntry",e,t,n].join("-")}distinctAuthorIds(e){return o.f.getDistinctAuthorIds(e,(function(e){return e.entrySpecificData&&e.entrySpecificData.streamUser&&e.entrySpecificData.streamUser.id||"unknown"}))}}V.SUPPORTED_PROVIDERS=["bb_disc"],V.ICON="discussion",V.ENTRY_GROUPING_KEY_DELIMITER="##",V.$inject=[u.serviceName];r.module(o.g).service(k,V);var $=n("Sa5G"),j=n("P2dS"),H=n("8jzW"),K=n("KtUo"),F=n("IbyE"),z=n("+O05");const Y="duedatedContentStreamEntryTransformer";class W extends o.c{constructor(e,t,n,s,r,a,i,o,c,l){super(W.SUPPORTED_EVENT_TYPES,c),this.bbLocalize=e,this.CourseModel=n,this.ColumnModel=s,this.scoreProviderHelper=r,this.gradeColumnCategoryService=a,this.$modal=i,this.$rootScope=o,this.ltiService=l,this.serverTime=t.getServerTime(),this.remove=function(){return c.all(this.notificationIds.map((e=>n.$new(this.courseId).notifications.$new(e).$destroy().$allow([404]).$asPromise())))}}convert(e){const t=super.convert(e),n=this._getEvent(t.type),{contentDetails:s,notificationDetails:r}=e.itemSpecificData;if(t.isImportant=W.OVERDUE===n,t.isImportant){if(d.ob.NotificationRecipientType.Sender===r.recipientType)return null;t.remove=this.remove}t.isGroupable=!1,this.processDetails(t,r,s),this.setLegacyCourseUrlRefToBody(e,t);const a=C.a.normalize(null==s?void 0:s.contentHandler),i=d.p.ContentHandler.parse(a);if(i===d.p.ContentHandler.LtiLink){t.entrySpecificData={contentItem:{id:r.courseContentId,courseId:t.courseId,contentHandler:i,title:r.title}};const[e,n]=s.contentSpecificExtraData.split(":::");t.entrySpecificData.contentItem.contentDetail={},t.entrySpecificData.contentItem.contentDetail[i.toString()]={itemOrigin:e,cloudDocumentType:n},t.body.clickHandler=()=>{this.ltiService.ltiLaunch({courseId:t.courseId,contentId:r.courseContentId,showPreLaunchPanel:!0})}}return t}processDetails(e,t,n){this._setDueDateDependentProperties(e,t,n),this._setGradebookColumn(e,t)}_getEvent(e){const t=e.substr(e.indexOf(":")+1);return t.indexOf("_AVAIL")>0?"AVAIL":t}_getTitle(e,t,n,s){let r=W.DUE===e&&t&&0===K.a(t,this.serverTime)?"dueToday":e.toLowerCase();return"PE"===s&&(r=`peer.${r}`),this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle."+r,params:{entryTitle:n},noWrap:!0,noEscape:!0})}_setDueDateDependentProperties(e,t,n){const s=t.dueDate&&new Date(t.dueDate),r=this._getEvent(e.type);e.contextualDate="AVAIL"===r?null:s,e.title=this._getTitle(r,e.contextualDate,t.title,t.sourceType),e.body={type:h.a.DueDatedContent},s&&this.bbLocalize.formatDatetime(s,o.f.DUE_DATE_FORMAT).then((t=>{e.body.content={localizedDueDate:t}})),this._setClickHandler(e,t,n)}_setClickHandler(e,t,n){const s=$.g.parse(n&&n.contentHandler);if(s&&t.courseId&&t.courseContentId){this.scoreProviderHelper.openStateRef(s,{contentId:t.courseContentId,courseId:t.courseId})&&(e.body.clickHandler=()=>{this.CourseModel.$new(t.courseId).contents.$find(t.courseContentId).$allow(["404","403"]).$then((n=>{if(n.$response){const r=n.$response.status;404===r?this.$modal.open({template:O,scope:null}).result.then((()=>{this.$rootScope.$emit("stream-entry-parent-item-not-found",e)})):403===r?this.$modal.open({template:U,scope:null}).result.then((()=>{this.$rootScope.$emit("stream-entry-parent-item-not-found",e)})):this.scoreProviderHelper.openStateRef(s,{contentId:t.courseContentId,courseId:t.courseId,isCollectExternalSubmissions:z.a.isExternalSubmissionsAssessment(n)},H.a.GoToState)}}))})}}_setGradebookColumn(e,t){if(t.secondarySourceType){const n=q.SOURCETYPE_TO_PROVIDER_MAP[t.secondarySourceType],s=t.calculationType;n&&(e.entrySpecificData={gradebookColumn:this.ColumnModel.$build({scoreProviderHandle:n,calculationType:s})})}if(!r.isUndefined(t.gradebookCategoryName)&&!r.isUndefined(t.isGradebookCategoryUserDefined)){const n=this.gradeColumnCategoryService.getIconByGradebookCategory(t.gradebookCategoryName,t.isGradebookCategoryUserDefined);n&&(e.icon=n)}}}W.SUPPORTED_EVENT_TYPES={AS:["AS:DUE","AS:OVERDUE","AS:AS_AVAIL","AS:AS_GA_AVAIL","AS:AS_AVAIL_RESEND","AS:AS_GA_AVAIL_RESEND"],GB:["GB:DUE","GB:OVERDUE"],PE:["PE:DUE","PE:OVERDUE","PE:PE_AVAIL","PE:PE_AVAIL_RESEND"],PS:["PS:DUE","PS:OVERDUE","PS:PS_AVAIL","PS:PS_AVAIL_RESEND"],SU:["SU:DUE","SU:OVERDUE","SU:SU_AVAIL"],SC:["SC:DUE","SC:OVERDUE","SC:SC_AVAIL","SC:SC_AVAIL_RESEND"],TE:["TE:DUE","TE:OVERDUE","TE:TE_AVAIL","TE:TE_AVAIL_RESEND"],UA:["UA:DUE","UA:OVERDUE","UA:UA_AVAIL","UA:UA_AVAIL_RESEND"]},W.SOURCETYPE_TO_PROVIDER_MAP={BL:F.Q.Blog,JN:F.Q.Blog,DF:F.Q.Discussion,DT:F.Q.Discussion,SC:F.Q.Scorm,UA:F.Q.UltraAssignment,WK:F.Q.Wiki},W.DUE="DUE",W.OVERDUE="OVERDUE",W.$inject=[u.serviceName,l.b,d.m.serviceName,d.C.serviceName,H.c,j.c,"$modal","$rootScope","$q",D.b];class q extends W{}r.module(o.g).service(Y,W);const J="evidenceCollectionStreamEntryTransformer";class Q extends o.a{constructor(e){super(Q.SUPPORTED_PROVIDERS),this.bbLocalize=e}convert(e){const t=super.convert(e);return t.icon=o.b.DEFAULT_ICON,t.header=this.bbLocalize.translateSync({locale:null,key:"base.stream.goalsAndAssessment"}),this.processDetails(t,e.itemSpecificData.evidenceDetails),t}processDetails(e,t){e.title=this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.outcomes.bb-evidence-collection",params:{entryTitle:t.title},noWrap:!0,noEscape:!0}),t.sessionDate&&(e.notificationCreationDate=new Date(t.sessionDate)),t.dueDate&&(e.contextualDate=new Date(t.dueDate),e.body={type:h.a.DueDatedContent},this.bbLocalize.formatDatetime(e.contextualDate,o.f.DUE_DATE_FORMAT).then((t=>{e.body.content={localizedDueDate:t}}))),t.evidenceUrl&&(e.body||(e.body={type:h.a.SimpleText}),e.body.externalRef={target:"new",href:P.c(t.evidenceUrl)})}}Q.SUPPORTED_PROVIDERS=["bb-evidence-collection"],Q.$inject=[u.serviceName];r.module(o.g).service(J,Q);const X="gradesStreamEntryTransformer";class Z extends o.a{constructor(e){super(Z.SUPPORTED_PROVIDERS),this.bbLocalize=e}convert(e){const t=e.itemSpecificData.gradeDetails;if(!this._isGraded(t))return null;const n=super.convert(e);return n.icon="grades",n.isImportant=!1,n.isGroupable=!1,this.processDetails(n,t),this.setStateRef(n,e.ui&&e.ui.streamCourse),n}processDetails(e,t){e.title=this._getTitle(t),e.body={type:h.a.Grades,content:{isInteractive:!0,grade:this._getGrade(t),attemptsRemaining:null,feedback:w.a.text(t.instructorFeedback.displayText),pointsPossible:t.pointsPossible,displayGrade:{grade:t.displayGradeGrade,score:t.displayGradeScore},schema:{scaleType:t.scaleType},column:{possible:t.pointsPossible,calculationType:t.calculationType}}},t.lastGradedDate&&(e.notificationCreationDate=new Date(t.lastGradedDate))}setStateRef(e,t){if(t)if(t.isClassic()){const n="/webapps/gradebook/do/student/viewGrades?course_id="+t.id+"&callback=course";e.body.stateRef=o.f.getCoursePanelStateRef(t.id,n)}else e.body.stateRef="course.grades("+r.toJson({courseId:t.id})+")"}_getGrade(e){return d.ob.GradeIconType.Completed===e.gradeIcon?this.bbLocalize.translateSync({locale:null,key:"base.stream.entryBody.grades.completedScore"}):e.grade}_getTitle(e){return this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.grade.posted",params:{entryTitle:e.title},noWrap:!0,noEscape:!0})}_isGraded(e){return e.grade&&"-"!==e.grade||d.ob.GradeIconType.Completed===e.gradeIcon}}Z.SUPPORTED_PROVIDERS=["bb_mygrades"],Z.$inject=[u.serviceName];r.module(o.g).service(X,Z);const ee="messageStreamEntryTransformer";class te extends o.d{constructor(e){super(e,te.SUPPORTED_PROVIDERS)}convert(e){const t=super.convert(e);return t.icon=te.ICON,t.isGroupable=!0,this.processDetails(t,e.itemSpecificData.messageDetails),t}processDetails(e,t){e.conversationId=t.conversationId,e.isImportant=this.isUltraMessage(t)&&!t.canBeRepliedTo,e.body={type:h.a.SimpleText,content:{bodyText:t.contentExtract},stateRef:this.getBodyStateRef(e,t)},this.setTitle(e)}setTitle(e){e.entrySpecificData&&e.entrySpecificData.streamUser?this.getUserDisplayName(e.entrySpecificData.streamUser).then((t=>{e.title=this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.newMessage",params:{authorName:t}})})):e.title=this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.newMessage",params:{authorName:null}})}isUltraMessage(e){return!!e.conversationId}getBodyStateRef(e,t){return this.isUltraMessage(t)?'stream-message({ courseId: "'+e.courseId+'", conversationId: "'+t.conversationId+'" })':'course.outline({ courseId: "'+e.courseId+'", legacyUrl: "'+P.f("/webapps/blackboard/messaging/course","messageDetail.jsp",{nav:"messages",course_id:e.courseId,folder:"inbox",course_message_id:t.messageId})+'" })'}group(e){const t=o.f;if(!t.validateEntriesForGrouping(e,te.SUPPORTED_PROVIDERS))throw new o.e({message:"Could not group stream entries"});let n=[];const s=[],r={};return e.forEach((e=>{if(e.conversationId){(r[e.conversationId]=r[e.conversationId]||[]).push(e)}else s.push(e)})),Object.keys(r).forEach((e=>{const s=r[e];if(s.length>1){const r=t.getMostRecentEntry(s),a=r.courseId,i=t.getGroupedEntryIds(s),o=this.distinctAuthorNames(s),c={id:this.generateGroupedEntryId(a,e),groupedEntryIds:i,type:r.type,providerId:r.providerId,notificationCreationDate:r.notificationCreationDate,icon:te.ICON,isNew:t.hasNewEntry(s),isImportant:!1,isGroupable:!0,courseId:a,isOrg:r.isOrg,header:r.header,title:null,hasParticipated:s.some((e=>e.hasParticipated)),entrySpecificData:r.entrySpecificData,conversationId:e,body:r.body};this.setGroupedEntryTitle(c,s.length,o),n.push(c)}else n=n.concat(s)})),s.length>0&&(n=n.concat(s)),n}setGroupedEntryTitle(e,t,n){e.title=this.bbLocalize.translateSync({locale:null,key:s.compact(["base.stream.groupedEntries.message.title.messageNum.plural"]).join("."),params:{numUnreadMessages:t}}),this.bbLocalize.formatItems(n,2,null,!0,null).then((t=>{e.title+=t}))}generateGroupedEntryId(e,t){return["messageBoardGroupEntry",e,t].join("-")}distinctAuthorNames(e){return o.f.getDistinctAuthorIds(e,(e=>{let t;return e.entrySpecificData&&e.entrySpecificData.streamUser&&(t=this.bbLocalize.formatUsernameSync(e.entrySpecificData.streamUser,u.ILocaleUsernameFormat.Short,null,{noWrap:!0,noEscape:!0})),t||"unknown"}))}}te.SUPPORTED_PROVIDERS=["bb_message"],te.ICON="message",te.$inject=[u.serviceName];r.module(o.g).service(ee,te);const ne="needsGradingStreamEntryTransformer";class se extends o.c{constructor(e,t,n){super(se.SUPPORTED_EVENT_TYPES,n),this.bbLocalize=e,this.scoreProviderHelper=t}convert(e){const t=super.convert(e);t.isImportant=!1,t.isGroupable=!1,t.title=this._getTitle(t.notificationIds,e.itemSpecificData.notificationDetails.title);const n=e.itemSpecificData.notificationDetails,s=$.g.parse(e.itemSpecificData.contentDetails&&e.itemSpecificData.contentDetails.contentHandler);t.icon=this._getNeedsGradingIcon(s);const r=e.ui.streamCourse&&e.ui.streamCourse.isUltra();return this._setStateRef(t,n,s,r),r||this.setLegacyCourseUrlRefToBody(e,t),t}_getNeedsGradingIcon(e){let t=this.scoreProviderHelper.getNeedsGradingIconByContentHandler(e);return t||(t="grades"),t}_getTitle(e,t){const n=e.length>1?"base.stream.entryTitle.newSubmission.multipleNoCount":"base.stream.entryTitle.newSubmission.single";return this.bbLocalize.translateSync({locale:null,key:n,params:{entryTitle:t},noWrap:!0,noEscape:!0})}_setStateRef(e,t,n,s){const r=t.courseId,a=t.courseContentId;if(s&&r&&a&&n){if(("TE:TE_GT_SUBMIT"===e.type||"TE:TE_GT_SUBMIT_LATE"===e.type||"UA:UA_GA_SUBMIT"===e.type||"UA:UA_GA_SUBMIT_LATE"===e.type)&&d.ob.NotificationRecipientType.Sender===t.recipientType)return;const s={contentId:a,courseId:r,needsGrading:!0},i=this.scoreProviderHelper.getSubmissionListStateRefByContentHandler(n,s);i&&(e.body={stateRef:i})}}}se.SUPPORTED_EVENT_TYPES={AS:["AS:AS_ATTEMPT","AS:AS_LATE_ATTEMPT","AS:AS_GA_ATTEMPT","AS:AS_GA_LATE_ATTEMPT"],BL:["BL:BL_ATTEMPT","BL:BL_GR_ATTEMPT"],DF:["DF:DF_ATTEMPT","DF:DF_GR_ATTEMPT"],DT:["DT:DT_ATTEMPT","DT:DT_GR_ATTEMPT"],JN:["JN:JN_ATTEMPT","JN:JN_GR_ATTEMPT"],SC:["SC:SC_SUBMIT","SC:SC_SUBMIT_LATE"],TE:["TE:TE_SUBMIT","TE:TE_SUBMIT_LATE","TE:TE_GT_SUBMIT","TE:TE_GT_SUBMIT_LATE"],UA:["UA:UA_SUBMIT","UA:UA_SUBMIT_LATE","UA:UA_GA_SUBMIT","UA:UA_GA_SUBMIT_LATE"],WK:["WK:WK_ATTEMPT","WK:WK_GR_ATTEMPT"],PS:["PS:PS_SUBMIT","PS:PS_SUBMIT_LATE"],PE:["PE:PE_SUBMIT","PE:PE_SUBMIT_LATE"]},se.$inject=[u.serviceName,H.c,"$q"];r.module(o.g).service(ne,se);var re=n("D57K"),ae=n("aHpC");const ie="needsReconcilingtreamEntryTransformer";let oe=class e extends o.c{constructor(t,n,s){super(e.SUPPORTED_EVENT_TYPES,s),this.bbLocalize=t,this.scoreProviderHelper=n}convert(e){const t=super.convert(e);t.isImportant=!1,t.isGroupable=!1;const n=e.itemSpecificData.notificationDetails,s=$.g.parse(e.itemSpecificData.contentDetails&&e.itemSpecificData.contentDetails.contentHandler);t.icon=this._getNeedReconcilingIcon(s),t.title=this._getTitle(t.type,e.ui.streamCourse,n.title);const r=e.ui.streamCourse&&e.ui.streamCourse.isUltra();return this._setStateRef(t,n,s,r),r||this.setLegacyCourseUrlRefToBody(e,t),t}_getNeedReconcilingIcon(e){let t=this.scoreProviderHelper.getNeedsReconcilingIconByContentHandler(e);return t||(t="grades"),t}_getTitle(e,t,n){const s=e.substr(e.indexOf(":")+1);return this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.simple."+s,params:{entryTitle:n},noWrap:!0,noEscape:!0})}_setStateRef(e,t,n,s){const r=t.courseId,a=t.courseContentId;if(s&&r&&a&&n){const t=this.scoreProviderHelper.getSubmissionListStateRefByContentHandler(n,{contentId:a,courseId:r});t&&(e.body={stateRef:t})}}};oe.SUPPORTED_EVENT_TYPES={GB:["GB:GB_NEEDS_RECON"]},oe=Object(re.a)([Object(re.c)(0,Object(ae.b)(u.serviceName)),Object(re.c)(1,Object(ae.b)(H.c)),Object(re.c)(2,Object(ae.b)("$q"))],oe);r.module(o.g).service(ie,oe);const ce="simpleLegacyStreamEntryTransformer";class le extends o.c{constructor(e,t){super(le.SUPPORTED_EVENT_TYPES,t),this.bbLocalize=e}convert(e){const t=e.itemSpecificData.notificationDetails;if(t&&"CM"===t.sourceType)return null;const n=super.convert(e);return n.isImportant=!1,n.isGroupable=!1,n.title=this._getTitle(n.type,e.ui.streamCourse,t.title),this.setLegacyCourseUrlRefToBody(e,n),n}_getTitle(e,t,n){let s=e.substr(e.indexOf(":")+1);return"CR_AVAIL"===s&&t&&t.isOrganization&&(s="ORG_AVAIL"),this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.simple."+s,params:{entryTitle:n},noWrap:!0,noEscape:!0})}}le.SUPPORTED_EVENT_TYPES={CR:["CR:CR_AVAIL"],SU:["SU:SU_SUBMIT"],QU:["QU:QU_AVAIL"],CM:["CM:CM_RCVD"]},le.$inject=[u.serviceName,d.m.serviceName,"$q"];r.module(o.g).service(ce,le);var de=n("ZNC7"),ue=n("r6lH"),pe=n("zyQz"),he=n("EtRF"),me=n("nmzr");const ye="telemetryStreamEntryTransformer";class be extends o.a{constructor(e,t,n){super(be.SUPPORTED_EVENT_TYPES),this.bbLocalize=e,this.telemetry=t,this.remove=function(){let e=this.body.content.notificationId;return null==e&&(e="_"+this.body.content.sequenceId+"_1"),n.$new(e).$destroy().$asPromise()},this.analyticsContext=function(e){return e.notificationType=this.body.content.notificationType.toString(),this.body.content.phraseVariant&&(e.phraseVariant=this.body.content.phraseVariant),e}}convert(e){const t=super.convert(e),n=pe.a.parse(e.extraAttribs.notificationType);let s=e.extraAttribs.notificationId;const r=n&&n.getInitialView(),a=n?n.getPhraseVariant(e):void 0,i=n?n.getIcon().toString():he.a.Default,c=o.f.getSequenceId(e),l=n&&n.getAction(null);t.icon=i,t.isGroupable=!1,t.title=this._getTitle(n,e),t.isImportant="true"===e.extraAttribs.important,t.telemetryNotificationType=n&&n.toString();return(e.extraAttribs.inTroubleCount||e.extraAttribs.inTroubleAbsent||e.extraAttribs.inTroubleFailing)&&(t.studentsInTrouble={studentsInTrouble:e.extraAttribs.inTroubleCount,studentsInTroubleAbsent:e.extraAttribs.inTroubleAbsent,studentsInTroubleFailing:e.extraAttribs.inTroubleFailing}),t.notificationShapeType={shape:this._getNotificationShapeType(n)},t.body={type:this._getBodyType(l),content:{bodyText:this._getBody(n,e),sequenceId:c,notificationType:n,notificationId:s,phraseVariant:a}},t.remove=this.remove,t.analyticsContext=this.analyticsContext,null==s&&(s="_"+c+"_1"),this._setBodyStateRef(l,t,s,r),t}_getBodyType(e){return e?h.a.Telemetry:h.a.SimpleText}_getTitle(e,t){return e?this.bbLocalize.translateSync(e.getTitle(t,null)):this.bbLocalize.translateSync({locale:null,key:"base.stream.telemetry.unknownType",params:{type:t.extraAttribs.notificationType}})}_getBody(e,t){if(e){const n=e.getBody(t,null);if(n.key)return this.bbLocalize.translateSync(n)}return""}_setBodyStateRef(e,t,n,s){if(s)switch(s){case me.M.DIRECT_TO_COURSE:{const n=o.f.getCoursePanelStateRef(t.courseId);this._setStateRefProps(e,t,n,!0);break}case me.M.INSTRUCTOR_DYNAMIC:this.telemetry.determinePanelSref(t.courseId,n).then((n=>{this._setStateRefProps(e,t,n)}));break;default:{const r=this.telemetry.createPanelSref(s,t.courseId,n);this._setStateRefProps(e,t,r);break}}}_setStateRefProps(e,t,n,s=!1){e?(t.body.content.actionText=this.bbLocalize.translateSync(e),t.body.content.actionSref=n,t.body.content.isComponentActionSref=s):t.body.stateRef=n}_getNotificationShapeType(e){let t;switch(e){case pe.a.SufficientActivityData:case pe.a.SufficientGradeData:case pe.a.StudentsInTrouble:}return t=de.a.DefaultNotification,t}}be.SUPPORTED_EVENT_TYPES=["bb_tel","bb_tel:ins_grade","bb_tel:stu_activity","bb_tel:stu_grade"],be.$inject=[u.serviceName,ue.b,d.Bb.serviceName];r.module(o.g).service(ye,be),n.d(t,"b",(function(){return Ee})),n.d(t,"c",(function(){return Te})),n.d(t,"a",(function(){return fe}));const Ee="ultra.service.stream.transformer",Te="streamEntryTransformer";class fe extends i.a{constructor(e,t){super(e),this.supportedTypes=t}getSupportedTypes(){return this.supportedTypes}}fe.AssignmentsAndTests=new fe("AssignmentsAndTests",s.union(q.SUPPORTED_EVENT_TYPES.AS,q.SUPPORTED_EVENT_TYPES.TE,q.SUPPORTED_EVENT_TYPES.UA)),fe.GradesAndFeedback=new fe("GradesAndFeedback",s.union(K.b(class extends se{}.SUPPORTED_EVENT_TYPES),class extends Z{}.SUPPORTED_PROVIDERS,class extends le{}.SUPPORTED_EVENT_TYPES.GB)),fe.Discussions=new fe("Discussions",class extends V{}.SUPPORTED_PROVIDERS),fe.Messages=new fe("Messages",class extends te{}.SUPPORTED_PROVIDERS);class ge{constructor(e,...t){this._baseDataTransformer=e,this.typeToTransformer=Object.create(null),this._dataTransformers=t||[]}get dataTransformers(){return this._dataTransformers}set dataTransformers(e){this._dataTransformers=e}get baseDataTransformer(){return this._baseDataTransformer}set baseDataTransformer(e){this._baseDataTransformer=e}getDataTransformerByType(e){return this.typeToTransformer[e]=this.typeToTransformer[e]||this._lookupDataTransformerByType(e)}_lookupDataTransformerByType(e){const t=this.dataTransformers.filter((t=>t.canHandleType(e)));return t&&t[0]||this.baseDataTransformer}}ge.REGISTERED_DATA_TRANSFORMERS=[m,E,f,N,B,k,Y,J,X,ee,ne,ce,ye,ie],ge.$inject=[o.h].concat(ge.REGISTERED_DATA_TRANSFORMERS);r.module(Ee,[o.g]).service(Te,ge)},sbY4:function(e,t){e.exports='<p class="summary js-feedback" ng-if="::interactiveBodyContent.content.feedback" ng-bind-html="::interactiveBodyContent.content.feedback"></p>\n<span ng-if="::interactiveBodyContent.content">\n  <span class="stream-grade-controls">\n\n    <button id="streamEntryBodyViewGradeButton{{::interactiveBodyContent.id}}"\n            class="button button--secondary round small"\n            ng-click="interactiveBodyContent.showTheContent()"\n            bb-click-focus="#grade-value{{::interactiveBodyContent.id}} .wrapping-input-style"\n            ng-hide="interactiveBodyContent.showContent"\n            bb-translate bb-translate-attrs="{ \'aria-label\': \'base.stream.entryBody.grades.viewGrade\' }"\n            analytics-id="base.stream.entryBody.grades.viewGrade">\n      base.stream.entryBody.grades.viewGrade\n    </button>\n    \x3c!--removing aria-hidden as it is redundant ng-show is enough as it hides the content\n    cleaning this up to prevent potential bugs--\x3e\n    <div class="js-grade stream-grade"\n         ng-show="interactiveBodyContent.showContent">\n      <bb-display-grade id="grade-value{{::interactiveBodyContent.id}}" class="grade-value"\n                        column="interactiveBodyContent.content.column" grade-detail="interactiveBodyContent.content"\n                        schema="interactiveBodyContent.content.schema" display-type="GradeColor" aria-live="assertive"></bb-display-grade>\n      <button class="anchor" id="streamEntryBodyHideGradeLink{{::interactiveBodyContent.id}}"\n         ng-click="interactiveBodyContent.hideTheContent()"\n         bb-click-focus="#streamEntryBodyViewGradeButton{{::interactiveBodyContent.id}}"\n         bb-translate\n         analytics-id="base.stream.entryBody.grades.hideGrade">\n        base.stream.entryBody.grades.hideGrade\n      </button>\n    </div>\n\n  </span>\n  <div class="row js-attemptsRemaining"\n       ng-if="::interactiveBodyContent.content.attemptsRemaining"\n       bb-translate translate-values="{ numberOfAttemptsLeft: {{::interactiveBodyContent.content.attemptsRemaining}} }">\n    base.stream.entryBody.grades.attemptsLeft.plural\n  </div>\n</span>\n'},tdYh:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));const s=/^\w+\:{1}/},u2fd:function(e,t){e.exports='<p class="summary" ng-if="bodyContent().bodyText" ng-bind-html="bodyContent().bodyText"></p>'},xpqL:function(e,t,n){"use strict";n.d(t,"a",(function(){return y})),n.d(t,"b",(function(){return b}));var s=n("D57K"),r=n("Llzl"),a=n("nsO7"),i=n("7C3+"),o=n("0JpG"),c=n("pjml"),l=n("iG2q"),d=n("yC9S"),u=n("adx1"),p=n("MOka"),h=n("z6Q5"),m=n("aHpC");const y="ultra.service.stream.manager",b="streamEntryManager",E="STREAM_CONTENT_PULLED",T=["GB:GB_ATT_UPDATED","GB:GB_GRA_UPDATED","GB:GB_GRA_CLEARED"];let f=class e extends u.a{constructor(e,t,n,s,r,a,i,o,c,l){super(),this.$log=e,this.$q=t,this.$rootScope=n,this.$timeout=s,this.BatchApiService=r,this.bbLocalize=a,this.streamSettingsService=i,this.CourseModel=o,this.StreamContentModel=c,this.transformer=l,this.providers={},this.entries=[],this.deletedIds=[],this.userCache={},this.courseCache={},this.userCourseAvailabilities={},this.hasMoreData=!0,d.b.OnRootScope(this.$rootScope,"membership.update",((e,t,n,s,r,a,i,o)=>{this.userCourseAvailabilities[o]&&(this.userCourseAvailabilities[o][i.id]=t.isAvailable)}))}loadBundle(){return this.bbLocalize.loadBundle("features/base/stream/base-stream")}loadAllStreamEntries(e,t){return this.$q.all([this.getEntries(t),this.loadBundle()]).then((t=>(this.hasMoreData&&this.getMoreEntries().then((t=>{e&&e(this.processStreamData(t))})),this.processStreamData(t[0]))),(()=>({entries:[],deletedIds:[]})))}removeStreamEntryFromServer(e){if(e&&e.isImportant&&e.remove)return e.remove();const t=this.$q.defer();return t.reject("Can only remove important notifications with remove method"),t.promise}processStreamEntries(e){return(e||[]).map((e=>e&&this.processStreamEntry(e))).filter((e=>e&&T.indexOf(e.type)<0))}processStreamEntry(e){const t=i.f.getEntryType(e);return this.transformer.getDataTransformerByType(t).convert(e)}processGroupStreamEntry(e,t){const n=this.transformer.getDataTransformerByType(t);if(n.group)try{return n.group(e)}catch(e){this.$log.log(e)}else this.$log.log("Method for grouping stream entries does not exist for data transformer used for processing entries with type of "+t);return e}processStreamData(t,n=[]){const s={entries:this.processStreamEntries(t.entries),deletedIds:t.deletedIds},r=new Set;return s.entries.filter((({courseId:e,entrySpecificData:t})=>e&&a.at(t||{},"streamUser.avatar.permanentUrl")[0])).filter((({courseId:t})=>(new Date).getTime()-(this.userCourseAvailabilities[t]||{_lastUpdatedAt:0})._lastUpdatedAt>e.MIN_INTERNAL_COURSE_MEMBERSHIP_FETCH_IN_MS)).forEach((({courseId:e})=>{r.add(e)})),n.push(this.BatchApiService.performBatch((()=>{r.forEach((e=>{this.CourseModel.$new(e).memberships.$fetch({limit:1e4}).$asPromise().then((t=>{const n=this.userCourseAvailabilities[e]||(this.userCourseAvailabilities[e]={});n._lastUpdatedAt=(new Date).getTime(),t.forEach((e=>{n[e.userId]=e.isAvailable}))}))}))}))),s}_reset(){this.startTime=Date.now(),this.lastCall=null,this.entries=[],this.deletedIds=[]}getEntries(e){return this._reset(),this._getRawEntries(!1,e)}getMoreEntries(){const e=this.$q.when({entries:[],deletedIds:[]});return this.hasMoreData?this.getEntries(!1):e}_shouldKeepLoading(){return Date.now()-this.startTime<this.gracePeriod&&this.hasMoreData}_collectEntries(e){return this.entries=this.entries.concat(e.sv_streamEntries),this.deletedIds=this.deletedIds.concat(e.sv_deletedIds),this.$emitEvent(E,{entries:this.processStreamEntries(e.sv_streamEntries),deletedIds:e.sv_deletedIds}),this._shouldKeepLoading()?this._getRawEntries(!0,!1):this.$q.when({entries:this.entries,deletedIds:this.deletedIds})}_getRawEntries(t,n){const s=this.lastCall?Math.max(0,e.GET_ENTRIES_CALL_INTERVAL-(Date.now()-this.lastCall)):0;return this.$timeout((()=>{this.lastCall=Date.now();const s=this._generatePayload(t,n);return this.StreamContentModel.$new(e.ULTRA_STREAM_ID).$fetch(s).$asPromise().then((e=>(this._processProviders(e.sv_providers),this._cacheCourses(e.sv_extras.sx_courses),this._cacheUsers(e.sv_extras.sx_users),this.gracePeriod=1e3*e.sv_autoDisplayGracePeriodSeconds,this.hasMoreData=e.sv_moreData,this._populateExtras(e.sv_streamEntries),this._collectEntries(e)))).catch((t=>(this.hasMoreData=!1,this.$rootScope.$emit(e.STREAMS_LOADING_ERROR_EVENT),this.$q.reject(t))))}),s)}_processProviders(e){e&&e.forEach((e=>{this.providers[e.sp_provider]={sp_provider:e.sp_provider,sp_newest:e.sp_newest,sp_oldest:e.sp_oldest,sp_refreshDate:e.sp_refreshDate}}))}_cacheCourses(e){(e||[]).forEach((e=>{this.courseCache[e.id]=this.CourseModel.$build(e)}))}_cacheUsers(e){e.filter((e=>null!=e.sx_user)).forEach((e=>{this.userCache[e.sx_id]=e.sx_user}))}_populateExtras(t){const n=Object.keys(this.userCache).length>0,s=Object.keys(this.courseCache).length>0;t.forEach((t=>{if(t.ui={},n&&(t.ui.streamUser=t.se_userId&&this.userCache[t.se_userId]||null),s){const e=i.f.getCourseId(t);t.ui.streamCourse=e&&this.courseCache[e]||null}t.itemSpecificData=a.omitBy(t.itemSpecificData,a.isNull);const r=e.DETAIL_NAMES[t.providerId];if(r){const e=t.itemSpecificData[r];a.defaults(e,a.omit(t.itemSpecificData,r))}}))}_generatePayload(e,t){const n=!!r.isDefined(t)&&t;return{providers:this.providers,forOverview:!1,retrieveOnly:e,flushCache:n}}$onStreamPulled(e){return super.$onEvent(E,e)}};f.STREAMS_LOADING_ERROR_EVENT="streams-fetching-error",f.MIN_INTERNAL_COURSE_MEMBERSHIP_FETCH_IN_MS=3e4,f.GET_ENTRIES_CALL_INTERVAL=1e3,f.ULTRA_STREAM_ID="ultra",f.DETAIL_NAMES={"bb-announcement":"notificationDetails",bb_blog:"blogDetails",bb_calendar:"calendarDetails",bb_disc:"discussionboardDetails","bb-evidence-collection":"evidenceDetails",bb_mygrades:"gradeDetails",bb_deployment:"learnDeploymentDetails",bb_message:"messageDetails","bb-nautilus":"notificationDetails",bb_Wiki:"wikiDetails"},f=Object(s.a)([Object(s.c)(0,Object(m.b)("$log")),Object(s.c)(1,Object(m.b)("$q")),Object(s.c)(2,Object(m.b)("$rootScope")),Object(s.c)(3,Object(m.b)("$timeout")),Object(s.c)(4,Object(m.b)(h.b)),Object(s.c)(5,Object(m.b)(o.serviceName)),Object(s.c)(6,Object(m.b)(p.b)),Object(s.c)(7,Object(m.b)(c.m.serviceName)),Object(s.c)(8,Object(m.b)(c.ob.serviceName)),Object(s.c)(9,Object(m.b)(l.c))],f);r.module(y,[c.N,h.a,l.b,p.a]).service(b,f)},zyQz:function(e,t,n){"use strict";var s=n("nbDY"),r=n.n(s),a=n("EtRF"),i=n("1ovh"),o=n("nmzr");class c extends r.a{constructor(e,t){super(e),this.options=t}getRelatedTimeSeries(){return this.options.relatedTimeSeries}getTitle(e,t){if(this===c.StudentsInTrouble){const n=parseInt(e.extraAttribs.inTroubleCount,10)||0,s=parseInt(e.extraAttribs.inTroubleFailing,10)||0,r=parseInt(e.extraAttribs.inTroubleAbsent,10)||0;let a="withBoth.plural";return a=s>0?r>0?"withBoth.plural":"withFailing.plural":r>0?"withAbsent.plural":"noExtras.plural",{locale:t,key:this.options.bundleTitleKey+"."+a,params:{count:n,failing:s,absent:r}}}const n=this.getPhraseVariant(e);return n?{locale:t,key:this.options.bundleTitleKey+".variation"+n}:{locale:t,key:this.options.bundleTitleKey}}getBody(e,t){if(this.options.bundleBodyKey){const n=this.getPhraseVariant(e);return n?{locale:t,key:this.options.bundleBodyKey+".variation"+n}:{locale:t,key:this.options.bundleBodyKey}}return{locale:t,key:""}}getPhraseVariant(e){if(this.options.phraseVariants){return 1+((e.extraAttribs.phraseVariant||1)-1)%this.options.phraseVariants}}getInitialView(){return this.options.initialView}getInsight(e){return this.options.insightKey?{locale:e,key:this.options.insightKey}:null}getAction(e){return this.options.actionKey?{locale:e,key:this.options.actionKey}:null}getIcon(){return this.options.icon}}c.SufficientActivityData=new c("SufficientActivityData",{initialView:o.M.INSTRUCTOR_DYNAMIC,relatedTimeSeries:i.a.Activity,bundleTitleKey:"base.stream.telemetry.sufficientActivityData.title",bundleBodyKey:"base.stream.telemetry.sufficientActivityData.body",icon:a.a.Default}),c.SufficientGradeData=new c("SufficientGradeData",{initialView:o.M.INSTRUCTOR_DYNAMIC,relatedTimeSeries:i.a.Grades,bundleTitleKey:"base.stream.telemetry.sufficientGradeData.title",bundleBodyKey:"base.stream.telemetry.sufficientGradeData.body",icon:a.a.Default}),c.StudentsInTrouble=new c("StudentsInTrouble",{initialView:o.M.INSTRUCTOR_DYNAMIC,relatedTimeSeries:i.a.Grades,bundleTitleKey:"base.stream.telemetry.studentsInTrouble",icon:a.a.Alert}),c.GradeBelowThreshold=new c("GradeBelowThreshold",{initialView:o.M.STUDENT_LOW_GRADES,relatedTimeSeries:i.a.Grades,bundleTitleKey:"base.stream.telemetry.gradeWarning.title",bundleBodyKey:"base.stream.telemetry.gradeWarning.body",phraseVariants:2,insightKey:"components.directives.telemetry.insight.gradeBelowThreshold",actionKey:"base.stream.telemetry.action.level",icon:a.a.Alert}),c.GradeInLowest=new c("GradeInLowest",{initialView:o.M.STUDENT_LOW_GRADES,relatedTimeSeries:i.a.Grades,bundleTitleKey:"base.stream.telemetry.gradeWarning.title",bundleBodyKey:"base.stream.telemetry.gradeWarning.body",phraseVariants:2,insightKey:"components.directives.telemetry.insight.lowPerformer",actionKey:"base.stream.telemetry.action.level",icon:a.a.Alert}),c.GradeDropped=new c("GradeDropped",{initialView:o.M.STUDENT_FIND_A_STUDY_PARTNER,relatedTimeSeries:i.a.Grades,bundleTitleKey:"base.stream.telemetry.gradeDropped.title",bundleBodyKey:"base.stream.telemetry.gradeDropped.body",insightKey:"components.directives.telemetry.insight.trendingDown",actionKey:"base.stream.telemetry.action.studyPartner",icon:a.a.Alert}),c.NoRecentActivity=new c("NoRecentActivity",{initialView:o.M.DIRECT_TO_COURSE,relatedTimeSeries:i.a.Activity,bundleTitleKey:"base.stream.telemetry.activityLowestWarning.title",bundleBodyKey:"base.stream.telemetry.activityLowestWarning.body",insightKey:"components.directives.telemetry.insight.noRecentActivity",actionKey:"base.stream.telemetry.action.courseOutline",icon:a.a.Alert}),c.ActivityInLowest=new c("ActivityInLowest",{initialView:o.M.STUDENT_LOW_ACTIVITY,relatedTimeSeries:i.a.Activity,bundleTitleKey:"base.stream.telemetry.activityLowestWarning.title",bundleBodyKey:"base.stream.telemetry.activityLowestWarning.body",insightKey:"components.directives.telemetry.insight.lowPerformer",actionKey:"base.stream.telemetry.action.level",icon:a.a.Alert}),c.ActivityDropped=new c("ActivityDropped",{initialView:o.M.STUDENT_LOW_ACTIVITY,relatedTimeSeries:i.a.Activity,bundleTitleKey:"base.stream.telemetry.activityDroppedWarning.title",bundleBodyKey:"base.stream.telemetry.activityDroppedWarning.body",insightKey:"components.directives.telemetry.insight.trendingDown",actionKey:"base.stream.telemetry.action.level",icon:a.a.Alert}),c.ActivityIncreased=new c("ActivityIncreased",{initialView:o.M.STUDENT_PROGRESS,relatedTimeSeries:i.a.Activity,bundleTitleKey:"base.stream.telemetry.performanceIncreased.title",bundleBodyKey:"base.stream.telemetry.performanceIncreased.body",actionKey:"base.stream.telemetry.action.performance",icon:a.a.Kudos}),c.ActivityInHighest=new c("ActivityInHighest",{initialView:o.M.STUDENT_HIGH_PERFORMANCE,relatedTimeSeries:i.a.Activity,bundleTitleKey:"base.stream.telemetry.activityInHighest.title",bundleBodyKey:"base.stream.telemetry.activityInHighest.body",actionKey:"base.stream.telemetry.action.performance",icon:a.a.Kudos}),c.GradeIncreased=new c("GradeIncreased",{initialView:o.M.STUDENT_PROGRESS,relatedTimeSeries:i.a.Grades,bundleTitleKey:"base.stream.telemetry.performanceIncreased.title",bundleBodyKey:"base.stream.telemetry.performanceIncreased.body",actionKey:"base.stream.telemetry.action.performance",icon:a.a.Kudos}),c.GradeInHighest=new c("GradeInHighest",{initialView:o.M.STUDENT_HIGH_PERFORMANCE,relatedTimeSeries:i.a.Grades,bundleTitleKey:"base.stream.telemetry.gradeInHighest.title",bundleBodyKey:"base.stream.telemetry.gradeInHighest.body",actionKey:"base.stream.telemetry.action.performance",icon:a.a.Kudos}),t.a=c}}]);