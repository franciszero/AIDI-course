(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{"/ugB":function(e,t){e.exports='<bb-telemetry-chart ng-if="telemetry.showData"\n                    chart-config="telemetry.chart"\n                    reflow-chart-on="reflowChartOn()"\n                    table-config="telemetry.table"\n                    course="course()"\n                    selected-user="user()"\n                    filename-suffix="a"\n                    can-view-all-user-data="canViewAllUserData()"\n                    class="telemetry-time-series">\n  \x3c!-- Activity time-series table --\x3e\n  <div st-table="rows" st-safe-src="telemetry.table.rows" class="activity-time-series-table">\n    <table class="fs-table table table-striped">\n      <thead>\n      <tr>\n        <th id="my-activity-date-header"\n            scope="col"\n            class="telemetry-sortable"\n            st-sort="date"\n            st-skip-natural="true"\n            st-sort-default="true" >\n            <span role="button" tabindex="0">\n              <bb-translate>components.directives.telemetry.table.dateColumn</bb-translate>\n              <span id="my-activity-date-header-asc">\n                <span class="sr-only" bb-translate>components.directives.telemetry.table.ascendingOrder</span>\n              </span>\n              <span id="my-activity-date-header-desc">\n                <span class="sr-only" bb-translate>components.directives.telemetry.table.descendingOrder</span>\n              </span>\n            </span>\n        </th>\n        <th scope="col" bb-translate>components.directives.telemetry.table.classActivityColumn</th>\n        <th scope="col" bb-translate>components.directives.telemetry.table.classActivityConfidenceColumn</th>\n        <th scope="col" bb-translate>components.directives.telemetry.table.classActivityInstructor</th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr ng-repeat="row in rows">\n        <td scope="row" class="date" bb-translate translate-values="{ value: row.date }">components.directives.telemetry.table.dateValue</td>\n        <td class="activity-class">\n          <span class="round" bb-translate translate-values="{ value: row.courseValue }">components.directives.telemetry.table.activityValue</span>\n        </td>\n        <td class="delta">\n          <span class="round" bb-translate translate-values="{ min: row.intervalMin, max: row.intervalMax }">components.directives.telemetry.table.activityValueRange</span>\n        </td>\n        <td class="activity">\n          <span class="round" bb-translate translate-values="{ value: row.studentValue }">components.directives.telemetry.table.activityValue</span>\n          <span class="deviation down" ng-if="::row.belowStdDev && row.diffFromInterval >= 0.01 " bb-translate translate-values="{ diff: row.diffFromInterval }">components.directives.telemetry.table.valueBelowInterval</span>\n          <span class="deviation up" ng-if="::row.aboveStdDev && row.diffFromInterval >= 0.01 " bb-translate translate-values="{ diff: row.diffFromInterval }">components.directives.telemetry.table.valueAboveInterval</span>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n  <div class="telemetry-table-legend" ng-show="telemetry.table.hasDataOutsideInterval">\n    <div class="telemetry-table-legend-container">\n      <span class="legend-entry">\n      <span class="ci-icon above-ci-icon"></span>\n      <span class="ci-label" bb-translate>components.directives.telemetry.table.legendAboveCI</span>\n    </span>\n      <span class="legend-entry">\n      <span class="ci-icon below-ci-icon"></span>\n      <span class="ci-label" bb-translate>components.directives.telemetry.table.legendBelowCI</span>\n    </span>\n    </div>\n  </div>\n</bb-telemetry-chart>'},"1ovh":function(e,t,s){"use strict";var n=s("nbDY"),r=s.n(n),a=s("7g5f"),i=s("/ugB");class o extends r.a{constructor(e,t){super(e),this.templateHtml=t}getTemplateHtml(){return this.templateHtml}}o.Grades=new o("grades",a),o.Activity=new o("activity",i),t.a=o},"3Bw1":function(e,t){e.exports='<bb-modal id="content-deleted-modal"\n          class="notification"\n          modal-title-key="base.stream.modal.deleted.title"\n          analytics-id-tag-prefix="base.stream.modal.deleted">\n  <div name="modal-contents">\n    <p bb-translate>base.stream.modal.deleted.body</p>\n  </div>\n  <button name="modal-footer-button-primary" class="button confirm-ok js-primary-button" ng-click="$parent.$close()" bb-translate analytics-id="global.ok">global.ok</button>\n</bb-modal>\n'},"7C3+":function(e,t,s){"use strict";s.d(t,"g",(function(){return g})),s.d(t,"h",(function(){return f})),s.d(t,"f",(function(){return S})),s.d(t,"e",(function(){return I})),s.d(t,"a",(function(){return v})),s.d(t,"d",(function(){return D})),s.d(t,"b",(function(){return _})),s.d(t,"c",(function(){return C}));var n=s("nsO7"),r=s("Llzl"),a=s("6ynb"),i=s("0JpG"),o=s("vhkR"),l=s("Is+C"),c=s("Fvsw"),d=s("KBr+"),u=s("P2dS"),p=s("12mu"),m=s("pjml"),h=s("8jzW"),y=s("KtUo"),b=s("r6lH"),E=s("av75"),T=s("nmzr");const g="ultra.service.stream.transformer.data",f="baseStreamEntryTransformer";class S{static getCourseId(e){return e&&e.se_courseId||e&&e.se_orgId||""}static getCourseName(e){return e&&e.ui.streamCourse&&e.ui.streamCourse.name||""}static getSequenceId(e){return e.se_id.substr(e.providerId.length)}static getEntryType(e){if(e){const t=e.extraAttribs&&e.extraAttribs.event_type||e.providerId;if(t&&t.length>0)return t.trim()}throw new Error("Type identifier does not exist on the given Learn stream entry."+(e.se_id||""))}static generateStreamId(e){return e&&e.se_id||"local_"+S.index++}static validateEntriesForGrouping(e,t){let s=e&&e.length>0;if(s){const n=e[0].courseId;s=e.every((e=>e.isGroupable&&t.some((t=>t===e.type))&&e.courseId===n))}return s}static hasNewEntry(e){return e&&e.some((e=>e.isNew))||!1}static getMostRecentEntry(e){return e&&e.length>0?n.sortBy(e,"notificationCreationDate")[e.length-1]:null}static getGroupedEntryIds(e){let t=[];return e&&Array.isArray(e)&&e.forEach((e=>{const s=e.groupedEntryIds;s?t=t.concat(s):t.push(e.id)})),t}static getDistinctAuthorIds(e,t){const s={};return e.forEach((e=>{const n=e.authorIds;if(n)n.forEach((e=>{s[e]=s[e]||[]}));else{const n=t(e);(s[n]=s[n]||[]).push(e)}})),Object.keys(s)}static getCoursePanelStateRef(e,t){return"course.outline("+r.toJson({courseId:e,legacyUrl:t})+")"}static getDiscussionPanelStateRef(e,t){return'discussion.view.with-grading({ contentId: "'+e+'", courseId: "'+t+'" })'}static getJournalPanelStateRef(e,t){return`${T.A.JOURNAL_VIEW_WITH_PARTICIPATION}({ contentId: "${e}", courseId: "${t}" })`}}S.DUE_DATE_FORMAT=i.ILocaleDatetimeFormat.Short,S.index=1;class I extends a.a{constructor(e){super(e),this.name="StreamEntriesGroupingError"}}class v{constructor(e){this.supportedTypes=e}canHandle(e){return e&&this.canHandleType(S.getEntryType(e))}canHandleType(e){return this.supportedTypes&&this.supportedTypes.some((t=>0===t.indexOf(e)))}convert(e){return{id:S.generateStreamId(e),type:S.getEntryType(e),providerId:e.providerId,eventType:e.itemSpecificData.eventType,notificationCreationDate:e.se_timestamp>0?new Date(e.se_timestamp):null,contextualDate:null,icon:null,isNew:!1,isImportant:!1,isGroupable:!1,courseId:S.getCourseId(e),isOrg:e&&e.ui.streamCourse&&e.ui.streamCourse.isOrganization||null,header:S.getCourseName(e),title:null,contentHandler:e.itemSpecificData.contentDetails&&e.itemSpecificData.contentDetails.contentHandler}}setLegacyCourseUrlRefToBody(e,t){const s=e&&e.ui&&e.ui.streamCourse,n=e&&e.se_itemUri;s&&s.isClassic()&&n&&(t.body=t.body||{},t.body.stateRef=S.getCoursePanelStateRef(s.id,n))}}class D extends v{constructor(e,t){super(t),this.bbLocalize=e}convert(e){const t=super.convert(e);return t.entrySpecificData=e.ui.streamUser?{streamUser:e.ui.streamUser}:null,t}getUserDisplayName(e){return this.bbLocalize.formatUsername(e,i.ILocaleUsernameFormat.Short,null,{noWrap:!0,noEscape:!0})}}class _ extends v{constructor(){super([])}canHandle(e){return!1}canHandleType(e){return!1}convert(e){const t=super.convert(e),s=e.itemSpecificData;return t.icon=_.DEFAULT_ICON,t.body={type:E.a.SimpleText,content:{bodyText:s.contentExtract||e.se_details||e.se_context}},t}}_.DEFAULT_ICON="post";class C extends v{constructor(e,t){super(y.b(e)),this.supportedEventTypes=e}canHandleType(e){if(!this.supportedEventTypes||!Object.keys(this.supportedEventTypes).length)return!1;const t=e.split(":")[0],s=this.supportedEventTypes[t];return s&&s.length>0&&s.some((t=>0===t.indexOf(e)))}convert(e){const t=super.convert(e),s=e.itemSpecificData.notificationDetails;return t.icon=C.TYPE_ICON_MAPPINGS[s.sourceType]||t.icon,t.notificationIds=s.notificationIds,t}}C.TYPE_ICON_MAPPINGS={AS:"assignment",BL:"blog",CM:"message",CR:"course",DF:"discussion",DT:"discussion",JN:"journal",GB:"grades",PE:"test",PS:"test",QU:"course",SU:"survey",SC:"scormengine",TE:"test",UA:"assignment",WK:"wiki"};r.module(g,[i.moduleName,o.a,l.b,c.a,d.a,p.a,m.N,h.b,b.a,u.b]).service(f,_)},"7g5f":function(e,t){e.exports='<bb-telemetry-chart ng-if="telemetry.showData"\n                    chart-config="telemetry.chart"\n                    reflow-chart-on="reflowChartOn()"\n                    table-config="telemetry.table"\n                    course="course()"\n                    selected-user="user()"\n                    filename-suffix="g"\n                    can-view-all-user-data="canViewAllUserData()"\n                    y-axis-zoom-enabled="false"\n                    class="telemetry-time-series">\n  \x3c!-- Grade time-series table --\x3e\n  <div st-table="rows" st-safe-src="telemetry.table.rows" class="grade-time-series-table">\n    <table class="fs-table table table-striped">\n      <thead>\n      <tr>\n        <th id="my-grades-date-header"\n            scope="col"\n            class="telemetry-sortable"\n            st-sort="date"\n            st-skip-natural="true"\n            st-sort-default="true">\n            <span tabindex="0" role="button">\n              <bb-translate>components.directives.telemetry.table.dateColumn</bb-translate>\n              <span id="my-grades-date-header-asc">\n                <span class="sr-only" bb-translate>components.directives.telemetry.table.ascendingOrder</span>\n              </span>\n              <span id="my-grades-date-header-desc">\n                <span class="sr-only" bb-translate>components.directives.telemetry.table.descendingOrder</span>\n              </span>\n            </span>\n        </th>\n        <th scope="col" bb-translate>components.directives.telemetry.table.classGradeColumn</th>\n        <th scope="col" bb-translate>components.directives.telemetry.table.classGradeConfidenceColumn</th>\n        <th scope="col" bb-translate>components.directives.telemetry.table.classGradeInstructor</th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr ng-repeat="row in rows">\n        <td scope="row" class="date" bb-translate translate-values="{ value: row.date }">components.directives.telemetry.table.dateValue</td>\n        <td class="grade-class">\n          <span class="round" bb-translate translate-values="{percentage: row.courseValue}">global.percentDecimal</span>\n        </td>\n        <td class="delta">\n          <span class="round" bb-translate translate-values="{ min: row.intervalMin, max: row.intervalMax }">components.directives.telemetry.table.gradeValueRange</span>\n        </td>\n        <td class="grade">\n          <div><readonly-grade-pill grade="row.studentValue" points-possible="telemetry.gradePillSettings.pointsPossible"\n                                  variant="telemetry.gradePillSettings.variant"\n                                  grade-color-variant="telemetry.gradePillSettings.colorDefault">\n          </readonly-grade-pill></div>\n          <span class="deviation down" ng-if="::row.belowStdDev && row.diffFromInterval >= 0.01" bb-translate translate-values="{ diff: row.diffFromInterval }">components.directives.telemetry.table.valueBelowInterval</span>\n          <span class="deviation up" ng-if="::row.aboveStdDev && row.diffFromInterval >= 0.01" bb-translate translate-values="{ diff: row.diffFromInterval }">components.directives.telemetry.table.valueAboveInterval</span>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n  <div class="telemetry-table-legend" ng-show="telemetry.table.hasDataOutsideInterval">\n    <div class="telemetry-table-legend-container">\n      <span class="legend-entry">\n      <span class="ci-icon above-ci-icon"></span>\n      <span class="ci-label" bb-translate>components.directives.telemetry.table.legendAboveCI</span>\n    </span>\n      <span class="legend-entry">\n      <span class="ci-icon below-ci-icon"></span>\n      <span class="ci-label" bb-translate>components.directives.telemetry.table.legendBelowCI</span>\n    </span>\n    </div>\n  </div>\n</bb-telemetry-chart>\n'},"8iPc":function(e,t){e.exports='<p class="summary" ng-if="::bodyContent().bodyText" ng-bind-html="::bodyContent().bodyText"></p>\n<a class="button button--secondary action-button"\n   ng-if="::!bodyContent().isComponentActionSref"\n   bb-peek-sref="{{bodyContent().actionSref}}"\n   analytics-id="base.stream.entryBody.telemetry.link">{{::bodyContent().actionText}}</a>'},EtRF:function(e,t,s){"use strict";var n=s("nbDY"),r=s.n(n);class a extends r.a{}a.DEFAULT=new a("retention-center"),a.KUDOS=new a("kudos"),a.ALERT=new a("alert-error"),t.a=a},"KBr+":function(e,t,s){"use strict";var n=s("Llzl"),r=s("iYZE");const a="ultra.utility.batchLoader",i="BatchLoaderFactory";class o{constructor(e,t,s,n){this.modelStatic=t,this.$q=s,this.$timeout=n,this.toFetch={},this.cache=new r(e)}push(e,t){const s=this.cache.get(e);if(void 0!==s)return t(null,this.modelStatic.$buildRaw(s),e);const n=this.toFetch[e];null==n?this.toFetch[e]=[t]:n.push(t)}load(e){const t=this.$q.defer();return n.isArray(e)&&e.length>0||!n.isArray(e)?this._loadInternal(e,((e,s,n)=>{e?t.reject(e):t.resolve(s)})):t.resolve({}),t.promise}_loadInternal(e,t){if(Array.isArray(e)){const s=this.getCoalescingCallback(e.length,t);for(let t=0;t<e.length;t++)this.push(e[t],s)}else this.push(e,t);this.lazyLoad()}_load(){const e=this.toFetch;this.toFetch={};const t=Object.keys(e);0!==t.length&&this.modelStatic.findMany(t).$asPromise().then((s=>{let n,r={};if(Array.isArray(s))for(let e=0;e<s.length;e++)n=s[e],r[n.id]=n;else{if("object"!=typeof s)throw new Error("Invalid items format");r=s}for(let s=0;s<t.length;s++){const a=t[s];n=r[a];const i=e[a];this.cache.set(a,void 0===n?null:n.$encode());for(let e=0;e<i.length;e++)i[e](null,n,a)}}),(s=>{t.forEach((t=>{e[t].forEach((e=>{e(s)}))}))}))}lazyLoad(){null==this.timeout&&(this.timeout=this.$timeout((()=>{this._load(),this.timeout=null}),0,!1))}getCoalescingCallback(e,t){let s=!1;const n={};let r=0;return(a,i,o)=>{if(!s){if(a)return s=!0,t(a);i&&(n[o]=i),r++,r>=e&&(s=!0,t(null,n))}}}}n.module(a,[]).factory(i,["$q","$timeout",(e,t)=>function(s,n){return new o(s,n,e,t)}]);var l=s("pjml");s.d(t,"a",(function(){return c})),s.d(t,"b",(function(){return d}));const c="ultra.batchLoader.courseNameBatchLoader",d="CourseBatchLoader";class u{constructor(e,t){this.batchLoader=e(200,t)}load(e){return this.batchLoader.load(e)}}u.$inject=[i,l.m.serviceName];n.module(c,[a,l.N]).service(d,u)},KtUo:function(e,t,s){"use strict";s.d(t,"c",(function(){return n})),s.d(t,"a",(function(){return r})),s.d(t,"b",(function(){return a}));const n=function(e){return e.contextualDate||e.notificationCreationDate},r=function(e,t){const s=new Date(t.getTime());s.setHours(0,0,0,0);const n=new Date(s.getTime()+864e5);return e<s?-1:e>=n?1:0},a=function(e){return e&&Object.keys(e||{}).reduce(((t,s)=>t.concat(e[s])),[])}},OaxLs:function(e,t,s){"use strict";var n=s("D57K"),r=s("nsO7"),a=s("Llzl"),i=s("5MwF"),o=s("Fvsw"),l=s("xpqL"),c=s("yC9S"),d=s("adx1"),u=s("aHpC"),p=s("MOka"),m=s("KtUo");var h=function(e){return e.filter((function(e){return e.isImportant}))};var y=function(e,t){return e.filter((function(e){const s=m.c(e);return!e.isImportant&&s&&m.a(s,t)<0}))};var b=function(e,t){return e.filter((function(e){const s=m.c(e);return!e.isImportant&&s&&0===m.a(s,t)}))};var E=function(e,t){return e.filter((function(e){const s=m.c(e);return!e.isImportant&&s&&m.a(s,t)>0}))},T=s("av75");class g{constructor(){this.allEntries=[],this.view=[]}addEntries(e){this.allEntries=this.allEntries.concat(e)}refreshView(e){this.view=[].concat((e?e(this.allEntries):this.allEntries).filter((e=>!e.hidden)))}deleteEntries(e){this.allEntries=this.allEntries.filter((t=>-1===e.indexOf(t.id)))}}class f extends g{constructor(e){super(),this.entryLoader=e}addEntries(e){super.addEntries(h(e))}deleteEntry(e){if(e.isImportant){const t=this.allEntries.indexOf(e);t>=0&&(this.allEntries.splice(t,1),this.refreshView(this.entryLoader.viewFilter))}}refreshView(e){super.refreshView(e),this.entryLoader._updateBadgeCount()}}class S extends g{constructor(e){super(),this.context=e,this.hasMoreInView=!1}addEntries(e){super.addEntries(E(e,this.context.getServerTime())),this.allEntries=r.sortBy(this.allEntries,m.c)}refreshView(e){super.refreshView(e);const t=this.view.slice(P.UPCOMING_MAX_LENGTH,this.view.length);this.hasMoreInView=t.length>0&&t.some((e=>e.body&&e.body.type===T.a.DueDatedContent)),this.view=this.hasMoreInView?this.view.slice(0,P.UPCOMING_MAX_LENGTH):this.view}}class I extends g{constructor(e,t,s){super(),this.context=e,this.entryLoader=t,this.streamSettings=s}addEntries(e){super.addEntries(b(e,this.context.getServerTime())),this.allEntries=this.entryLoader.groupStreamEntries(this.allEntries);const t=this.context.getServerTime(),s=this.allEntries.filter((e=>m.c(e)>=t)),n=this.allEntries.filter((e=>m.c(e)<t));this.allEntries=r.sortBy(s,m.c).concat(r.sortBy(n,m.c).reverse()),this.allEntries.forEach((e=>{e.hidden=this.streamSettings.hidden(e)}))}deleteEntries(e){this.allEntries=this.allEntries.filter((t=>{const s=t;if(s.groupedEntryIds){s.groupedEntryIds=s.groupedEntryIds.filter((t=>-1===e.indexOf(t)));const t=s;return t.entryContents&&(t.entryContents=t.entryContents.filter((t=>-1===e.indexOf(t.id)))),s.groupedEntryIds.length>0}return-1===e.indexOf(t.id)}))}}class v extends g{constructor(e,t){super(),this.context=e,this.entryLoader=t,this._currentViewFilter=null,this.queuedView=[]}addEntries(e){super.addEntries(y(e,this.context.getServerTime())),this.allEntries=r.sortBy(this.allEntries,m.c).reverse()}refreshView(e){this.queuedView=[].concat((e?e(this.allEntries):this.allEntries).filter((e=>!e.hidden))),(e||null)!==this._currentViewFilter?(this.view=[],this.loadMoreEntriesIntoView(),this._currentViewFilter=e):this.view=this.queuedView.splice(0,this.view.length)}loadMoreEntriesIntoView(){if(this.queuedView.length>0){const e=this.queuedView.splice(0,this._numEntriesToLoad());Array.prototype.push.apply(this.view,e)}}_numEntriesToLoad(){const e=this.entryLoader.countViewEntries();return e>=v.MAX_ENTRIES_TO_PROGRESSIVE_LOAD?v.MAX_ENTRIES_TO_PROGRESSIVE_LOAD:v.MAX_ENTRIES_TO_PROGRESSIVE_LOAD-e}get MAX_ENTRIES_TO_PROGRESSIVE_LOAD(){return v.MAX_ENTRIES_TO_PROGRESSIVE_LOAD}}v.MAX_ENTRIES_TO_PROGRESSIVE_LOAD=20;var D=s("eQBN");s.d(t,"c",(function(){return _})),s.d(t,"d",(function(){return C})),s.d(t,"a",(function(){return R})),s.d(t,"b",(function(){return P}));const _="ultra.service.stream.loader",C="streamEntryLoader";let A=0;const R="PullingTaskScheduled";let P=class e extends d.a{constructor(e,t,s,n,a,i,o,l){super(),this.$interval=e,this.$log=t,this.$q=s,this.$rootScope=n,this.context=a,this.streamEntryManager=i,this.streamSettings=o,this.studentPreview=l,this.badgeCount=0,this.loadingErrorCount=0,this.buckets={},this.preLoading=!0,this.loadingStreamEntriesInProgress=!1,this.oneLoadingIsQueued=!1,this.buckets={important:new f(this),upcoming:new S(a),today:new I(a,this,o),previous:new v(a,this)},c.b.OnRootScope(this.$rootScope,"stream-entry-parent-item-not-found",((e,t)=>{this.deleteEntries([t.id]),this.refreshEntries(!0)})),c.b.OnRootScope(this.$rootScope,"stream-settings-updated",(()=>{this.reapplySettings()})),this.studentPreview.isInIframeOfPreviewMode()||this.init(),c.b.OnRootScope(this.$rootScope,"update-course-status",((e,t)=>{const s=[];r.forEach(this.buckets,(e=>{r.forEach(e.allEntries,(e=>{e.courseId&&e.courseId===t&&!e.isOrg&&s.push(e.id)}))})),this.deleteEntries(s),this.refreshEntries(!0)})),c.b.OnRootScope(this.$rootScope,"update-course-name",((e,t)=>{r.forEach(this.buckets,(e=>{r.forEach(e.allEntries,(e=>{e.courseId&&e.courseId===t.id&&!e.isOrg&&(e.header=t.displayName)}))}))}))}init(){this.initialLoading=this.streamSettings.initializeSettings().finally((()=>{this.preLoading=!1;try{return this.schedulePullingTask()}finally{this.currentTask.run()}})),this.streamEntryManager.$onStreamPulled(((e,t)=>{this._queueStreamData(t)}))}schedulePullingTask(e=!1){if(this.currentTask&&!e)return this.currentTask.promise;this.$log.debug("Stream Polling Task Scheduled",(new Date).toISOString());const t=this.$q.defer(),s=this.$q.defer(),n=this.currentTask={id:A++,run:r.once((()=>{window.requestAnimationFrame((()=>{this.$log.debug("Stream Polling Task Running",(new Date).toISOString()),this._loadEntries(e).finally((()=>{t.resolve(!0),n.run=r.once((()=>s.resolve()));const e=this.$interval(r.noop,i.a.streamLoadingInterval,1,!1);return this.$q.race([s.promise,e]).then((()=>{this.$interval.cancel(e)}))})).then((()=>{this.currentTask=null,this.schedulePullingTask()}))}))})),promise:t.promise};return this.$emitEvent(R,this.currentTask),t.promise}_loadEntries(e){return this.loadingStreamEntriesInProgress?this.oneLoadingIsQueued?null:(this.oneLoadingIsQueued=!0,this.loadEntriesPromise.then((()=>(this.oneLoadingIsQueued=!1,this._loadEntries(e))))):(this.loadingStreamEntriesInProgress=!0,this.loadEntriesPromise=this.streamEntryManager.loadAllStreamEntries((()=>{}),e).then((()=>{this.loadingErrorCount=0}),(()=>{this.loadingErrorCount++,this.loadingErrorCount>=w.MAX_LOADING_ERRORS&&this.cancelPeriodicLoading()})).finally((()=>{this.loadingStreamEntriesInProgress=!1})),this.loadEntriesPromise)}refreshEntries(e){return this.schedulePullingTask(e)}cancelPeriodicLoading(){this.$log.error("Stream loading errors")}reapplySettings(){this.getAllEntries().then((e=>{e.forEach((e=>{e.hidden=this.streamSettings.hidden(e)})),this._refreshViews()}))}isStreamLoading(){return this.loadingStreamEntriesInProgress||this.preLoading}groupStreamEntries(t){if(t&&t.length>0){const s={};t.forEach((t=>{const n=t.type+e.ENTRY_GROUPING_KEY_DELIMITER+t.courseId;(s[n]=s[n]||[]).push(t)}));let n=[];return Object.keys(s).forEach((t=>{let r=s[t];if(1!==r.length&&r[0].isGroupable){const s=t.split(e.ENTRY_GROUPING_KEY_DELIMITER)[0];r=this.streamEntryManager.processGroupStreamEntry(r,s),n=n.concat(r)}else n=n.concat(r)})),n}return t}bulkUpdateEntryStatus(e){e.forEach((e=>{a.isUndefined(e.hidden)&&(e.hidden=this.streamSettings.hidden(e))}))}_queueStreamData(e){this._deleteEntries(e.deletedIds,!1),this._populateEntries(e.entries)}_populateEntries(e){this.bulkUpdateEntryStatus(e),this.addEntries(e,!1)}deleteEntries(e){this._deleteEntries(e,!1)}_deleteEntries(e,t){e&&e.length>0&&(this.allBuckets().forEach((t=>t.deleteEntries(e))),t||this._refreshViews())}addEntries(e,t){e&&e.length>0&&(this.allBuckets().forEach((t=>t.addEntries(e))),t||this._refreshViews())}removeImportantEntry(e){this.buckets.important.deleteEntry(e)}_refreshViews(){this.allBuckets().forEach((e=>e.refreshView(this.viewFilter)))}_updateBadgeCount(){this.badgeCount=this.buckets.important.view.length}allBuckets(){return Object.keys(this.buckets).reduce(((e,t)=>(e.push(this.buckets[t]),e)),[])}_countAllEntries(){return this.allBuckets().reduce(((e,t)=>e+t.allEntries.length),0)}findEntry(e){return this.getAllEntries().then((t=>r.find(t,{id:e})))}getAllEntries(){return this.studentPreview.isInIframeOfPreviewMode()?this.$q.when([]):this.initialLoading.then((()=>this._getAllEntries()))}_getAllEntries(){return Object.keys(this.buckets).reduce(((e,t)=>e.concat(this.buckets[t].allEntries)),[])}countViewEntries(){return this.allBuckets().reduce(((e,t)=>e+t.view.length),0)}setViewFilter(e){this.viewFilter=e,this._refreshViews()}_reset(){this.allBuckets().forEach((e=>{e.allEntries=[]})),this._refreshViews()}};P.ENTRY_GROUPING_KEY_DELIMITER="##",P.UPCOMING_MAX_LENGTH=5,P.MAX_LOADING_ERRORS=3,P=Object(n.a)([Object(n.c)(0,Object(u.b)("$interval")),Object(n.c)(1,Object(u.b)("$log")),Object(n.c)(2,Object(u.b)("$q")),Object(n.c)(3,Object(u.b)("$rootScope")),Object(n.c)(4,Object(u.b)(o.b)),Object(n.c)(5,Object(u.b)(l.b)),Object(n.c)(6,Object(u.b)(p.b)),Object(n.c)(7,Object(u.b)(D.e))],P);class w extends P{}a.module(_,[o.a,D.b,l.a]).service(C,P)},Oy15:function(e,t){e.exports='<span class="due-date" ng-switch on="bodyContent().localizedDueDate != null">\n  <bb-translate ng-switch-when="true" translate-values="{ datetime: \'{{bodyContent().localizedDueDate}}\' }">base.stream.entryBody.duedatedContent.dueDate</bb-translate>\n  <bb-translate ng-switch-when="false">base.stream.entryBody.duedatedContent.noDueDate</bb-translate>\n</span>\n\n'},ZNC7:function(e,t,s){"use strict";var n=s("nbDY"),r=s.n(n);class a extends r.a{constructor(e,t){super(e),this.cssClassObj=t}getCSSClass(){return this.cssClassObj.cssClass}getFirstCSSClass(){return this.cssClassObj.firstCssClass}}a.BoxNotification=new a("BOX_NOTIFICATION",{cssClass:"notification-box",firstCssClass:"first-of-box"}),a.DefaultNotification=new a("DEFAULT_NOTIFICATION",{cssClass:"notification-default"}),t.a=a},av75:function(e,t,s){"use strict";s.d(t,"a",(function(){return d}));var n=s("nbDY"),r=s.n(n),a=s("u2fd"),i=s("Oy15"),o=s("gFY1"),l=s("sbY4"),c=s("8iPc");class d extends r.a{constructor(e,t){super(e),this.templateObj=t}getTemplateHtml(){return this.templateObj.template}}d.SimpleText=new d("SIMPLE_TEXT",{template:a}),d.DueDatedContent=new d("DUE_DATED_CONTENT",{template:i}),d.Calendar=new d("CALENDAR",{template:o}),d.Grades=new d("GRADES",{template:l}),d.Telemetry=new d("TELEMETRY",{template:c})},gFY1:function(e,t){e.exports='<p class="summary">{{bodyContent().eventDescription}}</p>\n<bb-translate ng-if="!(bodyContent().isAllDayEvent)" translate-values="{ datetime: \'{{bodyContent().localizedEventDate}}\' }">base.stream.entryBody.calendar.eventDate</bb-translate>\n<bb-translate ng-if="bodyContent().isAllDayEvent" translate-values="{ date: \'{{bodyContent().localizedEventDate}}\' }">base.stream.entryBody.calendar.allDayEventDate</bb-translate>\n'},iG2q:function(e,t,s){"use strict";var n=s("nsO7"),r=s("Llzl"),a=s("nbDY"),i=s.n(a),o=s("7C3+"),l=s("m3mx"),c=s("Fvsw"),d=s("pjml"),u=s("0JpG"),p=s("g66W"),m=s("av75");const h="announcementStreamEntryTransformer";class y extends o.a{constructor(e,t,s,n){super(y.SUPPORTED_EVENT_TYPES),this.bbLocalize=e,this.context=t,this.CourseModel=s,this.remove=function(){return n.all(this.notificationIds.map((e=>s.$new(this.courseId).notifications.$new(e).$destroy().$allow([404]).$asPromise())))}}convert(e){const t=super.convert(e);return t.icon="announcement",t.isGroupable=!1,t.isImportant=!1,t.remove=this.remove,this.processDetails(t,e),t}processDetails(e,t){const s=t.itemSpecificData.notificationDetails,n="SYSTEM"===s.announcementType;n&&this.context.getBrand().$then((t=>{e.header=this.bbLocalize.translateSync({locale:null,key:"base.stream.institution",params:{brand:t.bannerText}})})),e.title=s.announcementTitle,e.body={type:m.a.SimpleText,content:{bodyText:p.b(s.contentExtract),fullText:p.c(s.announcementBody)}},n?e.body.stateRef='announcement({streamEntryId:"'+e.id+'"})':t.ui&&t.ui.streamCourse&&t.ui.streamCourse.isUltra()?(e.body.stateRef="announcement-detail("+r.toJson({courseId:s.courseId,announcementId:s.sourceId,mode:l.a.VIEW,courseName:e.header})+")",e.notificationIds=s.notificationIds,e.body.content.sourceId=s.sourceId):this.setLegacyCourseUrlRefToBody(t,e)}}y.SUPPORTED_EVENT_TYPES=["AN:AN_AVAIL","AN_AVAIL"],y.$inject=[u.serviceName,c.b,d.m.serviceName,"$q"];r.module(o.g).service(h,y);var b=s("zGdY");const E="calendarStreamEntryTransformer";class T extends o.a{constructor(e){super(T.SUPPORTED_PROVIDERS),this.bbLocalize=e}convert(e){const t=super.convert(e);return t.icon="calendar",this.processDetails(t,e.itemSpecificData.calendarDetails),t}processDetails(e,t){switch(t.calendarId){case b.U.Institution:e.header=this.bbLocalize.translateSync({locale:null,key:"base.stream.calendar.institution"});break;case b.U.Personal:e.header=this.bbLocalize.translateSync({locale:null,key:"base.stream.calendar.personal"})}e.title=this._getTitle(t.title);const s=new Date(t.startDate);let n=!1;if(t.endDate){const e=new Date(t.endDate);n=0===s.getHours()&&0===s.getMinutes()&&23===e.getHours()&&59===e.getMinutes()}e.contextualDate=s;const r={eventDescription:t.description,localizedEventDate:n?this.bbLocalize.formatDateSync(s,u.ILocaleDateFormat.Short):this.bbLocalize.formatDatetimeSync(s,u.ILocaleDatetimeFormat.Short),eventStartDate:s,isAllDayEvent:n};e.body={type:m.a.Calendar,content:r};const a=t.canEdit?"event-edit":"event-view";e.body.stateRef=[a,"({",'calendarId: "',t.calendarId,'",','itemSourceType: "',t.itemSourceType,'",','itemSourceId: "',t.itemSourceId,'"',"})"].join("")}_getTitle(e){return this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.calendar.event",params:{entryTitle:e},noWrap:!0,noEscape:!0})}}T.SUPPORTED_PROVIDERS=["bb_calendar"],T.$inject=[u.serviceName];angular.module(o.g).service(E,T);const g="collabStreamEntryTransformer";var f,S;function I(e){switch(e){case S.EntryPosted:return"entryPosted";case S.EntryEdited:return"entryEdited";case S.EntryDeleted:return"entryDeleted";case S.CommentPosted:return"commentPosted";case S.CommentDeleted:return"commentDeleted"}}!function(e){e.Blog="blog",e.Journal="journal",e.Wiki="wiki"}(f||(f={})),function(e){e.EntryPosted="EP",e.EntryEdited="EE",e.EntryDeleted="ED",e.CommentPosted="CP",e.CommentDeleted="CD"}(S||(S={}));class v extends o.d{constructor(e){super(e,v.SUPPORTED_PROVIDERS)}convert(e){const t=super.convert(e);t.isGroupable=!0,t.hasParticipated=e.se_participated,t.collabAuthorUser=e.ui.streamUser;const s=e.itemSpecificData.blogDetails,n=e.itemSpecificData.wikiDetails,r=s||n;s?(t.collabType=s.isJournal?f.Journal:f.Blog,t.collabId=s.coreIdContainer,t.collabTitle=s.blogName,s.isJournal?t.eventType="JR_".concat(t.eventType):t.eventType="BL_".concat(t.eventType)):n&&(t.collabType=f.Wiki,t.collabId=n.coreIdContainer,t.collabTitle=n.wikiName),this.processDetails(t,r),this.setLegacyCourseUrlRefToBody(e,t);const a=r.others;if(a&&a.length>0){const e=t;return t.collabAuthorUser?e.authorIds=a.concat([t.collabAuthorUser.id]):e.authorIds=a,e.groupedEntryIds=[t.id],this._setGroupedEntryTitle(e,t,e.authorIds.length),e}return this._setEntryTitle(t),t}processDetails(e,t){var s;e.collabEventType=(s=t.eventType,Object.values(S).find((e=>e===s))),e.collabEntryId=t.coreId,e.collabEntryTitle=t.title,e.icon=e.collabType,e.body={type:m.a.SimpleText,content:{bodyText:this._getBodyText(t)}}}_setEntryTitle(e){const t=I(e.collabEventType);t||(e.title=e.collabEntryTitle);const s=this.getTitle(e),n=["base.stream.entryTitle",e.collabType,t];e.collabAuthorUser?this.getUserDisplayName(e.collabAuthorUser).then((t=>{n.push("withName"),e.title=this.bbLocalize.translateSync({locale:null,key:n.join("."),params:{entryTitle:s,userName:t}})})):(n.push("noName"),e.title=this.bbLocalize.translateSync({locale:null,key:n.join("."),params:{entryTitle:s,userName:null}}))}getTitle(e){return this._isCommentEventType(e.collabEventType)?e.collabEntryTitle:e.collabTitle}_getBodyText(e){return this._isCommentEventType(e.eventType)?e.contentExtract:e.contentExtract?this.bbLocalize.translateSync({locale:null,key:"base.stream.entryBody.withHeader",noEscape:!0,params:{header:e.title,body:e.contentExtract}}):e.title}_isCommentEventType(e){return S.CommentPosted===e||S.CommentDeleted===e}group(e){const t=o.f;if(!t.validateEntriesForGrouping(e,v.SUPPORTED_PROVIDERS))throw new o.e({message:"Could not group stream entries"});let s=[];const n={};return e.forEach((e=>{const t=this._isCommentEventType(e.collabEventType);let r=t?e.collabEntryId:e.collabId;if(!r&&t&&f.Wiki===e.collabType&&(r=e.collabEntryTitle),r){const t=[e.collabType,e.collabEventType,r].join(v.ENTRY_GROUPING_KEY_DELIMITER);(n[t]=n[t]||[]).push(e)}else s.push(e)})),Object.keys(n).forEach((e=>{const r=n[e];if(r.length>1){const n=t.getMostRecentEntry(r),a=this.distinctAuthorIds(r),i=n.courseId,o=t.getGroupedEntryIds(r),l={id:this.generateGroupedEntryId(i,e),groupedEntryIds:o,collabType:n.collabType,collabEventType:n.collabEventType,collabId:n.collabId,collabEntryId:n.collabEntryId,collabTitle:n.collabTitle,collabEntryTitle:n.collabEntryTitle,collabAuthorUser:n.collabAuthorUser,authorIds:a,entrySpecificData:n.entrySpecificData,type:n.type,providerId:n.providerId,eventType:n.eventType,notificationCreationDate:n.notificationCreationDate,icon:n.icon,isNew:t.hasNewEntry(r),isImportant:!1,isGroupable:!0,hasParticipated:r.some((e=>e.hasParticipated)),courseId:i,isOrg:n.isOrg,header:n.header,headerSubtitle:n.headerSubtitle,title:null,body:n.body};this._setGroupedEntryTitle(l,n,a.length),s.push(l)}else s=s.concat(r)})),s}_setGroupedEntryTitle(e,t,s){const r=this.getTitle(t),a=["base.stream.groupedEntries",t.collabType,I(t.collabEventType)];if(t.collabAuthorUser)this.getUserDisplayName(t.collabAuthorUser).then((t=>{const i=s-1,o=i>0?"plural":"";a.push("withName",o),e.title=this.bbLocalize.translateSync({locale:null,key:n.compact(a).join("."),params:{entryTitle:r,userName:t,numUsers:i}})}));else{const t=s,i=t>0?"plural":"";a.push("noName",i),e.title=this.bbLocalize.translateSync({locale:null,key:n.compact(a).join("."),params:{entryTitle:r,userName:null,numUsers:t}})}}generateGroupedEntryId(e,t){return["collabGroupEntry",e,t].join(v.ENTRY_GROUPING_KEY_DELIMITER)}distinctAuthorIds(e){return o.f.getDistinctAuthorIds(e,(function(e){const t=e;return t.collabAuthorUser&&t.collabAuthorUser.id||"unknown"}))}}v.SUPPORTED_PROVIDERS=["bb_blog","bb_Wiki"],v.ENTRY_GROUPING_KEY_DELIMITER="##",v.$inject=[u.serviceName];r.module(o.g).service(g,v);var D=s("vhkR"),_=s("Is+C"),C=s("4nF1"),A=s("TnpK"),R=s("tdYh"),P=s("Q/M7"),w=s("f4B+"),O=s("3Bw1"),U=s("SeO5");const L="courseContentStreamEntryTransformer";class N extends o.c{constructor(e,t,s,n,r,a,i,o){super({CO:[N.TYPE]},o),this.bbLocalize=e,this.CourseModel=t,this.ltiService=s,this.scormService=n,this.ultraState=r,this.$modal=a,this.$rootScope=i,this._GROUPED_ENTRY_TITLE="base.stream.groupedEntries.courseContent.title",this.SUPPORTED_GROUP_PEEK_TYPES=[d.p.ContentHandler.ExternalLink,d.p.ContentHandler.File,d.p.ContentHandler.LtiPlacement,d.p.ContentHandler.LtiLink,d.p.ContentHandler.PartnerCloud]}convert(e){const t=super.convert(e);return t.isGroupable=!0,t.icon="",t.streamCourse=e.ui.streamCourse,this.processDetails(t,e.itemSpecificData),this.setLegacyCourseUrlRefToBody(e,t),t}processDetails(e,t){const s=t.notificationDetails,n=t.contentDetails;e.title=this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.avail",params:{entryTitle:s.title},noWrap:!0,noEscape:!0}),e.body={type:m.a.SimpleText,content:{bodyText:e.streamCourse.isUltra()?w.a.HTML(s.contentExtract||""):s.contentExtract}};let r=null;const a=C.a.normalize(n&&n.contentHandler);switch(r=d.p.ContentHandler.parse(a),e.entrySpecificData={contentItem:{id:s.courseContentId,courseId:e.courseId,contentHandler:r,title:s.title}},r){case d.p.ContentHandler.Discussion:e.body.stateRef=o.f.getDiscussionPanelStateRef(s.courseContentId,e.courseId);break;case d.p.ContentHandler.ExternalLink:{let t=n.contentSpecificExtraData;t&&(t=R.a.test(t)?t:"http://"+t,e.body.externalRef={target:"_blank",href:t});break}case d.p.ContentHandler.LtiPlacement:case d.p.ContentHandler.LtiLink:{const[t,a]=n.contentSpecificExtraData.split(":::");e.entrySpecificData.contentItem.contentDetail={},e.entrySpecificData.contentItem.contentDetail[r.toString()]={itemOrigin:t,cloudDocumentType:a},e.body.clickHandler=()=>{this.ltiService.ltiLaunch({courseId:e.courseId,contentId:s.courseContentId,showPreLaunchPanel:!0})};break}case d.p.ContentHandler.PartnerCloud:e.body.clickHandler=()=>{this.ltiService.ltiLaunch({courseId:e.courseId,contentId:s.courseContentId,showPreLaunchPanel:!0})};break;case d.p.ContentHandler.RusticiScorm:e.body.clickHandler=()=>{this.scormService.scormLaunch({courseId:e.courseId,contentId:s.courseContentId,showPreLaunchPanel:!0})};break;case d.p.ContentHandler.File:{const t=n.contentSpecificExtraData;t&&(e.entrySpecificData.contentItem.contentDetail={},e.entrySpecificData.contentItem.contentDetail[d.p.ContentHandler.File.toString()]={file:{mimeType:t},fileAssociationMode:b.G.Link});const s=n.contentSpecificFileData;s&&(e.body.externalRef={target:"_blank",href:P.c(s)});break}case d.p.ContentHandler.Folder:{e.entrySpecificData.contentItem.contentDetail={};const n=t.contentDetails&&t.contentDetails.isBbPage;e.entrySpecificData.contentItem.contentDetail[d.p.ContentHandler.Folder.toString()]={isBbPage:n,isFolder:t.contentDetails&&t.contentDetails.isFolder},n&&this.setStreamEntryClickToGoToDestination(e,s,(()=>{this.ultraState.goPeekState(C.b.EDIT_STATE_SREF,{id:s.courseContentId,courseId:e.courseId})}));break}case d.p.ContentHandler.Journal:e.body.stateRef=o.f.getJournalPanelStateRef(s.courseContentId,e.courseId)}e.body.externalRef||e.body.stateRef||e.body.clickHandler||this.setCourseUrlRefToBody(e)}setStreamEntryClickToGoToDestination(e,t,s){e.body.clickHandler=()=>{this.CourseModel.$new(t.courseId).contents.$find(t.courseContentId).$allow(["404","403"]).$then((t=>{if(t.$response){const n=t.$response.status;404===n?this.$modal.open({template:O,scope:null}).result.then((()=>{this.$rootScope.$emit("stream-entry-parent-item-not-found",e)})):403===n?this.$modal.open({template:U,scope:null}).result.then((()=>{this.$rootScope.$emit("stream-entry-parent-item-not-found",e)})):s()}}))}}group(e){const t=o.f,s=N.TYPE;if(t.validateEntriesForGrouping(e,[s])){const n=t.getMostRecentEntry(e),r=n.courseId,a=this.generateGroupedEntryId(r),i={id:a,groupedEntryIds:t.getGroupedEntryIds(e),type:s,providerId:n.providerId,notificationCreationDate:n.notificationCreationDate,icon:"document-multiple",isNew:t.hasNewEntry(e),isImportant:!1,isGroupable:!0,courseId:r,isOrg:n.isOrg,streamCourse:n.streamCourse,header:n.header,title:this.bbLocalize.translateSync({locale:null,key:this._GROUPED_ENTRY_TITLE}),entryContents:this.getGroupedEntryContents(e)};return i.streamCourse.isUltra()&&this.areAllSupportedGroupPeekEntries(i.entryContents)?i.body={stateRef:'content-group({streamEntryId:"'+a+'"})'}:this.setCourseUrlRefToBody(i),[i]}throw new o.e({message:"Could not group stream entries"})}getGroupedEntryContents(e){let t=[];return e&&Array.isArray(e)&&e.forEach((e=>{const s=e.entryContents;s?t=t.concat(s):t.push(e)})),t}generateGroupedEntryId(e){return["courseContentGroupEntry",N.TYPE,e].join("-")}setCourseUrlRefToBody(e){e.body=e.body||{},null!==e.streamCourse&&(e.body.stateRef=o.f.getCoursePanelStateRef(e.streamCourse.id))}areAllSupportedGroupPeekEntries(e){return e.every((e=>C.a.matchesHandlers(e.entrySpecificData.contentItem.contentHandler.toString(),this.SUPPORTED_GROUP_PEEK_TYPES)))}}N.TYPE="CO:CO_AVAIL",N.$inject=[u.serviceName,d.m.serviceName,D.b,_.c,A.d,"$modal","$rootScope","$q"];r.module(o.g).service(L,N);var G=s("KBr+");const x="deploymentStreamEntryTransformer";class B extends o.a{constructor(e,t){super(B.SUPPORTED_PROVIDERS),this.bbLocalize=e,this.CourseBatchLoader=t}convert(e){const t=super.convert(e);return t.icon="survey",this.processDetails(t,e.itemSpecificData.learnDeploymentDetails),t}processDetails(e,t){t.courseId?this.CourseBatchLoader.load(t.courseId).then((t=>{e.courseId=t.id,e.header=t.name})):e.header=this.bbLocalize.translateSync({locale:null,key:"base.stream.institution",params:{brand:t.deploymentName}}),e.title=this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.outcomes.bb_deployment",params:{entryTitle:t.instrumentName},noWrap:!0,noEscape:!0}),e.body={type:m.a.SimpleText,content:{bodyText:this.bbLocalize.translateSync({locale:null,key:"base.stream.entryBody.bb_deployment"})}},t.deploymentUrl&&(e.body.externalRef={target:"new",href:t.deploymentUrl})}}B.SUPPORTED_PROVIDERS=["bb_deployment"],B.$inject=[u.serviceName,G.b];r.module(o.g).service(x,B);const k="discussionBoardStreamEntryTransformer";class V extends i.a{constructor(e,t,s,n,r){super(e),this.learnEntryType=e,this.resourceKey=t,this.entryTitlePropertyName=s,this.entryTitleContainsUsersName=n,this.groupingIdPropertyName=r}isGroupable(){return null!=this.groupingIdPropertyName}getGroupingId(e){return e[this.groupingIdPropertyName]}getEntryTitle(e){return e[this.entryTitlePropertyName]}isThreadEventType(){return V.ThreadPosted.isEqualTo(this)||V.ThreadSubscribed.isEqualTo(this)||V.ThreadUnsubscribed.isEqualTo(this)}}V.ForumCreated=new V("FC","forumCreated","forumName",!1,null),V.ForumSubscribed=new V("FS","forumSubscribed","forumName",!0,"forumId"),V.ForumUnsubscribed=new V("FU","forumUnsubscribed","forumName",!0,"forumId"),V.PostRated=new V("PR","postRated","msgTitle",!0,"msgId"),V.ReplyPosted=new V("RP","replyPosted","threadTitle",!0,"threadId"),V.ThreadPosted=new V("TP","threadPosted","threadTitle",!0,null),V.ThreadSubscribed=new V("TS","threadSubscribed","threadTitle",!0,"threadId"),V.ThreadUnsubscribed=new V("TU","threadUnsubscribed","threadTitle",!0,"threadId");class M extends o.d{constructor(e){super(e,M.SUPPORTED_PROVIDERS)}convert(e){const t=e.itemSpecificData.discussionboardDetails;if(t.isIndirect)return null;const s=super.convert(e);return s.hasParticipated=e.se_participated,this.processDetails(s,t),this.setLegacyCourseUrlRefToBody(e,s),s}processDetails(e,t){const s=V.parse(t.eventType),n=s.isThreadEventType();e.icon=M.ICON,e.isGroupable=!0,e.forumId=t.coreIdContainer,e.forumName=t.forumName,e.threadId=n?t.coreId:t.threadId,e.threadTitle=n?t.title:t.threadName,e.msgEventType=s,e.msgId=t.coreId,e.msgTitle=t.title,e.body={type:m.a.SimpleText,content:{bodyText:t.contentExtract},stateRef:o.f.getDiscussionPanelStateRef(t.courseContentId,e.courseId)},this._setTitle(e)}_setTitle(e){const t=["base.stream.entryTitle.disc",e.msgEventType.resourceKey],s=e.msgEventType.entryTitleContainsUsersName,n=e.msgEventType.getEntryTitle(e);s&&e.entrySpecificData&&e.entrySpecificData.streamUser?this.getUserDisplayName(e.entrySpecificData.streamUser).then((s=>{t.push("withName"),e.title=this.bbLocalize.translateSync({locale:null,key:t.join("."),params:{userName:s,entryTitle:n}})})):(s&&t.push("noName"),e.title=this.bbLocalize.translateSync({locale:null,key:t.join("."),params:{userName:null,entryTitle:n}}))}group(e){const t=o.f;if(!t.validateEntriesForGrouping(e,M.SUPPORTED_PROVIDERS))throw new o.e({message:"Could not group stream entries"});let s=[];const n={};return e.forEach((e=>{let t=!1;if(e.msgEventType.isGroupable()){const s=e.msgEventType.getGroupingId(e);if(s){t=!0;const r=[s,e.msgEventType].join(M.ENTRY_GROUPING_KEY_DELIMITER);(n[r]=n[r]||[]).push(e)}}t||s.push(e)})),Object.keys(n).forEach((e=>{const r=e.split(M.ENTRY_GROUPING_KEY_DELIMITER),a=r[0],i=r[1],o=n[e];if(o.length>1){const e=t.getMostRecentEntry(o),n=e.courseId,r=t.getGroupedEntryIds(o),l=this.distinctAuthorIds(o),c={id:this.generateGroupedEntryId(n,i,a),forumId:e.forumId,forumName:e.forumName,threadId:e.threadId,threadTitle:e.threadTitle,entrySpecificData:e.entrySpecificData,msgId:e.msgId,msgTitle:e.msgTitle,msgEventType:e.msgEventType,groupedEntryIds:r,authorIds:l,type:e.type,providerId:e.providerId,notificationCreationDate:e.notificationCreationDate,icon:M.ICON,isNew:t.hasNewEntry(o),isImportant:!1,isGroupable:!0,hasParticipated:o.some((e=>e.hasParticipated)),courseId:n,isOrg:e.isOrg,header:e.header,headerSubtitle:e.headerSubtitle,title:null,body:e.body};this._setGroupedEntryTitle(c,l.length,e.msgEventType.getEntryTitle(e)),s.push(c)}else s=s.concat(o)})),s}_setGroupedEntryTitle(e,t,s){const r=["base.stream.groupedEntries.disc",e.msgEventType.resourceKey];if(e.entrySpecificData&&e.entrySpecificData.streamUser)this.getUserDisplayName(e.entrySpecificData.streamUser).then((a=>{const i=t-1,o=i>0?"plural":"";r.push("withName",o),e.title=this.bbLocalize.translateSync({locale:null,key:n.compact(r).join("."),params:{userName:a,numUsers:i,entryTitle:s}})}));else{const a=t,i=a>0?"plural":"";r.push("noName",i),e.title=this.bbLocalize.translateSync({locale:null,key:n.compact(r).join("."),params:{userName:null,numUsers:a,entryTitle:s}})}}generateGroupedEntryId(e,t,s){return["discBoardGroupEntry",e,t,s].join("-")}distinctAuthorIds(e){return o.f.getDistinctAuthorIds(e,(function(e){return e.entrySpecificData&&e.entrySpecificData.streamUser&&e.entrySpecificData.streamUser.id||"unknown"}))}}M.SUPPORTED_PROVIDERS=["bb_disc"],M.ICON="discussion",M.ENTRY_GROUPING_KEY_DELIMITER="##",M.$inject=[u.serviceName];r.module(o.g).service(k,M);var $=s("Sa5G"),j=s("P2dS"),H=s("8jzW"),F=s("KtUo"),K=s("IbyE"),z=s("+O05");const Y="duedatedContentStreamEntryTransformer";class W extends o.c{constructor(e,t,s,n,r,a,i,o,l,c){super(W.SUPPORTED_EVENT_TYPES,l),this.bbLocalize=e,this.CourseModel=s,this.ColumnModel=n,this.scoreProviderHelper=r,this.gradeColumnCategoryService=a,this.$modal=i,this.$rootScope=o,this.ltiService=c,this.serverTime=t.getServerTime(),this.remove=function(){return l.all(this.notificationIds.map((e=>s.$new(this.courseId).notifications.$new(e).$destroy().$allow([404]).$asPromise())))}}convert(e){const t=super.convert(e),s=this._getEvent(t.type),{contentDetails:n,notificationDetails:r}=e.itemSpecificData;if(t.isImportant=W.OVERDUE===s,t.isImportant){if(d.ob.NotificationRecipientType.Sender===r.recipientType)return null;t.remove=this.remove}t.isGroupable=!1,this.processDetails(t,r,n),this.setLegacyCourseUrlRefToBody(e,t);const a=C.a.normalize(null==n?void 0:n.contentHandler),i=d.p.ContentHandler.parse(a);if(i===d.p.ContentHandler.LtiLink){t.entrySpecificData={contentItem:{id:r.courseContentId,courseId:t.courseId,contentHandler:i,title:r.title}};const[e,s]=n.contentSpecificExtraData.split(":::");t.entrySpecificData.contentItem.contentDetail={},t.entrySpecificData.contentItem.contentDetail[i.toString()]={itemOrigin:e,cloudDocumentType:s},t.body.clickHandler=()=>{this.ltiService.ltiLaunch({courseId:t.courseId,contentId:r.courseContentId,showPreLaunchPanel:!0})}}return t}processDetails(e,t,s){this._setDueDateDependentProperties(e,t,s),this._setGradebookColumn(e,t)}_getEvent(e){const t=e.substr(e.indexOf(":")+1);return t.indexOf("_AVAIL")>0?"AVAIL":t}_getTitle(e,t,s,n){let r=W.DUE===e&&t&&0===F.a(t,this.serverTime)?"dueToday":e.toLowerCase();return"PE"===n&&(r=`peer.${r}`),this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle."+r,params:{entryTitle:s},noWrap:!0,noEscape:!0})}_setDueDateDependentProperties(e,t,s){const n=t.dueDate&&new Date(t.dueDate),r=this._getEvent(e.type);e.contextualDate="AVAIL"===r?null:n,e.title=this._getTitle(r,e.contextualDate,t.title,t.sourceType),e.body={type:m.a.DueDatedContent},n&&this.bbLocalize.formatDatetime(n,o.f.DUE_DATE_FORMAT).then((t=>{e.body.content={localizedDueDate:t}})),this._setClickHandler(e,t,s)}_setClickHandler(e,t,s){const n=$.g.parse(s&&s.contentHandler);if(n&&t.courseId&&t.courseContentId){this.scoreProviderHelper.openStateRef(n,{contentId:t.courseContentId,courseId:t.courseId})&&(e.body.clickHandler=()=>{this.CourseModel.$new(t.courseId).contents.$find(t.courseContentId).$allow(["404","403"]).$then((s=>{if(s.$response){const r=s.$response.status;404===r?this.$modal.open({template:O,scope:null}).result.then((()=>{this.$rootScope.$emit("stream-entry-parent-item-not-found",e)})):403===r?this.$modal.open({template:U,scope:null}).result.then((()=>{this.$rootScope.$emit("stream-entry-parent-item-not-found",e)})):this.scoreProviderHelper.openStateRef(n,{contentId:t.courseContentId,courseId:t.courseId,isCollectExternalSubmissions:z.a.isExternalSubmissionsAssessment(s)},H.a.GoToState)}}))})}}_setGradebookColumn(e,t){if(t.secondarySourceType){const s=q.SOURCETYPE_TO_PROVIDER_MAP[t.secondarySourceType],n=t.calculationType;s&&(e.entrySpecificData={gradebookColumn:this.ColumnModel.$build({scoreProviderHandle:s,calculationType:n})})}if(!r.isUndefined(t.gradebookCategoryName)&&!r.isUndefined(t.isGradebookCategoryUserDefined)){const s=this.gradeColumnCategoryService.getIconByGradebookCategory(t.gradebookCategoryName,t.isGradebookCategoryUserDefined);s&&(e.icon=s)}}}W.SUPPORTED_EVENT_TYPES={AS:["AS:DUE","AS:OVERDUE","AS:AS_AVAIL","AS:AS_GA_AVAIL","AS:AS_AVAIL_RESEND","AS:AS_GA_AVAIL_RESEND"],GB:["GB:DUE","GB:OVERDUE"],PE:["PE:DUE","PE:OVERDUE","PE:PE_AVAIL","PE:PE_AVAIL_RESEND"],PS:["PS:DUE","PS:OVERDUE","PS:PS_AVAIL","PS:PS_AVAIL_RESEND"],SU:["SU:DUE","SU:OVERDUE","SU:SU_AVAIL"],SC:["SC:DUE","SC:OVERDUE","SC:SC_AVAIL","SC:SC_AVAIL_RESEND"],TE:["TE:DUE","TE:OVERDUE","TE:TE_AVAIL","TE:TE_AVAIL_RESEND"],UA:["UA:DUE","UA:OVERDUE","UA:UA_AVAIL","UA:UA_AVAIL_RESEND"]},W.SOURCETYPE_TO_PROVIDER_MAP={BL:K.O.Blog,JN:K.O.Blog,DF:K.O.Discussion,DT:K.O.Discussion,SC:K.O.Scorm,UA:K.O.UltraAssignment,WK:K.O.Wiki},W.DUE="DUE",W.OVERDUE="OVERDUE",W.$inject=[u.serviceName,c.b,d.m.serviceName,d.C.serviceName,H.c,j.c,"$modal","$rootScope","$q",D.b];class q extends W{}r.module(o.g).service(Y,W);const J="evidenceCollectionStreamEntryTransformer";class Q extends o.a{constructor(e){super(Q.SUPPORTED_PROVIDERS),this.bbLocalize=e}convert(e){const t=super.convert(e);return t.icon=o.b.DEFAULT_ICON,t.header=this.bbLocalize.translateSync({locale:null,key:"base.stream.goalsAndAssessment"}),this.processDetails(t,e.itemSpecificData.evidenceDetails),t}processDetails(e,t){e.title=this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.outcomes.bb-evidence-collection",params:{entryTitle:t.title},noWrap:!0,noEscape:!0}),t.sessionDate&&(e.notificationCreationDate=new Date(t.sessionDate)),t.dueDate&&(e.contextualDate=new Date(t.dueDate),e.body={type:m.a.DueDatedContent},this.bbLocalize.formatDatetime(e.contextualDate,o.f.DUE_DATE_FORMAT).then((t=>{e.body.content={localizedDueDate:t}}))),t.evidenceUrl&&(e.body||(e.body={type:m.a.SimpleText}),e.body.externalRef={target:"new",href:P.c(t.evidenceUrl)})}}Q.SUPPORTED_PROVIDERS=["bb-evidence-collection"],Q.$inject=[u.serviceName];r.module(o.g).service(J,Q);const X="gradesStreamEntryTransformer";class Z extends o.a{constructor(e){super(Z.SUPPORTED_PROVIDERS),this.bbLocalize=e}convert(e){const t=e.itemSpecificData.gradeDetails;if(!this._isGraded(t))return null;const s=super.convert(e);return s.icon="grades",s.isImportant=!1,s.isGroupable=!1,this.processDetails(s,t),this.setStateRef(s,e.ui&&e.ui.streamCourse),s}processDetails(e,t){e.title=this._getTitle(t),e.body={type:m.a.Grades,content:{isInteractive:!0,grade:this._getGrade(t),attemptsRemaining:null,feedback:w.a.text(t.instructorFeedback.displayText),pointsPossible:t.pointsPossible,displayGrade:{grade:t.displayGradeGrade,score:t.displayGradeScore},schema:{scaleType:t.scaleType},column:{possible:t.pointsPossible,calculationType:t.calculationType}}},t.lastGradedDate&&(e.notificationCreationDate=new Date(t.lastGradedDate))}setStateRef(e,t){if(t)if(t.isClassic()){const s="/webapps/gradebook/do/student/viewGrades?course_id="+t.id+"&callback=course";e.body.stateRef=o.f.getCoursePanelStateRef(t.id,s)}else e.body.stateRef="course.grades("+r.toJson({courseId:t.id})+")"}_getGrade(e){return d.ob.GradeIconType.Completed===e.gradeIcon?this.bbLocalize.translateSync({locale:null,key:"base.stream.entryBody.grades.completedScore"}):e.grade}_getTitle(e){return this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.grade.posted",params:{entryTitle:e.title},noWrap:!0,noEscape:!0})}_isGraded(e){return e.grade&&"-"!==e.grade||d.ob.GradeIconType.Completed===e.gradeIcon}}Z.SUPPORTED_PROVIDERS=["bb_mygrades"],Z.$inject=[u.serviceName];r.module(o.g).service(X,Z);const ee="messageStreamEntryTransformer";class te extends o.d{constructor(e){super(e,te.SUPPORTED_PROVIDERS)}convert(e){const t=super.convert(e);return t.icon=te.ICON,t.isGroupable=!0,this.processDetails(t,e.itemSpecificData.messageDetails),t}processDetails(e,t){e.conversationId=t.conversationId,e.isImportant=this.isUltraMessage(t)&&!t.canBeRepliedTo,e.body={type:m.a.SimpleText,content:{bodyText:t.contentExtract},stateRef:this.getBodyStateRef(e,t)},this.setTitle(e)}setTitle(e){e.entrySpecificData&&e.entrySpecificData.streamUser?this.getUserDisplayName(e.entrySpecificData.streamUser).then((t=>{e.title=this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.newMessage",params:{authorName:t}})})):e.title=this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.newMessage",params:{authorName:null}})}isUltraMessage(e){return!!e.conversationId}getBodyStateRef(e,t){return this.isUltraMessage(t)?'stream-message({ courseId: "'+e.courseId+'", conversationId: "'+t.conversationId+'" })':'course.outline({ courseId: "'+e.courseId+'", legacyUrl: "'+P.f("/webapps/blackboard/messaging/course","messageDetail.jsp",{nav:"messages",course_id:e.courseId,folder:"inbox",course_message_id:t.messageId})+'" })'}group(e){const t=o.f;if(!t.validateEntriesForGrouping(e,te.SUPPORTED_PROVIDERS))throw new o.e({message:"Could not group stream entries"});let s=[];const n=[],r={};return e.forEach((e=>{if(e.conversationId){(r[e.conversationId]=r[e.conversationId]||[]).push(e)}else n.push(e)})),Object.keys(r).forEach((e=>{const n=r[e];if(n.length>1){const r=t.getMostRecentEntry(n),a=r.courseId,i=t.getGroupedEntryIds(n),o=this.distinctAuthorNames(n),l={id:this.generateGroupedEntryId(a,e),groupedEntryIds:i,type:r.type,providerId:r.providerId,notificationCreationDate:r.notificationCreationDate,icon:te.ICON,isNew:t.hasNewEntry(n),isImportant:!1,isGroupable:!0,courseId:a,isOrg:r.isOrg,header:r.header,title:null,hasParticipated:n.some((e=>e.hasParticipated)),entrySpecificData:r.entrySpecificData,conversationId:e,body:r.body};this.setGroupedEntryTitle(l,n.length,o),s.push(l)}else s=s.concat(n)})),n.length>0&&(s=s.concat(n)),s}setGroupedEntryTitle(e,t,s){e.title=this.bbLocalize.translateSync({locale:null,key:n.compact(["base.stream.groupedEntries.message.title.messageNum.plural"]).join("."),params:{numUnreadMessages:t}}),this.bbLocalize.formatItems(s,2,null,!0,null).then((t=>{e.title+=t}))}generateGroupedEntryId(e,t){return["messageBoardGroupEntry",e,t].join("-")}distinctAuthorNames(e){return o.f.getDistinctAuthorIds(e,(e=>{let t;return e.entrySpecificData&&e.entrySpecificData.streamUser&&(t=this.bbLocalize.formatUsernameSync(e.entrySpecificData.streamUser,u.ILocaleUsernameFormat.Short,null,{noWrap:!0,noEscape:!0})),t||"unknown"}))}}te.SUPPORTED_PROVIDERS=["bb_message"],te.ICON="message",te.$inject=[u.serviceName];r.module(o.g).service(ee,te);const se="needsGradingStreamEntryTransformer";class ne extends o.c{constructor(e,t,s){super(ne.SUPPORTED_EVENT_TYPES,s),this.bbLocalize=e,this.scoreProviderHelper=t}convert(e){const t=super.convert(e);t.isImportant=!1,t.isGroupable=!1,t.title=this._getTitle(t.notificationIds,e.itemSpecificData.notificationDetails.title);const s=e.itemSpecificData.notificationDetails,n=$.g.parse(e.itemSpecificData.contentDetails&&e.itemSpecificData.contentDetails.contentHandler);t.icon=this._getNeedsGradingIcon(n);const r=e.ui.streamCourse&&e.ui.streamCourse.isUltra();return this._setStateRef(t,s,n,r),r||this.setLegacyCourseUrlRefToBody(e,t),t}_getNeedsGradingIcon(e){let t=this.scoreProviderHelper.getNeedsGradingIconByContentHandler(e);return t||(t="grades"),t}_getTitle(e,t){const s=e.length>1?"base.stream.entryTitle.newSubmission.multipleNoCount":"base.stream.entryTitle.newSubmission.single";return this.bbLocalize.translateSync({locale:null,key:s,params:{entryTitle:t},noWrap:!0,noEscape:!0})}_setStateRef(e,t,s,n){const r=t.courseId,a=t.courseContentId;if(n&&r&&a&&s){if(("TE:TE_GT_SUBMIT"===e.type||"TE:TE_GT_SUBMIT_LATE"===e.type||"UA:UA_GA_SUBMIT"===e.type||"UA:UA_GA_SUBMIT_LATE"===e.type)&&d.ob.NotificationRecipientType.Sender===t.recipientType)return;const n={contentId:a,courseId:r,needsGrading:!0},i=this.scoreProviderHelper.getSubmissionListStateRefByContentHandler(s,n);i&&(e.body={stateRef:i})}}}ne.SUPPORTED_EVENT_TYPES={AS:["AS:AS_ATTEMPT","AS:AS_LATE_ATTEMPT","AS:AS_GA_ATTEMPT","AS:AS_GA_LATE_ATTEMPT"],BL:["BL:BL_ATTEMPT","BL:BL_GR_ATTEMPT"],DF:["DF:DF_ATTEMPT","DF:DF_GR_ATTEMPT"],DT:["DT:DT_ATTEMPT","DT:DT_GR_ATTEMPT"],JN:["JN:JN_ATTEMPT","JN:JN_GR_ATTEMPT"],SC:["SC:SC_SUBMIT","SC:SC_SUBMIT_LATE"],TE:["TE:TE_SUBMIT","TE:TE_SUBMIT_LATE","TE:TE_GT_SUBMIT","TE:TE_GT_SUBMIT_LATE"],UA:["UA:UA_SUBMIT","UA:UA_SUBMIT_LATE","UA:UA_GA_SUBMIT","UA:UA_GA_SUBMIT_LATE"],WK:["WK:WK_ATTEMPT","WK:WK_GR_ATTEMPT"],PS:["PS:PS_SUBMIT","PS:PS_SUBMIT_LATE"],PE:["PE:PE_SUBMIT","PE:PE_SUBMIT_LATE"]},ne.$inject=[u.serviceName,H.c,"$q"];r.module(o.g).service(se,ne);var re=s("D57K"),ae=s("aHpC");const ie="needsReconcilingtreamEntryTransformer";let oe=class e extends o.c{constructor(t,s,n){super(e.SUPPORTED_EVENT_TYPES,n),this.bbLocalize=t,this.scoreProviderHelper=s}convert(e){const t=super.convert(e);t.isImportant=!1,t.isGroupable=!1;const s=e.itemSpecificData.notificationDetails,n=$.g.parse(e.itemSpecificData.contentDetails&&e.itemSpecificData.contentDetails.contentHandler);t.icon=this._getNeedReconcilingIcon(n),t.title=this._getTitle(t.type,e.ui.streamCourse,s.title);const r=e.ui.streamCourse&&e.ui.streamCourse.isUltra();return this._setStateRef(t,s,n,r),r||this.setLegacyCourseUrlRefToBody(e,t),t}_getNeedReconcilingIcon(e){let t=this.scoreProviderHelper.getNeedsReconcilingIconByContentHandler(e);return t||(t="grades"),t}_getTitle(e,t,s){const n=e.substr(e.indexOf(":")+1);return this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.simple."+n,params:{entryTitle:s},noWrap:!0,noEscape:!0})}_setStateRef(e,t,s,n){const r=t.courseId,a=t.courseContentId;if(n&&r&&a&&s){const t=this.scoreProviderHelper.getSubmissionListStateRefByContentHandler(s,{contentId:a,courseId:r});t&&(e.body={stateRef:t})}}};oe.SUPPORTED_EVENT_TYPES={GB:["GB:GB_NEEDS_RECON"]},oe=Object(re.a)([Object(re.c)(0,Object(ae.b)(u.serviceName)),Object(re.c)(1,Object(ae.b)(H.c)),Object(re.c)(2,Object(ae.b)("$q"))],oe);r.module(o.g).service(ie,oe);const le="simpleLegacyStreamEntryTransformer";class ce extends o.c{constructor(e,t){super(ce.SUPPORTED_EVENT_TYPES,t),this.bbLocalize=e}convert(e){const t=e.itemSpecificData.notificationDetails;if(t&&"CM"===t.sourceType)return null;const s=super.convert(e);return s.isImportant=!1,s.isGroupable=!1,s.title=this._getTitle(s.type,e.ui.streamCourse,t.title),this.setLegacyCourseUrlRefToBody(e,s),s}_getTitle(e,t,s){let n=e.substr(e.indexOf(":")+1);return"CR_AVAIL"===n&&t&&t.isOrganization&&(n="ORG_AVAIL"),this.bbLocalize.translateSync({locale:null,key:"base.stream.entryTitle.simple."+n,params:{entryTitle:s},noWrap:!0,noEscape:!0})}}ce.SUPPORTED_EVENT_TYPES={CR:["CR:CR_AVAIL"],SU:["SU:SU_SUBMIT"],QU:["QU:QU_AVAIL"],CM:["CM:CM_RCVD"]},ce.$inject=[u.serviceName,d.m.serviceName,"$q"];r.module(o.g).service(le,ce);var de=s("ZNC7"),ue=s("r6lH"),pe=s("zyQz"),me=s("EtRF"),he=s("nmzr");const ye="telemetryStreamEntryTransformer";class be extends o.a{constructor(e,t,s){super(be.SUPPORTED_EVENT_TYPES),this.bbLocalize=e,this.telemetry=t,this.remove=function(){let e=this.body.content.notificationId;return null==e&&(e="_"+this.body.content.sequenceId+"_1"),s.$new(e).$destroy().$asPromise()},this.analyticsContext=function(e){return e.notificationType=this.body.content.notificationType.toString(),this.body.content.phraseVariant&&(e.phraseVariant=this.body.content.phraseVariant),e}}convert(e){const t=super.convert(e),s=pe.a.parse(e.extraAttribs.notificationType);let n=e.extraAttribs.notificationId;const r=s&&s.getInitialView(),a=s?s.getPhraseVariant(e):void 0,i=s?s.getIcon().toString():me.a.DEFAULT.toString(),l=o.f.getSequenceId(e),c=s&&s.getAction(null);t.icon=i,t.isGroupable=!1,t.title=this._getTitle(s,e),t.isImportant="true"===e.extraAttribs.important,t.telemetryNotificationType=s&&s.toString();return(e.extraAttribs.inTroubleCount||e.extraAttribs.inTroubleAbsent||e.extraAttribs.inTroubleFailing)&&(t.studentsInTrouble={studentsInTrouble:e.extraAttribs.inTroubleCount,studentsInTroubleAbsent:e.extraAttribs.inTroubleAbsent,studentsInTroubleFailing:e.extraAttribs.inTroubleFailing}),t.notificationShapeType={shape:this._getNotificationShapeType(s)},t.body={type:this._getBodyType(c),content:{bodyText:this._getBody(s,e),sequenceId:l,notificationType:s,notificationId:n,phraseVariant:a}},t.remove=this.remove,t.analyticsContext=this.analyticsContext,null==n&&(n="_"+l+"_1"),this._setBodyStateRef(c,t,n,r),t}_getBodyType(e){return e?m.a.Telemetry:m.a.SimpleText}_getTitle(e,t){return e?this.bbLocalize.translateSync(e.getTitle(t,null)):this.bbLocalize.translateSync({locale:null,key:"base.stream.telemetry.unknownType",params:{type:t.extraAttribs.notificationType}})}_getBody(e,t){if(e){const s=e.getBody(t,null);if(s.key)return this.bbLocalize.translateSync(s)}return""}_setBodyStateRef(e,t,s,n){if(n)switch(n){case he.L.DIRECT_TO_COURSE:{const s=o.f.getCoursePanelStateRef(t.courseId);this._setStateRefProps(e,t,s,!0);break}case he.L.INSTRUCTOR_DYNAMIC:this.telemetry.determinePanelSref(t.courseId,s).then((s=>{this._setStateRefProps(e,t,s)}));break;default:{const r=this.telemetry.createPanelSref(n,t.courseId,s);this._setStateRefProps(e,t,r);break}}}_setStateRefProps(e,t,s,n=!1){e?(t.body.content.actionText=this.bbLocalize.translateSync(e),t.body.content.actionSref=s,t.body.content.isComponentActionSref=n):t.body.stateRef=s}_getNotificationShapeType(e){let t;switch(e){case pe.a.SufficientActivityData:case pe.a.SufficientGradeData:case pe.a.StudentsInTrouble:}return t=de.a.DefaultNotification,t}}be.SUPPORTED_EVENT_TYPES=["bb_tel","bb_tel:ins_grade","bb_tel:stu_activity","bb_tel:stu_grade"],be.$inject=[u.serviceName,ue.b,d.Bb.serviceName];r.module(o.g).service(ye,be),s.d(t,"b",(function(){return Ee})),s.d(t,"c",(function(){return Te})),s.d(t,"a",(function(){return ge}));const Ee="ultra.service.stream.transformer",Te="streamEntryTransformer";class ge extends i.a{constructor(e,t){super(e),this.supportedTypes=t}getSupportedTypes(){return this.supportedTypes}}ge.AssignmentsAndTests=new ge("AssignmentsAndTests",n.union(q.SUPPORTED_EVENT_TYPES.AS,q.SUPPORTED_EVENT_TYPES.TE,q.SUPPORTED_EVENT_TYPES.UA)),ge.GradesAndFeedback=new ge("GradesAndFeedback",n.union(F.b(class extends ne{}.SUPPORTED_EVENT_TYPES),class extends Z{}.SUPPORTED_PROVIDERS,class extends ce{}.SUPPORTED_EVENT_TYPES.GB)),ge.Discussions=new ge("Discussions",class extends M{}.SUPPORTED_PROVIDERS),ge.Messages=new ge("Messages",class extends te{}.SUPPORTED_PROVIDERS);class fe{constructor(e,...t){this._baseDataTransformer=e,this.typeToTransformer=Object.create(null),this._dataTransformers=t||[]}get dataTransformers(){return this._dataTransformers}set dataTransformers(e){this._dataTransformers=e}get baseDataTransformer(){return this._baseDataTransformer}set baseDataTransformer(e){this._baseDataTransformer=e}getDataTransformerByType(e){return this.typeToTransformer[e]=this.typeToTransformer[e]||this._lookupDataTransformerByType(e)}_lookupDataTransformerByType(e){const t=this.dataTransformers.filter((t=>t.canHandleType(e)));return t&&t[0]||this.baseDataTransformer}}fe.REGISTERED_DATA_TRANSFORMERS=[h,E,g,L,x,k,Y,J,X,ee,se,le,ye,ie],fe.$inject=[o.h].concat(fe.REGISTERED_DATA_TRANSFORMERS);r.module(Ee,[o.g]).service(Te,fe)},sbY4:function(e,t){e.exports='<p class="summary js-feedback" ng-if="::interactiveBodyContent.content.feedback" ng-bind-html="::interactiveBodyContent.content.feedback"></p>\n<span ng-if="::interactiveBodyContent.content">\n  <span class="stream-grade-controls">\n\n    <button id="streamEntryBodyViewGradeButton{{::interactiveBodyContent.id}}"\n            class="button button--secondary round small"\n            ng-click="interactiveBodyContent.showTheContent()"\n            bb-click-focus="#grade-value{{::interactiveBodyContent.id}} .wrapping-input-style"\n            ng-hide="interactiveBodyContent.showContent"\n            bb-translate bb-translate-attrs="{ \'aria-label\': \'base.stream.entryBody.grades.viewGrade\' }"\n            analytics-id="base.stream.entryBody.grades.viewGrade">\n      base.stream.entryBody.grades.viewGrade\n    </button>\n    \x3c!--removing aria-hidden as it is redundant ng-show is enough as it hides the content\n    cleaning this up to prevent potential bugs--\x3e\n    <div class="js-grade stream-grade"\n         ng-show="interactiveBodyContent.showContent">\n      <bb-display-grade id="grade-value{{::interactiveBodyContent.id}}" class="grade-value"\n                        column="interactiveBodyContent.content.column" grade-detail="interactiveBodyContent.content"\n                        schema="interactiveBodyContent.content.schema" display-type="GradeColor" aria-live="assertive"></bb-display-grade>\n      <button class="anchor" id="streamEntryBodyHideGradeLink{{::interactiveBodyContent.id}}"\n         ng-click="interactiveBodyContent.hideTheContent()"\n         bb-click-focus="#streamEntryBodyViewGradeButton{{::interactiveBodyContent.id}}"\n         bb-translate\n         analytics-id="base.stream.entryBody.grades.hideGrade">\n        base.stream.entryBody.grades.hideGrade\n      </button>\n    </div>\n\n  </span>\n  <div class="row js-attemptsRemaining"\n       ng-if="::interactiveBodyContent.content.attemptsRemaining"\n       bb-translate translate-values="{ numberOfAttemptsLeft: {{::interactiveBodyContent.content.attemptsRemaining}} }">\n    base.stream.entryBody.grades.attemptsLeft.plural\n  </div>\n</span>\n'},tdYh:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));const n=/^\w+\:{1}/},u2fd:function(e,t){e.exports='<p class="summary" ng-if="bodyContent().bodyText" ng-bind-html="bodyContent().bodyText"></p>'},xpqL:function(e,t,s){"use strict";s.d(t,"a",(function(){return y})),s.d(t,"b",(function(){return b}));var n=s("D57K"),r=s("Llzl"),a=s("nsO7"),i=s("7C3+"),o=s("0JpG"),l=s("pjml"),c=s("iG2q"),d=s("yC9S"),u=s("adx1"),p=s("MOka"),m=s("z6Q5"),h=s("aHpC");const y="ultra.service.stream.manager",b="streamEntryManager",E="STREAM_CONTENT_PULLED",T=["GB:GB_ATT_UPDATED","GB:GB_GRA_UPDATED","GB:GB_GRA_CLEARED"];let g=class e extends u.a{constructor(e,t,s,n,r,a,i,o,l,c){super(),this.$log=e,this.$q=t,this.$rootScope=s,this.$timeout=n,this.BatchApiService=r,this.bbLocalize=a,this.streamSettingsService=i,this.CourseModel=o,this.StreamContentModel=l,this.transformer=c,this.providers={},this.entries=[],this.deletedIds=[],this.userCache={},this.courseCache={},this.userCourseAvailabilities={},this.hasMoreData=!0,d.b.OnRootScope(this.$rootScope,"membership.update",((e,t,s,n,r,a,i,o)=>{this.userCourseAvailabilities[o]&&(this.userCourseAvailabilities[o][i.id]=t.isAvailable)}))}loadBundle(){return this.bbLocalize.loadBundle("features/base/stream/base-stream")}loadAllStreamEntries(e,t){return this.$q.all([this.getEntries(t),this.loadBundle()]).then((t=>(this.hasMoreData&&this.getMoreEntries().then((t=>{e&&e(this.processStreamData(t))})),this.processStreamData(t[0]))),(()=>({entries:[],deletedIds:[]})))}removeStreamEntryFromServer(e){if(e&&e.isImportant&&e.remove)return e.remove();const t=this.$q.defer();return t.reject("Can only remove important notifications with remove method"),t.promise}processStreamEntries(e){return(e||[]).map((e=>e&&this.processStreamEntry(e))).filter((e=>e&&T.indexOf(e.type)<0))}processStreamEntry(e){const t=i.f.getEntryType(e);return this.transformer.getDataTransformerByType(t).convert(e)}processGroupStreamEntry(e,t){const s=this.transformer.getDataTransformerByType(t);if(s.group)try{return s.group(e)}catch(e){this.$log.log(e)}else this.$log.log("Method for grouping stream entries does not exist for data transformer used for processing entries with type of "+t);return e}processStreamData(t,s=[]){const n={entries:this.processStreamEntries(t.entries),deletedIds:t.deletedIds},r=new Set;return n.entries.filter((({courseId:e,entrySpecificData:t})=>e&&a.at(t||{},"streamUser.avatar.permanentUrl")[0])).filter((({courseId:t})=>(new Date).getTime()-(this.userCourseAvailabilities[t]||{_lastUpdatedAt:0})._lastUpdatedAt>e.MIN_INTERNAL_COURSE_MEMBERSHIP_FETCH_IN_MS)).forEach((({courseId:e})=>{r.add(e)})),s.push(this.BatchApiService.performBatch((()=>{r.forEach((e=>{this.CourseModel.$new(e).memberships.$fetch({limit:1e4}).$asPromise().then((t=>{const s=this.userCourseAvailabilities[e]||(this.userCourseAvailabilities[e]={});s._lastUpdatedAt=(new Date).getTime(),t.forEach((e=>{s[e.userId]=e.isAvailable}))}))}))}))),n}_reset(){this.startTime=Date.now(),this.lastCall=null,this.entries=[],this.deletedIds=[]}getEntries(e){return this._reset(),this._getRawEntries(!1,e)}getMoreEntries(){const e=this.$q.when({entries:[],deletedIds:[]});return this.hasMoreData?this.getEntries(!1):e}_shouldKeepLoading(){return Date.now()-this.startTime<this.gracePeriod&&this.hasMoreData}_collectEntries(e){return this.entries=this.entries.concat(e.sv_streamEntries),this.deletedIds=this.deletedIds.concat(e.sv_deletedIds),this.$emitEvent(E,{entries:this.processStreamEntries(e.sv_streamEntries),deletedIds:e.sv_deletedIds}),this._shouldKeepLoading()?this._getRawEntries(!0,!1):this.$q.when({entries:this.entries,deletedIds:this.deletedIds})}_getRawEntries(t,s){const n=this.lastCall?Math.max(0,e.GET_ENTRIES_CALL_INTERVAL-(Date.now()-this.lastCall)):0;return this.$timeout((()=>{this.lastCall=Date.now();const n=this._generatePayload(t,s);return this.StreamContentModel.$new(e.ULTRA_STREAM_ID).$fetch(n).$asPromise().then((e=>(this._processProviders(e.sv_providers),this._cacheCourses(e.sv_extras.sx_courses),this._cacheUsers(e.sv_extras.sx_users),this.gracePeriod=1e3*e.sv_autoDisplayGracePeriodSeconds,this.hasMoreData=e.sv_moreData,this._populateExtras(e.sv_streamEntries),this._collectEntries(e)))).catch((t=>(this.hasMoreData=!1,this.$rootScope.$emit(e.STREAMS_LOADING_ERROR_EVENT),this.$q.reject(t))))}),n)}_processProviders(e){e&&e.forEach((e=>{this.providers[e.sp_provider]={sp_provider:e.sp_provider,sp_newest:e.sp_newest,sp_oldest:e.sp_oldest,sp_refreshDate:e.sp_refreshDate}}))}_cacheCourses(e){(e||[]).forEach((e=>{this.courseCache[e.id]=this.CourseModel.$build(e)}))}_cacheUsers(e){e.filter((e=>null!=e.sx_user)).forEach((e=>{this.userCache[e.sx_id]=e.sx_user}))}_populateExtras(t){const s=Object.keys(this.userCache).length>0,n=Object.keys(this.courseCache).length>0;t.forEach((t=>{if(t.ui={},s&&(t.ui.streamUser=t.se_userId&&this.userCache[t.se_userId]||null),n){const e=i.f.getCourseId(t);t.ui.streamCourse=e&&this.courseCache[e]||null}t.itemSpecificData=a.omitBy(t.itemSpecificData,a.isNull);const r=e.DETAIL_NAMES[t.providerId];if(r){const e=t.itemSpecificData[r];a.defaults(e,a.omit(t.itemSpecificData,r))}}))}_generatePayload(e,t){const s=!!r.isDefined(t)&&t;return{providers:this.providers,forOverview:!1,retrieveOnly:e,flushCache:s}}$onStreamPulled(e){return super.$onEvent(E,e)}};g.STREAMS_LOADING_ERROR_EVENT="streams-fetching-error",g.MIN_INTERNAL_COURSE_MEMBERSHIP_FETCH_IN_MS=3e4,g.GET_ENTRIES_CALL_INTERVAL=1e3,g.ULTRA_STREAM_ID="ultra",g.DETAIL_NAMES={"bb-announcement":"notificationDetails",bb_blog:"blogDetails",bb_calendar:"calendarDetails",bb_disc:"discussionboardDetails","bb-evidence-collection":"evidenceDetails",bb_mygrades:"gradeDetails",bb_deployment:"learnDeploymentDetails",bb_message:"messageDetails","bb-nautilus":"notificationDetails",bb_Wiki:"wikiDetails"},g=Object(n.a)([Object(n.c)(0,Object(h.b)("$log")),Object(n.c)(1,Object(h.b)("$q")),Object(n.c)(2,Object(h.b)("$rootScope")),Object(n.c)(3,Object(h.b)("$timeout")),Object(n.c)(4,Object(h.b)(m.b)),Object(n.c)(5,Object(h.b)(o.serviceName)),Object(n.c)(6,Object(h.b)(p.b)),Object(n.c)(7,Object(h.b)(l.m.serviceName)),Object(n.c)(8,Object(h.b)(l.ob.serviceName)),Object(n.c)(9,Object(h.b)(c.c))],g);r.module(y,[l.N,m.a,c.b,p.a]).service(b,g)},zyQz:function(e,t,s){"use strict";var n=s("nbDY"),r=s.n(n),a=s("EtRF"),i=s("1ovh"),o=s("nmzr");class l extends r.a{constructor(e,t){super(e),this.options=t}getRelatedTimeSeries(){return this.options.relatedTimeSeries}getTitle(e,t){if(this===l.StudentsInTrouble){const s=parseInt(e.extraAttribs.inTroubleCount,10)||0,n=parseInt(e.extraAttribs.inTroubleFailing,10)||0,r=parseInt(e.extraAttribs.inTroubleAbsent,10)||0;let a="withBoth.plural";return a=n>0?r>0?"withBoth.plural":"withFailing.plural":r>0?"withAbsent.plural":"noExtras.plural",{locale:t,key:this.options.bundleTitleKey+"."+a,params:{count:s,failing:n,absent:r}}}const s=this.getPhraseVariant(e);return s?{locale:t,key:this.options.bundleTitleKey+".variation"+s}:{locale:t,key:this.options.bundleTitleKey}}getBody(e,t){if(this.options.bundleBodyKey){const s=this.getPhraseVariant(e);return s?{locale:t,key:this.options.bundleBodyKey+".variation"+s}:{locale:t,key:this.options.bundleBodyKey}}return{locale:t,key:""}}getPhraseVariant(e){if(this.options.phraseVariants){return 1+((e.extraAttribs.phraseVariant||1)-1)%this.options.phraseVariants}}getInitialView(){return this.options.initialView}getInsight(e){return this.options.insightKey?{locale:e,key:this.options.insightKey}:null}getAction(e){return this.options.actionKey?{locale:e,key:this.options.actionKey}:null}getIcon(){return this.options.icon}}l.SufficientActivityData=new l("SufficientActivityData",{initialView:o.L.INSTRUCTOR_DYNAMIC,relatedTimeSeries:i.a.Activity,bundleTitleKey:"base.stream.telemetry.sufficientActivityData.title",bundleBodyKey:"base.stream.telemetry.sufficientActivityData.body",icon:a.a.DEFAULT}),l.SufficientGradeData=new l("SufficientGradeData",{initialView:o.L.INSTRUCTOR_DYNAMIC,relatedTimeSeries:i.a.Grades,bundleTitleKey:"base.stream.telemetry.sufficientGradeData.title",bundleBodyKey:"base.stream.telemetry.sufficientGradeData.body",icon:a.a.DEFAULT}),l.StudentsInTrouble=new l("StudentsInTrouble",{initialView:o.L.INSTRUCTOR_DYNAMIC,relatedTimeSeries:i.a.Grades,bundleTitleKey:"base.stream.telemetry.studentsInTrouble",icon:a.a.ALERT}),l.GradeBelowThreshold=new l("GradeBelowThreshold",{initialView:o.L.STUDENT_LOW_GRADES,relatedTimeSeries:i.a.Grades,bundleTitleKey:"base.stream.telemetry.gradeWarning.title",bundleBodyKey:"base.stream.telemetry.gradeWarning.body",phraseVariants:2,insightKey:"components.directives.telemetry.insight.gradeBelowThreshold",actionKey:"base.stream.telemetry.action.level",icon:a.a.ALERT}),l.GradeInLowest=new l("GradeInLowest",{initialView:o.L.STUDENT_LOW_GRADES,relatedTimeSeries:i.a.Grades,bundleTitleKey:"base.stream.telemetry.gradeWarning.title",bundleBodyKey:"base.stream.telemetry.gradeWarning.body",phraseVariants:2,insightKey:"components.directives.telemetry.insight.lowPerformer",actionKey:"base.stream.telemetry.action.level",icon:a.a.ALERT}),l.GradeDropped=new l("GradeDropped",{initialView:o.L.STUDENT_FIND_A_STUDY_PARTNER,relatedTimeSeries:i.a.Grades,bundleTitleKey:"base.stream.telemetry.gradeDropped.title",bundleBodyKey:"base.stream.telemetry.gradeDropped.body",insightKey:"components.directives.telemetry.insight.trendingDown",actionKey:"base.stream.telemetry.action.studyPartner",icon:a.a.ALERT}),l.NoRecentActivity=new l("NoRecentActivity",{initialView:o.L.DIRECT_TO_COURSE,relatedTimeSeries:i.a.Activity,bundleTitleKey:"base.stream.telemetry.activityLowestWarning.title",bundleBodyKey:"base.stream.telemetry.activityLowestWarning.body",insightKey:"components.directives.telemetry.insight.noRecentActivity",actionKey:"base.stream.telemetry.action.courseOutline",icon:a.a.ALERT}),l.ActivityInLowest=new l("ActivityInLowest",{initialView:o.L.STUDENT_LOW_ACTIVITY,relatedTimeSeries:i.a.Activity,bundleTitleKey:"base.stream.telemetry.activityLowestWarning.title",bundleBodyKey:"base.stream.telemetry.activityLowestWarning.body",insightKey:"components.directives.telemetry.insight.lowPerformer",actionKey:"base.stream.telemetry.action.level",icon:a.a.ALERT}),l.ActivityDropped=new l("ActivityDropped",{initialView:o.L.STUDENT_LOW_ACTIVITY,relatedTimeSeries:i.a.Activity,bundleTitleKey:"base.stream.telemetry.activityDroppedWarning.title",bundleBodyKey:"base.stream.telemetry.activityDroppedWarning.body",insightKey:"components.directives.telemetry.insight.trendingDown",actionKey:"base.stream.telemetry.action.level",icon:a.a.ALERT}),l.ActivityIncreased=new l("ActivityIncreased",{initialView:o.L.STUDENT_PROGRESS,relatedTimeSeries:i.a.Activity,bundleTitleKey:"base.stream.telemetry.performanceIncreased.title",bundleBodyKey:"base.stream.telemetry.performanceIncreased.body",actionKey:"base.stream.telemetry.action.performance",icon:a.a.KUDOS}),l.ActivityInHighest=new l("ActivityInHighest",{initialView:o.L.STUDENT_HIGH_PERFORMANCE,relatedTimeSeries:i.a.Activity,bundleTitleKey:"base.stream.telemetry.activityInHighest.title",bundleBodyKey:"base.stream.telemetry.activityInHighest.body",actionKey:"base.stream.telemetry.action.performance",icon:a.a.KUDOS}),l.GradeIncreased=new l("GradeIncreased",{initialView:o.L.STUDENT_PROGRESS,relatedTimeSeries:i.a.Grades,bundleTitleKey:"base.stream.telemetry.performanceIncreased.title",bundleBodyKey:"base.stream.telemetry.performanceIncreased.body",actionKey:"base.stream.telemetry.action.performance",icon:a.a.KUDOS}),l.GradeInHighest=new l("GradeInHighest",{initialView:o.L.STUDENT_HIGH_PERFORMANCE,relatedTimeSeries:i.a.Grades,bundleTitleKey:"base.stream.telemetry.gradeInHighest.title",bundleBodyKey:"base.stream.telemetry.gradeInHighest.body",actionKey:"base.stream.telemetry.action.performance",icon:a.a.KUDOS}),t.a=l}}]);