(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{Ego9:function(e,s,t){"use strict";t.d(s,"a",(function(){return a})),t.d(s,"b",(function(){return n}));var i=t("Llzl"),r=t("pjml"),o=t("Fvsw");const a="ultraUi.components.services.courseFavorite",n="courseFavorite";class c{constructor(e,s){this.$q=e,this.contextService=s,this.userPreferenceFavoriteCoursesKey="favorite.courses",this.favoriteCourses={}}get favoriteCourseIds(){return Object.keys(this.favoriteCourses)}fetchFavoriteCourseIds(){return this.contextService.getPreference(this.userPreferenceFavoriteCoursesKey).then((e=>e&&e.value?(this.favoriteCourses=JSON.parse(e.value),Object.keys(this.favoriteCourses)):[]),(e=>[])).catch((e=>[]))}pin(e){this.isPinned(e)||(this.favoriteCourses[e.id]=!0,this.contextService.setPreference(this.userPreferenceFavoriteCoursesKey,JSON.stringify(this.favoriteCourses)))}unpin(e){this.isPinned(e)&&(delete this.favoriteCourses[e.id],this.contextService.setPreference(this.userPreferenceFavoriteCoursesKey,JSON.stringify(this.favoriteCourses)))}clear(e){e&&e.length>0&&(e.forEach((e=>{delete this.favoriteCourses[e]})),this.contextService.setPreference(this.userPreferenceFavoriteCoursesKey,JSON.stringify(this.favoriteCourses)))}isPinned(e){return this.favoriteCourses[e.id]}_fakeFavorites(e){e&&e.length&&e.forEach((e=>{e&&(this.favoriteCourses[e]=!0)}))}}c.$inject=["$q",o.b];i.module(a,[r.N,o.a]).service(n,c)},QIw5:function(e,s,t){"use strict";t.d(s,"b",(function(){return n})),t.d(s,"c",(function(){return c})),t.d(s,"a",(function(){return u}));var i=t("Llzl"),r=t("pjml"),o=t("TnpK"),a=t("Si89");const n="ultra.components.services.routing",c="routing";var u;!function(e){e.Already="Already",e.Failure="Failure",e.Unavailable="Unavailable"}(u||(u={}));class l{constructor(e,s,t){this.CourseModel=e,this.ultraState=s,this.landingPage=t}goToPostRegistrationPage(e){"succeeded"!==e.enrollStatusCode&&"alreadyEnrolledInCourse"!==e.enrollStatusCode||!e.courseId?e.courseId&&"invalidInput"===e.enrollStatusCode?this.ultraState.go("base.courses",{enrollmentMessage:u.Failure}):this.landingPage.navigateToLandingPage():this.CourseModel.$find(e.courseId,{fields:"isAvailable"}).$then((s=>{s.isAvailable?"succeeded"===e.enrollStatusCode?this.ultraState.goPeekState("course.outline",{courseId:e.courseId}):"alreadyEnrolledInCourse"===e.enrollStatusCode&&this.ultraState.goPeekState("course.outline",{courseId:e.courseId,enrollmentMessage:u.Already}):this.ultraState.go("base.courses",{enrollmentMessage:u.Unavailable})}))}}l.$inject=[r.m.serviceName,o.d,a.b];i.module(n,[o.b,a.a]).service(c,l)},S1rJ:function(e,s){e.exports='<bb-modal class="js-course-status-modal-{{currentCourseStatus.toString()}} notification" modal-title-key="{{currentCourseStatus.getModalTitle()}}"\n          modal-dismiss-key="{{currentCourseStatus.getModalDismissText()}}"\n          analytics-id-tag-prefix="{{currentAnalyticsId}}">\n  <div name="modal-contents">\n    <p bb-translate="{{currentCourseStatus.getModalText()}}"></p>\n  </div>\n  <span name="modal-footer-button-primary">\n    <button ng-if="currentCourseStatus.getPrimaryButtonText()"\n            ng-click="$parent.$close(currentCourseStatus.getPrimaryButtonStatus())"\n            class="button js-primary-button js-course-status-{{currentCourseStatus.getPrimaryButtonStatus()}}"\n            analytics-id="{{currentAnalyticsId}}.primaryButton.button">\n      <span bb-translate="{{currentCourseStatus.getPrimaryButtonText()}}"></span>\n    </button>\n  </span>\n  <span name="modal-footer-button-secondary">\n    <button ng-if="currentCourseStatus.getSecondaryButtonText()"\n            ng-click="$parent.$close(currentCourseStatus.getSecondaryButtonStatus())"\n            class="button button--secondary js-secondary-button js-course-status-{{currentCourseStatus.getSecondaryButtonStatus()}}"\n            analytics-id="{{currentAnalyticsId}}.close.button">\n      <span bb-translate="{{currentCourseStatus.getSecondaryButtonText()}}"></span>\n    </button>\n  </span>\n</bb-modal>\n'},"k+3c":function(e,s,t){"use strict";t.d(s,"a",(function(){return a}));var i=t("ZQey");class r{constructor(e,s,t,i,r,o,a,n,c){this.modalTitle=e,this.modalText=s,this.secondaryButtonText=t,this.primaryButtonText=i,this.modalDismissText=r,this.secondaryButtonStatus=o,this.primaryButtonStatus=a,this.courseStatusName=n,this.courseDescription=c}}class o{}o.Open=new r(".openCourse.modalTitle",".openCourse.modalText",".openCourse.makePrivate",".openCourse.makeComplete","global.cancelTakeMeBack","PRIVATE","COMPLETE",".openCourse.courseStatus",".openCourse.courseDescription"),o.Complete=new r(".completeCourse.modalTitle",".completeCourse.modalText",".completeCourse.makeOpen",".completeCourse.makePrivate","global.cancelTakeMeBack","OPEN","PRIVATE",".completeCourse.courseStatus",".completeCourse.courseDescription"),o.Private=new r(".privateCourse.modalTitle",".privateCourse.modalText","global.cancel",".privateCourse.makeOpen","","","OPEN",".privateCourse.courseStatus",".privateCourse.courseDescription"),o.PrivateDuration=new r(".privateCourse.modalTitle",".privateDurationCourse.modalText","","global.close","","","",".privateCourse.courseStatus",".privateCourse.courseDescription"),o.PrivateDurationClassic=new r(".privateCourse.modalTitle",".privateDurationClassicCourse.modalText","","global.close","","","",".privateCourse.courseStatus",".privateCourse.courseDescription"),o.OpenTermClassic=new r(".openTermClassicCourse.modalTitle",".openTermClassicCourse.modalText","global.cancel","","","","OPEN",".openTermClassicCourse.courseStatus",".openTermClassicCourse.courseDescription"),o.PrivateTermClassic=new r(".privateTermClassicCourse.modalTitle",".privateTermClassicCourse.modalText","global.cancel","","","","PRIVATE",".privateTermClassicCourse.courseStatus",".privateTermClassicCourse.courseDescription"),o.TermOpen=new r(".openTermCourse.modalTitle",".openTermCourse.modalText","global.cancel",".openTermCourse.makeComplete","","","COMPLETE",".openTermCourse.courseStatus",".openTermCourse.courseDescription"),o.TermComplete=new r(".completeTermCourse.modalTitle",".completeTermCourse.modalText","global.cancel",".completeTermCourse.makeOpen","","","OPEN",".completeTermCourse.courseStatus",".completeTermCourse.courseDescription"),o.TermPrivate=new r(".privateTermCourse.modalTitle",".privateTermCourse.modalText","global.cancel","","","","OPEN",".privateTermCourse.courseStatus",".privateTermCourse.courseDescription"),o.OpenClassic=new r(".openClassicCourse.modalTitle",".openClassicCourse.modalText","global.cancel",".openClassicCourse.makePrivate","","","PRIVATE",".openClassicCourse.courseStatus",".openClassicCourse.courseDescription");class a{constructor(e,s){switch(this.course=e,this.status=s,s){case i.a.Open:this.optionsForCurrentStatus=o.Open;break;case i.a.Complete:this.optionsForCurrentStatus=o.Complete;break;case i.a.Private:this.optionsForCurrentStatus=o.Private;break;case i.a.PrivateDuration:this.optionsForCurrentStatus=o.PrivateDuration;break;case i.a.PrivateDurationClassic:this.optionsForCurrentStatus=o.PrivateDurationClassic;break;case i.a.OpenTermClassic:this.optionsForCurrentStatus=o.OpenTermClassic;break;case i.a.PrivateTermClassic:this.optionsForCurrentStatus=o.PrivateTermClassic;break;case i.a.TermOpen:this.optionsForCurrentStatus=o.TermOpen;break;case i.a.TermComplete:this.optionsForCurrentStatus=o.TermComplete;break;case i.a.TermPrivate:this.optionsForCurrentStatus=o.TermPrivate;break;case i.a.OpenClassic:this.optionsForCurrentStatus=o.OpenClassic;break;default:throw new Error("Unknown CourseStatus")}}getLocalizationKey(e){const s=this.course.isOrganization?"organization.outline":"course.outline";return(e||"").startsWith(".")?s+e:e}getStatus(){return this.status}getModalTitle(){return this.getLocalizationKey(this.optionsForCurrentStatus.modalTitle)}getModalDismissText(){return this.getLocalizationKey(this.optionsForCurrentStatus.modalDismissText)}getModalText(){return this.getLocalizationKey(this.optionsForCurrentStatus.modalText)}getSecondaryButtonText(){return this.getLocalizationKey(this.optionsForCurrentStatus.secondaryButtonText)}getPrimaryButtonText(){return this.getLocalizationKey(this.optionsForCurrentStatus.primaryButtonText)}getSecondaryButtonStatus(){return this.getLocalizationKey(this.optionsForCurrentStatus.secondaryButtonStatus)}getPrimaryButtonStatus(){return this.getLocalizationKey(this.optionsForCurrentStatus.primaryButtonStatus)}getCourseStatusName(){return this.getLocalizationKey(this.optionsForCurrentStatus.courseStatusName)}getCourseDescription(){return this.getLocalizationKey(this.optionsForCurrentStatus.courseDescription)}}},ptBS:function(e,s,t){var i=t("ziER"),r=t("5JeM"),o=new i({id:"icon-medium-messages",use:"icon-medium-messages-usage",viewBox:"0 0 24 24",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-medium-messages"><path d="M1 4v16h22V4H1z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /><path d="M1 4l8.4419 7.6744L12 14l2.5581-2.3256L23 4M23 20c-3.3676-3.5207-5.5754-5.3288-8.4418-8.3256M1 20l8.4419-8.3256" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});r.add(o);e.exports=o},"qG/h":function(e,s,t){"use strict";t.d(s,"c",(function(){return J})),t.d(s,"a",(function(){return Y})),t.d(s,"b",(function(){return Z}));var i=t("D57K"),r=t("nsO7"),o=t("71td"),a=t("Llzl"),n=t("5MwF"),c=t("9zo4"),u=t("nbDY"),l=t.n(u),h=t("0JpG"),m=t("Fvsw"),d=t("fYJU"),p=t("ZzN+"),b=t("go4a"),C=t("Sa5G"),v=t("0+Qs"),T=t("pjml"),y=t("emI2"),g=t("QIw5"),S=t("zdqs"),f=t("BjFu"),F=t("SoDU"),M=t("lEL+"),k=t("hkqm"),P=t("p7qr"),I=t("TnpK"),L=t("Ego9"),w=t("Q/M7"),O=t("yC9S"),A=t("z6Q5"),x=t("+brj"),z=t("aHpC"),B=t("GbAM"),$=t("H8CZ"),E=t("k+3c"),j=t("ZQey"),_=t("/jNt"),N=t("seHs"),U=t("gkef"),H=t("zGdY"),D=t("YXyV"),R=t("s7x+"),K=t("S1rJ"),G=t("Y+9S");class V extends l.a{}V.FilterAll=new V("filter-all-courses"),V.FilterTeach=new V("filter-courses-i-teach"),V.FilterTake=new V("filter-courses-i-take"),V.FilterSupport=new V("filter-courses-i-support"),V.FilterOpen=new V("filter-open-courses"),V.FilterPrivate=new V("filter-private-courses"),V.FilterCompleted=new V("filter-completed-courses"),V.FilterExternal=new V("filter-external-courses"),V.FilterHidden=new V("filter-hidden-from-me");const q="list",W=[N.d,N.b,N.a],Q="COURSES_SELECTED_PAGE_SIZE",J="ultra.base.courses.controller";let Y=class e{constructor(e,s,i,o,n,c,u,l,h,m,d,p,b,C,v,T,y,g,S,F,M,k,P,I,L,w,A,z){this.$compile=e,this.$modal=s,this.$q=i,this.$rootScope=o,this.$scope=n,this.browserStorage=c,this.bbBatch=u,this.accessibility=l,this.context=h,this.interval=m,this.bbLocalize=d,this.CourseMembershipModel=p,this.TermModel=b,this.UserModel=C,this.CourseModel=v,this.TermService=T,this.timeout=y,this.toast=g,this.ultraState=S,this.courseFavoriteService=F,this.ScheduledTaskModel=M,this.ConversionService=k,this.ConversionTaskModel=P,this.AnalyticsEvent=I,this.contextUser=L,this.preferenceService=w,this.windowSizeService=A,this.courseBanner=z,this.loadedFavorites=Object.create(null),this.courseCarouselReady=!1,this.courseCarousel=Object.create(null),this.visibleCourseFilters=[],this.pageSizeOptions=W,this.toFocusTermSelector=!1,this.courseShowFocused=!1,this.showMagicMoment=!1,this.isLoading=!0,this.hasHiddenCourse=!1,this.ctrlTitles={},this.setToUltraCourses={},this.batchQueue=[],this.showSearchInputInLargeDownBreakpoints=!1,this.isFavoriteFTUECreated=!1,this.initialLoadingPassed=!1,this.bannerThumbnailImages={},this.bannerDeregisterFunctions=[],this.getOverflowMenuItems=e=>[{uniqueId:"edit-course-image",icon:"draw",labelKey:this.ctrlTitles.editCourseImage,show:()=>this.courseBanner.canAccessEditBannerPeek(e.course)&&this.isMultiColumnCardView(),onClick:this.openEditBannerPanel.bind(this,e),additionalAttributes:{analyticsIdOverride:"base.courses.courseCard.editBanner.button"}},{uniqueId:"unlocked-classic",icon:"unlocked",labelKey:this.ctrlTitles.privateCourse,show:()=>!e.course.isUndecided()&&this.isCourseConversionComplete(e.course)&&e.course.isOpen()&&Object(f.a)(e.course)&&e.course.isClassic()&&(e.course.permissions.editAvailability||e.course.permissions.editClosed),onClick:this.openCourseStatusUpdateModal.bind(this,e),ariaLabel:()=>this.bbLocalize.translateSync({locale:e.course.getLocale()||this.bbLocalize.getAppLocale(),key:this.keyPrefix+".completeClassicCourse",params:{courseTitle:e.course.displayName},noWrap:!0})},{uniqueId:"unlocked-non-classic",icon:"unlocked",labelKey:this.ctrlTitles.completeOrPrivateCourse,show:()=>!e.course.isUndecided()&&this.isCourseConversionComplete(e.course)&&e.course.isOpen()&&Object(f.a)(e.course)&&e.course.isOpenNonClassic()&&(e.course.permissions.editAvailability||e.course.permissions.editClosed),onClick:this.openCourseStatusUpdateModal.bind(this,e),ariaLabel:()=>this.bbLocalize.translateSync({locale:e.course.getLocale()||this.bbLocalize.getAppLocale(),key:this.keyPrefix+".completeCourse",params:{courseTitle:e.course.displayName},noWrap:!0})},{icon:"lock",labelKey:this.ctrlTitles.openCourse,show:()=>!e.course.isUndecided()&&this.isCourseConversionComplete(e.course)&&(e.course.isPrivate()||!Object(f.a)(e.course))&&(e.course.permissions.editAvailability||e.course.permissions.editClosed),onClick:this.openCourseStatusUpdateModal.bind(this,e),ariaLabel:()=>this.bbLocalize.translateSync({locale:e.course.getLocale()||this.bbLocalize.getAppLocale(),key:this.keyPrefix+".openCourse",params:{courseTitle:e.course.displayName},noWrap:!0})},{icon:"course-complete",labelKey:this.ctrlTitles.openOrPrivateCourse,show:()=>!e.course.isUndecided()&&this.isCourseConversionComplete(e.course)&&e.course.isComplete()&&Object(f.a)(e.course)&&(e.course.permissions.editAvailability||e.course.permissions.editClosed),onClick:this.openCourseStatusUpdateModal.bind(this,e),ariaLabel:()=>this.bbLocalize.translateSync({locale:e.course.getLocale()||this.bbLocalize.getAppLocale(),key:this.keyPrefix+".privateCourse",params:{courseTitle:e.course.displayName},noWrap:!0})},{icon:"visible",labelKey:this.ctrlTitles.hideCourse,show:()=>!e.userHasHidden&&this.isCourseConversionComplete(e.course),onClick:this.toggleCourseHideStatus.bind(this,e),ariaLabel:()=>this.bbLocalize.translateSync({locale:e.course.getLocale()||this.bbLocalize.getAppLocale(),key:this.keyPrefix+".hideCourse",params:{courseTitle:e.course.displayName},noWrap:!0})},{icon:"invisible",labelKey:this.ctrlTitles.showCourse,show:()=>e.userHasHidden,onClick:this.toggleCourseHideStatus.bind(this,e),ariaLabel:()=>this.bbLocalize.translateSync({locale:e.course.getLocale()||this.bbLocalize.getAppLocale(),key:this.keyPrefix+".showCourse",params:{courseTitle:e.course.displayName},noWrap:!0})}],this.onChangePage=e=>{this.$scope.$apply((()=>{this.activeFavoritePlaceHolder=0,this.currentPage=Math.max(0,e)})),a.element("#main-content-inner").animate({scrollTop:0},400,(()=>{a.element(".course-element-card").eq(0).focus()}))},this.onPageSizeChange=e=>{this.browserStorage.saveToStorage(Q,e.toString(10),x.a.LocalStorage),this.pageSize=e,this.currentPage=Math.min(this.currentPage,this.numberOfPages-1)},this.activeFavoritePlaceHolder=0,this.isBaseOrganizations=S.includes("base.organizations.**"),this.keyPrefix=this.isBaseOrganizations?"base.organizations":"base.courses",this.fillFavoriteFTUE(),n.baseCourses=this,this.initializeAllFilters();const B=i.defer();n.firstSlideCreated=r.once((e=>{B.resolve()})),n.previewModalTitleKey=this.isBaseOrganizations?"organization.outline.previewCourse.modalTitle":"course.outline.previewCourse.modalTitle",this.$q.all([this.initializeData(),B.promise]).then((()=>{this.setupCourseCarousel()&&(this.isLoading=!1,this.displayStatusForCompleteConversions(),this.hasHiddenCourse=this.foundHiddenCourses(),Promise.all([t.e(0),t.e(1),t.e(4),t.e(5),t.e(6),t.e(8),t.e(7),t.e(9),t.e(10),t.e(22),t.e(40),t.e(36),t.e(46),t.e(49),t.e(51),t.e(69),t.e(47),t.e(77),t.e(76),t.e(81)]).then((()=>{}).bind(null,t)).catch((()=>{})))})),n.$on("add-external-course",((e,s)=>{const t=this.TermService.parseMembershipFromExternalCourse(s);this.addCourseMembership(t,!0),this.showMagicMoment=!1})),n.$on("update-external-course",((e,s)=>{const t=this.TermService.parseMembershipFromExternalCourse(s);this.updateCourseMembership(t,!0)})),n.$on("delete-external-course",((e,s)=>{const t=this.TermService.parseMembershipFromExternalCourse(s);this.deleteCourseMembership(t,!0),this.showMagicMoment=this.hasNoCourse()})),n.$on("update-course-status",((e,s,t,i)=>{const r=this._findCourseMembership(s,this.termsAndMemberships.memberships);if(this.mySelectedFilter.isCourseStatusFilter){const e=this.termsAndMemberships.memberships[r];this.cutCourseMembershipFrom(e.course.id,this.loadedTermsAndMemberships.membershipsByTermId[e.course.ui.term.id].memberships)}this.termsAndMemberships.memberships[r].course.setStatus(t,i),this.refreshFilters()})),n.$on("update-slick-refresh",(e=>{this.courseCarousel.slick("slickGoTo",this.slickCurrentIndex,!0)})),n.$watch("baseCourses.slickCurrentIndex",((e,s)=>{this.slickIndexChanged(e,s)})),n.$on("showConversionTooltip",((e,s)=>{this.termsAndMembershipsLoadedPromise.then((()=>{this.accessibility.setFocusOverrideOnPanel("[data-course-id="+s+"]",".base");const e=this._findCourseMembership(s,this.termsAndMemberships.memberships);if(-1!==e){const s=this.termsAndMemberships.memberships[e];s.course.refreshConvertToUltraStatus().then((e=>{this.showConversionTooltip(e),this.ConversionService.isConversionComplete(e.ui.convertToUltraTaskStatus)||this._resetConversionTaskInterval(s)}))}}))})),n.$on("reloadCourse",((e,s)=>{this._reloadCourse(s)})),n.$on("reloadCourseSchedule",((e,s)=>{this.reloadCourseSchedule(s)})),O.b.OnWindow("resize",(()=>n.$evalAsync()),n),n.$on("$destroy",(()=>{this.bannerDeregisterFunctions.forEach((e=>{e()}))}));if(["showCourse","hideCourse","privateCourse","completeOrPrivateCourse","openCourse","openOrPrivateCourse","editCourseImage"].forEach((e=>s=>{this.ctrlTitles[s]=this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:`${e}.${s}`})})(this.keyPrefix+".title")),this.currentPage=0,c.getFromStorage(Q,x.a.LocalStorage).then((e=>{this.initialPageSize=Number(e)||this.pageSizeOptions[0],this.pageSize=this.initialPageSize})).catch((()=>{this.initialPageSize=this.pageSizeOptions[0],this.pageSize=this.initialPageSize})),Object(G.m)()){const e={type:G.c.TimelineOpened,status:G.b.Success};Object(G.r)(e),Object(G.j)(this.ultraState)}}get view(){return this._view}set view(e){this._view=e,this.setViewPreference()}search(e){this.freetypeSearchKeyword=e,this.changeFilter(this.mySelectedFilter)}fillFavoriteFTUE(){$.a(o(".base-courses-container"),(e=>{if(!e.originalEvent||"base-courses-container-show-event-trigger"!==e.originalEvent.animationName)return!0;{const s=o(e.target);this.$compile('<div bb-guidance-target class="favorite-guidance-target" component-key="course.favorite"></div>')(this.$scope.$new(!0),(e=>{s.append(e)})),this.$compile('<bb-guidance class="guidance-element-overlay course-favorite-guidance" component-key="course.favorite"><bb-translate>'+this.keyPrefix+".addCourseToFavorites</bb-translate></bb-guidance>")(this.$scope.$new(!0),(e=>{s.parents("bb-base-course-card > div").append(e)}))}}))}_resetConversionTaskInterval(e){const s=e.course;this.ConversionService.setCheckConversionInterval(s,((t,i)=>{this.CourseModel.findCourseByCourseId(s.courseId,!1).then((i=>{s.ui.showConversionInProgress=!1,s.ui.convertToUltraTaskStatus=t,s.ultraStatus=i.ultraStatus,s.$pk=i.id,s.id=i.id,s.ui.courseColorClass=b.a(e),this.showConversionTooltip(s)}))}))}isMultiColumnCardView(){return"grid"===this.view}shouldRenderFavoriteButton(e){return!e.isGuestMembership()&&this.isCourseConversionComplete(e.course)}initializeData(){const e=this.$q.defer();return this.termsAndMembershipsLoadedPromise=e.promise,this.$q.all([this.TermService.reloadTermsAndMemberships(),this.getSelectedFilterFromBrowserStorage(),this.getViewPreference(),this.courseFavoriteService.fetchFavoriteCourseIds()]).then((([s,t,i])=>{this.view=i,this.termsAndMemberships=s;const o=new F.a(this.TermModel,this.termsAndMemberships.terms);this.currentTerm=o.currentTerm,this.upcomingTerm=o.upcomingTerm;const a=new S.a(o);this.membershipMapper=a.getMembershipMapper(),this.refreshFilters();const n=t&&(r.find(this.allFilters,(e=>e.nature.isEqualTo(new V(t))))||{}).nature;this.mySelectedFilter=this._findCourseFilter(n||V.FilterAll),this.loadedTermsAndMemberships=this.buildCourseMemberships(this.mySelectedFilter),this.clearUnavailableFavoriteCourses(this.termsAndMemberships),g.a.Failure===this.ultraState.params.enrollmentMessage?this.toast.show({messageKey:this.keyPrefix+".failToEnroll"}):g.a.Unavailable===this.ultraState.params.enrollmentMessage&&this.toast.show({messageKey:this.keyPrefix+".courseUnavailable"}),this.initTermSelector(),e.resolve()}))}invokeBatchQueue(){this.bbBatch.performBatch((()=>{this.batchQueue.forEach((e=>e()))})),this.batchQueue=[]}patchData(e){e.course.instructorsMembership.isPatched||(s=>{e.course.instructorsMembership.$resolve=(...t)=>(this.batchQueue.push((()=>{s.apply(e.course.instructorsMembership,t).$allow([403])})),this.invokeBatchQueue(),e.course.instructorsMembership),e.course.instructorsMembership.isPatched=!0})(e.course.instructorsMembership.$resolve)}getSelectedFilterFromBrowserStorage(){return this.browserStorage.getFromStorage(e.LOCAL_STORAGE_KEY_SELECTED_Filter,x.a.LocalStorage)}_reloadCourse(e){const s=this._findCourseMembership(e,this.termsAndMemberships.memberships);if(-1!==s){this.termsAndMemberships.memberships[s].course.$fetch()}}reloadCourseSchedule(e){const s=this._findCourseMembership(e,this.termsAndMemberships.memberships);if(-1!==s){this.termsAndMemberships.memberships[s].course.schedule.$refresh({limit:1})}}getTermName(e){switch(e.ui.type){case"current":return this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".currentCourses"});case"upcoming":return this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".upcomingCourses"});case"year":return this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".yearTerm",params:{year:e.ui.year}});default:return e.name}}initializeAllFilters(){this.allFilters=[{index:0,name:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.options.all"}),title:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.titles.all"}),state:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.noCourses.all"}),nature:V.FilterAll,show:e=>!0,filter:e=>!0},{index:1,name:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.options.teach"}),title:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.titles.teach"}),state:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.noCourses.teach"}),nature:V.FilterTeach,show:e=>e.isActAsInstructorMembership(),filter:e=>e.isActAsInstructorMembership()},{index:2,name:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.options.take"}),title:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.titles.take"}),state:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.noCourses.take"}),nature:V.FilterTake,show:e=>e.isStudentMembership(),filter:e=>e.isStudentMembership()},{index:3,name:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.options.support"}),title:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.titles.support"}),state:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.noCourses.support"}),nature:V.FilterSupport,show:e=>e.isInRoleBucket(H.y.Supporting),filter:e=>e.isInRoleBucket(H.y.Supporting)},{index:4,name:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.options.open"}),title:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.titles.open"}),state:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.noCourses.open"}),nature:V.FilterOpen,show:e=>!0,filter:e=>e.courseIsOpen()&&!e.course.appearsAsPrivate(),isCourseStatusFilter:!0},{index:5,name:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.options.private"}),title:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.titles.private"}),state:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.noCourses.private"}),nature:V.FilterPrivate,show:e=>e.isActAsInstructorMembership(),filter:e=>e.courseIsPrivate()||e.course.appearsAsPrivate(),isCourseStatusFilter:!0},{index:6,name:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.options.complete"}),title:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.titles.complete"}),state:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.noCourses.complete"}),nature:V.FilterCompleted,show:e=>!0,filter:e=>e.courseIsComplete(),isCourseStatusFilter:!0},{index:7,name:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.options.external"}),title:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.titles.external"}),state:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.noCourses.external"}),nature:V.FilterExternal,show:e=>{if(n.a.features.externalCourse)return e.course.ui.isExternal},filter:e=>{if(n.a.features.externalCourse)return e.course.ui.isExternal}},{index:8,name:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.options.hidden"}),title:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.titles.hidden"}),state:this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:this.keyPrefix+".filters.noCourses.hidden"}),nature:V.FilterHidden,show:e=>e.userHasHidden,filter:e=>e.userHasHidden}]}_findCourseFilter(e){return this.allFilters.filter((s=>e.isEqualTo(s.nature)))[0]}hasCoursesInTerm(e,s){return s.membershipsByTermId[e.id]&&s.membershipsByTermId[e.id].memberships&&s.membershipsByTermId[e.id].memberships.length>0}isCourseConversionComplete(e){const s=this.ConversionService.isConversionComplete(e.ui.convertToUltraTaskStatus);return!e.ui.convertToUltraTaskStatus||"?"===e.ui.convertToUltraTaskStatus||s}filterCourseMemberships(e,s){let t;return V.FilterHidden.isEqualTo(e.nature)?t=s.filter(e.filter):(t=s.filter((e=>!e.userHasHidden)),t=t.filter(e.filter)),t}hasMultipleTerms(e){return this.termsAndMemberships.termsByTermId&&this.termsAndMemberships.termsByTermId[e]&&this.termsAndMemberships.termsByTermId[e].length>0}onFavorite(e,s,t){t?(e.ui.isFavorite=t,this.$scope.$broadcast("pin-a-course",e),this.courseFavoriteService.pin(e.course),this.addCourseMembershipToFavorites(e,s)):(this.$scope.$broadcast("unpin-a-course",e),this.courseFavoriteService.unpin(e.course),this.resetCourseMembershipToOriginalLocation(e,s))}addCourseMembershipToFavorites(e,s){const t=this.loadedFavorites[s.id].memberships;if(t.find((s=>s.course.id===e.course.id))||(t.push(e),this.loadedFavorites[s.id].memberships=r.sortBy(t,(e=>e.course.displayName))),e.course.ui.term.id!==s.id&&this.loadedFavorites[e.course.ui.term.id]&&!this.loadedFavorites[e.course.ui.term.id].memberships.find((s=>s.course.id===e.course.id))){const s=this.loadedFavorites[e.course.ui.term.id].memberships;s.push(e),this.loadedFavorites[e.course.ui.term.id].memberships=r.sortBy(s,(e=>e.course.displayName))}if(e.course.term&&e.course.term.id!==s.id&&this.loadedFavorites[e.course.term.id]&&!this.loadedFavorites[e.course.term.id].memberships.find((s=>s.course.id===e.course.id))){const s=this.loadedFavorites[e.course.term.id].memberships;s.push(e),this.loadedFavorites[e.course.term.id].memberships=r.sortBy(s,(e=>e.course.displayName))}}removeCourseMembershipFromFavorites(e,s){const t=s.id,i=this.loadedFavorites[t].memberships,r=i.findIndex((s=>s.course.id===e.course.id));if(r>=0&&(i.splice(r,1),this.loadedFavorites[t].memberships=i),e.course.ui.term.id!==s.id&&this.loadedFavorites[e.course.ui.term.id]){const s=this.loadedFavorites[e.course.ui.term.id].memberships,t=this.loadedFavorites[e.course.ui.term.id].memberships.findIndex((s=>s.course.id===e.course.id));t>=0&&(s.splice(t,1),this.loadedFavorites[e.course.ui.term.id].memberships=s)}if(e.course.term&&e.course.term.id!==s.id&&this.loadedFavorites[e.course.term.id]){const s=this.loadedFavorites[e.course.term.id].memberships,t=this.loadedFavorites[e.course.term.id].memberships.findIndex((s=>s.course.id===e.course.id));t>=0&&(s.splice(t,1),this.loadedFavorites[e.course.term.id].memberships=s)}}resetCourseMembershipToOriginalLocation(e,s){const t=this.loadedTermsAndMemberships.membershipsByTermId[s.id].memberships.find((s=>s.course.id===e.course.id));if(t&&(t.ui.isFavorite=!1,t.ui._score=void 0,t.ui._hidden=!1),e.course.ui.term.id!==s.id){const s=this.loadedTermsAndMemberships.membershipsByTermId[e.course.ui.term.id].memberships.find((s=>s.course.id===e.course.id));s&&(s.ui.isFavorite=!1,s.ui._score=void 0,s.ui._hidden=!1)}if(e.course.term&&e.course.term.id!==s.id){const s=this.loadedTermsAndMemberships.membershipsByTermId[e.course.term.id].memberships.find((s=>s.course.id===e.course.id));s&&(s.ui.isFavorite=!1,s.ui._score=void 0,s.ui._hidden=!1)}}isFirstNonFavorite(s,t){const i=this.isFirstCourseMembershipInGroup(s,t);return r.isUndefined(s.ui.isNeedCreateFTUE)&&e.STRING_EMPTY!==i&&(this.isFavoriteFTUECreated?s.ui.isNeedCreateFTUE=!1:s.ui.isNeedCreateFTUE=this.isFavoriteFTUECreated=!0),s}isLastFavorite(e,s){return r.last(this.loadedFavorites[s.id].memberships)===e}isFirstCourseMembershipInGroup(s,t){const i=this.loadedTermsAndMemberships.membershipsByTermId[t.id].memberships,r=this.TermService.filterAssortedDatesCourseMemberships(i).filter((e=>this.myFilter(e))),o=this.TermService.filterAssociatedWithTermCourseMemberships(i).filter((e=>this.myFilter(e)));return s.ui._hidden||0!==r.findIndex((e=>e.course.id===s.course.id))?s.ui._hidden||0!==o.filter((e=>!e.ui._hidden&&s.course.term&&e.course.term.id===s.course.term.id)).findIndex((e=>e.course.id===s.course.id))?e.STRING_EMPTY:"REGULAR_TERM":"ASSORTED_DATES"}isCurrentTerm(e){return T.Gb.ConstantTermId.CurrentTerm===e.id}isUpcomingTerm(e){return T.Gb.ConstantTermId.UpcomingTerm===e.id}filterFavoriteCourses(s){const t=s.filter((e=>this.courseFavoriteService.isPinned(e.course)));return t.forEach((s=>{s.ui.isFavorite=!0,s.ui._score=e.FAVORITE_SCORE})),t}clearUnavailableFavoriteCourses(s,t){const i=this.courseFavoriteService.favoriteCourseIds;if(i.length>e.MAX_FAVORITE_COURSES_LENGTH){let e;e=t?s.membershipsByTermId[t].memberships.map((e=>e.course.id)):s.memberships.map((e=>e.course.id));const o=r.difference(i,e);this.courseFavoriteService.clear(o)}}resetFavoriteCourseStatus(e){e.forEach((e=>{e.ui._hidden&&(e.ui._hidden=!1,e.ui.isFavorite&&!this.courseFavoriteService.isPinned(e.course)&&(e.ui.isFavorite=!1,e.ui._score=void 0),!e.ui.isFavorite&&e.ui._score&&(e.ui._score=void 0))}))}buildFavorites(e){Object.keys(e.membershipsByTermId).forEach((s=>{const t=e.membershipsByTermId[s].memberships,i=this.filterFavoriteCourses(t);this.loadedFavorites[s]={memberships:r.sortBy(i,["ui._score","course.displayName"])}}))}partiallyBuildCourseOrOrgMemberships(){const e={terms:[],termsByTermId:{},memberships:[],membershipsByTermId:{}};return Object.keys(this.termsAndMemberships.membershipsByTermId).forEach((s=>{var t,i;e.membershipsByTermId[s]={memberships:this.isBaseOrganizations?this.TermService.getOrganizationMembershipsFromArray(null===(t=this.termsAndMemberships.membershipsByTermId[s])||void 0===t?void 0:t.memberships):this.TermService.getCourseMembershipsFromArray(null===(i=this.termsAndMemberships.membershipsByTermId[s])||void 0===i?void 0:i.memberships)}})),e}_partiallyBuildMemberships(e){const s={terms:[],termsByTermId:{},memberships:[],membershipsByTermId:{}};return Object.keys(this.termsAndMemberships.membershipsByTermId).forEach((t=>{let i;i=this.isBaseOrganizations?this.TermService.getOrganizationMembershipsFromArray(this.termsAndMemberships.membershipsByTermId[t].memberships):this.TermService.getCourseMembershipsFromArray(this.termsAndMemberships.membershipsByTermId[t].memberships);let o=[];if(this.hasMultipleTerms(t)){i=r.sortBy(i,(e=>e.course.term?e.course.term.name:"")),this.termsAndMemberships.termsByTermId[t].forEach((s=>{const t=this.TermService.filterAssociatedWithTermCourseMembershipsByTerm(i,s);o.push.apply(o,r.sortBy(this.filterCourseMemberships(e,t),["ui._score","course.displayName"]))}));const s=this.TermService.filterAssortedDatesCourseMemberships(i);o.push.apply(o,r.sortBy(this.filterCourseMemberships(e,s),["ui._score","course.displayName"]))}else o=r.sortBy(this.filterCourseMemberships(e,i),["ui._score","course.displayName"]);this.resetFavoriteCourseStatus(o);this.filterFavoriteCourses(o).forEach((e=>e.ui._hidden=!0)),s.membershipsByTermId[t]={memberships:o}})),s}myFilter(e){return!(!0===e.ui._hidden)}updateTerms(e){const s=this.termsAndMemberships.terms,t=this.partiallyBuildCourseOrOrgMemberships(),i=s.filter((e=>T.Gb.ConstantTermId.CurrentTerm===e.id||T.Gb.ConstantTermId.UpcomingTerm===e.id||this.hasCoursesInTerm(e,t)));e.terms=i}buildCourseMemberships(e,s){const t=this._partiallyBuildMemberships(e);return this.buildFavorites(t),this.updateTerms(t),this.initCourseCardImages(t),this.initialLoadingPassed?(this.loadedTermsAndMemberships.membershipsByTermId=t.membershipsByTermId,this.loadedTermsAndMemberships.memberships=t.memberships,this.loadedTermsAndMemberships.termsByTermId=t.termsByTermId,this.loadedTermsAndMemberships.terms.splice(0,this.loadedTermsAndMemberships.terms.length,...t.terms)):(this.loadedTermsAndMemberships=t,this.initialLoadingPassed=!0),t}setCourseCardImage(e){return this.courseBanner.getCustomOrDefaultBannerThumbnail(e.course.id,e.id).then((s=>{this.bannerThumbnailImages[e.id]=s}))}initCourseCardImages(e){const s=[];Object.values(e.membershipsByTermId).forEach((e=>{e.memberships.forEach((e=>{if(s.includes(e.id))return;this.setCourseCardImage(e);const t=this.courseBanner.registerUpdateBannerListener((s=>{s===e.course.id&&this.setCourseCardImage(e)}));this.bannerDeregisterFunctions.push(t),s.push(e.id)}))}))}changeFilter(s){s&&(this.mySelectedFilter=s,this.browserStorage.saveToStorage(e.LOCAL_STORAGE_KEY_SELECTED_Filter,this.mySelectedFilter.nature,x.a.LocalStorage)),this.buildCourseMemberships(this.wrapFilterWithKeyword(s)),this.currentPage=0;const t=this.activeTerm?this.activeTerm:this.currentTerm;this.notifyScreenReaderForResults(t)}notifyScreenReaderForResults(e){let s="";s=this.mySelectedFilter&&e&&this.loadedTermsAndMemberships.membershipsByTermId[e.id]&&this.loadedTermsAndMemberships.membershipsByTermId[e.id].memberships.length?this.keyPrefix+".search.someResults":this.keyPrefix+".search.noResults",s=this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.$scope),key:s,noWrap:!0,noEscape:!0}),this.timeout((()=>{this.$rootScope.$broadcast(B.b,s)}),this.$scope,1e3)}wrapFilterWithKeyword(e){const s=e.filter;let t={...e,filter:e=>(e.ui._score=void 0,s(e))};if(this.freetypeSearchKeyword){const e=[(()=>{const e=new RegExp("^.*"+this.freetypeSearchKeyword.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+".*$","i");return s=>e.test(s.course.displayName)||e.test(s.course.displayId)})(),(()=>{const e=this.freetypeSearchKeyword.split(/\s+/).map((e=>new RegExp(e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"i")));return s=>e.some((e=>!!e.exec(s.course.displayName)))||e.some((e=>!!e.exec(s.course.displayId)))})()],s=t.filter;t={...t,filter:t=>s(t)&&(()=>{const s=e.findIndex((e=>e(t)));return t.ui._score=s,s>=0})()}}return t}foundHiddenCourses(){return this.termsAndMemberships.memberships.some(this._findCourseFilter(V.FilterHidden).filter)}updateSlick(e){e&&(this.activeTerm=e),this.activeTerm||(this.activeTerm=this.currentTerm);let s=this.loadedTermsAndMemberships.terms.indexOf(this.activeTerm);s<0&&(this.activeTerm=this.currentTerm,s=this.loadedTermsAndMemberships.terms.indexOf(this.currentTerm)),this.slickCurrentIndex=s,this.courseCarousel.slick("slickGoTo",this.slickCurrentIndex,!0),this.notifyScreenReaderForResults(this.activeTerm)}slickIndexChanged(e,s){if(null==e)return;const t=this.loadedTermsAndMemberships.terms;this.loadedTermsAndMemberships.terms.length;this.activeTerm=t[e],this.preActiveTerm=t[e-1],this.nextActiveTerm=t[e+1],r.isUndefined(s)||(this.toFocusTermSelector?(this.toFocusTermSelector=!1,a.element(".term-navigator .select-wrapper>button").focus()):s>e?a.element(".term-navigator > .sibling-term").first().focus():s<e&&a.element(".term-navigator > .sibling-term").last().focus()),this.notifyScreenReaderForResults(this.activeTerm)}identifyActiveTerm(e){return(!e||e<0)&&(e=0),this.loadedTermsAndMemberships.terms[e]}setCourseShowFocused(e){this.courseShowFocused=e}addCourseMembership(e,s){const t=this.membershipMapper.adjustTerm(e,this.context.getServerTime());e.course.ui.term=t,this.termsAndMemberships.memberships.push(e),this.termsAndMemberships.membershipsByTermId[t.id]||(this.termsAndMemberships.membershipsByTermId[t.id]={memberships:[]});let i=this.termsAndMemberships.membershipsByTermId[t.id].memberships;i.push(e),i=r.sortBy(i,(e=>e.course.displayName)),this.termsAndMemberships.membershipsByTermId[t.id].memberships=i;const o=this.filterCourseMemberships(this.mySelectedFilter,[e]);let a=this.slickCurrentIndex+1;if(o.length>0){const s=this.filterCourseMemberships(this.mySelectedFilter,i);if(this.loadedTermsAndMemberships.membershipsByTermId[t.id]&&this.loadedTermsAndMemberships.membershipsByTermId[t.id].memberships){const i=this.loadedTermsAndMemberships.membershipsByTermId[t.id].memberships.length;this.loadedTermsAndMemberships.membershipsByTermId[t.id].memberships=s.slice(0,i+1);this.loadedTermsAndMemberships.membershipsByTermId[t.id].memberships.indexOf(e)<0&&(this.loadedTermsAndMemberships.membershipsByTermId[t.id].memberships.splice(i,1),this.loadedTermsAndMemberships.membershipsByTermId[t.id].memberships.push(e))}else this.loadedTermsAndMemberships.membershipsByTermId[t.id]={memberships:[...s]};this.updateTerms(this.loadedTermsAndMemberships),a=this.loadedTermsAndMemberships.terms.indexOf(t)}s&&(this.refreshFilters(),this.updateSlick(this.identifyActiveTerm(a)))}updateCourseMembership(e,s){this.deleteCourseMembership(e,!1),this.addCourseMembership(e,s)}cutCourseMembershipFrom(e,s){const t=this._findCourseMembership(e,s);return t>=0?s.splice(t,1)[0]:null}cutCourseMembershipByCourse(e){this.cutCourseMembershipFrom(e.id,this.loadedTermsAndMemberships.membershipsByTermId[this.activeTerm.id].memberships),this.cutCourseMembershipFrom(e.id,this.loadedFavorites[this.activeTerm.id].memberships),e.ui.term.id!==this.activeTerm.id&&(this.cutCourseMembershipFrom(e.id,this.loadedTermsAndMemberships.membershipsByTermId[e.ui.term.id].memberships),this.cutCourseMembershipFrom(e.id,this.loadedFavorites[e.ui.term.id].memberships)),e.term&&e.term.id!==this.activeTerm.id&&(this.cutCourseMembershipFrom(e.id,this.loadedTermsAndMemberships.membershipsByTermId[e.term.id].memberships),this.cutCourseMembershipFrom(e.id,this.loadedFavorites[e.term.id].memberships))}deleteCourseMembership(e,s){const t=e.course.id;if(!(e=this.cutCourseMembershipFrom(t,this.termsAndMemberships.memberships)))return;const i=e.course.ui.term.id;this.cutCourseMembershipFrom(t,this.termsAndMemberships.membershipsByTermId[i].memberships);const r=this.loadedTermsAndMemberships.membershipsByTermId[i].memberships;this.cutCourseMembershipFrom(t,r);this.updateTerms(this.loadedTermsAndMemberships),this.hasHiddenCourse=this.foundHiddenCourses(),this.refreshFilters()}_findCourseMembership(e,s){for(let t=0;t<s.length;t++)if(s[t].course.id===e)return t;return-1}isFilterOptionVisible(e,s){for(let t=s.terms.length-1;t>=0;--t){const i=s.membershipsByTermId[s.terms[t].id];if(i&&i.memberships.some(e.show))return!0}return!1}_afterHidden(e,s){this.cutCourseMembershipByCourse(s.course);const t=this.loadedTermsAndMemberships.membershipsByTermId[this.activeTerm.id].memberships;e&&0===t.length&&this.updateTerms(this.loadedTermsAndMemberships),this.hasHiddenCourse=this.foundHiddenCourses(),this.$scope.$root.$emit("membership-hidden-status-update",s),this.refreshFilters()}toggleCourseHideStatus(e,s){const t=e.course;let i;if(t.ui.isExternal){const s=this.TermService.parseExternalCourseFromMembership(e);i=s.isHidden,s.isHidden=!i,s.$save(["isHidden"]).$then((s=>{e.userHasHidden=s.isHidden,this._afterHidden(!i,e)}))}else{const s=t.memberships.$new(e.id);i=e.userHasHidden,s.userHasHidden=!i,s.$save(["userHasHidden"]).$then((r=>{e.userHasHidden=r.userHasHidden,this._afterHidden(!i,e);const o={action:"click",analyticsId:"hideCourse",url:document.URL,context:{user:this.contextUser.userId,membership:s.id,originalStatus:i,currentStatus:r.userHasHidden},applicationId:n.a.telemetryAppId,course:{id:t.id,uuid:t.uuid,batchUid:t.batchUid,ultraStatus:t.ultraStatus}};this.AnalyticsEvent.$create(o)}))}s&&(s.stopPropagation(),s.stopImmediatePropagation(),s.preventDefault())}setupCourseCarousel(){return this.courseCarousel.init(),!!this.courseCarousel[0].slick&&(this.updateSlick(this.currentTerm),this.courseCarousel.slick("slickGoTo",this.slickCurrentIndex,!0),this.courseCarouselReady=!0,this.showMagicMoment=this.hasNoCourse(),!0)}refreshFilters(){const e=this.allFilters.filter((e=>this.isFilterOptionVisible(e,this.termsAndMemberships)));return(e.length!==this.visibleCourseFilters.length||e.some(((e,s)=>this.visibleCourseFilters[s]!==e)))&&(this.visibleCourseFilters=e),!!(this.mySelectedFilter&&this.visibleCourseFilters.indexOf(this.mySelectedFilter)<0)&&(this.changeFilter(this._findCourseFilter(V.FilterAll)),!0)}hasNoCourse(){return Object.keys(this.termsAndMemberships.membershipsByTermId).every((e=>this.termsAndMemberships.membershipsByTermId[e].memberships.length<=0))}isAllFilterSelected(){return!!this.mySelectedFilter&&V.FilterAll.isEqualTo(this.mySelectedFilter.nature)}openEditBannerPanel(e){const s=this.isBaseOrganizations?"organizations":"courses";this.ultraState.goPeekState("course-edit-banner",{coursesOrOrganizations:s,id:e.course.id})}openCourseStatusUpdateModal(e,s){let t;s&&(s.stopImmediatePropagation(),s.preventDefault()),this.setCourseStatus(e.course),this.ConversionService.isPreview(e.course)?(t=this.$modal.open({template:R,scope:this.$scope,resolve:{translations:[h.serviceName,e=>e.loadBundle("features/course/outline/course-outline")]}}),t.result.then((s=>{s&&(this.setToUltraCourses[e.course.id]=!0,this.updateCourseStatusAndDisplayMemberships(e,s),e.course.setUltraStatusDecided().then((()=>{this.setToUltraCourses[e.course.id]=!1})))}))):(this.$scope.currentAnalyticsId="base.courses.statusUpdateModal",t=this.$modal.open({template:K,scope:this.$scope,resolve:{translations:[h.serviceName,e=>e.loadBundle("features/course/outline/course-outline")]}}),t.result.then((s=>{this.updateCourseStatusAndDisplayMemberships(e,s)})))}isSetToUltraCourse(e){return!!this.setToUltraCourses[e.id]}updateCourseStatusAndDisplayMemberships(e,s){if(s){e.course.$snapshot();const t=e.course.getStatus();e.course.setStatus(s),e.course.withParams({expand:"effectiveAvailability"}).$patch().$then((i=>{if(i){const r=i.getStatus(),o={effectiveAvailability:i.effectiveAvailability,effectiveAvailabilityUnprivileged:i.effectiveAvailabilityUnprivileged};this.$scope.$emit("update-course-status",i.id,s,o),t!==r&&this.mySelectedFilter.isCourseStatusFilter&&this.cutCourseMembershipByCourse(e.course)}}))}}setCourseStatus(e){const s=!Object(f.a)(e);s&&e.isClassic()?this.$scope.currentCourseStatus=new E.a(e,j.a.PrivateDurationClassic):e.isOpen()&&e.isClassic()&&e.isHonorTermAvailability?this.$scope.currentCourseStatus=new E.a(e,j.a.OpenTermClassic):e.isPrivate()&&e.isClassic()&&e.isHonorTermAvailability?this.$scope.currentCourseStatus=new E.a(e,j.a.PrivateTermClassic):e.isOpen()&&e.isClassic()?this.$scope.currentCourseStatus=new E.a(e,j.a.OpenClassic):s?this.$scope.currentCourseStatus=new E.a(e,j.a.PrivateDuration):e.isOpen()&&e.isHonorTermAvailability?this.$scope.currentCourseStatus=new E.a(e,j.a.TermOpen):e.isPrivate()&&e.isHonorTermAvailability?this.$scope.currentCourseStatus=new E.a(e,j.a.TermPrivate):e.isOpen()?this.$scope.currentCourseStatus=new E.a(e,j.a.Open):e.isPrivate()?this.$scope.currentCourseStatus=new E.a(e,j.a.Private):e.isHonorTermAvailability?this.$scope.currentCourseStatus=new E.a(e,j.a.TermComplete):this.$scope.currentCourseStatus=new E.a(e,j.a.Complete)}openExternalCourseInNewWindow(e,s){return w.o(e.ui.externalUrl),s.preventDefault(),s.stopImmediatePropagation(),!1}handleCourseLinkClick(e,s){if(!e.isAvailable&&e.canConvert())e.ui.isUpdatingConversionStatus=!0,this.CourseModel.findCourseByCourseId(e.courseId,!0).then((t=>{t.id!==e.id&&(this.updateRestoredCourse(e,t),e.id=t.id),e.ultraStatus=t.ultraStatus,e.refreshConvertToUltraStatus().then((()=>{e.ui.isUpdatingConversionStatus=!1,this.ConversionService.isConversionComplete(e.ui.convertToUltraTaskStatus)?(this.ConversionService.cancelConversionInterval(e),this.courseLinkClickWithoutConversion(e,s)):(this.showConversionTooltip(e),this.ConversionService.setCheckConversionIntervalIfNotExist(e))}))}));else{if(e.canAccess())return this.courseLinkClickWithoutConversion(e,s);e.ui.showStudentUnavailable=!0}}courseLinkClickWithoutConversion(e,s){if(e.ui.isExternal)return this.openExternalCourseInNewWindow(e,s);this.ultraState.goPeekState("course.outline",{courseId:e.id})}_replaceCourseMembership(e,s,t){const i=this._findCourseMembership(e.course.id,t);i>=0&&(t[i]=s)}updateRestoredCourse(e,s){this.contextUser.userModel.memberships.$fetch({organization:!1,limit:1e4,expand:"course.instructorsMembership,course.effectiveAvailability,course.permissions,courseRole"}).$asPromise().then((t=>{const i=r.find(t,(e=>e.course&&e.course.$pk===s.id));if(i){i.course.ui=a.copy(e.ui),i.course.ui.courseColorClass=b.a(i);const s=this.TermService.getCourseMembership(e.id),t=s.course.ui.term.id;this._replaceCourseMembership(s,i,this.loadedTermsAndMemberships.membershipsByTermId[t].memberships),this._replaceCourseMembership(s,i,this.termsAndMemberships.membershipsByTermId[t].memberships),this._replaceCourseMembership(s,i,this.termsAndMemberships.memberships)}}))}batchEvaluateConversionStatus(e){const s=e.filter((e=>e.course.isUltraPreview()||e.course.isClassic())).map((e=>({course:e.course})));if(0===s.length)return;const t=s.map((e=>({course:e.course})));this.bbBatch.performBatch((()=>this.$q.all(s.map((e=>e.course.conversions.$new("conversionStatus").$fetch().$allow([404,403]).$asPromise()))))).then((s=>{s.forEach(((s,i)=>{const r=t[i].course;r.ui.convertToUltraTaskId=s.taskId,r.ui.convertToUltraTaskStatus=s.taskStatus?s.taskStatus.toString():void 0,r.ui.conversionTaskTitle=s.taskTitle,this.ConversionService.isConversionComplete(r.ui.convertToUltraTaskStatus)||(this._resetConversionTaskInterval(e[i]),this.showConversionTooltip(r))}))}))}getAlertType(e){let s=C.i.None;return e.ui.showConversionInProgress?s=e.isOrganization?C.i.OrgConversionInProgress:C.i.ConversionInProgress:e.ui.showConversionComplete?s=e.isOrganization?C.i.OrgConversionComplete:C.i.ConversionComplete:e.ui.showStudentUnavailable&&(s=e.isOrganization?C.i.ParticipantTryAgain:C.i.StudentTryAgain),s}hideConversionStatus(e){e.ui.showConversionInProgress=!1,e.ui.showConversionComplete=!1,e.ui.showStudentUnavailable=!1}confirmConversionDialog(e){e.ui.showConversionComplete?this.goPeekState("course.outline",e):o(`#course-link-${e.id}`).focus(),this.hideConversionStatus(e)}goPeekState(e,s){this.ultraState.goPeekState(e,{courseId:s.id}),this.hideConversionStatus(s)}displayStatusForCompleteConversions(){this.batchEvaluateConversionStatus(this.filterCourseMemberships(this.mySelectedFilter,this.termsAndMemberships.memberships).filter((e=>!e.course.ui.isExternal&&e.course.canConvert())))}isFocusedCourse(e){return o(document.activeElement).is(a.element(o("a#course-link-"+e)))}showConversionTooltip(e){const s=this.ConversionService.isConversionComplete(e.ui.convertToUltraTaskStatus);this.changeTooltipStatus(s,e)}changeTooltipStatus(e,s){s.ui.showConversionComplete=e,s.ui.showConversionInProgress=!e}getInstructorUsers(e){e.ui=e.ui||{};let s=e.ui.cachedInstructors;return s&&e.instructorsMembership.length===e.ui.cachedInstructors.length||(s=e.instructorsMembership?e.instructorsMembership.map((e=>e.user)):[],e.ui.cachedInstructors=s),s}getCourseName(e){const s=e.course.displayName;if(this.isMultiColumnCardView()){const s=this.getCourseTitleElement(e.course.id);Object(P.a)(s)}return s}showBasicInfo(e){return e.courseIsPrivate()||e.course.appearsAsPrivate()||e.courseIsComplete()||e.course.instructorsMembership.length}showCourseStatus(e){return e.courseIsPrivate()||e.course.appearsAsPrivate()||e.courseIsComplete()}showPrivateStatus(e){return e.courseIsPrivate()||e.course.appearsAsPrivate()}showCompleteStatus(e){return e.courseIsComplete()&&!e.course.appearsAsPrivate()}getCourseTitleElement(e){const s=o(`#course-link-${e} .js-course-title-element`);return s.length?s[0]:void 0}initTermSelector(){this.availableTerms=this.loadedTermsAndMemberships.terms.map(((e,s)=>{const t=this.getTermName(e);return{index:s,name:t,nature:t,value:t}})),this.availableTerms.reverse(),this.mySelectedTerm=this.availableTerms[1]}changeTerm(e,s=!0){this.mySelectedTerm=e,this.toFocusTermSelector=s,this.courseCarousel.slick("slickGoTo",this.mySelectedTerm.index,s),this.currentPage=0,this.updateInitialPageSize()}slideToPrevTerm(){const e=this.availableTerms[this.availableTerms.length-this.slickCurrentIndex];this.changeTerm(e,!1)}slideToNextTerm(){const e=this.availableTerms[this.availableTerms.length-this.slickCurrentIndex-2];this.changeTerm(e,!1)}updateInitialPageSize(){this.initialPageSize=this.pageSize}get numberOfPages(){const e=this.activeTermMembershipsExist?this.loadedTermsAndMemberships.membershipsByTermId[this.activeTerm.id].memberships.length:0;return Math.ceil(e/this.pageSize)}get activeTermMembershipsExist(){return null!==this.loadedTermsAndMemberships.membershipsByTermId[this.activeTerm.id]}get isSmallBreakpoint(){return this.windowSizeService.isSmallBreakpoint()}get initialPageSizeString(){return this.initialPageSize.toString()}getCurrentPageFavoritesCount(e,s=this.currentPage){if(a.isUndefined(this.loadedFavorites[e.id]))return 0;const t=s*this.pageSize;return this.loadedFavorites[e.id].memberships.slice(t,t+this.pageSize).length}getLimit(e){if(Number.isNaN(Number(this.currentPage))||!this.loadedFavorites[e.id])return this.pageSize;const s=this.loadedFavorites[e.id].memberships.length;if(0===s)return this.pageSize;const t=Math.ceil(s/this.pageSize),i=this.getCurrentPageFavoritesCount(e);if(this.currentPage+1<t)return 0;return Math.abs(this.pageSize-i+this.activeFavoritePlaceHolder)}getLimitBegin(e){if(Number.isNaN(Number(this.currentPage))||a.isUndefined(this.loadedFavorites[e.id]))return 0;const s=this.currentPage*this.pageSize-this.loadedFavorites[e.id].memberships.length;return s>=0?s:0}toggleSearchInput(){this.showSearchInputInLargeDownBreakpoints=!this.showSearchInputInLargeDownBreakpoints,this.showSearchInputInLargeDownBreakpoints&&this.timeout((()=>{a.element("#course-search-input").focus()}),this.$scope,100,!1)}shouldShowSearchInput(){return this.showSearchInputInLargeDownBreakpoints||this.windowSizeService.isLargeBreakpoint()}isLargeBreakpoint(){return this.windowSizeService.isLargeBreakpoint()}getCatalogType(){return this.isBaseOrganizations?_.b:_.a}getViewPeferenceKey(){return this.isBaseOrganizations?"ultraui.courselist.view.organization":"ultraui.courselist.view.course"}getViewPreference(){return this.preferenceService.getPreference(this.getViewPeferenceKey(),q).then((e=>r.get(e,"value")||q))}setViewPreference(){if(!this.isLoading&&this._view)return this.preferenceService.setPreference(this.getViewPeferenceKey(),this.view)}getCourseCardThumbnail(e){return this.bannerThumbnailImages[e.id]}};Y.LOCAL_STORAGE_KEY_SELECTED_Filter="LOCAL_STORAGE_KEY_SELECTED_Filter",Y.MAX_FAVORITE_COURSES_LENGTH=100,Y.FAVORITE_SCORE=-1e4,Y.STRING_EMPTY="",Object(i.a)([Object(z.a)(800)],Y.prototype,"invokeBatchQueue",null),Y=Object(i.a)([Object(i.c)(0,Object(z.b)("$compile")),Object(i.c)(1,Object(z.b)("$modal")),Object(i.c)(2,Object(z.b)("$q")),Object(i.c)(3,Object(z.b)("$rootScope")),Object(i.c)(4,Object(z.b)("$scope")),Object(i.c)(5,Object(z.b)(x.c)),Object(i.c)(6,Object(z.b)(A.b)),Object(i.c)(7,Object(z.b)(c.c)),Object(i.c)(8,Object(z.b)(m.b)),Object(i.c)(9,Object(z.b)(v.b)),Object(i.c)(10,Object(z.b)(h.serviceName)),Object(i.c)(11,Object(z.b)(T.t.serviceName)),Object(i.c)(12,Object(z.b)(T.Gb.serviceName)),Object(i.c)(13,Object(z.b)(T.Jb.serviceName)),Object(i.c)(14,Object(z.b)(T.m.serviceName)),Object(i.c)(15,Object(z.b)(f.c)),Object(i.c)(16,Object(z.b)(M.b)),Object(i.c)(17,Object(z.b)(k.b)),Object(i.c)(18,Object(z.b)(I.d)),Object(i.c)(19,Object(z.b)(L.b)),Object(i.c)(20,Object(z.b)(T.nb.serviceName)),Object(i.c)(21,Object(z.b)(p.b)),Object(i.c)(22,Object(z.b)(T.l.serviceName)),Object(i.c)(23,Object(z.b)(T.b.serviceName)),Object(i.c)(24,Object(z.b)(d.b)),Object(i.c)(25,Object(z.b)(y.c)),Object(i.c)(26,Object(z.b)(U.b)),Object(i.c)(27,Object(z.b)(D.b))],Y);class Z extends Y{}},"s7x+":function(e,s){e.exports='<bb-modal class="js-course-status-modal-PREVIEW notification" modal-title-key="{{previewModalTitleKey}}"\n          modal-dismiss-key=""\n          analytics-id-tag-prefix="course.outline.previewCourse">\n  <div name="modal-contents">\n    <p bb-translate="course.outline.previewCourse.modalText" course-org-token-resolver></p>\n  </div>\n  <button name="modal-footer-button-primary" \n          ng-click="$parent.$close(\'OPEN\')" \n          class="button js-course-status-OPEN js-primary-button"\n          analytics-id="course.outline.previewCourse.open.button">\n    <span bb-translate="course.outline.previewCourse.makeOpen" course-org-token-resolver></span>\n  </button>\n  <button name="modal-footer-button-secondary" \n          ng-click="$parent.$close()" \n          class="button button--secondary js-course-status- js-secondary-button"\n          analytics-id="course.outline.previewCourse.close.button">\n    <span bb-translate="global.cancel"></span>\n  </button>\n</bb-modal>'},seHs:function(e,s,t){"use strict";t.d(s,"d",(function(){return i})),t.d(s,"b",(function(){return r})),t.d(s,"a",(function(){return o})),t.d(s,"c",(function(){return a}));const i=25,r=50,o=100,a=[i,r,o]}}]);