(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{m3mx:function(e,t,n){"use strict";var s,a=n("ERkP"),i=n("7nmT"),o=n("uDfI"),r=n("7O4Y"),c=n("np6O"),l=n("EGyI"),u=n("wgY5"),d=n.n(u),m=n("GR+8"),h=n("MC1S"),p=n("WBPx"),g=n("caKH");!function(e){e.View="view",e.Create="create",e.Edit="edit",e.Duplicate="duplicate",e.Delete="delete"}(s||(s={}));var C=s,b=n("n7/H"),S=n("ERsv"),E=n("RPob");function y(e,t){let n="";if(e&&d()(e).isValid()){const s=d()(e).toDate();if(function(e,t,n){return e>=t&&e<n}((new Date).getTime()-s.getTime(),0,864e5)){const e=t.formatDuration(s,{},b.ILocaleDateFormat.Short);n=t.translate("components.directives.duration.agoText",{durationDate:e.date||"",durationTime:e.time||""})}else n=t.formatDatetime(s,b.ILocaleDatetimeFormat.Short)}return n}const v=document.createElement("textarea");function D(e){return v.innerHTML=e,v.value}function A(e,t){e=e.replace(/"{"/g,"'{\"").replace(/"}"/g,"\"}'");let n=(new DOMParser).parseFromString(e,"text/html");const s=[{tag:"table",replacementText:`[${t.translate("course.announcements.tableWithContent")}]`}];n=Object(E.B)(n,s);return Array.from(n.getElementsByTagName("a")).forEach((e=>{const t=JSON.parse(Object(S.fixDoubleQuotesInJSONValues)(e.getAttribute("data-bbfile")));(null==t?void 0:t.alternativeText)?e.textContent=`[${t.alternativeText}]`:(null==t?void 0:t.alt)?e.textContent=`[${t.alt}]`:e.textContent=`[${e.textContent}]`})),n.body.innerHTML=n.body.innerHTML.replace(/</g," <"),(n.body.innerText||n.body.innerHTML).trim()}function f(e,t){const n=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds());return d()(n)}var k=n("myse"),I=n("Pam5"),T=n("0x+l");class N extends a.Component{constructor(e){super(e),this.timerHandler=null,this.onClickActionMenu=e=>{this.setState({target:e.currentTarget})},this.onOpenDeleteConfirmDialog=()=>{this.setState({hideDialog:!1})},this.onCloseDeleteConfirmDialog=()=>{this.setState({hideDialog:!0})},this.onOpenAnnouncement=()=>{const{courseId:e,announcement:t,permissions:n}=this.props;this.props.openAnnouncementDetailPanel(e,t.id,n)},this.onPostAnnouncement=()=>{this.setState({disablePostButton:!0});const{saveAnnouncement:e,courseId:t,announcement:n}=this.props;e(t,{...n,isDraft:!1,startDateRestriction:d()().toDate(),endDateRestriction:null}).catch((()=>this.setState({disablePostButton:!1})))},this.onEditAnnouncement=()=>{this.setState({disablePostButton:!1});const{courseId:e,announcement:t,permissions:n}=this.props;this.props.openAnnouncementDetailPanel(e,t.id,n,C.Edit)},this.onDuplicateAnnouncement=()=>{const{courseId:e,announcement:t,permissions:n}=this.props;this.props.openAnnouncementDetailPanel(e,t.id,n,C.Duplicate)},this.onDeleteAnnouncement=()=>{const{removeAnnouncement:e,announcement:t,loadAnnouncements:n,courseId:s}=this.props;e(t.courseId,t.id).then((()=>{this.onCloseDeleteConfirmDialog(),n(s,{})}))},this.isPostedAnnouncement=e=>!(e.isDraft||e.startDateRestriction&&d()(e.startDateRestriction).isAfter(d()())),this.getActionOptions=()=>{const{permissions:e,analyticsId:t,analyticsEventAugmentor:n,localize:s}=this.props,i={items:[]},o=n(k.AnalyticsEventTypes.CLICK_EVENT,this.onEditAnnouncement,t+".listItem.edit.button"),r=n(k.AnalyticsEventTypes.CLICK_EVENT,this.onDuplicateAnnouncement,t+".listItem.duplicate.button"),c=n(k.AnalyticsEventTypes.CLICK_EVENT,this.onOpenDeleteConfirmDialog,t+".listItem.delete.button");return e&&e.modify&&i.items.push({key:C.Edit,name:s.translate("course.announcements.button.edit"),icon:a.createElement(T.Edit,null),onClick:o}),e&&e.create&&i.items.push({key:C.Duplicate,name:s.translate("course.announcements.button.duplicate"),icon:a.createElement(T.Duplicate,null),onClick:r}),e&&e.delete&&i.items.push({key:C.Delete,name:s.translate("course.announcements.button.delete"),icon:a.createElement(T.Trash,null),onClick:c}),i},this.renderItemStatus=()=>{const{announcement:e,localize:t,permissions:n,analyticsId:s,isCourseAvailable:i,isCompact:o}=this.props;let r=`course.announcements.status.${this.isPostedAnnouncement(e)?"posted":"inSchedule"}.${o?"uppercase":"capitalize"}`;return e.isDraft&&(r="course.announcements.status.draft"),a.createElement("div",{className:"item-status-info"},e.isDraft&&n.modify?a.createElement(p.AnalyticsDefaultButton,{"data-automation-id":"test",onClick:this.onPostAnnouncement,disabled:!n.viewUnposted||!i||this.state.disablePostButton,analyticsId:`${s}.listItem.postNow`},t.translate("course.announcements.button.postNow")):a.createElement("div",null,a.createElement("span",{className:"list-item-status"},n.viewUnposted&&t.translate(r)),a.createElement("span",{className:"list-item-date-sent"},e.startDateRestriction&&!e.isDraft&&y(e.startDateRestriction.toISOString(),t))))},this.registerTimeoutEvent=()=>{const{debounceTime:e,onExpire:t,announcement:n}=this.props;this.timerHandler=setTimeout((()=>{t(n.id)}),e)},this.renderDialog=()=>{const{localize:e,analyticsId:t}=this.props;return a.createElement(g.c,{onDismiss:()=>{this.setState({hideDialog:!0})},showAsCallout:!this.state.hideDialog,target:this.state.target,dialogContentProps:{type:h.DialogType.actionConfirmation,title:e.translate("course.announcements.dialogText.deleteAnnouncement"),subText:e.translate("course.announcements.dialogText.confirmDeleteAnnouncement"),showCloseButton:!1},analyticsId:t+".listItem.deleteDialog"},a.createElement(h.DialogFooter,null,a.createElement(p.AnalyticsDefaultButton,{onClick:this.onCloseDeleteConfirmDialog,analyticsId:t+".listItem.deleteDialog.cancel.button"},e.translate("course.announcements.button.cancel")),a.createElement(p.AnalyticsPrimaryButton,{onClick:this.onDeleteAnnouncement,className:"deleteConfirmBtn",analyticsId:t+".listItem.deleteDialog.confirm.button"},e.translate("course.announcements.button.delete"))))},this.state={hideDialog:!0,target:null,disablePostButton:!1}}componentDidMount(){this.props.isNewlyCreated&&this.registerTimeoutEvent()}componentDidUpdate(e){!e.isNewlyCreated&&this.props.isNewlyCreated&&this.registerTimeoutEvent()}componentWillUnmount(){this.timerHandler&&clearTimeout(this.timerHandler)}render(){const{announcement:e,localize:t,permissions:n,isNewlyCreated:s,analyticsId:i,analyticsEventAugmentor:o,isCompact:r}=this.props,c=this.getActionOptions(),l=o(k.AnalyticsEventTypes.CLICK_EVENT,this.onOpenAnnouncement,i+".listItem.open.link");return a.createElement("tr",{className:"announcement-item-row "+(s?"is-new":""),role:"row"},a.createElement("td",{className:"announcement-header-column "+(n.viewUnposted?"small-1-2":"large-1"),role:"gridcell"},a.createElement("div",{className:"announcement-header"},a.createElement("div",{className:"small-1-1 announcement-icon"+(e.isDraft?" is-restricted":"")},a.createElement("div",{className:"element-image"},a.createElement(I.a,{color:"primary"}))),a.createElement("div",{className:"click-message-detail"},a.createElement("div",{className:"announcement-title-detail"},a.createElement("a",{className:`list-item-title ${n.viewUnposted?"entitled":""} `,href:"#","data-analytics-id":`${i}.listItem.open.link`,onClick:l},D(e.title)),e.isDraft&&a.createElement("span",{className:"draft-status one-line"},t.translate("course.announcements.status.draft"))),a.createElement("a",{className:"list-item-body "+(n.viewUnposted?"one-line":"three-lines multiple-line-ellipsis"),href:"#",onClick:this.onOpenAnnouncement},e.body&&A(e.body.rawText,this.props.localize))),r&&this.renderItemStatus())),!r&&a.createElement("td",{className:"announcement-status-column",role:"gridcell"}," ",this.renderItemStatus()," "),n.viewUnposted&&a.createElement("td",{className:"announcement-viewers-column",role:"gridcell"},a.createElement("div",{className:"announcement-viewers",onClick:this.onClickActionMenu},a.createElement("span",{className:"list-item-view-count"},e.readCount||0," / ",e.totalParticipants),c&&c.items&&c.items.length>0&&a.createElement(h.ActionMenu,{ariaLabel:`${t.translate("course.announcements.moreOptions",{announcementTitle:e.title})}`,className:"announcement-item-action-menu",disabled:!this.state.hideDialog,menuProps:c,maintainExpandedProperties:!this.state.hideDialog,analyticsId:i+".listItem.actionMenu"}),this.renderDialog())))}}var w=Object(k.withAnalytics)(Object(m.a)(N)),P=n("AuQm"),x=n("nsO7");class O extends a.PureComponent{constructor(e){super(e),this.debouncedSearch=x.debounce((()=>{const{courseId:e,notifyStateChange:t,searchAnnouncements:n}=this.props;this.setState({shouldNotify:!0}),this.state.isValidSearch&&n(e,{searchText:encodeURIComponent(this.state.text.trim())})}),this.props.debounceTime),this.focusElement=e=>{e.focus()},this.shouldStartSearching=e=>!e.trim().length||e.trim().length>=this.props.minCharToStartSearching,this.showCharacterInsufficient=e=>!!e.trim()&&e.trim().length<this.props.minCharToStartSearching,this.handleSearchTextChange=e=>{const t=e.target.value;this.setState({text:t,isValidSearch:this.shouldStartSearching(t),shouldNotify:!1}),this.debouncedSearch()},this.handleEnterToSearch=e=>{const{searchAnnouncements:t,courseId:n,notifyStateChange:s}=this.props;"Enter"===e.key&&(this.setState((e=>({isValidSearch:e.text.trim().length>0}))),this.state.isValidSearch&&(s(this.state.text,this.state.isCollapsed,this.state.isValidSearch),t(n,{searchText:encodeURIComponent(this.state.text.trim())})))},this.closeSearchInput=()=>{this.setState({text:"",isCollapsed:!0,isValidSearch:!1})},this.state={text:"",isCollapsed:!1,isValidSearch:!1,shouldNotify:!0}}UNSAFE_componentWillReceiveProps(e){e.isCollapsed&&!e.searchText.trim().length&&this.debouncedSearch.cancel(),this.setState({text:e.searchText,isCollapsed:e.isCollapsed})}componentDidUpdate(e,t){const{isCollapsed:n,notifyStateChange:s}=this.props;!0===e.isCollapsed&&n!==e.isCollapsed&&this.focusElement(this.searchInput),this.showCharacterInsufficient(this.state.text)?this.searchInput.addEventListener("keyup",this.handleEnterToSearch):this.searchInput.removeEventListener("keyup",this.handleEnterToSearch),this.state.shouldNotify&&s(this.state.text,this.state.isCollapsed,this.state.isValidSearch)}render(){const{t:e,analyticsId:t,analyticsEventAugmentor:n}=this.props,s=n(k.AnalyticsEventTypes.CLICK_EVENT,(()=>{}),t);return a.createElement("div",{className:"search-input-wrap","data-analytics-id":t},a.createElement(T.Search,{className:"search-icon"}),a.createElement("label",{className:"sr-only",htmlFor:"search-input"},this.props.placeHolder),a.createElement("input",{className:"left",id:"search-input",onChange:this.handleSearchTextChange,placeholder:this.props.placeHolder,ref:e=>{this.searchInput=e},type:"text",value:this.state.text,onClick:s}),a.createElement(c.AnalyticsIconButton,{"aria-label":e("course.announcements.button.closeSearch"),className:"search-controls button super-clear",onClick:this.closeSearchInput,title:e("course.announcements.button.closeSearch"),analyticsId:"course.announcements.listPanel.closeSearch.button"},a.createElement(T.Clear,null)))}}var M=Object(k.withAnalytics)(Object(l.a)(O)),V=n("zGdY");class B extends a.PureComponent{constructor(){super(...arguments),this.getArrowDirection=()=>{const{currentSort:e,sortField:t}=this.props;return t&&(null==e?void 0:e.field)===t?(this.localSort=e,this.isDescendingSort(e)?"arrow-down":"arrow-up"):""},this.updateSortCriteria=()=>{const{sortField:e,onSwitchSortCriteria:t}=this.props;this.localSort?this.localSort={field:e,direction:this.localSort.direction===V.cc.Ascending?V.cc.Descending:V.cc.Ascending}:this.localSort={field:e,direction:V.cc.Ascending},t(this.localSort)},this.isDescendingSort=e=>e.direction===V.cc.Descending}render(){const{t:e,viewText:t,analyticsId:n,analyticsEventAugmentor:s}=this.props,i=s(k.AnalyticsEventTypes.CLICK_EVENT,this.updateSortCriteria,n);return a.createElement(a.Fragment,null,a.createElement("button",{id:`sort-by-${t}-button`,className:"active clear",onClick:i,"data-analytics-id":n},a.createElement("span",{className:"sort-description"},e(`course.announcements.sort.${t}.description`)),a.createElement("div",{className:"sort-list-arrows "+this.getArrowDirection(),role:"presentation"},a.createElement("div",{className:"sort-list-arrow-up"}),a.createElement("div",{className:"sort-list-arrow-down"}))))}}var j,R=Object(k.withAnalytics)(Object(l.a)(B));!function(e){e.Ascending="ascending",e.Descending="descending",e.None="none",e.Other="other"}(j||(j={}));var L=j,U=n("50Q+"),F=n("Y+9S"),z=n("E1pj"),H=n("8jBL"),W=n("IbyE"),_=n("9OUN");class $ extends a.PureComponent{constructor(){super(...arguments),this.renderAnnouncementItem=e=>{const{courseId:t,courseContext:n,openAnnouncementDetailPanel:s,permissions:i,removeAnnouncement:o,saveAnnouncement:r,recentUpdatedAnnouncementIds:c,removeFromRecentUpdated:l,UltraWindowSize:u}=this.props,d=Object.values(this.props.announcements)[e];return a.createElement(w,{announcement:d,courseId:t,debounceTime:2e3,isCompact:null==u?void 0:u.isSmallBreakpoint(),isCourseAvailable:n.isAvailable,isNewlyCreated:c&&c.indexOf(d.id)>-1,key:d.id,onExpire:l,openAnnouncementDetailPanel:s,permissions:i,removeAnnouncement:o,saveAnnouncement:r,loadAnnouncements:this.loadAnnByCurrentSettings,analyticsId:"course.announcements.listPanel"})},this.loadMore=()=>{const{announcements:e,paging:t,loadAnnouncements:n,courseId:s,searchInputState:a,sortCriteria:i}=this.props,o=a.searchText;n(s,{paging:{offset:Object.keys(e).length,limit:t.limit},searchText:o,sort:i},!0)},this.searchInputStateChange=(e,t,n)=>{const{searchInputState:s,changeSearchInputState:a}=this.props;t&&t!==s.isCollapsed?this.onToggleSearchInput():e===s.searchText&&t===s.isCollapsed&&n===s.isValidSearch||a({searchText:e,isCollapsed:t,isValidSearch:n})},this.onToggleSearchInput=()=>{const{courseId:e,searchInputState:t,changeSearchInputState:n}=this.props,s=!t.isCollapsed,a=s?"":t.searchText;n({searchText:a,isCollapsed:s}),s&&t.searchText.trim().length>0&&this.loadAnnByCurrentSettings(e,{searchText:a})},this.onSwitchSortCriteria=e=>{const{courseId:t,switchSortCriteria:n}=this.props;n([e]),this.loadAnnByCurrentSettings(t,{sort:[e]})},this.sortAriaValueForAnnouncement=e=>{const t=e[0];return(null==t?void 0:t.field)===V.db.Title?t.direction===V.cc.Ascending?L.Ascending:L.Descending:L.None},this.sortAriaValueByStatus=e=>{const t=e[0];return(null==t?void 0:t.field)===V.db.Status?t.direction===V.cc.Ascending?L.Ascending:L.Descending:L.None},this.sortAriaValueByViewers=e=>{const t=e[0];return(null==t?void 0:t.field)===V.db.ReadCount?t.direction===V.cc.Ascending?L.Ascending:L.Descending:L.None},this.onCreateAnnouncement=()=>{this.props.openAnnouncementDetailPanel(this.props.courseId,null,this.props.permissions,C.Create)},this.loadAnnByCurrentSettings=(e,t)=>{const{announcements:n,searchInputState:s,loadAnnouncements:a,sortCriteria:i}=this.props,o=t||{},r=null!=o.searchText?o.searchText:!s.isCollapsed&&s.searchText.trim()||"",c=o.sort||i,l=n&&Object.keys(n).length||0;a(e,{searchText:r,paging:{limit:o.limit||Math.max(l,10),offset:o.offset||0},sort:c})},this.renderNoResultString=e=>{const{searchInputState:t,t:n,isLoading:s,paging:i,isSearchingSuccessful:o,courseContext:r}=this.props;return t.searchText?e?a.createElement("p",{className:"search-insufficient","aria-live":"assertive"},n("course.announcements.characterInsufficient")):o&&a.createElement("p",{className:"search-no-results ng-scope","aria-live":"assertive"},n("course.announcements.noSearchResult")):!s&&0===(null==i?void 0:i.count)&&t.isCollapsed&&a.createElement("p",{className:"search-no-results ng-scope"},n(Object(U.r)("announcements.noResult",null==r?void 0:r.isOrganization)))},this.getMessageAnnouncementInCourse=()=>{const{t:e,announcementsCounts:t,announcements:n}=this.props;return e("course.announcements.totalAnnouncementInCourse",{filterCount:Object.values(n).length,announcementCount:t.draftCount+t.postedCount+t.scheduledCount})},this.renderAnnouncementListView=e=>{const{t,searchInputState:n,sortCriteria:s,isSearchingSuccessful:i,permissions:o,courseContext:c,UltraWindowSize:l}=this.props,u=n.searchText.trim(),d=!n.isCollapsed&&u.length&&u.length<2&&!n.isValidSearch;return e>0&&!d?a.createElement("div",{className:Object(r.a)("tabular-list-container",{"-with-seach-bar":!n.isCollapsed})},a.createElement("div",{className:"tabular-list"},a.createElement("table",{className:"table-content sortable-table",role:"grid","aria-readonly":!0,"aria-labelledby":"announcement-table-caption"},a.createElement("caption",{id:"announcement-table-caption",className:"sr-only"},t(Object(U.r)("announcements.pageTitle",null==c?void 0:c.isOrganization))),a.createElement("thead",{className:"list-item-columns announcement-sort-header"},a.createElement("tr",{className:"list-item-row announcement-sort-row",role:"row"},a.createElement("th",{className:"column-title sort",role:"columnheader",id:"title","aria-sort":this.sortAriaValueForAnnouncement(s)},a.createElement(R,{courseId:this.props.courseId,currentSort:s[0],onSwitchSortCriteria:this.onSwitchSortCriteria,sortField:V.db.Title,viewText:"title",analyticsId:"course.announcements.listPanel.sortByTitle.button"})),!l.isSmallBreakpoint()&&a.createElement("th",{className:`column-${o.viewUnposted?"status":"date"} sort`,role:"columnheader",id:o.viewUnposted?"status":"date","aria-sort":this.sortAriaValueByStatus(s)},a.createElement(R,{courseId:this.props.courseId,currentSort:s[0],onSwitchSortCriteria:this.onSwitchSortCriteria,sortField:o.viewUnposted?V.db.Status:V.db.StartDateRestriction,viewText:t(o.viewUnposted?"status":"date"),analyticsId:"course.announcements.listPanel.sortByDate.button"})),o.viewUnposted&&a.createElement("th",{className:"column-viewers sort",role:"columnheader",id:"viewers","aria-sort":this.sortAriaValueByViewers(s)},a.createElement(R,{courseId:this.props.courseId,currentSort:s[0],onSwitchSortCriteria:this.onSwitchSortCriteria,sortField:V.db.ReadCount,viewText:"viewers",analyticsId:"course.announcements.listPanel.sortByViews.button"})))),a.createElement("tbody",null,Object.values(this.props.announcements).map(((e,t)=>a.createElement(a.Fragment,null,this.renderAnnouncementItem(t))))),n.isValidSearch&&i&&a.createElement("div",{"aria-live":"polite","aria-hidden":!1,className:"sr-only",role:"status"},t("course.announcements.searchResults"))),this.renderScroll()),a.createElement("span",{role:"status",className:"sr-only"},this.getMessageAnnouncementInCourse())):a.createElement("div",{className:"columns small-12 no-result-section"},a.createElement("div",{className:"row"},a.createElement("div",{className:"columns small-12 small-centered text-center ftue-container"},this.renderNoResultString(d))))}}componentDidMount(){const{courseId:e,courseContext:t,getAnnouncementsCounts:n,getCourseContext:s,permissions:a,switchSortCriteria:i}=this.props;if(Object(F.m)()){const e={type:F.c.AnnouncementListOpened,status:F.b.Success,permission:{search:!0}},t=Object(F.q)(e);t.response.subscribe((e=>{e.event===F.a.Search&&this.onToggleSearchInput()})),this.correlationId=t.correlationId}const o=a.viewUnposted?[{field:V.db.ModifiedDate,direction:V.cc.Descending}]:[{field:V.db.StartDateRestriction,direction:V.cc.Descending}];i(o),this.loadAnnByCurrentSettings(e,{sort:o}),n(e),t&&t.courseId===e||s(e)}componentDidUpdate(e){this.props.listener.refreshAnnouncementsCounts&&!e.listener.refreshAnnouncementsCounts&&this.props.getAnnouncementsCounts(this.props.courseId),this.props.listener.resetSortSetting&&!e.listener.resetSortSetting&&this.props.switchSortCriteria([{field:V.db.ModifiedDate,direction:V.cc.Descending}]),this.props.listener.resetSearchSetting&&!e.listener.resetSearchSetting&&this.props.changeSearchInputState({searchText:"",isCollapsed:!0}),this.props.listener.refreshAnnouncements&&!e.listener.refreshAnnouncements&&this.props.loadAnnouncements(this.props.courseId,{searchText:this.props.searchInputState.searchText})}componentWillUnmount(){const{root:e,clearAnnouncements:t}=this.props;Object(F.m)()&&Object(F.f)(this.correlationId),t()}renderScroll(){const{paging:e,isLoading:t}=this.props,n=!t&&(null==e?void 0:e.count)>Object.keys(this.props.announcements).length;return n&&a.createElement(P.Y,{loader:this.loadMore,hasMore:n})}render(){const{announcements:e,paging:t,permissions:n,searchInputState:s,courseId:i,courseContext:o,t:r,announcementsCounts:l,UltraWindowSize:u}=this.props,d=e&&Object.keys(e).length||0,m=(null==u?void 0:u.isMediumBreakpoint())||(null==u?void 0:u.isSmallBreakpoint());return a.createElement("div",{className:"page-announcement course-announcement-layer"},a.createElement("div",{className:"panel-wrap"},a.createElement("header",{className:"panel-header simple-header"},a.createElement("div",{className:"panel-titles-container"},a.createElement("span",{className:"panel-sub-title"},o&&o.displayName||""),a.createElement("div",{className:"editable-title-container black-header-contents"},a.createElement(c.AnalyticsIconButton,{"aria-label":r("base.menu"),className:"left-off-canvas-toggle menu-toggle  standard-button dark-background",title:r("base.menu"),analyticsId:"course.announcements.listPanel.menu.button"},a.createElement(T.MainMenu,null)),a.createElement("h1",{className:"panel-title"},r(Object(U.r)("announcements.pageTitle",null==o?void 0:o.isOrganization))))),a.createElement("div",{className:"header-actions-menu__item active no-select"},a.createElement("div",{className:"active no-select"},a.createElement(c.AnalyticsIconButton,{"aria-label":r("course.announcements.search.placeHolder"),className:"anchor-button",id:"search-button",onClick:this.onToggleSearchInput,title:r("course.announcements.search.placeHolder"),analyticsId:"course.announcements.listPanel.search.button"},m?a.createElement(T.Search,null):a.createElement(H.Search,null))))),a.createElement("div",{className:"guidance-wrapper "+(s.isCollapsed?"":"hide")},l&&(null==t?void 0:t.count)>=0&&a.createElement("span",null,n.viewUnposted?r("course.announcements.guidance.instructor",{postedCount:l.postedCount||0,scheduledCount:l.scheduledCount||0})+r("course.announcements.guidance.draftCount.plural",{draftCount:l.draftCount||0}):r("course.announcements.guidance.student",{totalCount:(null==t?void 0:t.count)||0})),n.create&&a.createElement(c.AnalyticsIconButton,{"aria-label":r("course.announcements.createAnnouncement"),className:"create-announcement",onClick:this.onCreateAnnouncement,title:r("course.announcements.createAnnouncement"),analyticsId:"course.announcements.listPanel.create.button"},m?a.createElement(T.Add,null):a.createElement(H.AddCircle,null))),a.createElement("div",{className:"panel-content"},a.createElement("div",{className:"row collapse "+(s.isCollapsed?"hide":""),id:"announcement-search"},a.createElement(M,{courseId:i,debounceTime:1500,isCollapsed:s.isCollapsed,minCharToStartSearching:2,notifyStateChange:this.searchInputStateChange,placeHolder:r("course.announcements.search.placeHolder"),searchAnnouncements:this.loadAnnByCurrentSettings,searchText:s.searchText,analyticsId:"course.announcements.listPanel.search.input.text"})),a.createElement("div",{className:"row collapse"},this.renderAnnouncementListView(d),this.props.isLoading?a.createElement("div",{className:"spinner bb-secondary-color-2"}):""))))}}var X=Object(o.b)((e=>({announcements:e.announcement.announcements,isLoading:e.announcement.isLoading,isSearchingSuccessful:e.announcement.isSearchingSuccessful,searchInputState:e.announcement.searchInputState,paging:e.announcement.paging,announcementsCounts:e.announcement.announcementsCounts,courseContext:e.announcement.courseContext,sortCriteria:e.announcement.sortCriteria,listener:e.announcement.listener,recentUpdatedAnnouncementIds:e.announcement.recentUpdatedAnnouncementIds})),(e=>Object(_.b)({loadAnnouncements:W.X.announcement.loadAnnouncements,removeAnnouncement:W.X.announcement.removeAnnouncement,saveAnnouncement:W.X.announcement.saveAnnouncement,changeSearchInputState:W.X.announcement.changeSearchInputState,getAnnouncementsCounts:W.X.announcement.getAnnouncementsCounts,getCourseContext:W.X.announcement.getCourseContext,switchSortCriteria:W.X.announcement.switchSortCriteria,clearAnnouncements:W.X.announcement.clearAnnouncements,removeFromRecentUpdated:W.X.announcement.removeFromRecentUpdated},e)))(Object(z.windowResizingResponsiveComponentWrapper)(Object(l.a)($))),Y=n("tN4z");const q=e=>({months:[e("course.announcements.datePicker.months.january"),e("course.announcements.datePicker.months.february"),e("course.announcements.datePicker.months.march"),e("course.announcements.datePicker.months.april"),e("course.announcements.datePicker.months.may"),e("course.announcements.datePicker.months.june"),e("course.announcements.datePicker.months.july"),e("course.announcements.datePicker.months.august"),e("course.announcements.datePicker.months.september"),e("course.announcements.datePicker.months.october"),e("course.announcements.datePicker.months.november"),e("course.announcements.datePicker.months.december")],shortMonths:[e("course.announcements.datePicker.shortMonths.january"),e("course.announcements.datePicker.shortMonths.february"),e("course.announcements.datePicker.shortMonths.march"),e("course.announcements.datePicker.shortMonths.april"),e("course.announcements.datePicker.shortMonths.may"),e("course.announcements.datePicker.shortMonths.june"),e("course.announcements.datePicker.shortMonths.july"),e("course.announcements.datePicker.shortMonths.august"),e("course.announcements.datePicker.shortMonths.september"),e("course.announcements.datePicker.shortMonths.october"),e("course.announcements.datePicker.shortMonths.november"),e("course.announcements.datePicker.shortMonths.december")],days:[e("course.announcements.datePicker.days.sunday"),e("course.announcements.datePicker.days.monday"),e("course.announcements.datePicker.days.tuesday"),e("course.announcements.datePicker.days.wednesday"),e("course.announcements.datePicker.days.thursday"),e("course.announcements.datePicker.days.friday"),e("course.announcements.datePicker.days.saturday")],shortDays:[e("course.announcements.datePicker.shortDays.sunday"),e("course.announcements.datePicker.shortDays.monday"),e("course.announcements.datePicker.shortDays.tuesday"),e("course.announcements.datePicker.shortDays.wednesday"),e("course.announcements.datePicker.shortDays.thursday"),e("course.announcements.datePicker.shortDays.friday"),e("course.announcements.datePicker.shortDays.saturday")],goToToday:e("course.announcements.datePicker.goToToday"),prevMonthAriaLabel:e("course.announcements.datePicker.prevMonthAriaLabel"),nextMonthAriaLabel:e("course.announcements.datePicker.nextMonthAriaLabel"),prevYearAriaLabel:e("course.announcements.datePicker.prevYearAriaLabel"),nextYearAriaLabel:e("course.announcements.datePicker.nextYearAriaLabel")});class K extends a.PureComponent{constructor(e){super(e),this.timeoutPromiseWrapper=(e,t,n)=>new Promise((s=>{e.apply(this,t),setTimeout((()=>{const a=e.apply(n,t);s(a)}))})),this.errorMessage=()=>{const{isValueValid:e,errorEmptyMessage:t,errorFormatMessage:n}=this.props;if(!e){let e=n;return this.state.uiDateStr||(e=t),a.createElement("span",{className:"error-message"},a.createElement(T.Attention,null),e)}return null},this.toggleCalendar=()=>{this.setState((e=>({isDisplayCalendar:!e.isDisplayCalendar})),(()=>{this.state.isDisplayCalendar&&setTimeout((()=>{this.calRef.focus()}),100)}))},this.onSelectDate=e=>{const{localize:t,onChangeValue:n}=this.props;this.timeoutPromiseWrapper(t.formatDate,[e,b.ILocaleDateFormat.Short],t).then((t=>{n(e),this.setState({uiDateStr:t}),this.toggleCalendar()}))},this.onTypeDate=e=>{this.setState({uiDateStr:e.target.value})},this.onHandleBlur=()=>{var e,t;const{uiDateStr:n}=this.state,{onChangeValue:s,localize:a}=this.props;setTimeout((()=>{this.datePickerRef.contains(document.activeElement)||this.setState({isDisplayCalendar:!1})}));const i=this.timeoutPromiseWrapper(a.parseDate,[n,b.ILocaleDateFormat.Short],a).then((e=>{e&&s(e)}));null===(t=(e=this.props).onDateTimeChanging)||void 0===t||t.call(e,i)},this.state={isDisplayCalendar:!1,uiDateStr:""}}componentDidMount(){const{value:e,onChangeValue:t,localize:n}=this.props;e&&this.timeoutPromiseWrapper(n.formatDate,[e,b.ILocaleDateFormat.Short],n).then((n=>{t(e),this.setState({uiDateStr:n})}))}componentDidUpdate(e,t){const{uiDateStr:n}=this.state,{value:s,onValidateCallback:a,disabled:i,localize:o}=this.props;s&&s!==e.value&&this.timeoutPromiseWrapper(o.formatDate,[s,b.ILocaleDateFormat.Short],o).then((e=>{this.setState({uiDateStr:e}),a(!0)})),s||s===e.value||(this.setState({uiDateStr:""}),a(!0)),this.state.uiDateStr===t.uiDateStr||i||this.timeoutPromiseWrapper(o.parseDate,[n,b.ILocaleDateFormat.Short],o).then((e=>{a(!!e)}))}render(){const{isDisplayCalendar:e,uiDateStr:t}=this.state,{value:n,disabled:s,localize:{translate:i},analyticsId:o,analyticsEventAugmentor:r}=this.props,l=r(k.AnalyticsEventTypes.CLICK_EVENT,(()=>{}),o+".input.text");return a.createElement("div",{ref:e=>this.datePickerRef=e,className:"date-picker"},a.createElement("div",{className:"calendar-input-container",id:`${o}.input.text`,"data-analytics-id":`${o}.input.text`},a.createElement("input",{"aria-labelledby":`${o}.input.text`,className:"date-input",ref:e=>this.dateInputRef=e,type:"text",value:t,onChange:this.onTypeDate,disabled:s,onClick:l,onBlur:this.onHandleBlur}),a.createElement(c.AnalyticsIconButton,{"aria-label":i("course.announcements.datePicker.dueDate"),className:"btn-date open-datepicker",disabled:s,onClick:this.toggleCalendar,title:i("course.announcements.datePicker.dueDate"),analyticsId:o+".open.button"},a.createElement(T.Calendar,null)),this.errorMessage()),e&&a.createElement(h.Callout,{target:this.dateInputRef,doNotLayer:!0,directionalHint:5,isBeakVisible:!1,gapSpace:0,setInitialFocus:!1},a.createElement(h.Calendar,{componentRef:e=>this.calRef=e,className:"date-picker-dropdown",value:n,strings:q(i),isMonthPickerVisible:!1,showGoToToday:!1,onSelectDate:this.onSelectDate,analyticsId:o+".calendar"})))}}var G=Object(k.withAnalytics)(Object(m.a)(K));class J extends a.Component{constructor(){super(...arguments),this.getEditorElement=()=>document.querySelector(".bb-editor"),this.prepareEditorPlugins=()=>{const{localize:e,editor:t,fileUploadSettings:n}=this.props,s={...t.pluginConfig,babelfishFormatInstance:e.babelfishFormat,babelfishInstance:e.babelfish,apiBasePath:W.kb.apiBasePath,locale:e.locale,xsrfToken:W.kb.xsrf,fileUploadSettings:n},a=[Object(S.link)(),Object(S.image)(),Object(S.video)(),Object(S.insertLocalFile)(s),Object(S.videoEverywhere)(s)];return s.openCloudStorageIntegrationModal&&a.push(Object(S.insertCloudStorageIntegrationFile)({openCloudStorageIntegrationModal:s.openCloudStorageIntegrationModal,...s})),s.getEmbedSrc&&a.push(Object(S.insertYoutubeVideo)({getEmbedSrc:s.getEmbedSrc,...s})),a},this.focusEditor=()=>{const e=this.getEditorElement();e&&e.focus()}}componentDidMount(){this.props.editor.isReadOnly||this.focusEditor()}shouldComponentUpdate(e){return Object(x.differenceWith)([e.editor],[this.props.editor],x.isEqual).length>0}componentDidUpdate(){this.props.editor.isReadOnly||this.focusEditor()}render(){const{editor:e}=this.props,t=this.prepareEditorPlugins();return a.createElement(S.BbEditor,{...e,plugins:t})}}const Q=Object(m.a)(J),Z=256;class ee extends a.Component{constructor(e){super(e),this.mappingAnnouncementToState=e=>{const{courseId:t,courseContext:n,getCourseContext:s}=this.props;if(e){const{title:t="",startDateRestriction:n,endDateRestriction:s,isDraft:a,pushNotify:i}=e,o=e.body&&e.body.rawText||"";this.setState({currentBbml:o,currentAnnouncement:e,title:t,isValid:!!t.trim()&&!!o.trim(),isDraft:a,isSendEmailChecked:i}),a||(i||this.setState({isScheduleChecked:!0,isShowOnChecked:!0,startDate:d()(n).toDate(),startTime:d()(n).toDate()}),s&&this.setState({isEndChecked:!0,endDate:d()(s).toDate(),endTime:d()(s).toDate()}))}this.notifyMobileApp(e),n&&n.courseId===t||s(t);const a=this.getMode();this.titleTextField&&this.isEditableMode(a)&&this.titleTextField.focus(),this.updateAnnouncementPanelState(C.Duplicate===a,!1)},this.notifyMobileApp=e=>{const t={type:F.c.AnnouncementDetailOpened,status:F.b.Success,pageTitle:this.getTitle(e)};Object(F.r)(t)},this.getMode=()=>this.props.mode||C.View,this.isEditableMode=e=>C.Edit===e||C.Duplicate===e||C.Create===e,this.onTitleChange=e=>{this.setState((t=>({title:e,isTitleInputPristine:!1,isValid:!!e.trim()&&e.trim().length<=Z&&!!t.currentBbml.trim()}))),this.updateAnnouncementPanelState(!!e.trim())},this.onMessageChange=e=>{const{currentAnnouncement:t,isMessageEditorPristine:n}=this.state,s=e.toBbML();this.setState((e=>({currentBbml:s,isMessageEditorPristine:!1,isValid:!!s.trim()&&!!e.title.trim()&&e.title.trim().length<=Z}))),t&&!n?this.updateAnnouncementPanelState(t.body.rawText!==s):t||this.updateAnnouncementPanelState(!!s)},this.onTitleErrorMessage=e=>{const{isTitleInputPristine:t}=this.state,{t:n}=this.props;let s="";return t||e.trim().length?!t&&e.trim().length>Z&&(s=n("course.announcements.errors.messages.titleMaxlength",{maxLength:Z})):s=n("course.announcements.errors.messages.titleRequired"),s},this.onSave=async()=>{if(this.state.isSaving)return;this.setState({isSaving:!0}),await this.state.onDateTimeChangingPromise;const e=this.getMode();let{currentAnnouncement:t}=this.state;const{currentBbml:n,title:s,isSendEmailChecked:a,isScheduleChecked:i,isShowOnChecked:o,isEndChecked:r,startDate:c,startTime:l,endDate:u,endTime:d}=this.state,{courseId:m,saveAnnouncement:h,closePanel:p}=this.props;if(c&&l&&c.setHours(l.getHours(),l.getMinutes(),l.getSeconds()),u&&d&&u.setHours(d.getHours(),d.getMinutes(),d.getSeconds()),t||C.Create!==e){if(C.Duplicate!==e&&C.Edit!==e)return console.error("Failed to save announcement!"),void this.setState({isSaving:!1});{const m={...t.body,rawText:n};t={...t,title:s,body:m},C.Duplicate===e&&(t={...t,isDraft:!0,id:null}),t.pushNotify=a,i?(t.isDraft=!1,o&&(t.startDateRestriction=f(c,l).toDate()),t.endDateRestriction=r?f(u,d).toDate():null):(t.isDraft=!0,t.startDateRestriction=null,t.endDateRestriction=null)}}else t={},t.isDraft=!0,t.title=s,t.body={rawText:n},t.pushNotify=a,i&&(t.isDraft=!1,o&&(t.startDateRestriction=f(c,l).toDate()),t.endDateRestriction=r?f(u,d).toDate():null);h(m,t).then((()=>{this.updateAnnouncementPanelState(!1,!0),p()}))},this.onCancel=()=>{this.props.closePanel()},this.validateInputs=()=>!!this.state.title.trim()&&!!this.state.currentBbml.trim()&&this.state.title.trim().length<=Z,this.validateSchedule=()=>{const{isScheduleChecked:e,isShowOnChecked:t,isEndChecked:n,isStartDateValid:s,isStartTimeValid:a,isEndDateValid:i,isEndTimeValid:o}=this.state;if(e){if(t&&(!s||!a))return!1;if(n&&(!i||!o))return!1}return!0},this.onSendEmailChange=()=>{this.updateAnnouncementPanelState(!0),this.setState((e=>({isSendEmailChecked:!e.isSendEmailChecked})))},this.onScheduleChange=()=>{this.updateAnnouncementPanelState(!0),this.setState((e=>({isScheduleChecked:!e.isScheduleChecked,isShowOnChecked:!e.isScheduleChecked&&!e.isSendEmailChecked})))},this.onShowOnChange=()=>{this.setState((e=>({isShowOnChecked:!e.isShowOnChecked}))),this.updateAnnouncementPanelState(!0)},this.onHideOnChange=()=>{this.setState((e=>({isEndChecked:!e.isEndChecked}))),this.updateAnnouncementPanelState(!0)},this.isEndLaterThanStart=()=>{const{isScheduleChecked:e,isEndChecked:t,isStartDateValid:n,isStartTimeValid:s,isEndDateValid:a,isEndTimeValid:i,startDate:o,startTime:r,endDate:c,endTime:l}=this.state;return!(e&&t&&n&&s&&a&&i&&o&&r&&c&&l)||f(c,l).diff(f(o,r))>0},this.state={currentBbml:"",currentAnnouncement:null,title:"",isMessageEditorPristine:!0,isTitleInputPristine:!0,isSaving:!1,isValid:!1,isDraft:!1,isSendEmailChecked:!1,isScheduleChecked:!1,isShowOnChecked:!1,isEndChecked:!1,startDate:null,startTime:null,endDate:null,endTime:null,isStartDateValid:!0,isStartTimeValid:!0,isEndDateValid:!0,isEndTimeValid:!0,onDateTimeChangingPromise:Promise.resolve()}}componentDidMount(){const{courseId:e,announcementId:t,announcements:n,announcement:s,getAnnouncement:a,permissions:i}=this.props;C.Create===this.getMode()?i.create?this.mappingAnnouncementToState(null):console.error("User is not authorized to create announcement!"):n&&n[t]?this.mappingAnnouncementToState(n[t]):s&&s.id===t?this.mappingAnnouncementToState(s):t?a(e,t).then((()=>{this.mappingAnnouncementToState(this.props.announcement)})):console.error("Unexpected behavior!")}componentDidUpdate(e,t){const{isScheduleChecked:n,isShowOnChecked:s,isSendEmailChecked:a}=this.state;if((t.isScheduleChecked!==n&&n||t.isShowOnChecked!==s&&s)&&!a&&(this.state.startDate&&this.state.startTime||this.setState({startDate:d()().toDate(),startTime:d()().toDate()})),t.isSendEmailChecked!==a&&a&&(this.state.startDate||this.state.startTime)&&this.setState({startDate:null,startTime:null}),this.state.isEndChecked!==t.isEndChecked&&this.state.isEndChecked&&(!this.state.endDate||!this.state.endTime)){const{startDate:e,startTime:t}=this.state;if(e&&t)this.setState({endDate:d()(e).add(1,"days").toDate(),endTime:d()(t).add(1,"days").toDate()});else{const e=d()().toDate();this.setState({endDate:d()(e).add(1,"days").toDate(),endTime:d()(e).add(1,"days").toDate()})}}}getTitle(e){const t=this.getMode(),{t:n}=this.props;let s=e&&D(e.title)||"";return C.Create===t?s=n("course.announcements.newAnnouncement"):C.Edit===t?s=n("course.announcements.editAnnouncement",{announcement:s}):C.Duplicate===t&&(s=n("course.announcements.copyAnnouncement",{announcement:s})),s}updateAnnouncementPanelState(e,t=!1){this.props.changeAnnouncementPanelState({isDirty:e,isSaved:t})}get isEditorInputValid(){const{currentBbml:e,isMessageEditorPristine:t}=this.state;return t||e.length>0}renderBbEditorErrorMessage(){return this.isEditorInputValid?null:a.createElement("div",{className:"error-message",role:"alert"},a.createElement(T.Attention,null),a.createElement("span",null,this.props.t("course.announcements.errors.messages.messageRequired")))}render(){const e=this.getMode(),{permissions:t,courseContext:n,t:s,pluginConfig:i,fileUploadSettings:o}=this.props,{currentAnnouncement:l,isSaving:u,isValid:d,isSendEmailChecked:m,isScheduleChecked:g,isShowOnChecked:b,isEndChecked:S,startDate:E,startTime:y,endDate:v,endTime:A,isStartDateValid:f,isStartTimeValid:k,isEndDateValid:I,isEndTimeValid:N}=this.state,w=this.getTitle(l),x=(null==l?void 0:l.body.rawText)||"";return(t.viewUnposted||C.View===e)&&a.createElement("div",{className:"announcement-detail-panel"},C.View===e&&a.createElement("div",{className:"panel-wrap"},a.createElement("header",{className:"panel-header simple-header"},a.createElement("div",{className:"panel-titles-container"},a.createElement("span",{className:"panel-sub-title"},s(Object(U.r)("announcements.pageTitle",null==n?void 0:n.isOrganization))),a.createElement("div",{className:"editable-title-container black-header-contents"},a.createElement(c.AnalyticsIconButton,{className:"left-off-canvas-toggle menu-toggle  standard-button dark-background",title:s("base.menu"),"aria-label":s("base.menu"),analyticsId:"course.announcements.detailPanel.menu.button"},a.createElement(T.MainMenu,null)),a.createElement("h1",{className:"panel-title",title:w},w)))),a.createElement("section",{className:"panel-container panel-content"},a.createElement("div",{className:"body-text"},a.createElement(Q,{editor:{bbml:x,pluginConfig:i,isReadOnly:!0,isToolbarHidden:!0,showWordCount:!1,onChange:this.onMessageChange,placeholder:s("course.announcements.detail.messageDesc")},fileUploadSettings:o})))),this.isEditableMode(e)&&a.createElement("div",{className:"peek-panel-with-footer"},a.createElement("div",{className:"panel-wrap"},a.createElement("header",{className:"panel-header simple-header"},a.createElement("div",{className:"panel-titles-container"},a.createElement("span",{className:"panel-sub-title"},n&&n.displayName||""),a.createElement("div",{className:"editable-title-container black-header-contents"},a.createElement(c.AnalyticsIconButton,{className:"left-off-canvas-toggle menu-toggle standard-button dark-background",title:s("base.menu"),"aria-label":s("base.menu"),analyticsId:"course.announcements.detailPanel.menu.button"},a.createElement(T.MainMenu,null)),a.createElement("h1",{className:"panel-title",title:w},w)))),a.createElement("section",{className:"panel-container panel-content -has-footer"},a.createElement(h.TextField,{className:"label-decorator",label:s("course.announcements.detail.title"),value:D(this.state.title),onChanged:this.onTitleChange,placeholder:s("course.announcements.detail.titleDesc"),ref:e=>{this.titleTextField=e},onGetErrorMessage:this.onTitleErrorMessage,required:!0,analyticsId:"course.announcements.detailPanel.title.input.text"}),a.createElement(h.Dropdown,{label:s("course.announcements.detail.recipients"),defaultSelectedKey:"all",required:!0,options:[{key:"all",text:s(Object(U.r)("announcements.detail.allRecipients",null==n?void 0:n.isOrganization),{studentCount:n&&n.membershipCount||0})}],analyticsId:"course.announcements.detailPanel.recipients.dropdown"}),a.createElement("div",{className:"panel-content__field"},a.createElement(h.Label,{className:"panel-content__field__label",id:"announcement-bb-editor-label",required:!0},s("course.announcements.detail.message")),a.createElement("div",{className:Object(r.a)("panel-content__message",{"-invalid":!this.isEditorInputValid})},a.createElement(Q,{editor:{bbml:x,pluginConfig:i,ariaLabelledBy:"announcement-bb-editor-label",ariaRequired:!0,isReadOnly:!1,isToolbarHidden:!1,onChange:this.onMessageChange,placeholder:s("course.announcements.detail.messageDesc"),showWordCount:!0},fileUploadSettings:o})),this.renderBbEditorErrorMessage()),a.createElement("div",null,a.createElement(Y.AnalyticsFormControlLabel,{label:s("course.announcements.button.email"),disabled:g,htmlFor:"send-email-checkbox",className:"announcement-checkbox",control:a.createElement(Y.AnalyticsCheckbox,{id:"send-email-checkbox",checked:m,onChange:this.onSendEmailChange,"aria-describedby":"email-checkbox-desc",analyticsId:"course.announcements.detailPanel.sendEmail.input.checkbox"}),"aria-describedby":"email-checkbox-desc",analyticsId:"course.announcements.detailPanel.sendEmail.input.label"}),a.createElement("p",{className:"information-message",id:"email-checkbox-desc"},s("course.announcements.detail.emailDesc")),a.createElement("p",{className:"information-message",id:"email-checkbox-warning"},s("course.announcements.detail.emailRestriction"))),a.createElement("div",null,a.createElement(Y.AnalyticsFormControlLabel,{label:s("course.announcements.button.schedule"),disabled:m,htmlFor:"schedule-announcement-checkbox",className:"announcement-checkbox",control:a.createElement(Y.AnalyticsCheckbox,{id:"schedule-announcement-checkbox",checked:g,onChange:this.onScheduleChange,"aria-describedby":"email-info-checkbox-desc",analyticsId:"course.announcements.detailPanel.scheduleAnnouncement.input.checkbox"}),"aria-describedby":"email-info-checkbox-desc",analyticsId:"course.announcements.detailPanel.scheduleAnnouncement.input.label"}),a.createElement("p",{className:"information-message",id:"email-info-checkbox-desc"},s("course.announcements.detail.scheduleEmailInfo")),g&&!m&&a.createElement("div",null,a.createElement("div",null,a.createElement(Y.AnalyticsFormControlLabel,{label:s("course.announcements.dateTimePicker.showOn"),disabled:m,htmlFor:"show-on-checkbox",className:"announcement-checkbox",control:a.createElement(Y.AnalyticsCheckbox,{id:"show-on-checkbox",checked:b,onChange:this.onShowOnChange,analyticsId:"course.announcements.detailPanel.showOn.input.checkbox"}),analyticsId:"course.announcements.detailPanel.showOn.input.label"}),a.createElement("div",{className:"row collapse date-time-inputs"},a.createElement("div",{className:"columns small-6"},a.createElement(G,{value:E,disabled:m,onChangeValue:e=>{this.setState({startDate:e})},onValidateCallback:e=>{this.setState({isStartDateValid:e})},onDateTimeChanging:e=>{this.setState({onDateTimeChangingPromise:e})},isValueValid:f||!b||m,errorFormatMessage:s("components.directives.validation.messages.errors.date"),errorEmptyMessage:s("components.directives.content-visibility.startDateError"),analyticsId:"course.announcements.detailPanel.showOn.datePicker"})),a.createElement("div",{className:"columns small-6"},a.createElement(P.W,{value:y,disabled:m,onChangeValue:e=>{this.setState({startTime:e})},onValidateCallback:e=>{this.setState({isStartTimeValid:e})},isValueValid:k||!b||m,onDateTimeChanging:e=>{this.setState({onDateTimeChangingPromise:e})},errorFormatMessage:s("components.directives.validation.messages.errors.time"),errorEmptyMessage:s("components.directives.content-visibility.startTimeError"),analyticsId:"course.announcements.detailPanel.showOn.timePicker"})))),a.createElement("div",null,a.createElement(Y.AnalyticsFormControlLabel,{label:s("course.announcements.dateTimePicker.hideOn"),htmlFor:"hide-on-checkbox",className:"announcement-checkbox",control:a.createElement(Y.AnalyticsCheckbox,{id:"hide-on-checkbox",checked:S,onChange:this.onHideOnChange,analyticsId:"course.announcements.detailPanel.hideOn.input.checkbox"}),analyticsId:"course.announcements.detailPanel.hideOn.input.label"}),a.createElement("div",{className:"row collapse date-time-inputs"},a.createElement("div",{className:"columns small-6"},a.createElement(G,{value:v,onChangeValue:e=>{this.setState({endDate:e})},onValidateCallback:e=>{this.setState({isEndDateValid:e})},onDateTimeChanging:e=>{this.setState({onDateTimeChangingPromise:e})},isValueValid:I||!S,disabled:!S,errorFormatMessage:s("components.directives.validation.messages.errors.date"),errorEmptyMessage:s("components.directives.content-visibility.endDateError"),analyticsId:"course.announcements.detailPanel.hideOn.datePicker"})),a.createElement("div",{className:"columns small-6"},a.createElement(P.W,{value:A,onChangeValue:e=>{this.setState({endTime:e})},onValidateCallback:e=>{this.setState({isEndTimeValid:e})},isValueValid:N||!S,disabled:!S,onDateTimeChanging:e=>{this.setState({onDateTimeChangingPromise:e})},errorFormatMessage:s("components.directives.validation.messages.errors.time"),errorEmptyMessage:s("components.directives.content-visibility.endTimeError"),analyticsId:"course.announcements.detailPanel.hideOn.timePicker"})))),!this.isEndLaterThanStart()&&a.createElement("span",{className:"error-message"},a.createElement(T.Attention,null),s("course.announcements.errors.messages.hideOnShouldLaterThanShowOn")))))),a.createElement("footer",{className:"panel-footer"},a.createElement("span",{className:"place-holder"}),a.createElement(p.AnalyticsDefaultButton,{className:"button-cancel",onClick:this.onCancel,analyticsId:"course.announcements.detailPanel.cancel.button"},s("course.announcements.button.cancel")),a.createElement(p.AnalyticsPrimaryButton,{className:"button-save",disabled:!(d&&this.validateSchedule()&&this.isEndLaterThanStart()),onClick:this.onSave,analyticsId:"course.announcements.detailPanel.save.button"},s("course.announcements.button.save")))),u?a.createElement("div",{className:"spinner bb-secondary-color-2"}):"")}}var te=Object(o.b)((e=>({announcements:e.announcement.announcements,courseContext:e.announcement.courseContext,announcement:e.announcement.announcement,detailPanelState:e.announcement.detailPanelState,fileUploadSettings:W.gc.fileUploadSettings.getFileUploadSettings(e)})),(e=>Object(_.b)({saveAnnouncement:W.X.announcement.saveAnnouncement,getCourseContext:W.X.announcement.getCourseContext,getAnnouncement:W.X.announcement.getAnnouncement,changeAnnouncementPanelState:W.X.announcement.changeAnnouncementPanelState},e)))(Object(l.a)(ee)),ne=n("gh1U");class se extends a.Component{constructor(e){super(e),this.onOpenAllAnnouncements=()=>{const{onOpenAllAnnouncements:e}=this.props;e(),this.onDismissAll()},this.openAnnouncementDetail=e=>{const{openAnnouncementDetail:t}=this.props;t(e),this.onDismissAll()},this.onDismissAll=()=>{this.announcementSlides.forEach((e=>this.props.dismissAnnouncementItem(e.sourceEntry))),this.onCloseSlideModal()},this.updateContext=()=>{const{currentViewingIndex:e,currentAnnouncement:t}=this.state,{courseContext:n,getCourseContext:s}=this.props;t&&t.courseId&&e>=0&&(n&&n.courseId===t.courseId||s(t.courseId))},this.onCloseSlideModal=()=>{this.setState({showModal:!1})},this.state={currentAnnouncement:null,currentViewingIndex:-1,showModal:!1}}componentDidMount(){this.props.fetchAnnouncementSlides().then((e=>{e.sort((function(e,t){return e.startDateRestriction&&t.startDateRestriction?e.startDateRestriction.toISOString().localeCompare(t.startDateRestriction.toISOString()):0})),this.announcementSlides=e.slice(),this.announcementSlides.length>0&&this.setState({currentViewingIndex:0,currentAnnouncement:{...this.announcementSlides[0]},showModal:!0},this.updateContext),this.elementCards=this.announcementSlides.map((e=>{var t;return a.createElement("li",{className:"element-card",key:e.id},a.createElement("div",{className:"element-image"},a.createElement(I.a,{color:"primary"})),a.createElement("div",{className:"element-details"},a.createElement("div",{className:"name"},a.createElement("a",{className:"rows-block header-title",onClick:()=>{this.openAnnouncementDetail(e.id)},href:"#"},D(e.title)),a.createElement("span",{className:"rows-block header-sent-date"},y(null===(t=e.startDateRestriction)||void 0===t?void 0:t.toISOString(),this.props.localize))),a.createElement("br",null),a.createElement("div",{className:"rows-block body-text message-entries"},a.createElement("p",null,A(e.body.rawText,this.props.localize)))))}))}))}render(){const{localize:e,courseContext:t}=this.props;return a.createElement(ne.Modal,{isOpen:this.state.showModal,containerClassName:"ms-modalExample-container container-inherit"},a.createElement("div",{className:"notice notification "+this.props.courseColorClass+" reveal-modal course-announcements-slide open in"},a.createElement("div",{className:"title-container"},a.createElement("h1",{className:"title-modal"},e.translate(Object(U.r)("announcements.newCourseAnnouncements",null==t?void 0:t.isOrganization))),a.createElement(c.AnalyticsIconButton,{"aria-label":e.translate("course.announcements.closeModal"),className:"close-modal-button",onClick:this.onDismissAll,analyticsId:"course.announcements.modal.close.button"},a.createElement(T.Close,null))),a.createElement("div",{className:"modal-contents"},a.createElement("ul",{className:"modal-notifications"},this.elementCards)),a.createElement("div",{className:"announcement-modal-footer"},a.createElement(p.AnalyticsPrimaryButton,{onClick:this.onOpenAllAnnouncements,className:"view-all-announcements-button",analyticsId:"course.announcements.slide.view.all.button"},e.translate("course.announcements.button.viewAll")))))}}var ae=Object(o.b)((e=>({courseContext:e.announcement.courseContext})),(e=>Object(_.b)({getCourseContext:W.X.announcement.getCourseContext},e)))(Object(m.a)(se)),ie=n("Uhei");n.d(t,"a",(function(){return C}));const oe=(e,t,n,s,o,r)=>{let c=n;null==n&&"undefined"!=typeof window&&window.location.search.match("setLang=")&&(c=window.location.search.match(/setLang=([^$&]+)/)[1]),i.render(a.createElement(Y.AnalyticsJssThemeProvider,{theme:"light",isRtl:r},a.createElement(ie.a,{locale:c,babelfishInstance:s,babelfishFormatInstance:o,bundlesToLoad:["announcements/locales/[locale]/announcements.json"],isRtl:r},a.createElement("div",null,e))),t)},re={renderAnnouncementListPanel:(e,t,n,s,i,r,c,l,u)=>{oe(a.createElement(o.a,{store:t},a.createElement(X,{courseId:c,permissions:l,root:e,openAnnouncementDetailPanel:u})),e,n,s,i,r)},destroyAnnouncementListPanel:e=>{i.unmountComponentAtNode(e)},renderAnnouncementDetailPanel:(e,t,n,s,i,r,c,l,u,d,m,h)=>{oe(a.createElement(o.a,{store:t},a.createElement(te,{courseId:c,announcementId:l,permissions:u,mode:d,closePanel:m,pluginConfig:h})),e,n,s,i,r)},destroyAnnouncementDetailPanel:e=>{i.unmountComponentAtNode(e)},renderAnnouncementSlide:(e,t,n,s,i,r,c,l,u,d,m)=>{oe(a.createElement(o.a,{store:t},a.createElement(ae,{courseColorClass:c,fetchAnnouncementSlides:l,dismissAnnouncementItem:m,onOpenAllAnnouncements:u,openAnnouncementDetail:d})),e,n,s,i,r)},destroyAnnouncementSlide:e=>{i.unmountComponentAtNode(e)}};t.b=re}}]);