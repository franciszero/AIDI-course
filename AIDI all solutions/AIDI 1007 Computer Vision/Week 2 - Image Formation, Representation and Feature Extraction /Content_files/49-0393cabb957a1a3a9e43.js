(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{WyD7:function(e,t,o){"use strict";o.d(t,"a",(function(){return s}));var i=o("zYa8"),n=o("ECG1");const s="ultra.components.directives.bbUiIcon.small.Information";Object(i.a)(n.a,s,"bbUiIconSmallInformation")},X8JP:function(e,t,o){"use strict";o.d(t,"a",(function(){return a})),o.d(t,"b",(function(){return c}));var i=o("Vsv2"),n=o("pjml"),s=o("0JpG");const a="ultraUi.components.services.cloudDrive.rteCloudStorageIntegrationModal",c="RteCloudStorageIntegrationService";class r{constructor(e,t,o,i){this.$q=e,this.cloudDriveService=t,this.CloudDriveModel=o,this.bbLocalize=i}initialize(){return this.cloudDriveService.isCloudServiceAvailable().then((e=>this.isCloudServiceAvailable=e))}openFilePicker(e){const t=this.bbLocalize.getLocale(e);return this.cloudDriveService.cloudDriveStorage.openFilePicker(t,!0).then((e=>{if(e){const t=[];return e.forEach((o=>{const i=(e=>e.account+"|"+e.id)(o),n=this.CloudDriveModel.$new("CloudStorageIntegration").contents.$new(i).$fetch({accessToken:e[0].bearer_token.key}).$asPromise();t.push(n)})),this.$q.all(t).then((t=>t.map((t=>({id:t.id,cloudStorageIntegrationAccessToken:e[0].bearer_token.key,name:t.name,size:t.size,type:t.type,updatedTime:t.updatedTime,webLocation:t.webLocation})))))}return this.$q.reject()}))}getModalCallback(e){return()=>this.cloudDriveService.cloudDriveStorage?this.openFilePicker(e):this.cloudDriveService.initializeCloudDrive().then((()=>this.openFilePicker(e)))}}r.$inject=["$q",i.b,n.h.serviceName,s.serviceName],angular.module(a,[i.a]).service(c,r)},bDYn:function(e,t,o){"use strict";o.d(t,"a",(function(){return s}));var i=o("Llzl"),n=o("0JpG");const s="ultra.components.directives.bbUsernames";class a{constructor(e){this.bbLocalize=e,this.scope={users:"=",maxUser:"=?",autoUpdate:"&?",moreClickable:"&?"},this.restrict="AE",this.link=(e,t,o)=>{t.addClass("usernames");let i=e.maxUser;const s=o.format?this.bbLocalize.getFormatId(n.ILocaleUsernameFormat,o.format):n.ILocaleUsernameFormat.Short;let a=!1;const c=()=>{const o=e.users;let n={};e.moreClickable&&!0===e.moreClickable()&&(n={moreClickable:e.moreClickable(),userNameFormat:s}),this.bbLocalize.formatUsernameList(o,i,e,n).then((o=>{a?(o=o+'<br><a class="close-more-info" tabindex="0" role="link">'+this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(e),key:"global.close"})+"</a>",t.html(o)):t.html(o)})).then((()=>{const n=t.find(".click-more").on("click",(()=>{i=o.length,a=!0,c()})),s=t.find(".close-more-info").on("click",(()=>{i=e.maxUser,a=!1,c()}));t.find(".click-more").attr({tabindex:"0",role:"link"}),i=e.maxUser,a=!1,e.$on("destroy",(()=>{t.find(".click-more").off(n),t.find(".close-more-info").off(s),a=!1}))}))},r=e.$watchCollection("users",(()=>{const t=e.users;t&&0!==t.length&&(c(),e.autoUpdate&&e.autoUpdate()||r())}))}}}a.$inject=[n.serviceName],i.module(s,[n.moduleName]).directive("bbUsernames",["$injector",e=>e.instantiate(a)])},"bbg+":function(e,t,o){"use strict";o.d(t,"a",(function(){return a})),o.d(t,"b",(function(){return c}));var i=o("D57K"),n=o("0JpG"),s=o("aHpC");const a="ultra.services.nameFormat",c="nameFormatService";let r=class{constructor(e){this.localize=e}formatSelfFullName(e,t,o){return this.formatSelfName(o,"components.services.name-format.fullNameWithSelfCallout",e,t)}formatSelfGivenName(e,t){return this.formatSelfName(t,"components.services.name-format.givenNameWithSelfCallout",e)}formatSelfWithoutName(e){return this.formatSelfName(e,"components.services.name-format.selfCallout")}formatSelfName(e,t,o,i){return this.localize.translateSync({locale:e,key:t,noWrap:!0,params:{givenName:o,familyName:i},noEscape:!0})}};r=Object(i.a)([Object(i.c)(0,Object(s.b)(n.serviceName))],r);angular.module(a,[n.moduleName]).service(c,r)},jbaE:function(e,t,o){"use strict";(function(e){o.d(t,"a",(function(){return j}));var i=o("D57K"),n=(o("ph44"),o("vhkR")),s=o("cs5G"),a=o("Llzl"),c=o("Fvsw"),r=o("Qbdf"),l=o("0JpG"),d=o("X8JP"),h=o("9hVN"),u=o("TnpK"),b=o("ohO4"),p=o("jx5I"),m=o("5MwF"),f=o("ERsv"),v=o("Q/M7"),g=o("pjml"),$=o("Y+9S"),O=o("aHpC"),S=o("6PRJ");const j="ultraUi.components.directives.editor.richTextEditor";let C=class{constructor(e,t,o,i,n,s,a,c,r,l,d,h,u,b,p,m,f){this.$q=e,this.$scope=t,this.element=o,this.attrs=i,this.controllers=n,this.bbEditorFactory=s,this.bbLocalize=a,this.bbContext=c,this.ltiService=r,this.CloudStorageIntegrationModalService=l,this.ContentCollectionService=d,this.AnnotationsModel=h,this.contextCourse=u,this.allyService=b,this.ultraState=p,this.featureFlagService=m,this.fileUploadSettingsService=f;const v=this.$scope.$watch("pluginOptions",(e=>{e&&(v(),this.initEditor())}));this.reactAllyService=this.allyService.getReactService(this.$scope),t.$on("$destroy",(()=>{t.editor&&t.editor.destroy()}))}initEditor(){let e=null,t=!1,o=null;const i=this.controllers.ngModel,n=i.$setPristine.bind(i);i.$viewChangeListeners.push((()=>{t||n()})),i.$setPristine=()=>{n(),o&&o(i.$modelValue)};const s=e=>{this.$scope.editor&&this.$scope.editor.update(e)};this.$scope.$watch((()=>i.$modelValue),(t=>{t!==e&&s({bbml:t})})),this.$scope.$watchGroup(["isDisabled","isReadOnly","isToolbarHidden","allyIndexMap"],(([e,t,o,i])=>{this.$scope.editor&&s({isDisabled:e,isReadOnly:t,isToolbarHidden:o,ally:{service:this.reactAllyService,indexMap:i}})}));const a=(e,t)=>void 0!==e?e:t,c=e=>{this.$scope.fileLocation=e.data?e.data.fileLocation:e.fileLocation,this.$scope.webLocation=e.data?e.data.webLocation:e.webLocation},r=n=>{var s,a;t=n.isDirty,o=n.setPristine;const c=n.toBbML();e!==c&&(e=c,null===(a=(s=this.$scope).onChange)||void 0===a||a.call(s,n.toBbML),i.$setViewValue(c))},l={placeholderText:this.bbLocalize.translate({locale:this.bbLocalize.getLocale(this.$scope),key:this.$scope.placeholder})};this.$scope.pluginOptions&&this.$scope.pluginOptions.attachment&&(l.cloudStorageIntegration=this.CloudStorageIntegrationModalService.initialize()),l.inlineRenderFfEnabled=this.featureFlagService.createWaiter("feature.course.content.inline-render"),this.$q.all(l).then((e=>{const t=[Object(f.customClass)()],{locale:o,babelfishInstance:n,babelfishFormatter:s,isRtl:l}=this.bbLocalize.getReactBabelfishParams(this.$scope);if(this.$scope.pluginOptions){!1!==this.$scope.pluginOptions.link&&t.push(Object(f.link)()),!1!==this.$scope.pluginOptions.image&&t.push(Object(f.image)()),!1!==this.$scope.pluginOptions.video&&t.push(Object(f.video)()),this.$scope.pluginOptions.math&&t.push(Object(f.math)({apiBasePath:Object(v.c)(m.a.apiBasePath),courseId:this.contextCourse.courseId,xsrfToken:this.bbContext.xsrfToken,locale:o})),this.$scope.pluginOptions.attachment&&t.push(Object(f.insertLocalFile)({apiBasePath:Object(v.c)(m.a.apiBasePath),xsrfToken:this.bbContext.xsrfToken,webLocation:this.$scope.webLocation||"",fileLocation:this.$scope.fileLocation||"",onUploadSuccess:c,buttonId:Object($.m)()?"insertFile":"",supportsInlineDocumentRender:this.$scope.supportsInlineDocumentRender&&e.inlineRenderFfEnabled,fileUploadSettings:this.fileUploadSettingsService.getSettings(),onNewAttachmentSavePressed:this.$scope.onNewAttachmentSavePressed,courseId:this.contextCourse.courseId}));let i=!0;!1===this.$scope.pluginOptions.youtubeVideo&&(i=!1),i&&t.push(Object(f.insertYoutubeVideo)({apiBasePath:Object(v.c)(m.a.apiBasePath),getEmbedSrc:this.ltiService.configureAndInitInlineLaunch.bind(this.ltiService),xsrfToken:this.bbContext.xsrfToken,courseId:this.contextCourse.courseId})),this.$scope.pluginOptions.demoMashup&&t.push(Object(f.demoMashup)()),this.$scope.pluginOptions.attachment&&this.CloudStorageIntegrationModalService.isCloudServiceAvailable&&!Object($.m)()&&t.push(Object(f.insertCloudStorageIntegrationFile)({openCloudStorageIntegrationModal:this.CloudStorageIntegrationModalService.getModalCallback(this.$scope),apiBasePath:Object(v.c)(m.a.apiBasePath),xsrfToken:this.bbContext.xsrfToken,webLocation:this.$scope.webLocation||"",fileLocation:this.$scope.fileLocation||"",fileUploadSettings:this.fileUploadSettingsService.getSettings(),onNewAttachmentSavePressed:this.$scope.onNewAttachmentSavePressed})),this.$scope.pluginOptions.contentCollection&&t.push(Object(f.contentCollection)({getOpenContentCollectionFunction:this.ContentCollectionService.getOpenContentCollectionFunction(this.$scope)})),this.$scope.pluginOptions.contentMarket&&t.push(Object(f.contentMarket)({apiBasePath:Object(v.c)(m.a.apiBasePath),getEmbedSrc:this.ltiService.configureAndInitInlineLaunch.bind(this.ltiService),noInsert:this.$scope.contentMarketIsReadOnly,openContentMarket:this.ltiService.getOpenContentMarketConf(this.$scope),xsrfToken:this.bbContext.xsrfToken}))}let d=this.$scope.rootContentId;!d&&this.ultraState&&this.ultraState.getCurrentResolvedValues&&this.ultraState.getCurrentResolvedValues().currentContent&&(d=this.ultraState.getCurrentResolvedValues().currentContent.id);const h={bbml:i.$modelValue||"",isDisabled:a(this.$scope.isDisabled,!1),isReadOnly:a(this.$scope.isReadOnly,!1),isToolbarHidden:a(this.$scope.isToolbarHidden,!1),isRtl:l,locale:o,expandInlineFilesOnLoad:this.$scope.expandInlineFilesOnLoad,supportsInlineDocumentRender:this.$scope.supportsInlineDocumentRender&&e.inlineRenderFfEnabled,babelfishInstance:n,babelfishFormatInstance:s,onChange:r,placeholder:e.placeholderText,plugins:t,editorId:this.$scope.editorId,ariaLabelledBy:this.$scope.editorAriaLabelledBy,ariaDescribedBy:this.$scope.editorAriaDescribedBy,showWordCount:this.$scope.showWordCount,ally:{service:this.reactAllyService,indexMap:this.$scope.allyIndexMap||new Map},rootContentId:d,...this.$scope.onFocus?{onFocus:()=>this.$scope.$applyAsync(this.$scope.onFocus)}:null,...this.$scope.onBlur?{onBlur:()=>this.$scope.$applyAsync(this.$scope.onBlur)}:null,...m.a.unitTesting?{mockLocalize:Object(S.a)()}:null};this.$scope.onBlur&&i.$setTouched(),this.$scope.editor=this.bbEditorFactory(this.element[0],h)}))}getOnDownloadWithAnnotations(){return t=>{const o=!!t.groupAttemptFileId,i=t.attemptFileId||t.groupAttemptFileId,n={systemInfo:this.bbContext.getSystemInfo().$asPromise(),annotations:this.AnnotationsModel.downloadWithAnnotations(i,o,this.contextCourse.courseId).$asPromise()};return this.$q.all(n).then((t=>{const o=t.systemInfo.annotationRendererUrl;if(!(o&&o.length>0))throw new Error("Annotation Service url is not defined.");{const i=e("#annotationIframe");null!==i&&i.remove();const n=e("#annotationForm");null!==n&&n.remove();const s=e(document.createElement("iframe"));s.attr("src","about:blank"),s.attr("id","annotationIframe"),s.attr("name","annotationIframe"),s.css("display","none");const a=e(document.createElement("form"));a.attr("target","annotationIframe"),a.attr("method","POST"),a.attr("action",o+"/annotation/token"),a.attr("id","annotationForm"),a.attr("name","annotationForm");const c=e(document.createElement("input"));c.attr("type","hidden"),c.attr("name","jwt"),c.attr("value",t.annotations.jwt),c.appendTo(a);const r=e("body");a.appendTo(r),s.appendTo(r),a.submit()}}))}}};C=Object(i.a)([Object(i.c)(0,Object(O.b)("$q")),Object(i.c)(1,Object(O.b)("scope")),Object(i.c)(2,Object(O.b)("element")),Object(i.c)(3,Object(O.b)("attrs")),Object(i.c)(4,Object(O.b)("controllers")),Object(i.c)(5,Object(O.b)("BbEditorFactory")),Object(i.c)(6,Object(O.b)(l.serviceName)),Object(i.c)(7,Object(O.b)(c.b)),Object(i.c)(8,Object(O.b)(n.b)),Object(i.c)(9,Object(O.b)(d.b)),Object(i.c)(10,Object(O.b)(h.b)),Object(i.c)(11,Object(O.b)(g.c.serviceName)),Object(i.c)(12,Object(O.b)(r.e)),Object(i.c)(13,Object(O.b)(s.b)),Object(i.c)(14,Object(O.b)(u.d)),Object(i.c)(15,Object(O.b)(b.b)),Object(i.c)(16,Object(O.b)(p.b))],C);class y{constructor(e){this.$injector=e,this.link=(e,t,o,i)=>{t.addClass("rich-text-editor"),e.richTextEditor=this.$injector.instantiate(C,{scope:e,element:t,attrs:o,controllers:i})},this.require={ngModel:"ngModel"},this.restrict="E",this.scope={contentMarketIsReadOnly:"<?",fileLocation:"=?",isDisabled:"<?",isReadOnly:"<?",isToolbarHidden:"<?",onChange:"<?",onBlur:"&?",onNewAttachmentSavePressed:"&?",onFocus:"&?",placeholder:"@?editorPlaceholderKey",pluginOptions:"<?",webLocation:"=?",editorId:"@?",editorAriaLabelledBy:"@?",editorAriaDescribedBy:"@?",showWordCount:"<?",allyIndexMap:"=?",rootContentId:"@?",expandInlineFilesOnLoad:"<?",supportsInlineDocumentRender:"<?"}}}y.$inject=["$injector"],a.module(j,[l.moduleName,c.a,d.a,h.a,n.a,s.a,p.a]).value("BbEditorFactory",f.BbEditorFactory).directive("bbRichTextEditor",["$injector",e=>e.instantiate(y)])}).call(this,o("71td"))},"kk+D":function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var i=o("IbyE");function n(e,t,o){const n=i.Yb.systemPreference.getSystemPreferenceByKey(e,t);if(!n||!n.value)return o;switch(n.value.toLowerCase()){case"true":return"boolean"==typeof o||n.value;case"false":return"boolean"!=typeof o&&n.value;default:return n.value}}},ph44:function(e,t,o){},smDF:function(e,t,o){var i=o("ziER"),n=o("5JeM"),s=new i({id:"icon-medium-add-circle",use:"icon-medium-add-circle-usage",viewBox:"0 0 24 24",content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="icon-medium-add-circle"><circle cx="12" cy="12" r="11" stroke-width="2" /><path d="M12 7v10M7 12h10" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></symbol>'});n.add(s);e.exports=s}}]);